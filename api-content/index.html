{"posts":[{"title":"ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäº”ï¼‰ï¼šä½¿ç”¨ certd å…è´¹ç‰ˆé…ç½®æ³›åŸŸåè¯ä¹¦","content":"åŸæœ¬ã€Šç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—å‰å››ç¯‡æ–‡ç« å·²ç»å¤Ÿç”¨äº†ï¼Œæœ¬ç³»åˆ—ä¸­çš„ NAS æœåŠ¡ä¸ä¼šå¼€æ”¾åˆ°å…¬ç½‘ä¸Šï¼Œhttps æœ¬æ¥æ˜¯å¯æœ‰å¯æ— çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœä½ å’Œæœ¬ç«™ä¸€æ ·ä½¿ç”¨äº† .dev åŸŸï¼Œé‚£ä¹ˆä½ è‚¯å®šä¹Ÿä¼šé‡åˆ°å’Œæˆ‘ä¸€æ ·çš„é—®é¢˜ï¼šåªç”¨ http æ— æ³•è®¿é—®æœåŠ¡ï¼Œæµè§ˆå™¨ä¼šå¼ºåˆ¶ä½¿ç”¨ HTTPSã€‚ è¿™ä¸ªé—®é¢˜çš„èƒŒæ™¯æ˜¯ï¼š .dev æ˜¯ä¸€ä¸ªæ­£å¼çš„é€šç”¨é¡¶çº§åŸŸï¼ˆgTLDï¼‰ï¼Œç”± Googleï¼ˆCharleston Road Registry / Google Registryï¼‰è¿è¥ã€‚ æ•´ä¸ª .dev è¢«æ”¾åˆ° HSTS preload åˆ—è¡¨é‡Œï¼Œä¸»æµæµè§ˆå™¨ä¼šæŠŠå¯¹ .dev çš„è¯·æ±‚å½“ä½œå¿…é¡»èµ° HTTPS çš„ç«™ç‚¹å¤„ç†â€”â€”å¦‚æœæ²¡æœ‰æœ‰æ•ˆ TLSï¼Œæµè§ˆå™¨ä¼šæ‹’ç»/å‡çº§è¿æ¥ï¼Œå¯¼è‡´æ— æ³•é€šè¿‡ http://yourname.dev æ­£å¸¸æ‰“å¼€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨ .dev å‘å¸ƒç«™ç‚¹æ—¶å¿…é¡»é…ç½®æœ‰æ•ˆçš„è¯ä¹¦ï¼ˆLetâ€™s Encrypt ç­‰éƒ½å¯ç”¨ï¼‰ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ¬ç¯‡æ–‡ç« è¯ç”Ÿäº†ï¼šæœ¬æ–‡å°†æ•™ä¼šä½ å¦‚ä½•é€šè¿‡ certd è¿™ä¸ªå¼€æºé¡¹ç›®ç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼Œå¹¶é€šè¿‡æµæ°´çº¿å®šæ—¶è§¦å‘ + è„šæœ¬å¯¼å…¥å®ç°å…¨è‡ªåŠ¨æ›´æ–°ï¼Œä»¥ä¾¿åœ¨ DSM é¢æ¿å’Œ NAS ä¸Šçš„æœåŠ¡éƒ½èƒ½å®‰å…¨è®¿é—®ã€‚ æœ¬æ–‡ä¸ºã€Šç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬äº”ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½® DDNS ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½® WireGuard ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½® Nginx è®¿é—® Docker æœåŠ¡ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäº”ï¼‰ï¼šä½¿ç”¨ certd å…è´¹ç‰ˆé…ç½®æ³›åŸŸåè¯ä¹¦ æ–¹æ¡ˆæ¦‚è§ˆ è¿™å¥—æ–¹æ¡ˆçš„æ ¸å¿ƒæ€è·¯å¾ˆç®€å•ï¼š ç”¨ certd å…è´¹ç‰ˆé€šè¿‡ DNS-01 éªŒè¯ç”³è¯·æ³›åŸŸåè¯ä¹¦ã€‚ åœ¨æµæ°´çº¿é‡ŒæŠŠè¯ä¹¦å†™å…¥å›ºå®šè·¯å¾„ï¼Œå†ç”¨è„šæœ¬è‡ªåŠ¨å¯¼å…¥ DSMã€‚ é…ç½®æµæ°´çº¿å®šæ—¶è§¦å‘ï¼Œè¯ä¹¦åˆ°æœŸå‰è‡ªåŠ¨ç»­æœŸå¹¶è‡ªåŠ¨å¯¼å…¥ï¼Œå®ç°å…¨è‡ªåŠ¨ç»´æŠ¤ã€‚ å‰ç½®æ¡ä»¶ ä½ å·²æŒ‰å‰å››ç¯‡å®Œæˆ DDNSã€WireGuardã€Nginx ç­‰é…ç½®ã€‚ åŸŸåæ‰˜ç®¡åœ¨è…¾è®¯äº‘ï¼Œå¹¶ä¸”èƒ½ä½¿ç”¨ API å¯†é’¥æ“ä½œ DNS è§£æã€‚ ç¾¤æ™–å·²å®‰è£… Container Managerï¼ˆæˆ– Docker å¥—ä»¶ï¼‰ï¼Œå¯ä»¥è¿è¡Œå®¹å™¨ã€‚ å…ˆåœ¨å¥—ä»¶ä¸­å¿ƒå®‰è£… Python3 å¥—ä»¶ï¼Œè„šæœ¬ä¼šç”¨ python3ï¼ˆæˆ– pythonï¼‰è§£æ DSM è¿”å›çš„æ•°æ®ã€‚ å‡†å¤‡ä¸€ä¸ªä¸»åŸŸåï¼Œæ”¯æŒ *.example.com æ³›åŸŸåè¯ä¹¦ã€‚ åœ¨ç¾¤æ™–éƒ¨ç½² certd certd å®˜æ–¹æä¾›äº† Docker éƒ¨ç½²æ–¹å¼ï¼Œç¾¤æ™–ä¸Šç›´æ¥ç”¨ Container Manager å³å¯ã€‚ æ‰“å¼€ Container Managerï¼Œæ–°å¢é¡¹ç›®ï¼Œé€‰æ‹© docker-compose.yamlã€‚ å»ºè®®ä½¿ç”¨ä¸‹é¢çš„ç²¾ç®€é…ç½®ï¼Œå¹¶æŠŠæ•°æ®ç›®å½•æ”¹æˆä½ è‡ªå·±çš„å·è·¯å¾„ã€‚ version: &quot;3.3&quot; services: certd: image: registry.cn-shenzhen.aliyuncs.com/handsfree/certd:latest container_name: certd restart: unless-stopped volumes: - /volume1/docker/certd:/app/data:delegated ports: - &quot;7001:7001&quot; - &quot;7002:7002&quot; environment: - TZ=Asia/Shanghai - certd_koa_hostname=0.0.0.0 éƒ¨ç½²å®Œæˆåè®¿é—® http://ç¾¤æ™– IP:7001ï¼Œä½¿ç”¨é»˜è®¤è´¦å· admin/123456 ç™»å½•ï¼Œå¹¶ç¬¬ä¸€æ—¶é—´ä¿®æ”¹å¯†ç ã€‚ åœ¨ certd ä¸­ç”³è¯·æ³›åŸŸåè¯ä¹¦ 1. æ·»åŠ è…¾è®¯äº‘æˆæƒ è¿›å…¥ certd çš„æˆæƒç®¡ç†ï¼Œæ–°å¢è…¾è®¯äº‘æˆæƒï¼Œå¡«å†™ SecretId å’Œ SecretKeyã€‚ è¿™ä¸¤ä¸ªå€¼å¯ä»¥å¤ç”¨ä½ åœ¨ DDNS é…ç½®æ—¶åˆ›å»ºçš„å¯†é’¥ã€‚ 2. åˆ›å»ºè¯ä¹¦ç”³è¯·æµæ°´çº¿ è¿›å…¥è¯ä¹¦æµæ°´çº¿ï¼Œæ–°å¢ â€œè¯ä¹¦ç”³è¯·ï¼ˆJS ç‰ˆï¼‰â€ï¼ŒæŒ‰ä¸‹é¢çš„æ–¹å¼å¡«å†™ï¼š åŸŸåéªŒè¯æ–¹å¼ï¼šDNS ç›´æ¥éªŒè¯ã€‚ è¯ä¹¦é¢å‘æœºæ„ï¼šé€‰æ‹© â€œLet's Encryptâ€ã€‚ DNS è§£ææœåŠ¡å•†ï¼šè…¾è®¯äº‘ã€‚ è¯ä¹¦åŸŸåï¼šå¡«å†™ä¸»åŸŸåå’Œæ³›åŸŸåï¼Œä¾‹å¦‚ example.com ä¸ *.example.comã€‚ æ›´æ–°å¤©æ•°ï¼šæŒ‰éœ€è®¾ç½®ï¼ˆé»˜è®¤å€¼ä»¥ç•Œé¢ä¸ºå‡†ï¼‰ï¼Œè¡¨ç¤ºè¯ä¹¦åˆ°æœŸå‰å¤šå°‘å¤©è§¦å‘æ›´æ–°ã€‚ ä¿å­˜åä¸éœ€è¦æ‰‹åŠ¨è¿è¡Œï¼Œåé¢è®¾ç½®å®šæ—¶è§¦å‘åä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ å¦‚æœä½ å¸Œæœ›å°½å¿«æ‹¿åˆ°è¯ä¹¦ï¼Œå¯ä»¥æŠŠå®šæ—¶è§¦å‘æ—¶é—´è®¾ç½®ä¸ºå½“å‰æ—¶é—´åå‡ åˆ†é’Ÿï¼Œè®©å®ƒè‡ªåŠ¨è·‘é¦–è½®ã€‚ å¦‚æœå¤±è´¥ï¼Œå¤šåŠæ˜¯ DNS ç”Ÿæ•ˆæ—¶é—´ä¸å¤Ÿã€‚å¯ä»¥åœ¨æµæ°´çº¿é‡ŒæŠŠ â€œç­‰å¾…è§£æç”Ÿæ•ˆæ—¶é•¿â€ é€‚å½“è°ƒå¤§ï¼Œå†è¯•ä¸€æ¬¡ã€‚ å°†è¯ä¹¦è¾“å‡ºåˆ°å›ºå®šè·¯å¾„ ä¸ºäº†è®©è„šæœ¬èƒ½æ‹¿åˆ°è¯ä¹¦æ–‡ä»¶ï¼Œéœ€è¦æŠŠè¯ä¹¦ä¿å­˜åˆ° NAS ä¸Šä¸€ä¸ªå›ºå®šç›®å½•ã€‚certd çš„æµæ°´çº¿é‡ŒåŠ ä¸€ä¸ªâ€œä¸»æœº - å¤åˆ¶åˆ°æœ¬æœºâ€ä»»åŠ¡å³å¯ã€‚ æ‰“å¼€å¯¹åº”æµæ°´çº¿ï¼Œæ–°å¢ä»»åŠ¡ â€œä¸»æœº - å¤åˆ¶åˆ°æœ¬æœºâ€ã€‚ è¯ä¹¦ç±»å‹é€‰æ‹© pemã€‚ è·¯å¾„å»ºè®®è¿™æ ·å¡«ï¼ˆç›¸å¯¹è·¯å¾„ä¼šå†™åˆ° /app/data ä¸‹ï¼‰ï¼š å…¨é“¾è¯ä¹¦ä¿å­˜è·¯å¾„ï¼štmp/fullchain.pem ç§é’¥ä¿å­˜è·¯å¾„ï¼štmp/private.key ä¸­é—´è¯ä¹¦ä¿å­˜è·¯å¾„ï¼štmp/intermediate.pem å› ä¸ºæˆ‘åœ¨ docker-compose.yaml é‡ŒæŠŠ /volume1/docker/certd æ˜ å°„åˆ°å®¹å™¨çš„ /app/dataï¼Œæ‰€ä»¥ä¸Šé¢ä¸‰ä¸ªæ–‡ä»¶æœ€ç»ˆä¼šè½åœ¨ï¼š /volume1/docker/certd/tmp/fullchain.pem /volume1/docker/certd/tmp/private.key /volume1/docker/certd/tmp/intermediate.pem ä½ å¯ä»¥æŒ‰è‡ªå·±çš„æ˜ å°„å…³ç³»è°ƒæ•´è·¯å¾„ï¼Œä½†è„šæœ¬é‡Œè¦ç”¨åŒä¸€å¥—è·¯å¾„ã€‚ ç”¨è„šæœ¬å¯¼å…¥è¯ä¹¦åˆ° DSM ï¼ˆå¯é€‰ï¼‰ä¸ºå¯ç”¨ 2FA çš„è´¦æˆ·è·å– device-id å¦‚æœä½ çš„ DSM è´¦æˆ·å¯ç”¨äº†ä¸¤æ­¥éªŒè¯ï¼ˆ2FAï¼‰ï¼Œéœ€è¦å…ˆè·å–ä¸€æ¬¡ device-idï¼Œåç»­å°±å¯ä»¥ç”¨å®ƒæ¥å… OTP ç™»å½•ã€‚ åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ï¼ˆæˆ–ä»»ä½•èƒ½è®¿é—® NAS å†…ç½‘çš„è®¾å¤‡ï¼‰ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼ˆè®°å¾—æ›¿æ¢å…¶ä¸­çš„å‚æ•°ï¼‰ï¼š curl -sS -k -G &quot;https://192.168.1.10:5001/webapi/entry.cgi&quot; \\ --data-urlencode &quot;api=SYNO.API.Auth&quot; \\ --data-urlencode &quot;version=6&quot; \\ --data-urlencode &quot;method=login&quot; \\ --data-urlencode &quot;format=sid&quot; \\ --data-urlencode &quot;account=admin&quot; \\ --data-urlencode &quot;passwd=your-password&quot; \\ --data-urlencode &quot;otp_code=123456&quot; \\ --data-urlencode &quot;device_name=certd&quot; \\ --data-urlencode &quot;enable_device_token=yes&quot; \\ --data-urlencode &quot;enable_syno_token=yes&quot; \\ | grep -oP '&quot;device_id&quot;\\s*:\\s*&quot;\\K[^&quot;]+' å‚æ•°è¯´æ˜ï¼š https://192.168.1.10:5001ï¼šä½ çš„ NAS å†…ç½‘åœ°å€å’Œç«¯å£ accountï¼šDSM ç®¡ç†å‘˜è´¦å· passwdï¼šDSM ç®¡ç†å‘˜å¯†ç  otp_codeï¼šä»ä½ çš„ä¸¤æ­¥éªŒè¯åº”ç”¨ï¼ˆå¦‚ Google Authenticatorï¼‰è·å–çš„ 6 ä½æ•°å­— device_nameï¼šè‡ªå®šä¹‰è®¾å¤‡åç§°ï¼Œç”¨äºåœ¨ DSM ä¸­æ ‡è¯†è¯¥è®¾å¤‡ï¼Œå»ºè®®å¡« certd å‘½ä»¤ä¼šè¾“å‡ºç±»ä¼¼ aBcD1234eFgH5678 è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œè¿™å°±æ˜¯ä½ çš„ device-idï¼Œè®°å½•ä¸‹æ¥ä¾›åç»­è„šæœ¬ä½¿ç”¨ã€‚ å¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥æˆ–æ²¡æœ‰è¾“å‡ºï¼Œå¯ä»¥æ£€æŸ¥ï¼š OTP ç æ˜¯å¦æ­£ç¡®ä¸”æœªè¿‡æœŸ ç½‘ç»œæ˜¯å¦èƒ½è®¿é—®åˆ° NAS è´¦å·å¯†ç æ˜¯å¦æ­£ç¡® å‡†å¤‡å¯¼å…¥è„šæœ¬ é¦–æ¬¡ä½¿ç”¨å‰ä¸éœ€è¦æ‰‹åŠ¨å‡†å¤‡è¯ä¹¦è®°å½•ã€‚æ‰§è¡Œè„šæœ¬æ—¶ä¼ å…¥ --cert-descï¼Œå¹¶åŠ ä¸Š --createï¼Œè„šæœ¬ä¼šåœ¨ DSM é‡Œæ‰¾ä¸åˆ°åŒåæè¿°æ—¶è‡ªåŠ¨åˆ›å»ºè¯ä¹¦è®°å½•å¹¶å¯¼å…¥è¯ä¹¦ã€‚ å¦‚æœä½ éœ€è¦æ‰‹åŠ¨æ’æŸ¥æˆ–éªŒè¯ï¼Œä¹Ÿå¯ä»¥åœ¨ DSM é‡Œèµ° â€œæ–°å¢ â†’ æ–°å¢æ–°è¯ä¹¦ â†’ å¯¼å…¥è¯ä¹¦â€ï¼Œå¯¼å…¥ä¸€æ¬¡åå†äº¤ç»™è„šæœ¬æ›´æ–°ã€‚ DSM è‡ªå¸¦çš„ Let's Encrypt éœ€è¦å…¬ç½‘ 80 ç«¯å£å¯è¾¾ï¼Œä¸”é€šå¸¸ä¸æ”¯æŒ DNS-01 ä¸æ³›åŸŸåï¼Œä¸é€‚åˆæœ¬æ–¹æ¡ˆã€‚ æŠŠä¸‹é¢è„šæœ¬ä¿å­˜åˆ° NAS ä¸Šï¼Œä¾‹å¦‚ /volume1/docker/certd/scripts/synology-import-cert.shï¼Œæ— éœ€ä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œæ‰€æœ‰é…ç½®éƒ½é€šè¿‡å‚æ•°ä¼ å…¥ã€‚ è¯¥è„šæœ¬åŒæ­¥ä¿å­˜åœ¨ Github ä¸Šï¼šsynology-import-cert.sh è„šæœ¬ä¿å­˜åˆ°æœ¬åœ°åèµ‹äºˆå…¶å¯æ‰§è¡Œæƒé™ï¼š chmod +x /volume1/docker/certd/scripts/synology-import-cert.sh è®©æµæ°´çº¿è‡ªåŠ¨æ‰§è¡Œè„šæœ¬ è¦åšåˆ°å…¨è‡ªåŠ¨ï¼Œéœ€è¦è®© certd åœ¨è¯ä¹¦æ›´æ–°åè‡ªåŠ¨æ‰§è¡Œè„šæœ¬ã€‚åšæ³•æ˜¯ç»™æµæ°´çº¿å¢åŠ ä¸€ä¸ª â€œä¸»æœº - æ‰§è¡Œè¿œç¨‹ä¸»æœºè„šæœ¬å‘½ä»¤â€ ä»»åŠ¡ã€‚ åœ¨ certd çš„ â€œæˆæƒç®¡ç†â€ é‡Œæ–°å¢ SSH æˆæƒï¼Œä¸»æœºå¡« NAS åœ°å€ï¼Œç«¯å£å¡«ä½ çš„ SSH ç«¯å£ï¼ˆå¯åœ¨ DSM çš„ â€œæ§åˆ¶é¢æ¿ â†’ ç»ˆç«¯æœºå’Œ SNMP â†’ ç»ˆç«¯æœºâ€ ä¸­æŸ¥çœ‹ï¼Œé»˜è®¤ä¸º 22ï¼‰ï¼Œè´¦å·ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ã€‚ å¦‚æœä½ ä¹‹å‰æ²¡å¼€ SSHï¼Œå¯ä»¥åœ¨ DSM çš„ â€œæ§åˆ¶é¢æ¿ â†’ ç»ˆç«¯æœºå’Œ SNMP â†’ ç»ˆç«¯æœºâ€ é‡Œå¼€å¯ã€‚ å›åˆ°è¯ä¹¦æµæ°´çº¿ï¼Œåœ¨ â€œä¸»æœº - å¤åˆ¶åˆ°æœ¬æœºâ€ ä¹‹åæ–°å¢ â€œä¸»æœº - æ‰§è¡Œè¿œç¨‹ä¸»æœºè„šæœ¬å‘½ä»¤â€ ä»»åŠ¡ã€‚ é€‰æ‹©åˆšæ‰çš„ SSH æˆæƒï¼Œè„šæœ¬å‘½ä»¤å¡«å†™ä¸‹é¢çš„å†…å®¹ï¼š å¦‚æœå¯ç”¨äº† 2FAï¼Œåˆ™åœ¨å‚æ•°ä¸Šå¸¦ä¸Šä¹‹å‰è·å–åˆ°çš„ device-id bash /volume1/docker/certd/scripts/synology-import-cert.sh \\ --base-url &quot;https://192.168.1.10:5001&quot; \\ --username &quot;admin&quot; \\ --password &quot;your-password&quot; \\ --cert-desc &quot;nas-wildcard&quot; \\ --fullchain &quot;/volume1/docker/certd/tmp/fullchain.pem&quot; \\ --key &quot;/volume1/docker/certd/tmp/private.key&quot; \\ --device-id &quot;your-device-id&quot; \\ --set-default \\ --assign-services &quot;all&quot; \\ --insecure \\ --create å‚æ•°è¯´æ˜ï¼š å¦‚æœ DSM è¯ä¹¦å°šæœªå¯ä¿¡æˆ–åŸŸåä¸åŒ¹é…ï¼Œè¯·ä¿ç•™ --insecure å‚æ•°ã€‚æºå¸¦è¯¥å‚æ•°åå°†è·³è¿‡ HTTPS è¯ä¹¦æ ¡éªŒï¼Œé¿å…é¦–æ¬¡æ¥å…¥æ—¶å› è‡ªç­¾è¯ä¹¦æˆ–åŸŸåä¸åŒ¹é…è€Œç™»å½•å¤±è´¥ã€‚ å¦‚æœä½ å¸Œæœ›ä¸€æ¬¡æ€§è¦†ç›–å…¨éƒ¨æœåŠ¡ï¼Œä¿ç•™ --assign-services allï¼›ä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“æœåŠ¡åç§°ï¼Œä¾‹å¦‚ &quot;DSM Desktop Service,Reverse Proxy&quot;ã€‚ é…ç½®å®Œæˆåï¼Œå¯ä»¥æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡æµæ°´çº¿æµ‹è¯•ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¯ä¹¦ä¼šè‡ªåŠ¨å¯¼å…¥åˆ° DSMã€‚è¿™æ ·æµæ°´çº¿æ¯æ¬¡æ‹¿åˆ°æ–°è¯ä¹¦åéƒ½ä¼šè‡ªåŠ¨æ›´æ–° DSMã€‚ é¦–æ¬¡è¿è¡ŒæˆåŠŸåï¼Œå»ºè®®ä¼˜åŒ–è„šæœ¬é…ç½®ï¼šå°† --base-url æ”¹ä¸ºä½ çš„åŸŸåï¼Œå¹¶å»æ‰ --insecure å‚æ•°ï¼Œè¿™æ ·å¯ä»¥æ­£å¸¸æ ¡éªŒ HTTPS è¯ä¹¦ï¼Œæ›´åŠ å®‰å…¨ï¼š bash /volume1/docker/certd/scripts/synology-import-cert.sh \\ --base-url &quot;https://nas.example.com:5001&quot; \\ --username &quot;admin&quot; \\ --password &quot;your-password&quot; \\ --cert-desc &quot;nas-wildcard&quot; \\ --fullchain &quot;/volume1/docker/certd/tmp/fullchain.pem&quot; \\ --key &quot;/volume1/docker/certd/tmp/private.key&quot; \\ --device-id &quot;your-device-id&quot; \\ --set-default \\ --assign-services &quot;all&quot; \\ --create é…ç½® Nginx ä½¿ç”¨ SSL è¯ä¹¦ ç°åœ¨è¯ä¹¦å·²ç»èƒ½é€šè¿‡ certd è‡ªåŠ¨ç®¡ç†äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦è®© Nginx ä½¿ç”¨è¿™äº›è¯ä¹¦æ¥æ”¯æŒ HTTPS è®¿é—®ã€‚æœ¬æ–‡å°†åŸºäº DSM è‡ªå¸¦çš„ Nginxï¼ˆå‚è€ƒç¬¬ä¸‰ç¯‡æ–‡ç« ï¼‰ã€‚ ä¿®æ”¹ Nginx é…ç½® DSM è‡ªå¸¦çš„ Nginx é…ç½®æ–‡ä»¶åœ¨ /etc/nginx/sites-enabled ç›®å½•ä¸‹ã€‚ å‡è®¾ä½ åœ¨ç¬¬ä¸‰ç¯‡æ–‡ç« ä¸­ä¸º calibre é…ç½®äº† calibre.example.com.confï¼Œç°åœ¨éœ€è¦ä¿®æ”¹å®ƒä»¥æ”¯æŒ HTTPSã€‚ ä½¿ç”¨ SSH è¿æ¥åˆ° NASï¼Œç¼–è¾‘å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼š sudo vim /etc/nginx/sites-enabled/calibre.example.com.conf å°†åŸæœ‰çš„é…ç½®æ”¹ä¸ºï¼š # HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS server { listen 80; server_name calibre.example.com; return 301 https://$server_name$request_uri; } # HTTPS é…ç½® server { listen 443 ssl; server_name calibre.example.com; # SSL è¯ä¹¦é…ç½® ssl_certificate /volume1/docker/certd/tmp/fullchain.pem; ssl_certificate_key /volume1/docker/certd/tmp/private.key; # SSL åè®®ä¸åŠ å¯†å¥—ä»¶ ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_set_header X-Forwarded-Proto $scheme; proxy_redirect off; proxy_pass http://172.17.0.1:8083; client_max_body_size 2000m; } } å…³é”®ä¿®æ”¹ç‚¹ï¼š æ–°å¢ 80 ç«¯å£çš„ server å—ï¼Œè‡ªåŠ¨è·³è½¬åˆ° HTTPS åŸæœ‰çš„ server å—æ”¹ä¸ºç›‘å¬ 443 ç«¯å£ï¼Œå¹¶å¯ç”¨ SSL ä½¿ç”¨ certd å¯¼å‡ºçš„è¯ä¹¦è·¯å¾„ï¼š/volume1/docker/certd/tmp/fullchain.pem å’Œ /volume1/docker/certd/tmp/private.key æ–°å¢ X-Forwarded-Proto headerï¼Œè®©åç«¯åº”ç”¨çŸ¥é“ä½¿ç”¨çš„æ˜¯ HTTPS é‡å¯ Nginx ä¿å­˜é…ç½®æ–‡ä»¶åï¼Œæµ‹è¯•é…ç½®å¹¶é‡å¯ Nginx ä½¿é…ç½®ç”Ÿæ•ˆï¼š sudo /usr/bin/nginx -c /etc/nginx/nginx.conf.run -t sudo /usr/bin/nginx -c /etc/nginx/nginx.conf.run -s reload éªŒè¯ HTTPS æ˜¯å¦ç”Ÿæ•ˆ ç”¨æµè§ˆå™¨è®¿é—® https://calibre.example.comï¼Œæ£€æŸ¥ï¼š æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºå°é”å›¾æ ‡ã€‚ è¯ä¹¦ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®çš„åŸŸåå’Œé¢å‘æœºæ„ã€‚ é¡µé¢èƒ½æ­£å¸¸åŠ è½½ï¼Œæ²¡æœ‰è¯ä¹¦è­¦å‘Šã€‚ å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹ Nginx æ—¥å¿—ï¼š sudo tail -f /var/log/nginx/error.log å¸¸è§é—®é¢˜ï¼š è¯ä¹¦è·¯å¾„ä¸å¯¹ï¼šç¡®è®¤ /volume1/docker/certd/tmp/ ä¸‹æœ‰ fullchain.pem å’Œ private.key æ–‡ä»¶ã€‚ æƒé™é—®é¢˜ï¼šç¡®ä¿ Nginx èƒ½è¯»å–è¯ä¹¦æ–‡ä»¶ï¼Œå¯ä»¥æ‰§è¡Œ sudo chmod 644 /volume1/docker/certd/tmp/*.pem /volume1/docker/certd/tmp/*.keyã€‚ è¯ä¹¦æœªæ›´æ–°ï¼šcertd æ›´æ–°è¯ä¹¦åï¼ŒNginx éœ€è¦é‡å¯æ‰èƒ½é‡æ–°åŠ è½½è¯ä¹¦ã€‚ä½ å¯ä»¥åœ¨æµæ°´çº¿çš„ â€œä¸»æœº - æ‰§è¡Œè¿œç¨‹ä¸»æœºè„šæœ¬å‘½ä»¤â€ ä»»åŠ¡ä¸­ï¼Œåœ¨å¯¼å…¥è„šæœ¬åé¢åŠ ä¸€ä¸ªé‡å¯å‘½ä»¤ï¼š bash /volume1/docker/certd/scripts/synology-import-cert.sh \\ --base-url &quot;https://nas.example.com:5001&quot; \\ --username &quot;admin&quot; \\ --password &quot;your-password&quot; \\ --cert-desc &quot;nas-wildcard&quot; \\ --fullchain &quot;/volume1/docker/certd/tmp/fullchain.pem&quot; \\ --key &quot;/volume1/docker/certd/tmp/private.key&quot; \\ --device-id &quot;your-device-id&quot; \\ --set-default \\ --assign-services &quot;all&quot; \\ --create # é‡å¯ Nginx ä»¥é‡æ–°åŠ è½½è¯ä¹¦ sudo /usr/bin/nginx -c /etc/nginx/nginx.conf.run -s reload ç»­æœŸä¸ç»´æŠ¤ åœ¨åˆ›å»º certd æµæ°´çº¿æ—¶ï¼Œé»˜è®¤ä¼šæœ‰åŒ…å«ä¸€ä¸ªå®šæ—¶è§¦å‘å™¨ï¼ŒLet's Encrypt è¯ä¹¦æœ‰æ•ˆæœŸæ˜¯ 90 å¤©ã€‚è¦å®ç°å…¨è‡ªåŠ¨ï¼Œåªéœ€è¦åœ¨æµæ°´çº¿é‡Œé…ç½®å®šæ—¶è§¦å‘å³å¯ã€‚ certd ä¼šåœ¨è¯ä¹¦åˆ°æœŸå‰æŒ‰ç…§ â€œæ›´æ–°å¤©æ•°â€ è®¾å®šçš„å¤©æ•°è‡ªåŠ¨ç”³è¯·æ–°è¯ä¹¦å¹¶ç»§ç»­æ‰§è¡Œåç»­éƒ¨ç½²ä»»åŠ¡ï¼Œæ²¡åˆ°æœŸå‰ä¸ä¼šé‡å¤ç”³è¯·ã€‚ ","link":"https://blog.rakuyo.dev/synology-ssl-with-certd/"},{"title":"ä¸ºä»€ä¹ˆ Swift æ¨è Bool ç”¨ is å‰ç¼€ï¼Œè€Œ Java å¸¸è§„é¿","content":"æœ€è¿‘åœ¨è¯»é˜¿é‡Œå‡ºå“çš„ Java å¼€å‘æ‰‹å†Œï¼Œå…¶ä¸­æœ‰ä¸€æ¡è§„åˆ™æ˜¯ï¼š POJO ç±»ä¸­çš„ä»»ä½•å¸ƒå°”ç±»å‹çš„å˜é‡ï¼Œéƒ½ä¸è¦åŠ  is å‰ç¼€ï¼Œå¦åˆ™éƒ¨åˆ†æ¡†æ¶è§£æä¼šå¼•èµ·åºåˆ—åŒ–é”™è¯¯ã€‚ è¿™æ¡è§„åˆ™è®© iOS å¼€å‘å‡ºèº«çš„è®©æ„Ÿåˆ°å¥½å¥‡ï¼šä¸ºä»€ä¹ˆ Swift æ¨è Bool ç”¨ is å‰ç¼€ï¼Œè€Œ Java å´è¦é¿å…è¿™ç§å‘½åï¼Ÿ Javaï¼šJavaBeans è§„èŒƒå¸¦æ¥çš„è§£æå·®å¼‚ å…ˆä» Java è¯´èµ·ã€‚JavaBeans æ˜¯ä¸€å¥—åŸºäºå‘½åçº¦å®šçš„ç»„ä»¶æ¨¡å‹ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡ getX()/isX()/setX() çš„æ–¹æ³•åæ¨æ–­ â€œå±æ€§åâ€ï¼Œå¾ˆå¤šæ¡†æ¶ä¼šå€ŸåŠ© java.beans.Introspector ä¸ PropertyDescriptor è¿›è¡Œåå°„è§£æå¹¶è°ƒç”¨è®¿é—®å™¨ã€‚ å› æ­¤ Java ç”Ÿæ€å¹¿æ³›ä¾èµ– JavaBeans è§„èŒƒï¼Œå¸ƒå°”å­—æ®µå¦‚æœç›´æ¥å« isReadyï¼Œå¯èƒ½è¢«æ¨æ–­ä¸º ready æˆ– isReadyï¼Œåœ¨ä¸åŒæ¡†æ¶ä¹‹é—´å®¹æ˜“äº§ç”Ÿä¸ä¸€è‡´ã€‚ private boolean isReady; public boolean isReady() { return isReady; } public void setReady(boolean ready) { this.isReady = ready; } åº•å±‚ä¸Šï¼Œæ¡†æ¶å¾€å¾€å…ˆè§£æå‡ºå±æ€§åï¼Œå†æŒ‰å±æ€§åç»‘å®šæˆ–åºåˆ—åŒ–ï¼Œè¿™å°±æ˜¯ is å‰ç¼€äº§ç”Ÿæ­§ä¹‰çš„æ ¹å› ã€‚ å› æ­¤æ›´ç¨³å¦¥çš„åšæ³•é€šå¸¸æ˜¯ï¼šå­—æ®µç”¨ readyã€enabled è¿™ç±»åï¼Œgetter ç”¨ isReady()ï¼Œé¿å…å­—æ®µåæœ¬èº«å¸¦ isã€‚ Objective-Cï¼šgetter æ¨è isï¼Œä½†å±æ€§åæ›´åƒå½¢å®¹è¯ ä½œä¸ºæ—©æœŸ iOS å¼€å‘çš„ä»£è¡¨ï¼ŒObjective-C çš„ @property æ˜¯ç¼–è¯‘æœŸè¯­æ³•ç³–ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆ ivar ä¸ getter/setterï¼Œè¿è¡Œæ—¶é€šè¿‡ objc_msgSend åšæ¶ˆæ¯åˆ†å‘ï¼ŒKVC åˆ™æŒ‰è®¿é—®å™¨å’Œ ivar è§„åˆ™æŸ¥æ‰¾å±æ€§ã€‚ Cocoa å‘½åè§„åˆ™å»ºè®® BOOL çš„ getter ç”¨ is / has / shouldï¼Œä½†å±æ€§åæœ¬èº«æ›´å€¾å‘â€œå½¢å®¹è¯â€ã€‚å¸¸è§å†™æ³•æ˜¯ç”¨è‡ªå®šä¹‰ getterï¼š @property (nonatomic, getter=isHidden) BOOL hidden; è¿™æ ·è¯»å–æ—¶æ˜¯ isHiddenï¼Œsetter ä»ç„¶æ˜¯ setHidden:ï¼Œè¯­ä¹‰æ¸…æ™°ï¼Œä¹Ÿé¿å…å±æ€§åå« isHidden å¸¦æ¥çš„ setter å‘½åæ€ªå¼‚ã€‚ Swiftï¼šè¯­ä¹‰ä¼˜å…ˆï¼Œä¸å­˜åœ¨ JavaBeans æ­§ä¹‰ åˆ°äº† Swift çš„æ—¶ä»£ï¼Œå±æ€§è®¿é—®æ˜¯ç¼–è¯‘æœŸè¯­ä¹‰ã€‚obj.property å¯¹äºå­˜å‚¨å±æ€§ä¼šè¢«ç¼–è¯‘ä¸ºå†…å­˜åç§»çš„ç›´æ¥è¯»å†™ï¼Œè®¡ç®—å±æ€§åˆ™è°ƒç”¨ getter/setterï¼›ç±»çš„åŠ¨æ€è¡Œä¸ºä¸»è¦ç”±é™æ€æ´¾å‘æˆ–è™šè¡¨æ´¾å‘å®Œæˆï¼Œåªæœ‰æ ‡è®° @objc æˆ– dynamic æ—¶æ‰ä¼šèµ° Objective-C è¿è¡Œæ—¶ï¼Œå› æ­¤ä¸ä¼šä¾èµ– JavaBeans å¼çš„å‘½åè§£æã€‚ Swift çš„ API è®¾è®¡æŒ‡å—å¼ºè°ƒâ€œè¯»èµ·æ¥åƒæ–­è¨€â€ï¼Œæ‰€ä»¥ isEnabledã€isHidden è¿™ç±»åå­—éå¸¸è‡ªç„¶ï¼Œä¹Ÿä¸ä¼šå‡ºç° is å‰ç¼€è¢«å‰¥ç¦»çš„æ­§ä¹‰ã€‚ if view.isHidden {} Pythonï¼šå±æ€§è®¿é—®ç›´æ¥å¯¹åº”åå­— æ—¢ç„¶æèµ·äº†è¿™ä¸ªé—®é¢˜ï¼Œå°±è¿å¸¦ç€å¦å¤–ä¸€ä¸ªæˆ‘ç»å¸¸ä½¿ç”¨çš„å¼€å‘è¯­è¨€ Python ä¸€èµ·ç ”ç©¶ä¸€ä¸‹ã€‚ Python çš„å±æ€§è¯»å–ä¼šè¿›å…¥ __getattribute__ï¼ŒæŒ‰å®ä¾‹å­—å…¸ã€ç±»å­—å…¸ä¸æè¿°ç¬¦åè®®è§£æï¼Œ@property ä¹Ÿæ˜¯ç”¨æè¿°ç¬¦å®ç° getter/setterã€‚ç”±äºæŸ¥æ‰¾åŸºäºå­—å…¸ä¸æè¿°ç¬¦ï¼Œè€Œä¸æ˜¯å‘½åçº¦å®šï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° JavaBeans çš„æ­§ä¹‰ã€‚ çº¦å®šä¸Šå¸¸ç”¨ is_ã€has_ å‰ç¼€è¡¨è¾¾å¸ƒå°”è¯­ä¹‰ï¼Œä½†è¿™åªæ˜¯å‘½åä¹ æƒ¯ã€‚ class User: def __init__(self): self.is_ready = False å°ç»“ Javaï¼šå­—æ®µé¿å… is å‰ç¼€ï¼Œgetter ç”¨ isX()ã€‚ Objective-Cï¼šå±æ€§åç”¨å½¢å®¹è¯ï¼Œgetter ç”¨ isX æ›´ç¬¦åˆ Cocoaã€‚ Swiftï¼šæ”¾å¿ƒç”¨ is/has/shouldï¼Œè¯­ä¹‰æ›´å¼ºã€‚ Pythonï¼šç”¨ is_ åªæ˜¯é£æ ¼é€‰æ‹©ï¼Œä¸æ¶‰åŠè§£æå†²çªã€‚ ","link":"https://blog.rakuyo.dev/bool-is-prefix-in-swift-and-java/"},{"title":"iOS & Android & H5 ä¸‰ç«¯ JS Bridge çš„ç¼–è§£ç é€»è¾‘ä¸æºç åˆ†æ","content":"ä¸Šä¸€ç¯‡ å…¨é“¾è·¯ HTTP ç¼–è§£ç ï¼šä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®æµè½¬ è®²è§£ HTTP è¯·æ±‚ä¸­çš„ç¼–è§£ç ã€‚ç„¶è€Œåœ¨å®¢æˆ·ç«¯å¼€å‘çš„æ—¥å¸¸é‡Œï¼Œé™¤äº† HTTPï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´é«˜é¢‘çš„è·¨ç«¯ä¼ è¾“åœºæ™¯ï¼šä¸ H5 çš„æ•°æ®äº¤æ¢ï¼Œè€Œ JS Bridge æ­£æ˜¯å…¶ä¸­ä¸å¯æˆ–ç¼ºçš„æ¡¥æ¢ã€‚ æœ¬ç¯‡æ–‡ç« ä¼šæ²¿ç€äº¤äº’æµç¨‹è¿™æ¡ä¸»çº¿ï¼Œåªå…³æ³¨â€œç¼–ç  â†’ ä¼ è¾“ â†’ è§£ç â€ç›¸å…³çš„ç»†èŠ‚ã€‚iOSã€Android ä¸ H5 åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™åºåˆ—åŒ–ã€ä»€ä¹ˆæ—¶å€™åšå­—ç¬¦ä¸²è½¬ä¹‰ã€ä»€ä¹ˆæ—¶å€™ååºåˆ—åŒ–ï¼Œä»¥åŠè¿™äº›å·®å¼‚ä¼šå¸¦æ¥å“ªäº›å‘ã€‚ ä¸‹é¢ä»¥ä¸¤ä¸ªç»å…¸çš„å¼€æºå®ç°ä¸ºä¾‹ï¼Œåˆ†æåº•å±‚é€»è¾‘ä¸ä»£ç å®ç°ï¼š iOSï¼šmarcuswestin/WebViewJavascriptBridge Androidï¼šwendux/WebViewJavascriptBridge 1. äº¤äº’æµç¨‹ä¸­çš„ç¼–è§£ç éª¨æ¶ æ— è®ºæ˜¯å“ªç«¯å®ç°ï¼Œæ¶ˆæ¯æœ¬è´¨ä¸Šéƒ½æ˜¯ JSONã€‚å…ˆæŠŠæ¶ˆæ¯ç»“æ„è¯´æ¸…æ¥šï¼š æ¶ˆæ¯ç»“æ„ æ¶ˆæ¯åˆ†ä¸ºè¯·æ±‚å’Œå“åº”ä¸¤ç§æ ¼å¼ï¼š // è¯·æ±‚æ¶ˆæ¯ï¼šJS â†’ Native æˆ– Native â†’ JS { handlerName: &quot;getUserInfo&quot;, // è¦è°ƒç”¨çš„å¤„ç†å™¨åç§° data: { userId: &quot;123&quot; }, // ä¸šåŠ¡å‚æ•° callbackId: &quot;cb_1_1703404800&quot; // å›è°ƒæ ‡è¯†ï¼Œç”¨äºåŒ¹é…å“åº” } // å“åº”æ¶ˆæ¯ï¼šå¤„ç†å®Œæˆåè¿”å› { responseId: &quot;cb_1_1703404800&quot;, // å¯¹åº”è¯·æ±‚çš„ callbackId responseData: { name: &quot;å¼ ä¸‰&quot; } // å¤„ç†ç»“æœ } æ¥æ”¶æ–¹é€šè¿‡æ˜¯å¦å­˜åœ¨ responseId æ¥åŒºåˆ†è¯·æ±‚ä¸å“åº”ã€‚callbackId / responseId è™½ç„¶æ˜¯æµç¨‹å­—æ®µï¼Œä½†å®ƒä»¬åœ¨ç¼–ç é˜¶æ®µå°±å·²ç»å†™å…¥æ¶ˆæ¯ä½“ï¼Œä»»ä½•ä¸€ç«¯æ¼å†™æˆ–å‘½åä¸ä¸€è‡´ï¼Œéƒ½ä¼šå¯¼è‡´è§£ç æ­£å¸¸å´æ— æ³•åŒ¹é…å›è°ƒã€‚ åœ¨å®ç°é‡Œï¼ŒiOS ç”¨ NSDictionary å¡«å……è¿™äº›å­—æ®µï¼ˆWebViewJavascriptBridgeBase.m#L45-L62ï¼‰ï¼ŒAndroid åˆ™ç”¨ WVJBMessage ç±»å®šä¹‰å­—æ®µï¼ˆWVJBWebView.java#L114-L120ï¼‰ã€‚ äº¤äº’æµç¨‹ä¸­çš„ç¼–è§£ç èŠ‚ç‚¹ JS ä¾§æ„é€ å¯¹è±¡ â†’ JSON.stringifyï¼ˆç¼–ç ï¼‰ã€‚ Native ä¾§æ‹¿åˆ°å­—ç¬¦ä¸² â†’ NSJSONSerialization / JSONObjectï¼ˆè§£ç ï¼‰ã€‚ Native ä¾§æ„é€ å“åº” â†’ JSON åºåˆ—åŒ–ï¼ŒiOS é¢å¤–åš JS å­—ç¬¦ä¸²è½¬ä¹‰ï¼ˆç¼–ç ï¼‰ã€‚ JS ä¾§ JSON.parse â†’ å¾—åˆ°å¯¹è±¡ï¼ˆè§£ç ï¼‰ã€‚ ä¸‹é¢è¿™å¼ åºåˆ—å›¾å±•ç¤ºäº† JS Bridge çš„åŒå‘é€šä¿¡æµç¨‹ã€‚è¯»å›¾æ—¶åªéœ€è¦æŠŠæ³¨æ„åŠ›æ”¾åœ¨ä¸¤æ¬¡ JSON ç¼–ç ä¸ä¸¤æ¬¡ JSON è§£ç ä¸Šï¼Œå…¶ä½™æœºåˆ¶åªæ˜¯æŠŠæ¶ˆæ¯é€è¾¾ã€‚ 2. JS â†’ Native çš„ç¼–è§£ç  è¿™æ¡é“¾è·¯é‡Œï¼ŒH5 è´Ÿè´£ç¼–ç ï¼ŒNative è´Ÿè´£è§£ç ã€‚ H5 ä¾§ç¼–ç  iOS ä¸ Android çš„æ³¨å…¥è„šæœ¬è™½ç„¶ä¸åŒï¼Œä½†ç¼–ç åŠ¨ä½œæ˜¯ä¸€è‡´çš„ï¼šå…ˆæŠŠæ¶ˆæ¯åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸²ï¼ˆiOS è§ WebViewJavascriptBridge_JS.m#L72-L76ï¼ŒAndroid è§ WebViewJavascriptBridge.js#L12-L24ï¼‰ã€‚ // iOS ç«¯æ³¨å…¥çš„ JSï¼šæŠŠæ¶ˆæ¯é˜Ÿåˆ—åºåˆ—åŒ–æˆ JSON å­—ç¬¦ä¸² function _fetchQueue() { var messageQueueString = JSON.stringify(sendMessageQueue); sendMessageQueue = []; return messageQueueString; } // Android ç«¯æ³¨å…¥çš„ JSï¼šç›´æ¥åºåˆ—åŒ–å•æ¡æ¶ˆæ¯ function _doSend(message, responseCallback) { // ... var msg = JSON.stringify(message || {}); if (window.WVJBInterface) { WVJBInterface.notice(msg); } else { prompt(&quot;_wvjbxx&quot;, msg); } } JSON.stringify æœ‰å‡ ä¸ªå®¹æ˜“è¸©å‘çš„ç‚¹ï¼š undefined å’Œå‡½æ•°ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œå­—æ®µä¼šç›´æ¥æ¶ˆå¤±ã€‚ å¤§æ•´æ•°åœ¨ JS é‡Œæ˜¯ Numberï¼Œå¯èƒ½ä¸¢ç²¾åº¦ï¼Œè·¨ç«¯æ—¶å»ºè®®ç”¨å­—ç¬¦ä¸²ä¼ è¾“ã€‚ NaNã€Infinity ä¼šè¢«åºåˆ—åŒ–æˆ nullã€‚ iOS ç«¯è§£ç  iOS ç«¯é€šè¿‡ evaluateJavaScript è°ƒç”¨ _fetchQueue() æ‹‰å–é˜Ÿåˆ—ï¼ˆWKWebViewJavascriptBridge.m#L94-L101ï¼Œå‘½ä»¤å­—ç¬¦ä¸²ç”± WebViewJavascriptBridgeBase.m#L155-L157 ç”Ÿæˆï¼‰ã€‚æ‹¿åˆ° JSON å­—ç¬¦ä¸²åå†ç”¨ NSJSONSerialization ååºåˆ—åŒ–ï¼ˆWebViewJavascriptBridgeBase.m#L205-L207ï¼‰ï¼š // è·å– JS ç«¯çš„æ¶ˆæ¯é˜Ÿåˆ— NSString *messageQueueString = [self _evaluateJavascript:@&quot;WebViewJavascriptBridge._fetchQueue();&quot;]; // ååºåˆ—åŒ– - (NSArray *)_deserializeMessageJSON:(NSString *)messageJSON { return [NSJSONSerialization JSONObjectWithData: [messageJSON dataUsingEncoding:NSUTF8StringEncoding] options:0 error:nil]; } Android ç«¯è§£ç  Android ç«¯é€šè¿‡ JavascriptInterface æˆ– prompt æ‹¿åˆ°å­—ç¬¦ä¸²æ¶ˆæ¯ï¼ˆWVJBWebView.java#L371-L379ï¼ŒWVJBWebView.java#L626-L680ï¼‰ã€‚è¿™ä¸¤æ¡é€šé“åªæ˜¯ä¼ è¾“å·®å¼‚ï¼Œæ‹¿åˆ°çš„éƒ½æ˜¯ JSON å­—ç¬¦ä¸²ï¼Œåç»­å†äº¤ç»™ JSONObject è§£æå¹¶åˆ†å‘ï¼ˆWVJBWebView.java#L241-L275ï¼‰ï¼š // æ–¹å¼ä¸€ï¼šé€šè¿‡ JavascriptInterface @JavascriptInterface public void notice(String message) { handleMessage(message); } // æ–¹å¼äºŒï¼šé€šè¿‡æ‹¦æˆª prompt @Override public boolean onJsPrompt(WebView view, String url, String message, String defaultValue, JsPromptResult result) { if (message.equals(&quot;_wvjbxx&quot;)) { handleMessage(defaultValue); result.confirm(&quot;&quot;); return true; } return super.onJsPrompt(view, url, message, defaultValue, result); } 3. Native â†’ JS çš„ç¼–è§£ç  è¿™æ¡é“¾è·¯é‡Œï¼ŒNative è´Ÿè´£ç¼–ç ï¼ŒH5 è´Ÿè´£è§£ç ã€‚å…³é”®åœ¨äº Native ä¾§å¦‚ä½•æŠŠå¯¹è±¡å®‰å…¨åœ°å¡è¿› JS ä»£ç ä¸­ã€‚ iOS ç«¯ç¼–ç  å‘é€æ¶ˆæ¯æ—¶ï¼Œé€šè¿‡ NSJSONSerialization å°†å­—å…¸åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚åºåˆ—åŒ–æ–¹æ³•è§ WebViewJavascriptBridgeBase.m#L201-L203ï¼Œæ´¾å‘æ–¹æ³•è§ WebViewJavascriptBridgeBase.m#L178-L198ï¼š // åºåˆ—åŒ–æ–¹æ³•ï¼ˆç®€åŒ–ï¼‰ - (NSString *)_serializeMessage:(id)message { return [[NSString alloc] initWithData: [NSJSONSerialization dataWithJSONObject:message options:0 error:nil] encoding:NSUTF8StringEncoding]; } // æ´¾å‘æ¶ˆæ¯åˆ° JS - (void)_dispatchMessage:(NSDictionary *)message { NSString *messageJSON = [self _serializeMessage:message]; // è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œé˜²æ­¢ JS æ‰§è¡Œå‡ºé”™ messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\\\&quot; withString:@&quot;\\\\\\\\&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\&quot;&quot; withString:@&quot;\\\\\\&quot;&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\'&quot; withString:@&quot;\\\\'&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\n&quot; withString:@&quot;\\\\n&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\r&quot; withString:@&quot;\\\\r&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\f&quot; withString:@&quot;\\\\f&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\u2028&quot; withString:@&quot;\\\\u2028&quot;]; messageJSON = [messageJSON stringByReplacingOccurrencesOfString:@&quot;\\u2029&quot; withString:@&quot;\\\\u2029&quot;]; NSString *js = [NSString stringWithFormat: @&quot;WebViewJavascriptBridge._handleMessageFromObjC('%@');&quot;, messageJSON]; [self _evaluateJavascript:js]; } è¿™é‡Œçš„è½¬ä¹‰éå¸¸å…³é”®ï¼Œå› ä¸º JSON å­—ç¬¦ä¸²è¢«åŒ…åœ¨ JavaScript çš„å•å¼•å·å­—ç¬¦ä¸²é‡Œï¼Œå¿…é¡»é¿å…ç ´åå­—ç¬¦ä¸²è¾¹ç•Œï¼š åŸå§‹å­—ç¬¦ è½¬ä¹‰å è¯´æ˜ \\ \\\\ åæ–œæ æœ¬èº«éœ€è¦è½¬ä¹‰ &quot; \\&quot; åŒå¼•å·ï¼Œé˜²æ­¢ç ´åå­—ç¬¦ä¸²è¾¹ç•Œ ' \\' å•å¼•å·ï¼Œå› ä¸ºå¤–å±‚ç”¨å•å¼•å·åŒ…è£¹ \\n \\\\n æ¢è¡Œç¬¦ \\r \\\\r å›è½¦ç¬¦ \\f \\\\f æ¢é¡µç¬¦ \\u2028 \\\\u2028 è¡Œåˆ†éš”ç¬¦ï¼ˆJS ä¸­ä¼šè¢«è§£é‡Šä¸ºæ¢è¡Œï¼‰ \\u2029 \\\\u2029 æ®µè½åˆ†éš”ç¬¦ï¼ˆåŒä¸Šï¼‰ ç‰¹åˆ«æ³¨æ„ \\u2028 å’Œ \\u2029ã€‚å®ƒä»¬åœ¨ JSON ä¸­åˆæ³•ï¼Œä½†åœ¨ JS å­—ç¬¦ä¸²å­—é¢é‡ä¸­ä¼šè¢«å½“ä½œæ¢è¡Œå¤„ç†ï¼Œå¯¼è‡´è¯­æ³•é”™è¯¯ã€‚ Android ç«¯ç¼–ç  Android ç«¯ä½¿ç”¨ JSONObject è¿›è¡Œåºåˆ—åŒ–ï¼ˆåºåˆ—åŒ–è§ WVJBWebView.java#L278-L300ï¼Œæ´¾å‘è§ WVJBWebView.java#L235-L238ï¼‰ï¼š private JSONObject message2JSONObject(WVJBMessage message) { JSONObject jo = new JSONObject(); if (message.callbackId != null) { jo.put(&quot;callbackId&quot;, message.callbackId); } if (message.data != null) { jo.put(&quot;data&quot;, message.data); } // ... å…¶ä»–å­—æ®µ return jo; } private void dispatchMessage(WVJBMessage message) { String messageJSON = message2JSONObject(message).toString(); // æ‰§è¡Œ JS evaluateJavascript(&quot;WebViewJavascriptBridge._handleMessageFromJava(&quot; + messageJSON + &quot;)&quot;); } ç”±äº JSON ç›´æ¥ä½œä¸ºå¯¹è±¡å­—é¢é‡æ‹¼è¿› JS è°ƒç”¨ä¸­ï¼Œä¸éœ€è¦åƒ iOS ä¸€æ ·æŠŠ JSON æ”¾è¿›å•å¼•å·å­—ç¬¦ä¸²ï¼Œå› æ­¤å°‘äº†ä¸€å±‚å­—ç¬¦ä¸²è½¬ä¹‰ã€‚ H5 ä¾§è§£ç  iOS ç«¯ä¼ è¿›æ¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤ JS ä¾§éœ€è¦ JSON.parseï¼ˆWebViewJavascriptBridge_JS.m#L78-L113ï¼‰ï¼š function _dispatchMessageFromNative(messageJSON) { var message = JSON.parse(messageJSON); // å¤„ç†æ¶ˆæ¯... } Android ç«¯å¦‚æœç›´æ¥ä¼ å¯¹è±¡ï¼ŒJS ä¾§å¯ä»¥è·³è¿‡ JSON.parseï¼Œè¿™å–å†³äº Native ä¾§æ˜¯å¦ä»¥å­—ç¬¦ä¸²å½¢å¼ä¼ å‚ï¼ˆWVJBWebView.java#L235-L238ï¼ŒWebViewJavascriptBridge.js#L44-L84ï¼‰ã€‚ 4. ç¼–è§£ç è¯­ä¹‰å·®å¼‚ä¸å‘ç‚¹ å­—æ®µä¸€è‡´æ€§ ä¸‰ç«¯çº¦å®šçš„å­—æ®µåå¿…é¡»ä¸€è‡´ï¼ŒåŒ…æ‹¬ handlerNameã€dataã€callbackIdã€responseIdã€responseDataã€‚å‰ç¼€å·®å¼‚åªå½±å“è°ƒè¯•ï¼Œä¸å½±å“è§£æï¼Œä½†å­—æ®µåä¸€æ—¦å˜äº†ï¼Œå°±ä¼šå‡ºç°â€œè§£ç æ­£å¸¸å´æ‰¾ä¸åˆ°å›è°ƒâ€çš„ç°è±¡ã€‚ JSON è¯­ä¹‰å·®å¼‚ åœºæ™¯ JavaScript iOSï¼ˆNSJSONSerializationï¼‰ Androidï¼ˆJSONObjectï¼‰ null null NSNull JSONObject.NULL undefined undefinedï¼ˆä¸ä¼šè¢«åºåˆ—åŒ–ï¼‰ - - å¸ƒå°”å€¼ true / false @YES / @NO true / false å¤§æ•´æ•° å¯èƒ½ä¸¢å¤±ç²¾åº¦ NSNumber long ç‰¹åˆ«æ³¨æ„ undefinedã€‚JavaScript ä¸­å¯¹è±¡çš„ undefined å€¼åœ¨ JSON.stringify æ—¶ä¼šè¢«å¿½ç•¥ï¼Œè¿™å¯èƒ½å¯¼è‡´å­—æ®µä¸¢å¤±ã€‚ è§£æå…œåº• ä»»ä½•ä¸€ç«¯çš„ JSON.parse å¤±è´¥éƒ½ä¼šä¸­æ–­åç»­æµç¨‹ï¼Œå»ºè®®åŠ ä¸€å±‚ try-catchï¼š function _dispatchMessageFromNative(messageJSON) { try { var message = JSON.parse(messageJSON); // ... } catch (e) { console.error(&quot;Bridge message parse error:&quot;, e); } } 5. ç¼–è§£ç æ’æŸ¥æ¸…å• é‡åˆ°â€œå›è°ƒä¸æ‰§è¡Œâ€â€œæ•°æ®ä¸¢å¤±â€â€œä¸­æ–‡ä¹±ç â€æ—¶ï¼ŒæŒ‰ä¸‹é¢é¡ºåºæ’æŸ¥æœ€çœæ—¶ï¼š ç¼–ç é˜¶æ®µï¼šæ£€æŸ¥ JSON.stringify / NSJSONSerialization / JSONObject æ˜¯å¦æˆåŠŸã€‚ è½¬ä¹‰é˜¶æ®µï¼šç¡®è®¤ iOS ç«¯çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰æ˜¯å¦å®Œæ•´ï¼Œå°¤å…¶æ˜¯ \\u2028 / \\u2029ã€‚ è§£ç é˜¶æ®µï¼šæ£€æŸ¥ JSON.parse æ˜¯å¦æŠ›å¼‚å¸¸ï¼ŒNative ç«¯ååºåˆ—åŒ–æ˜¯å¦å¤±è´¥ã€‚ å­—æ®µé˜¶æ®µï¼šæ ¸å¯¹ callbackId / responseId æ˜¯å¦ä¸€è‡´ã€‚ 6. æ€»ç»“ JS Bridge çš„ç¼–ç é“¾è·¯å¹¶ä¸ç¥ç§˜ï¼Œæœ¬è´¨å°±æ˜¯ JSON çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼Œå·®åˆ«åœ¨äºä¼ è¾“é€šé“ä¸å­—ç¬¦ä¸²è½¬ä¹‰ã€‚åªè¦æŠŠæ¯ä¸€æ¬¡ç¼–ç ä¸è§£ç çš„ä½ç½®æ ‡æ¸…æ¥šï¼Œé—®é¢˜é€šå¸¸éƒ½èƒ½å¿«é€Ÿå®šä½ã€‚ ","link":"https://blog.rakuyo.dev/jsbridge-encoding-ios-android-h5/"},{"title":"å…¨é“¾è·¯ HTTP ç¼–è§£ç ï¼šä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„æ•°æ®æµè½¬","content":"ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬æ¯å¤©éƒ½åœ¨å’Œç½‘ç»œè¯·æ±‚æ‰“äº¤é“ã€‚ä½†ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼šå½“ iOS è°ƒç”¨ URLSession å‘èµ·ä¸€ä¸ª GET è¯·æ±‚æ—¶ï¼Œå‚æ•°é‡Œçš„ä¸­æ–‡æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿåç«¯çš„ Spring æ¡†æ¶åˆæ˜¯å¦‚ä½•è§£æè¿™äº›å‚æ•°çš„ï¼ŸJackson åœ¨å…¶ä¸­æ‰®æ¼”äº†ä»€ä¹ˆè§’è‰²ï¼Ÿ è¿™ç¯‡æ–‡ç« ä¼šä» HTTP åè®®çš„ç¼–ç è§„èŒƒè®²èµ·ï¼Œæ·±å…¥å®¢æˆ·ç«¯ç½‘ç»œå±‚çš„å®ç°ç»†èŠ‚ï¼Œå†åˆ°æœåŠ¡ç«¯çš„ Jackson ä¸ Spring è¯·æ±‚å¤„ç†ã€‚å¸Œæœ›è¯»å®Œä¹‹åï¼Œä½ å¯¹ã€Œæ•°æ®æ˜¯æ€ä¹ˆåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´æµè½¬çš„ã€èƒ½æœ‰ä¸€ä¸ªå®Œæ•´çš„è®¤è¯†ã€‚ 1. ç½‘ç»œå±‚ç¼–è§£ç ï¼šHTTP åè®®è§†è§’ æœ¬ç« èšç„¦ HTTP çš„ç¼–ç ç»†èŠ‚ã€‚å¦‚æœä½ å¯¹ HTTP åè®®æœ¬èº«ï¼ˆè¯·æ±‚æ–¹æ³•ã€çŠ¶æ€ç ã€Header è¯­ä¹‰ç­‰ï¼‰è¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆé˜…è¯» è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPSã€‚ 1.1 HTTP åè®®æœ¬èº«ä¸åšç¼–ç  å…ˆæ¾„æ¸…ä¸€ä¸ªå¸¸è§çš„è¯¯è§£ï¼šHTTP åè®®æœ¬èº«ä¸æ‰§è¡Œä»»ä½•ç¼–ç æ“ä½œã€‚ HTTP åªæ˜¯ä¸€ä»½è§„èŒƒæ–‡æ¡£ï¼ˆRFC 7230-7235 ç­‰ï¼‰ï¼Œå®ƒè§„å®šäº† â€œæ•°æ®åº”è¯¥ä»¥ä»€ä¹ˆæ ¼å¼ä¼ è¾“â€ï¼Œæ¯”å¦‚ URL ä¸­çš„ä¸­æ–‡è¦ç”¨ Percent-Encodingã€Body çš„æ ¼å¼ç”± Content-Type æŒ‡å®šã€‚ä½†å®ƒä¸ä¼šå¸®ä½ æŠŠä¸­æ–‡å˜æˆ %E4%B8%AD%E6%96%87ï¼Œä¹Ÿä¸ä¼šå¸®ä½ æŠŠå¯¹è±¡åºåˆ—åŒ–æˆ JSONâ€”â€”è¿™äº›å·¥ä½œç”±å„å±‚è½¯ä»¶å®Œæˆã€‚ 1.2 ç¼–ç èŒè´£åˆ†å±‚ ä¸€ä¸ªç½‘ç»œè¯·æ±‚çš„ç¼–ç å·¥ä½œï¼Œç”±å¤šå±‚è½¯ä»¶åä½œå®Œæˆï¼š å±‚çº§ è´Ÿè´£ä»€ä¹ˆ è°æ¥åš æ˜¯å¦è‡ªåŠ¨ åº”ç”¨å±‚ å¯¹è±¡ â†’ JSON å­—ç¬¦ä¸² ä½ çš„ä»£ç è°ƒç”¨ JSONEncoder / Gson æ‰‹åŠ¨è°ƒç”¨ HTTP æ¡†æ¶å±‚ URL ç¼–ç ã€HTTP æŠ¥æ–‡å°è£… URLSession / OkHttp / Alamofire å¤§éƒ¨åˆ†è‡ªåŠ¨ ä¼ è¾“å±‚ TCP åˆ†æ®µã€æ ¡éªŒå’Œ æ“ä½œç³»ç»Ÿç½‘ç»œæ ˆ å®Œå…¨è‡ªåŠ¨ ç½‘ç»œå±‚ IP æ•°æ®åŒ…å°è£… æ“ä½œç³»ç»Ÿç½‘ç»œæ ˆ å®Œå…¨è‡ªåŠ¨ ç”¨å›¾æ¥è¡¨ç¤ºï¼š å…³é”®ç‚¹ï¼šJSON åºåˆ—åŒ–ä¸æ˜¯è‡ªåŠ¨çš„ã€‚å³ä½¿ä½ ç”¨ Alamofire è¿™æ ·çš„é«˜å±‚æ¡†æ¶ï¼Œä¹Ÿéœ€è¦æŒ‡å®šç¼–ç å™¨ï¼ˆå¦‚ JSONParameterEncoderï¼‰ã€‚æ¡†æ¶åªæ˜¯å¸®ä½ ç®€åŒ–äº†è°ƒç”¨æ–¹å¼ï¼Œåº•å±‚ä»ç„¶æ˜¯æ‰‹åŠ¨è§¦å‘çš„åºåˆ—åŒ–ã€‚ 1.3 ä¸‰ä¸ªç¼–ç åœºæ™¯è¯¦è§£ åœ¨ä¸€ä¸ª HTTP è¯·æ±‚ä¸­ï¼Œæ•°æ®å¯ä»¥å‡ºç°åœ¨ä¸‰ä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®çš„ç¼–ç è§„åˆ™å’Œå®ç°æ–¹å¼ä¸åŒï¼š ä½ç½® å…¸å‹åœºæ™¯ ç¼–ç è§„åˆ™ è°æ¥åš URL Query GET è¯·æ±‚å‚æ•° Percent-Encoding HTTP æ¡†æ¶è‡ªåŠ¨ï¼Œè¾¹ç•Œæƒ…å†µéœ€æ‰‹åŠ¨ Header è®¤è¯ä¿¡æ¯ã€è‡ªå®šä¹‰å…ƒæ•°æ® ASCIIï¼ˆé ASCII éœ€ Base64ï¼‰ æ‰‹åŠ¨å¤„ç† Body POST/PUT è¯·æ±‚ä½“ å–å†³äº Content-Type åºåˆ—åŒ–æ‰‹åŠ¨ï¼Œå°è£…è‡ªåŠ¨ URL Query ç¼–ç  URL è§„èŒƒï¼ˆRFC 3986ï¼‰è§„å®šï¼ŒQuery ä¸­åªèƒ½åŒ…å«ç‰¹å®šçš„ ASCII å­—ç¬¦ã€‚å¯¹äºä¸­æ–‡ã€ç©ºæ ¼ç­‰å­—ç¬¦ï¼Œå¿…é¡»è¿›è¡Œ Percent-Encodingï¼ˆå…³äº URL çš„å®Œæ•´ç»“æ„ï¼Œå¯å‚è€ƒ è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNSï¼‰ï¼š åŸå§‹ï¼šname=å¼ ä¸‰&amp;city=åŒ—äº¬ ç¼–ç åï¼šname=%E5%BC%A0%E4%B8%89&amp;city=%E5%8C%97%E4%BA%AC è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ç»å¸¸è¢«å¿½ç•¥ï¼šç©ºæ ¼çš„ç¼–ç ã€‚åœ¨ Query ä¸­ï¼Œç©ºæ ¼å¯ä»¥ç¼–ç ä¸º %20 æˆ– +ï¼Œä½†ä¸¤è€…çš„è¯­ä¹‰ç•¥æœ‰ä¸åŒã€‚è¡¨å•æäº¤ï¼ˆapplication/x-www-form-urlencodedï¼‰é€šå¸¸ç”¨ +ï¼Œè€Œæ ‡å‡† URL ç¼–ç ç”¨ %20ã€‚ è°æ¥åšï¼Ÿ iOS çš„ URLComponentsã€Android çš„ Uri.Builder ä¼šè‡ªåŠ¨ç¼–ç å¤§éƒ¨åˆ†å­—ç¬¦ï¼Œä½† + ç­‰è¾¹ç•Œå­—ç¬¦å¯èƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†ã€‚ æºç å‚è€ƒï¼š iOS Alamofireï¼šParameterEncoder.swift#L174-L185 Androidï¼šOkHttp - HttpUrl.kt#L1106-L1123 Header ç¼–ç  HTTP Header æœ¬è´¨ä¸Šæ˜¯ ASCII æ–‡æœ¬ã€‚å¦‚æœä½ æƒ³åœ¨ Header é‡Œä¼ ä¸­æ–‡ï¼Œè¦ä¹ˆç”¨ Base64 ç¼–ç ï¼Œè¦ä¹ˆç”¨ RFC 5987 å®šä¹‰çš„æ‰©å±•è¯­æ³•ã€‚å®é™…å¼€å‘ä¸­ï¼Œå»ºè®® Header åªä¼  ASCII å®‰å…¨çš„å†…å®¹ï¼Œå¤æ‚æ•°æ®æ”¾ Bodyã€‚ è°æ¥åšï¼Ÿ éœ€è¦ä½ æ‰‹åŠ¨å¤„ç†ã€‚æ¡†æ¶ä¸ä¼šè‡ªåŠ¨å¸®ä½ æŠŠä¸­æ–‡ Base64 ç¼–ç ã€‚ Body ç¼–ç  Body çš„ç¼–ç æ–¹å¼å†³å®šäº†åº”è¯¥è®¾ç½®ä»€ä¹ˆ Content-Typeï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®å®ƒæ¥é€‰æ‹©è§£ç æ–¹å¼ï¼š application/jsonï¼šUTF-8 ç¼–ç çš„ JSON æ–‡æœ¬ application/x-www-form-urlencodedï¼šç±»ä¼¼ URL Query çš„é”®å€¼å¯¹ multipart/form-dataï¼šæ–‡ä»¶ä¸Šä¼ å¸¸ç”¨ï¼Œæ¯ä¸ª part æœ‰ç‹¬ç«‹çš„ç¼–ç  è°æ¥åšï¼Ÿ JSON åºåˆ—åŒ–éœ€è¦ä½ æ‰‹åŠ¨è°ƒç”¨ï¼ˆJSONEncoder / Gsonï¼‰ï¼Œä¹‹å HTTP æ¡†æ¶ä¼šè‡ªåŠ¨è®¾ç½® Content-Type å¹¶å°è£…åˆ° HTTP æŠ¥æ–‡ä¸­ã€‚ æºç å‚è€ƒï¼š iOS Alamofireï¼šParameterEncoder.swift#L186-L193 Android Retrofitï¼šRequestBuilder.java#L195-L202 1.4 å¸¸è§ç¼–ç é™·é˜± ç©ºå€¼å¤„ç† å½“å‚æ•°å€¼ä¸º null æˆ–ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œä¸åŒçš„ HTTP å®¢æˆ·ç«¯åº“å’Œåç«¯æ¡†æ¶å¤„ç†æ–¹å¼å·®å¼‚å¾ˆå¤§ï¼š æœ‰çš„æ¡†æ¶ä¼šçœç•¥æ•´ä¸ªé”®å€¼å¯¹ æœ‰çš„ä¼šä¿ç•™é”®ä½†å€¼ä¸ºç©ºï¼škey= æœ‰çš„ä¼šä¼ å­—ç¬¦ä¸² &quot;null&quot; ä»¥ Alamofire ä¸ºä¾‹ï¼Œå®ƒæä¾›äº†ä¸‰ç§ nil ç¼–ç ç­–ç•¥ï¼š public struct NilEncoding { public static let dropKey = NilEncoding { nil } // çœç•¥æ•´ä¸ªé”®å€¼å¯¹ public static let dropValue = NilEncoding { &quot;&quot; } // ä¿ç•™é”®ï¼Œå€¼ä¸ºç©º public static let null = NilEncoding { &quot;null&quot; } // ç¼–ç ä¸ºå­—ç¬¦ä¸² &quot;null&quot; } è€Œ Gson é»˜è®¤ä¸åºåˆ—åŒ– null å­—æ®µï¼Œéœ€è¦æ˜¾å¼è°ƒç”¨ serializeNulls() æ‰ä¼šè¾“å‡ºï¼š // é»˜è®¤è¡Œä¸ºï¼š{&quot;name&quot;:&quot;å¼ ä¸‰&quot;}ï¼ˆage å­—æ®µè¢«çœç•¥ï¼‰ // è°ƒç”¨ serializeNulls() åï¼š{&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;age&quot;:null} new GsonBuilder().serializeNulls().create(); å»ºè®®åœ¨å›¢é˜Ÿå†…æ˜ç¡®çº¦å®šï¼Œé¿å…è”è°ƒæ—¶è¸©å‘ã€‚ æºç å‚è€ƒï¼š iOS Alamofireï¼šURLEncodedFormEncoder.swift#L318-L325 Android Gsonï¼šGsonBuilder.java#L235-L239 æ•°å­—ç²¾åº¦ JavaScript çš„ Number ç±»å‹æ˜¯ IEEE 754 åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œæœ€å¤§å®‰å…¨æ•´æ•°æ˜¯ 2^53 - 1ï¼ˆçº¦ 9007 ä¸‡äº¿ï¼‰ã€‚è¶…è¿‡è¿™ä¸ªèŒƒå›´çš„ IDï¼Œåœ¨ JSON åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šä¸¢å¤±ç²¾åº¦ã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç”¨å­—ç¬¦ä¸²ä¼ é€’å¤§æ•´æ•°ã€‚ æ—¶é—´æ ¼å¼ ISO 8601ï¼ˆå¦‚ 2025-12-24T10:30:00Zï¼‰æ˜¯æœ€é€šç”¨çš„æ—¶é—´æ ¼å¼ï¼Œä½†è¦æ³¨æ„æ—¶åŒºé—®é¢˜ã€‚æœ‰äº›åç«¯è¿”å›çš„æ˜¯ Unix æ—¶é—´æˆ³ï¼ˆç§’æˆ–æ¯«ç§’ï¼‰ï¼Œæœ‰äº›æ˜¯å¸¦æ—¶åŒºçš„å­—ç¬¦ä¸²ï¼Œæœ‰äº›æ˜¯ UTC æ—¶é—´â€”â€”è”è°ƒå‰åŠ¡å¿…ç¡®è®¤ã€‚ 1.5 æ•°æ®é“¾è·¯æ¦‚è§ˆ ä¸€ä¸ªå…¸å‹çš„ç½‘ç»œè¯·æ±‚ï¼Œæ•°æ®ä¼šç»å†è¿™æ ·çš„é“¾è·¯ï¼š ç†è§£è¿™ä¸ªé“¾è·¯æœ‰åŠ©äºå®šä½é—®é¢˜ï¼šç¼–ç é—®é¢˜åœ¨å“ªä¸€å±‚äº§ç”Ÿï¼Œå°±åº”è¯¥åœ¨å“ªä¸€å±‚è§£å†³ã€‚ 2. iOS ç«¯ï¼šURLSession ä¸ Alamofire çš„ç¼–è§£ç é€»è¾‘ 2.1 URLSession çš„é»˜è®¤è¡Œä¸º URL Query çš„ç»„è£… ä½¿ç”¨ URLComponents æ„å»º URL æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œ Percent-Encodingï¼š var components = URLComponents(string: &quot;https://api.example.com/users&quot;)! components.queryItems = [ URLQueryItem(name: &quot;name&quot;, value: &quot;å¼ ä¸‰&quot;), URLQueryItem(name: &quot;age&quot;, value: &quot;25&quot;) ] // ç»“æœï¼šhttps://api.example.com/users?name=%E5%BC%A0%E4%B8%89&amp;age=25 ä½†è¿™é‡Œæœ‰ä¸ªå‘ï¼šURLQueryItem å¯¹æŸäº›å­—ç¬¦çš„ç¼–ç å¯èƒ½ä¸ç¬¦åˆé¢„æœŸã€‚æ¯”å¦‚ + å·é»˜è®¤ä¸ä¼šè¢«ç¼–ç ï¼Œä½†åœ¨æŸäº›åç«¯æ¡†æ¶ä¸­ä¼šè¢«è§£æä¸ºç©ºæ ¼ã€‚å¦‚æœé‡åˆ°è¿™ç±»é—®é¢˜ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒç”¨ addingPercentEncoding(withAllowedCharacters:)ã€‚ é¿å…äºŒæ¬¡ç¼–ç  URLComponents åœ¨è®¾ç½® queryItems æ—¶ä¼šè‡ªåŠ¨è¿›è¡Œ Percent-Encodingï¼Œæ‰€ä»¥ä½ ä¼ å…¥çš„å€¼åº”è¯¥æ˜¯åŸå§‹å€¼ï¼Œè€Œä¸æ˜¯å·²ç¼–ç çš„å€¼ï¼š // âœ… æ­£ç¡®ï¼šä¼ å…¥åŸå§‹å€¼ï¼ŒURLComponents è‡ªåŠ¨ç¼–ç  components.queryItems = [URLQueryItem(name: &quot;name&quot;, value: &quot;å¼ ä¸‰&quot;)] // ç»“æœï¼šname=%E5%BC%A0%E4%B8%89 // âŒ é”™è¯¯ï¼šä¼ å…¥å·²ç¼–ç çš„å€¼ï¼Œä¼šå¯¼è‡´äºŒæ¬¡ç¼–ç  let encoded = &quot;å¼ ä¸‰&quot;.addingPercentEncoding(withAllowedCharacters: .urlQueryAllowed)! components.queryItems = [URLQueryItem(name: &quot;name&quot;, value: encoded)] // ç»“æœï¼šname=%25E5%25BC%25A0%25E4%25B8%2589ï¼ˆ% è¢«ç¼–ç æˆäº† %25ï¼‰ é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦æ‰‹åŠ¨è°ƒç”¨ addingPercentEncoding(withAllowedCharacters:)ï¼Ÿ ç›´æ¥æ‹¼æ¥ URL å­—ç¬¦ä¸²æ—¶ï¼šå¦‚æœä½ ä¸ç”¨ URLComponentsï¼Œè€Œæ˜¯æ‰‹åŠ¨æ‹¼æ¥ URLï¼Œå°±éœ€è¦è‡ªå·±ç¼–ç  URLComponents ç¼–ç ä¸ç¬¦åˆé¢„æœŸæ—¶ï¼šæ¯”å¦‚ + å·é»˜è®¤ä¸ç¼–ç ï¼Œä½†åç«¯ä¼šè§£æä¸ºç©ºæ ¼ï¼Œè¿™æ—¶éœ€è¦æ‰‹åŠ¨å¤„ç† ä½¿ç”¨ percentEncodedQuery å±æ€§æ—¶ï¼šè¿™ä¸ªå±æ€§æ¥å—å·²ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œä¸ä¼šå†æ¬¡ç¼–ç  å¤„ç†ç‰¹æ®Šå­—ç¬¦ URLQueryItem éµå¾ª RFC 3986ï¼Œä½†å®é™…å¼€å‘ä¸­æœ‰å‡ ä¸ªå­—ç¬¦éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š å­—ç¬¦ URLQueryItem æ˜¯å¦ç¼–ç  æ½œåœ¨é—®é¢˜ + âŒ ä¸ç¼–ç  åç«¯å¯èƒ½è§£æä¸ºç©ºæ ¼ &amp; âœ… ç¼–ç ä¸º %26 - = âœ… ç¼–ç ä¸º %3D - # âœ… ç¼–ç ä¸º %23 - % âŒ ä¸ç¼–ç  å¦‚æœåé¢è·Ÿçš„ä¸æ˜¯æœ‰æ•ˆåå…­è¿›åˆ¶ï¼Œå¯èƒ½è§£æå¤±è´¥ ç©ºæ ¼ âœ… ç¼–ç ä¸º %20 - æœ€å¸¸è¸©å‘çš„æ˜¯ + å·ï¼Œå› ä¸ºå®ƒåœ¨ application/x-www-form-urlencoded è§„èŒƒä¸­ä»£è¡¨ç©ºæ ¼ï¼Œè€Œ URLQueryItem ä¸ä¼šç¼–ç å®ƒã€‚å¦‚æœä½ çš„å‚æ•°å€¼æœ¬èº«åŒ…å« +ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†ï¼š // é—®é¢˜åœºæ™¯ï¼švalue åŒ…å« + å· components.queryItems = [URLQueryItem(name: &quot;formula&quot;, value: &quot;1+1=2&quot;)] // ç»“æœï¼šformula=1+1=2ï¼ˆ+ æœªç¼–ç ï¼Œåç«¯å¯èƒ½è§£æä¸º &quot;1 1=2&quot;ï¼‰ // è§£å†³æ–¹æ¡ˆï¼šæ‰‹åŠ¨æ›¿æ¢ + ä¸º %2B let safeValue = &quot;1+1=2&quot;.replacingOccurrences(of: &quot;+&quot;, with: &quot;%2B&quot;) components.percentEncodedQuery = &quot;formula=\\(safeValue)&quot; // ç»“æœï¼šformula=1%2B1=2ï¼ˆåç«¯æ­£ç¡®è§£æä¸º &quot;1+1=2&quot;ï¼‰ æˆ–è€…å°è£…ä¸€ä¸ªæ›´é€šç”¨çš„æ–¹æ³•ï¼š extension String { var urlQueryEncoded: String { var allowed = CharacterSet.urlQueryAllowed allowed.remove(&quot;+&quot;) // å°† + ä» &quot;å…è®¸å­—ç¬¦&quot; ä¸­ç§»é™¤ï¼Œå¼ºåˆ¶ç¼–ç  return self.addingPercentEncoding(withAllowedCharacters: allowed) ?? self } } // ä½¿ç”¨ components.percentEncodedQuery = &quot;formula=\\(&quot;1+1=2&quot;.urlQueryEncoded)&quot; Body çš„ JSON ç¼–ç  URLSession æœ¬èº«ä¸æä¾› JSON åºåˆ—åŒ–ï¼Œéœ€è¦é…åˆ JSONEncoderï¼š struct User: Codable { let name: String let age: Int } let user = User(name: &quot;å¼ ä¸‰&quot;, age: 25) let jsonData = try JSONEncoder().encode(user) var request = URLRequest(url: url) request.httpMethod = &quot;POST&quot; request.httpBody = jsonData request.setValue(&quot;application/json&quot;, forHTTPHeaderField: &quot;Content-Type&quot;) JSONEncoder æœ‰å‡ ä¸ªå¸¸ç”¨é…ç½®ï¼š keyEncodingStrategyï¼šé©¼å³°è½¬ä¸‹åˆ’çº¿ï¼ˆ.convertToSnakeCaseï¼‰ dateEncodingStrategyï¼šæ—¶é—´æ ¼å¼ outputFormattingï¼šæ˜¯å¦æ ¼å¼åŒ–è¾“å‡ºï¼ˆè°ƒè¯•ç”¨ï¼‰ Content-Type çš„é»˜è®¤å¤„ç† URLSession ä¸ä¼šè‡ªåŠ¨è®¾ç½® Content-Typeï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®šã€‚å¿˜è®°è®¾ç½®çš„è¯ï¼ŒæœåŠ¡ç«¯å¯èƒ½æ— æ³•æ­£ç¡®è§£æè¯·æ±‚ä½“ã€‚ 2.2 Alamofire çš„é»˜è®¤ç¼–ç è¡Œä¸º Alamofire å¯¹å‚æ•°ç¼–ç åšäº†å¾ˆå¥½çš„å°è£…ï¼Œæ ¹æ®è¯·æ±‚æ–¹æ³•è‡ªåŠ¨é€‰æ‹©ç¼–ç æ–¹å¼ï¼š HTTP æ–¹æ³• é»˜è®¤ç¼–ç æ–¹å¼ å‚æ•°ä½ç½® GET, HEAD, DELETE URL Encoding URL Query POST, PUT, PATCH JSON Encoding Request Body å‚æ•°ç¼–ç ç­–ç•¥ Alamofire æä¾›äº†ä¸‰ç§å†…ç½®ç¼–ç å™¨ï¼š // URL ç¼–ç  - å‚æ•°æ”¾åœ¨ URL Query AF.request(url, parameters: params, encoder: URLEncodedFormParameterEncoder.default) // JSON ç¼–ç  - å‚æ•°åºåˆ—åŒ–ä¸º JSON Body AF.request(url, method: .post, parameters: params, encoder: JSONParameterEncoder.default) // è¡¨å•ç¼–ç  - multipart/form-data AF.upload(multipartFormData: { formData in formData.append(imageData, withName: &quot;avatar&quot;, fileName: &quot;avatar.jpg&quot;, mimeType: &quot;image/jpeg&quot;) }, to: url) å¸¸è§é…ç½®ç‚¹ä¸æ˜“è¸©å‘ æ•°ç»„ç¼–ç æ ¼å¼ï¼šitems[]=1&amp;items[]=2 vs items=1&amp;items=2ï¼Œä¸åŒåç«¯æ¡†æ¶æœ‰ä¸åŒåå¥½ å¸ƒå°”å€¼ç¼–ç ï¼štrue/false vs 1/0 åµŒå¥—å¯¹è±¡ï¼šuser[name]=å¼ ä¸‰ vs user.name=å¼ ä¸‰ Alamofire çš„ URLEncodedFormParameterEncoder æä¾›äº† ArrayEncoding å’Œ BoolEncoding é€‰é¡¹æ¥å¤„ç†è¿™äº›å·®å¼‚ã€‚ 3. æœåŠ¡ç«¯ï¼šJackson ä¸ Spring çš„ç¼–è§£ç  åœ¨çœ‹å®Œå®¢æˆ·ç«¯å¦‚ä½•å¤„ç†ç¼–è§£ç ä¹‹åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æœåŠ¡ç«¯æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ç†è§£å…¨é“¾è·¯æœ‰åŠ©äºæ’æŸ¥è”è°ƒé—®é¢˜ã€‚ æœ¬ç« åŸºäº Java 17 ä¸ Spring Boot 3.3.6ã€‚å³ä½¿ä½ æ²¡æœ‰ Java å¼€å‘ç»éªŒï¼Œä¹Ÿèƒ½è¯»æ‡‚æ ¸å¿ƒé€»è¾‘ã€‚ 3.1 Spring ä¸ Jacksonï¼šè°è´Ÿè´£ä»€ä¹ˆ å…ˆæ¾„æ¸…ä¸€ä¸ªæ¦‚å¿µï¼šSpring æœ¬èº«ä¸å¤„ç† JSON ç¼–è§£ç ï¼Œè¿™ä¸ªå·¥ä½œç”± Jackson å®Œæˆã€‚ Jackson æ˜¯ Java ç”Ÿæ€ä¸­æœ€æµè¡Œçš„ JSON åº“ï¼Œç±»ä¼¼äºï¼š iOS çš„ Codable + JSONEncoder / JSONDecoder Android çš„ Gson JavaScript çš„ JSON.stringify / JSON.parse Spring æ˜¯ Web æ¡†æ¶ï¼Œå®ƒçš„èŒè´£æ˜¯ï¼š æ¥æ”¶ HTTP è¯·æ±‚ï¼Œæå–å‚æ•° è°ƒç”¨ Jackson è¿›è¡Œ JSON ç¼–è§£ç  è°ƒç”¨ä¸šåŠ¡é€»è¾‘ï¼Œè¿”å›å“åº” ç”¨å›¾æ¥è¡¨ç¤ºï¼š æ‰€ä»¥ï¼Œå½“ä½ é‡åˆ° JSON ç›¸å…³çš„é—®é¢˜æ—¶ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åº”è¯¥å»çœ‹ Jackson çš„æ–‡æ¡£å’Œé…ç½®ã€‚ 3.2 Jackson æ ¸å¿ƒæœºåˆ¶ Jackson çš„æ ¸å¿ƒæ˜¯ ObjectMapper ç±»ï¼Œå®ƒæä¾›äº†ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•ï¼š ObjectMapper mapper = new ObjectMapper(); // åºåˆ—åŒ–ï¼šJava å¯¹è±¡ â†’ JSON å­—ç¬¦ä¸² String json = mapper.writeValueAsString(user); // ååºåˆ—åŒ–ï¼šJSON å­—ç¬¦ä¸² â†’ Java å¯¹è±¡ User user = mapper.readValue(json, User.class); åºåˆ—åŒ–æµç¨‹ å½“è°ƒç”¨ writeValueAsString() æ—¶ï¼ŒJackson å†…éƒ¨ä¼šï¼š æŸ¥æ‰¾åºåˆ—åŒ–å™¨ï¼šæ ¹æ®å¯¹è±¡ç±»å‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„ JsonSerializer åå°„è·å–å­—æ®µï¼šé€šè¿‡ Java åå°„æœºåˆ¶ï¼Œè·å–å¯¹è±¡çš„æ‰€æœ‰å­—æ®µå’Œ getter æ–¹æ³• é€ä¸ªåºåˆ—åŒ–ï¼šå¯¹æ¯ä¸ªå­—æ®µè°ƒç”¨å¯¹åº”çš„åºåˆ—åŒ–å™¨ï¼Œç”Ÿæˆ JSON ç‰‡æ®µ ç»„è£…è¾“å‡ºï¼šå°†æ‰€æœ‰ç‰‡æ®µç»„è£…æˆå®Œæ•´çš„ JSON å­—ç¬¦ä¸² // ç®€åŒ–çš„åºåˆ—åŒ–æµç¨‹ï¼ˆæºç ä½ç½®ï¼šDefaultSerializerProvider.java#L320ï¼‰ public void serializeValue(JsonGenerator gen, Object value) { if (value == null) { _serializeNull(gen); return; } // æ ¹æ®å¯¹è±¡ç±»å‹æŸ¥æ‰¾åºåˆ—åŒ–å™¨ Class&lt;?&gt; cls = value.getClass(); JsonSerializer&lt;Object&gt; ser = findTypedValueSerializer(cls, true, null); // æ‰§è¡Œåºåˆ—åŒ– _serialize(gen, value, ser); } æºç å‚è€ƒï¼šDefaultSerializerProvider.java#L321-L342 ååºåˆ—åŒ–æµç¨‹ å½“è°ƒç”¨ readValue() æ—¶ï¼ŒJackson å†…éƒ¨ä¼šï¼š è§£æ JSONï¼šå°† JSON å­—ç¬¦ä¸²è§£ææˆ token æµ æŸ¥æ‰¾ååºåˆ—åŒ–å™¨ï¼šæ ¹æ®ç›®æ ‡ç±»å‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„ JsonDeserializer åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼šè°ƒç”¨ç›®æ ‡ç±»çš„æ— å‚æ„é€ å‡½æ•°ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Jackson éœ€è¦æ— å‚æ„é€ å‡½æ•°ï¼‰ å¡«å……å­—æ®µï¼šæ ¹æ® JSON ä¸­çš„ keyï¼Œæ‰¾åˆ°å¯¹åº”çš„å­—æ®µæˆ– setterï¼Œè®¾ç½®å€¼ // ç®€åŒ–çš„ååºåˆ—åŒ–é€»è¾‘ public &lt;T&gt; T readValue(String content, Class&lt;T&gt; valueType) { // åˆ›å»º JSON è§£æå™¨ JsonParser parser = _jsonFactory.createParser(content); // æŸ¥æ‰¾ååºåˆ—åŒ–å™¨å¹¶æ‰§è¡Œ return _readMapAndClose(parser, _typeFactory.constructType(valueType)); } ç±»å‹æ˜ å°„ Jackson åœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œç±»å‹è½¬æ¢ï¼š JSON ç±»å‹ Java ç±»å‹ &quot;string&quot; String 123 int, long, Integer, Long 12.34 double, float, Double, Float, BigDecimal true/false boolean, Boolean null nullï¼ˆå¼•ç”¨ç±»å‹ï¼‰ [...] List, Set, æ•°ç»„ {...} Map, è‡ªå®šä¹‰å¯¹è±¡ 3.3 Spring å¦‚ä½•è°ƒç”¨ Jackson Spring é€šè¿‡ HttpMessageConverter æœºåˆ¶æ¥å¤„ç†è¯·æ±‚å’Œå“åº”çš„è½¬æ¢ã€‚å¯¹äº JSONï¼Œä½¿ç”¨çš„æ˜¯ MappingJackson2HttpMessageConverterã€‚ @RequestBody çš„å¤„ç†æµç¨‹ å½“ Spring é‡åˆ° @RequestBody æ³¨è§£æ—¶ï¼š @PostMapping(&quot;/users&quot;) public User createUser(@RequestBody User user) { return userService.save(user); } å†…éƒ¨å¤„ç†æµç¨‹ï¼š Spring æ£€æŸ¥è¯·æ±‚çš„ Content-Typeï¼Œå‘ç°æ˜¯ application/json é€‰æ‹© MappingJackson2HttpMessageConverter æ¥å¤„ç† Converter å†…éƒ¨è°ƒç”¨ Jackson çš„ ObjectMapper.readValue() è¿›è¡Œååºåˆ—åŒ– // AbstractJackson2HttpMessageConverter.javaï¼ˆç®€åŒ–ï¼‰ @Override protected Object readInternal(Class&lt;?&gt; clazz, HttpInputMessage inputMessage) { JavaType javaType = getJavaType(clazz, null); return readJavaType(javaType, inputMessage); } private Object readJavaType(JavaType javaType, HttpInputMessage inputMessage) { ObjectMapper objectMapper = selectObjectMapper(clazz, contentType); ObjectReader objectReader = objectMapper.readerFor(javaType); // è°ƒç”¨ Jackson è¿›è¡Œååºåˆ—åŒ– return objectReader.readValue(inputMessage.getBody()); } æºç å‚è€ƒï¼šAbstractJackson2HttpMessageConverter.java#L357-L408 @ResponseBody çš„å¤„ç†æµç¨‹ å½“æ–¹æ³•è¿”å›å€¼éœ€è¦è½¬æ¢ä¸º JSON æ—¶ï¼ˆ@RestController é»˜è®¤åŒ…å« @ResponseBodyï¼‰ï¼š Spring æ£€æŸ¥å®¢æˆ·ç«¯çš„ Accept å¤´ï¼Œç¡®å®šè¿”å›æ ¼å¼ é€‰æ‹© MappingJackson2HttpMessageConverter æ¥å¤„ç† Converter å†…éƒ¨è°ƒç”¨ Jackson çš„ ObjectMapper.writeValue() è¿›è¡Œåºåˆ—åŒ– // AbstractJackson2HttpMessageConverter.javaï¼ˆç®€åŒ–ï¼‰ @Override protected void writeInternal(Object object, HttpOutputMessage outputMessage) { ObjectMapper objectMapper = selectObjectMapper(object.getClass(), contentType); ObjectWriter objectWriter = objectMapper.writer(); // è°ƒç”¨ Jackson è¿›è¡Œåºåˆ—åŒ– objectWriter.writeValue(generator, object); } æºç å‚è€ƒï¼šAbstractJackson2HttpMessageConverter.java#L439-L487 3.4 Jackson å¸¸ç”¨é…ç½® Jackson æ˜¯ Spring é»˜è®¤çš„ JSON åº“ï¼Œå®ƒçš„è¡Œä¸ºå¯ä»¥é€šè¿‡æ³¨è§£æˆ–å…¨å±€é…ç½®æ¥è°ƒæ•´ã€‚ ç©ºå€¼å¤„ç†ï¼š@JsonInclude Jackson é»˜è®¤ä¼šåºåˆ—åŒ–æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬ nullï¼š public class User { private String name = &quot;å¼ ä¸‰&quot;; private String email = null; } // é»˜è®¤è¾“å‡ºï¼š{&quot;name&quot;:&quot;å¼ ä¸‰&quot;,&quot;email&quot;:null} å¦‚æœä½ æƒ³çœç•¥ null å­—æ®µï¼ˆå’Œ Gson é»˜è®¤è¡Œä¸ºä¸€è‡´ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ @JsonIncludeï¼š @JsonInclude(JsonInclude.Include.NON_NULL) public class User { private String name = &quot;å¼ ä¸‰&quot;; private String email = null; } // è¾“å‡ºï¼š{&quot;name&quot;:&quot;å¼ ä¸‰&quot;} @JsonInclude çš„å¸¸ç”¨é€‰é¡¹ï¼š é€‰é¡¹ è¡Œä¸º ALWAYS å§‹ç»ˆåŒ…å«ï¼ˆé»˜è®¤ï¼‰ NON_NULL æ’é™¤ null å€¼ NON_EMPTY æ’é™¤ nullã€ç©ºå­—ç¬¦ä¸²ã€ç©ºé›†åˆ NON_DEFAULT æ’é™¤ç­‰äºé»˜è®¤å€¼çš„å­—æ®µ æºç å‚è€ƒï¼šJsonInclude.java#L113-L241 - Include æšä¸¾ å‘½åç­–ç•¥ï¼šé©¼å³° vs ä¸‹åˆ’çº¿ Java ä¹ æƒ¯ç”¨é©¼å³°å‘½åï¼ˆuserNameï¼‰ï¼Œè€Œå¾ˆå¤š API è§„èŒƒè¦æ±‚ä¸‹åˆ’çº¿ï¼ˆuser_nameï¼‰ã€‚Jackson æä¾›äº† PropertyNamingStrategiesï¼š // å…¨å±€é…ç½®ï¼ˆSpring Boot application.ymlï¼‰ spring: jackson: property-naming-strategy: SNAKE_CASE // æˆ–è€…å•ä¸ªç±»é…ç½® @JsonNaming(PropertyNamingStrategies.SnakeCaseStrategy.class) public class User { private String userName; // åºåˆ—åŒ–ä¸º &quot;user_name&quot; } æ—¶é—´æ ¼å¼ Jackson é»˜è®¤æŠŠ Date åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ï¼Œå¦‚æœä½ æƒ³è¦ ISO 8601 æ ¼å¼ï¼š // å…¨å±€é…ç½® spring: jackson: date-format: yyyy-MM-dd'T'HH:mm:ss.SSSZ time-zone: UTC // æˆ–è€…å•ä¸ªå­—æ®µé…ç½® @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;Asia/Shanghai&quot;) private Date createTime; 3.5 URL Query ä¸å­—ç¬¦ç¼–ç  å‰é¢è®²çš„éƒ½æ˜¯ JSON Body çš„ç¼–è§£ç ï¼Œç”± Jackson è´Ÿè´£ã€‚ä½† URL Query çš„è§£ç å’Œ Jackson æ— å…³ï¼Œè¿™éƒ¨åˆ†ç”± Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰å’Œ Spring å…±åŒå®Œæˆã€‚ è§£ç æµç¨‹æ¦‚è§ˆ å½“å®¢æˆ·ç«¯å‘é€ GET /users?name=%E5%BC%A0%E4%B8%89&amp;age=25 æ—¶ï¼Œè§£ç æµç¨‹å¦‚ä¸‹ï¼š Tomcat çš„å‚æ•°è§£ç  Tomcat åœ¨é¦–æ¬¡è°ƒç”¨ request.getParameter() æ—¶æ‰ä¼šè§£æå‚æ•°ï¼ˆå»¶è¿Ÿè§£æï¼‰ã€‚æ ¸å¿ƒé€»è¾‘åœ¨ Parameters ç±»ä¸­ï¼š // Tomcat Parameters.javaï¼ˆç®€åŒ–ï¼‰ private void processParameters(byte[] bytes, int start, int len, Charset charset) { int pos = start; int end = start + len; while (pos &lt; end) { // æ‰¾åˆ° key=value å¯¹ int nameStart = pos; int nameEnd = -1; int valueStart = -1; int valueEnd = -1; // è§£æ key å’Œ value çš„è¾¹ç•Œ while (pos &lt; end) { byte b = bytes[pos]; if (b == '=' &amp;&amp; nameEnd == -1) { nameEnd = pos; valueStart = pos + 1; } else if (b == '&amp;') { valueEnd = pos; break; } pos++; } // å¯¹ key å’Œ value è¿›è¡Œ URL è§£ç  // %E5%BC%A0 â†’ 0xE5 0xBC 0xA0 â†’ &quot;å¼ &quot;ï¼ˆUTF-8ï¼‰ String name = urlDecode(bytes, nameStart, nameEnd, charset); String value = urlDecode(bytes, valueStart, valueEnd, charset); addParameter(name, value); } } æºç å‚è€ƒï¼šTomcat Parameters.java#L234-L463 Spring çš„ @RequestParam å¤„ç† Spring é€šè¿‡ RequestParamMethodArgumentResolver å¤„ç† @RequestParam æ³¨è§£ï¼š @GetMapping(&quot;/users&quot;) public List&lt;User&gt; getUsers( @RequestParam String name, // è‡ªåŠ¨è§£ç ä¸º &quot;å¼ ä¸‰&quot; @RequestParam int age // è‡ªåŠ¨è½¬æ¢ä¸ºæ•´æ•° 25 ) { // ... } Spring å†…éƒ¨çš„å¤„ç†é€»è¾‘ï¼š // RequestParamMethodArgumentResolver.javaï¼ˆç®€åŒ–ï¼‰ @Override protected Object resolveName(String name, MethodParameter parameter, NativeWebRequest request) throws Exception { HttpServletRequest servletRequest = request.getNativeRequest(HttpServletRequest.class); // è°ƒç”¨ Servlet API è·å–å‚æ•°ï¼ˆæ­¤æ—¶ Tomcat å·²å®Œæˆè§£ç ï¼‰ String[] paramValues = servletRequest.getParameterValues(name); if (paramValues != null) { return paramValues.length == 1 ? paramValues[0] : paramValues; } return null; } æºç å‚è€ƒï¼šRequestParamMethodArgumentResolver.java#L160-L190 CharacterEncodingFilter çš„ä½œç”¨ Spring Boot é»˜è®¤é…ç½®äº† CharacterEncodingFilterï¼Œç¡®ä¿ Tomcat ä½¿ç”¨ UTF-8 è§£ç å‚æ•°ï¼š // CharacterEncodingFilter.javaï¼ˆç®€åŒ–ï¼‰ @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) { String encoding = getEncoding(); // é»˜è®¤ UTF-8 // åœ¨ Tomcat è§£æå‚æ•°ä¹‹å‰è®¾ç½®ç¼–ç  if (isForceRequestEncoding() || request.getCharacterEncoding() == null) { request.setCharacterEncoding(encoding); } if (isForceResponseEncoding()) { response.setCharacterEncoding(encoding); } filterChain.doFilter(request, response); } æºç å‚è€ƒï¼šCharacterEncodingFilter.java#L187-L202 ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ CharacterEncodingFilter å¿…é¡»åœ¨å‚æ•°è§£æä¹‹å‰æ‰§è¡Œï¼Œå¦åˆ™ Tomcat ä¼šä½¿ç”¨é»˜è®¤ç¼–ç ï¼ˆé€šå¸¸æ˜¯ ISO-8859-1ï¼‰è§£ç å‚æ•°ï¼Œå¯¼è‡´ä¸­æ–‡ä¹±ç ã€‚Spring Boot é»˜è®¤å°†è¿™ä¸ª Filter é…ç½®ä¸ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šé‡åˆ°é—®é¢˜ã€‚ å¦‚æœé‡åˆ° URL Query ä¸­æ–‡ä¹±ç ï¼Œæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š CharacterEncodingFilter æ˜¯å¦æ­£ç¡®é…ç½® Tomcat çš„ URIEncoding é…ç½®ï¼ˆserver.xml ä¸­çš„ Connector é…ç½®ï¼‰ å®¢æˆ·ç«¯æ˜¯å¦ä½¿ç”¨ UTF-8 ç¼–ç  3.6 å¸¸è§é—®é¢˜æ’æŸ¥ é—®é¢˜ 1ï¼šå®¢æˆ·ç«¯å‘é€çš„ JSON å­—æ®µï¼Œåç«¯æ”¶åˆ°æ˜¯ null å¯èƒ½åŸå› ï¼š å‘½åä¸ä¸€è‡´ï¼šå®¢æˆ·ç«¯å‘ user_nameï¼Œåç«¯å­—æ®µæ˜¯ userNameï¼Œä¸”æ²¡é…ç½® SNAKE_CASE ç±»å‹ä¸åŒ¹é…ï¼šå®¢æˆ·ç«¯å‘å­—ç¬¦ä¸² &quot;25&quot;ï¼Œåç«¯æœŸæœ› intï¼ˆJackson é€šå¸¸èƒ½è‡ªåŠ¨è½¬æ¢ï¼Œä½†å¤æ‚ç±»å‹å¯èƒ½å¤±è´¥ï¼‰ ç¼ºå°‘æ— å‚æ„é€ å‡½æ•°ï¼šJackson ååºåˆ—åŒ–éœ€è¦æ— å‚æ„é€ å‡½æ•° é—®é¢˜ 2ï¼šåç«¯è¿”å›çš„ JSON å­—æ®µé¡ºåºå’Œé¢„æœŸä¸åŒ Jackson é»˜è®¤ä¸ä¿è¯å­—æ®µé¡ºåºã€‚å¦‚æœæœ‰é¡ºåºè¦æ±‚ï¼Œä½¿ç”¨ @JsonPropertyOrderï¼š @JsonPropertyOrder({&quot;id&quot;, &quot;name&quot;, &quot;email&quot;}) public class User { ... } é—®é¢˜ 3ï¼šå‰åç«¯ç©ºå€¼çº¦å®šä¸ä¸€è‡´ è¿™æ˜¯è”è°ƒä¸­æœ€å¸¸è§çš„é—®é¢˜ã€‚å»ºè®®å›¢é˜Ÿç»Ÿä¸€çº¦å®šï¼š åœºæ™¯ å®¢æˆ·ç«¯è¡Œä¸º åç«¯è¡Œä¸º å­—æ®µä¸ä¼  ä¸åŒ…å«è¯¥ key ä½¿ç”¨é»˜è®¤å€¼æˆ–åˆ¤æ–­ä¸º null ä¼  null &quot;field&quot;: null æ¥æ”¶ä¸º null ä¼ ç©ºå­—ç¬¦ä¸² &quot;field&quot;: &quot;&quot; æ¥æ”¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆæ³¨æ„ï¼šä¸ç­‰äº nullï¼‰ 3.7 ä¸å®¢æˆ·ç«¯ç¼–ç çš„å¯¹åº”å…³ç³» å®¢æˆ·ç«¯æ“ä½œ åç«¯å¤„ç† URLComponents ç¼–ç ä¸­æ–‡ @RequestParam è‡ªåŠ¨ URL è§£ç  JSONEncoder åºåˆ—åŒ–å¯¹è±¡ Jackson ååºåˆ—åŒ–ä¸º Java å¯¹è±¡ è®¾ç½® Content-Type: application/json Spring é€‰æ‹© MappingJackson2HttpMessageConverter Alamofire JSONParameterEncoder ç­‰åŒäºä¸Šè¿°ç»„åˆ ç†è§£äº†è¿™ä¸ªå¯¹åº”å…³ç³»ï¼Œè”è°ƒæ—¶é‡åˆ°é—®é¢˜å°±çŸ¥é“è¯¥ä»å“ªè¾¹æ’æŸ¥äº†ã€‚ 4. å»¶ä¼¸é˜…è¯»ï¼šJS Bridge çš„ç¼–è§£ç é€»è¾‘ å¦‚æœä½ å¯¹ Native ä¸ H5 ä¹‹é—´çš„ JS Bridge é€šä¿¡æœºåˆ¶æ„Ÿå…´è¶£ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡ç‹¬ç«‹çš„è§£ææ–‡ç« ï¼š ğŸ‘‰ iOS &amp; Android &amp; H5 ä¸‰ç«¯ JS Bridge çš„ç¼–è§£ç é€»è¾‘ä¸æºç åˆ†æ è¿™ç¯‡æ–‡ç« ä»æºç å±‚é¢æ‹†è§£äº† JS Bridge çš„ç¼–è§£ç é€»è¾‘ï¼ŒåŒ…æ‹¬ï¼š æ¶ˆæ¯ç»“æ„ä¸å›è°ƒæœºåˆ¶ iOSï¼ˆmarcuswestin/WebViewJavascriptBridgeï¼‰çš„å®ç°ç»†èŠ‚ Androidï¼ˆwendux/WebViewJavascriptBridgeï¼‰çš„å®ç°ç»†èŠ‚ H5 ç«¯çš„ JavaScript æ³¨å…¥ä¸æ¶ˆæ¯å¤„ç† ä¸‰ç«¯çš„å·®å¼‚ä¸æ³¨æ„ç‚¹ 5. æ€»ç»“ 5.1 å…¨é“¾è·¯ç¼–è§£ç æ¦‚è§ˆ ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚-å“åº”å‘¨æœŸä¸­ï¼Œæ•°æ®ç»å†çš„ç¼–è§£ç è¿‡ç¨‹ï¼š 5.2 æŒ‰è¯·æ±‚ç±»å‹çš„ç¼–è§£ç å¯¹ç…§ ä¸åŒçš„è¯·æ±‚ç±»å‹ï¼Œç¼–è§£ç çš„æ–¹å¼å’Œè´Ÿè´£äººä¸åŒï¼š GET è¯·æ±‚ï¼ˆå‚æ•°åœ¨ URL Queryï¼‰ é˜¶æ®µ ä½ç½® è´Ÿè´£äºº è‡ªåŠ¨/æ‰‹åŠ¨ è¯´æ˜ å®¢æˆ·ç«¯ç¼–ç  URL Query URLComponents / Uri.Builder âœ… è‡ªåŠ¨ Percent-Encoding æœåŠ¡ç«¯è§£ç  URL Query Tomcatï¼ˆServlet å®¹å™¨ï¼‰ âœ… è‡ªåŠ¨ request.getParameter() æ—¶è§£ç  POST / PUT / PATCH è¯·æ±‚ï¼ˆJSON Bodyï¼‰ é˜¶æ®µ ä½ç½® è´Ÿè´£äºº è‡ªåŠ¨/æ‰‹åŠ¨ è¯´æ˜ å®¢æˆ·ç«¯ç¼–ç  Body JSONEncoder / Gson âš ï¸ æ‰‹åŠ¨è°ƒç”¨ éœ€æ˜¾å¼è°ƒç”¨åºåˆ—åŒ–æ–¹æ³• æœåŠ¡ç«¯è§£ç  Body Jackson âœ… è‡ªåŠ¨ @RequestBody è§¦å‘è‡ªåŠ¨ååºåˆ—åŒ– æœåŠ¡ç«¯ç¼–ç  Body Jackson âœ… è‡ªåŠ¨ @ResponseBody è§¦å‘è‡ªåŠ¨åºåˆ—åŒ– å®¢æˆ·ç«¯è§£ç  Body JSONDecoder / Gson âš ï¸ æ‰‹åŠ¨è°ƒç”¨ éœ€æ˜¾å¼è°ƒç”¨ååºåˆ—åŒ–æ–¹æ³• POST è¯·æ±‚ï¼ˆForm URL-Encodedï¼‰ é˜¶æ®µ ä½ç½® è´Ÿè´£äºº è‡ªåŠ¨/æ‰‹åŠ¨ è¯´æ˜ å®¢æˆ·ç«¯ç¼–ç  Body HTTP æ¡†æ¶ï¼ˆAlamofire / OkHttpï¼‰ âœ… è‡ªåŠ¨ ç±»ä¼¼ URL Query çš„ç¼–ç  æœåŠ¡ç«¯è§£ç  Body Tomcatï¼ˆServlet å®¹å™¨ï¼‰ âœ… è‡ªåŠ¨ ä¸ URL Query å¤„ç†æ–¹å¼ç›¸åŒ 5.3 ç¼–è§£ç è´£ä»»é€ŸæŸ¥è¡¨ æ•°æ®ä½ç½® å®¢æˆ·ç«¯ç¼–ç  æœåŠ¡ç«¯è§£ç  æœåŠ¡ç«¯ç¼–ç  å®¢æˆ·ç«¯è§£ç  URL Query URLComponents Tomcat - - JSON Body JSONEncoder/Gson Jackson Jackson JSONDecoder/Gson Form Body HTTP æ¡†æ¶ Tomcat - - Header æ‰‹åŠ¨å¤„ç† æ‰‹åŠ¨å¤„ç† æ‰‹åŠ¨å¤„ç† æ‰‹åŠ¨å¤„ç† ğŸ’¡ è®°å¿†æŠ€å·§ï¼šURL ç›¸å…³çš„ç¼–è§£ç ç”±ã€ŒURL å¤„ç†ç»„ä»¶ã€è´Ÿè´£ï¼ˆURLComponentsã€Tomcatï¼‰ï¼ŒJSON ç›¸å…³çš„ç”±ã€ŒJSON åº“ã€è´Ÿè´£ï¼ˆJSONEncoderã€Jacksonã€Gsonï¼‰ã€‚ 5.4 ç»Ÿä¸€ç¼–ç è§„èŒƒçš„ä»·å€¼ é€šè¿‡è¿™ç¯‡æ–‡ç« çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šç¼–è§£ç é—®é¢˜å¾€å¾€ä¸æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œè€Œæ˜¯çº¦å®šé—®é¢˜ã€‚ æ— è®ºæ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„ HTTP æ¥å£ï¼Œåªè¦å„ç«¯çº¦å®šå¥½ï¼š å­—ç¬¦é›†ç»Ÿä¸€ç”¨ UTF-8 æ—¶é—´æ ¼å¼ç»Ÿä¸€ç”¨ ISO 8601 æˆ–æ—¶é—´æˆ³ ç©ºå€¼ç»Ÿä¸€ç”¨ null è¿˜æ˜¯çœç•¥ å¤§æ•´æ•°ç»Ÿä¸€ç”¨å­—ç¬¦ä¸² å°±èƒ½é¿å…ç»å¤§å¤šæ•°è”è°ƒé—®é¢˜ã€‚ è‡³æ­¤ï¼Œå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å»ºç«‹èµ·å¯¹ HTTP ç¼–ç çš„æ•´ä½“è®¤è¯†ã€‚ä¸‹æ¬¡é‡åˆ°ã€Œä¹±ç ã€ã€ã€Œå­—æ®µä¸¢å¤±ã€è¿™ç±»é—®é¢˜æ—¶ï¼Œå¸Œæœ›ä½ èƒ½çŸ¥é“è¯¥ä»å“ªé‡Œå¼€å§‹æ’æŸ¥äº†ã€‚ ","link":"https://blog.rakuyo.dev/http-encoding-and-jsbridge-cross-platform/"},{"title":"JavaScript console.log æ‰“å°å¯¹è±¡çš„å¼•ç”¨é™·é˜±ä¸ DevTools å»¶è¿Ÿå±•å¼€æœºåˆ¶","content":"æœ€è¿‘åœ¨å°çº¢ä¹¦ä¸Šçœ‹åˆ°ä¸€ä¸ªå¸–å­ï¼šåç«¯è½¬å‰ç«¯å‘ç°è¯¡å¼‚bugï¼Œä»–é‡åˆ°äº†è¿™æ ·çš„è¯¡å¼‚ç°è±¡ï¼š é—®é¢˜æè¿° ç°è±¡ï¼šæµè§ˆå™¨ Network é¢æ¿æ˜¾ç¤ºæ¥å£è¿”å›çš„ JSON æ•°æ®ä¸­ createdBy å­—æ®µå­˜åœ¨ä¸”æœ‰å€¼ é—®é¢˜ï¼šé€šè¿‡ axios è¯·æ±‚æ•°æ®åï¼Œä½¿ç”¨ console.log æ‰“å° response.dataï¼Œå±•å¼€å¯¹è±¡æ—¶è¯¥å­—æ®µæ˜¾ç¤ºä¸º undefined ç¯å¢ƒï¼šæµè§ˆå™¨ç¯å¢ƒï¼ˆChrome DevToolsï¼‰ï¼Œä½¿ç”¨ axios åº“ï¼Œä» Vue 3 é¡¹ç›®è¿ç§»éƒ¨åˆ†ä»£ç  å€Ÿç€è¿™ä¸ªé—®é¢˜ï¼Œè¯„è®ºåŒºæœ‰ä¸€ä¸ª momo å¤§ä½¬é¡ºåŠ¿æå‡ºäº†ä¸€é“é¢è¯•é¢˜ï¼š è¯·è§£é‡Šä¸ºä»€ä¹ˆåœ¨ JavaScript ä¸­ console.log æœ‰æ—¶æ‰“å°çš„ä¸æ˜¯è¿è¡Œå½“ä¸‹çš„å€¼ï¼Œè€Œæ˜¯å¯¹è±¡çš„æœ€ç»ˆå€¼ã€‚ ç‰¹åˆ«æ˜¯åœ¨ axios è¯·æ±‚åœºæ™¯ä¸­ï¼Œä¸ºä»€ä¹ˆ console.log(response.data) æ˜¾ç¤ºçš„å†…å®¹ä¼šå’Œæµè§ˆå™¨ Network é¢æ¿é‡Œçš„åŸå§‹å“åº”æ•°æ®ä¸ä¸€è‡´ã€‚ è¯·ç»“åˆå¯¹è±¡å¼•ç”¨ã€DevTools å»¶è¿Ÿå±•å¼€æœºåˆ¶è¿›è¡Œè¯´æ˜ï¼Œå¹¶ç»™å‡ºä¸€ä¸ªæœ€å°å¯å¤ç°çš„ä»£ç ç¤ºä¾‹ï¼ˆåŒ…å« axios æˆ–æ¨¡æ‹Ÿå¼‚æ­¥ä¿®æ”¹å¯¹è±¡çš„åœºæ™¯ï¼‰ï¼Œ åŒæ—¶ç»™å‡ºè‡³å°‘ä¸¤ç§æ­£ç¡®æ‰“å°â€œå½“æ—¶å¿«ç…§å€¼â€çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶è¯´æ˜å„è‡ªçš„é€‚ç”¨åœºæ™¯ã€‚ è´´ä¸»çš„è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆåŒæ—¶ä¹Ÿæ˜¯ momo å¤§ä½¬è¿™é“é¢è¯•é¢˜çš„ç­”æ¡ˆï¼Œå…¶æœ¬è´¨æ¶‰åŠä¸‰ä¸ªå±‚é¢ï¼š JavaScript å¯¹è±¡çš„å¼•ç”¨ä¼ é€’æœºåˆ¶ æµè§ˆå™¨ DevTools çš„å»¶è¿Ÿå±•å¼€å®ç° Vue 3 å“åº”å¼æ•°æ®çš„è®¿é—®æ–¹å¼ åŸå› åˆ†æ æµè§ˆå™¨ console.log çš„å»¶è¿Ÿå±•å¼€æœºåˆ¶ æ ¸å¿ƒæœºåˆ¶ å½“åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œ console.log(obj) æ—¶ï¼Œæ§åˆ¶å°çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š æ‰“å°é˜¶æ®µï¼šå­˜å‚¨è¯¥å¯¹è±¡çš„å†…å­˜å¼•ç”¨ï¼ˆè€Œéå€¼çš„å¿«ç…§ï¼‰ å±•å¼€é˜¶æ®µï¼šç”¨æˆ·ç‚¹å‡»æ§åˆ¶å°ä¸­çš„å¯¹è±¡æ—¶ï¼ŒDevTools è¯»å–è¯¥å¼•ç”¨æŒ‡å‘çš„å½“å‰å€¼ æ˜¾ç¤ºç»“æœï¼šå¦‚æœå¯¹è±¡åœ¨æ‰“å°åè¢«ä¿®æ”¹ï¼Œå±•å¼€æ—¶çœ‹åˆ°çš„æ˜¯ä¿®æ”¹åçš„å€¼ è¿™æ˜¯æµè§ˆå™¨ä¸ºäº†æ€§èƒ½ä¼˜åŒ–è€Œé‡‡å–çš„è®¾è®¡ï¼š é¿å…åœ¨æ‰“å°æ—¶æ·±åº¦éå†å’Œåºåˆ—åŒ–å¤§å‹å¯¹è±¡ èŠ‚çœå†…å­˜ï¼Œä¸éœ€è¦å­˜å‚¨å¯¹è±¡çš„å®Œæ•´å‰¯æœ¬ æå‡æ§åˆ¶å°å“åº”é€Ÿåº¦ å»¶è¿Ÿå±•å¼€çš„å‰¯ä½œç”¨ const data = { value: 1 }; console.log('æ‰“å°æ—¶åˆ»:', data); data.value = 2; // æ­¤æ—¶åœ¨æ§åˆ¶å°å±•å¼€ dataï¼Œçœ‹åˆ°çš„æ˜¯ { value: 2 } ä¸Šè¿°ä»£ç ä¸­ï¼Œè™½ç„¶æ‰“å°å‘ç”Ÿåœ¨ä¿®æ”¹ä¹‹å‰ï¼Œä½†ç”±äºå­˜å‚¨çš„æ˜¯å¼•ç”¨ï¼Œå±•å¼€æ—¶è¯»å–çš„æ˜¯ä¿®æ”¹åçš„å€¼ã€‚ æµè§ˆå™¨çš„æç¤ºæœºåˆ¶ Chrome DevTools ä¼šåœ¨æŸäº›æƒ…å†µä¸‹åœ¨æ§åˆ¶å°æ˜¾ç¤ºä¸€ä¸ª â“˜ æ ‡è®°ï¼Œæç¤ºç”¨æˆ·ï¼š&quot;Value below was evaluated just now&quot;ï¼ˆä¸‹é¢çš„å€¼æ˜¯åˆšåˆšè®¡ç®—çš„ï¼‰ã€‚è¿™è¯´æ˜å±•å¼€æ—¶çš„å€¼å¯èƒ½ä¸æ‰“å°æ—¶ä¸åŒã€‚ ç¯å¢ƒå·®å¼‚ï¼šæµè§ˆå™¨ vs Node.js ä¸åŒ JavaScript è¿è¡Œç¯å¢ƒå¯¹ console.log çš„å®ç°ä¸åŒï¼š ç¯å¢ƒ å®ç°æ–¹å¼ ç‰¹ç‚¹ æµè§ˆå™¨ å­˜å‚¨å¯¹è±¡å¼•ç”¨ï¼Œå»¶è¿Ÿå±•å¼€ æ€§èƒ½å¥½ï¼Œä½†å¯èƒ½æ˜¾ç¤º&quot;æœªæ¥çš„å€¼&quot; Node.js ç«‹å³åºåˆ—åŒ–å¯¹è±¡ æ˜¾ç¤ºæ‰“å°æ—¶åˆ»çš„å‡†ç¡®å€¼ åœ¨ Node.js ä¸­æ‰§è¡Œç›¸åŒä»£ç ï¼š const data = { value: 1 }; console.log('æ‰“å°æ—¶åˆ»:', data); // è¾“å‡º: æ‰“å°æ—¶åˆ»: { value: 1 } data.value = 2; // Node.js ä¸­è¾“å‡ºçš„å§‹ç»ˆæ˜¯ { value: 1 } æ¡ˆä¾‹ä¸­çš„ç¬¬äºŒå±‚åŸå› ï¼šVue 3 ref è®¿é—®é—®é¢˜ åŸå§‹é—®é¢˜çš„å®Œæ•´åŸå› æ˜¯åŒé‡çš„ï¼š console å»¶è¿Ÿå±•å¼€ï¼šå¯¼è‡´çœ‹åˆ°çš„æ˜¯å¯¹è±¡çš„æœ€ç»ˆçŠ¶æ€ Vue ref è®¿é—®é”™è¯¯ï¼šä» Vue ä»£ç è¿ç§»æ—¶å¿˜è®°æ·»åŠ  .value Vue 3 çš„å“åº”å¼æ•°æ®è®¿é—®ï¼š import { ref } from 'vue'; const userIdRef = ref('user123'); // é”™è¯¯ï¼šç›´æ¥è®¿é—® ref å¯¹è±¡ const createdBy = userIdRef; // è¿”å› RefImpl å¯¹è±¡ console.log(createdBy); // å¯èƒ½æ˜¾ç¤ºä¸º undefined æˆ– RefImpl // æ­£ç¡®ï¼šé€šè¿‡ .value è®¿é—®å®é™…å€¼ const createdBy = userIdRef.value; // è¿”å› 'user123' åœ¨ Vue ç»„ä»¶ä¸­ï¼Œæ¨¡æ¿ä¼šè‡ªåŠ¨è§£åŒ… refï¼Œä½†åœ¨çº¯ JavaScript ä»£ç ä¸­å¿…é¡»æ‰‹åŠ¨æ·»åŠ  .valueã€‚ æŠ€æœ¯åŸç† JavaScript å¼•ç”¨ç±»å‹ JavaScript çš„æ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼š åŸºæœ¬ç±»å‹ï¼ˆå€¼ä¼ é€’ï¼‰ Number String Boolean null undefined Symbol BigInt åŸºæœ¬ç±»å‹ç›´æ¥å­˜å‚¨å€¼ï¼Œèµ‹å€¼æ—¶å¤åˆ¶å€¼ï¼š let a = 1; let b = a; b = 2; console.log(a); // 1ï¼ˆä¸å— b çš„ä¿®æ”¹å½±å“ï¼‰ å¼•ç”¨ç±»å‹ï¼ˆå¼•ç”¨ä¼ é€’ï¼‰ Object Array Function Date RegExp Map Set å¼•ç”¨ç±»å‹å­˜å‚¨å†…å­˜åœ°å€ï¼Œèµ‹å€¼æ—¶å¤åˆ¶å¼•ç”¨ï¼š let obj1 = { value: 1 }; let obj2 = obj1; obj2.value = 2; console.log(obj1.value); // 2ï¼ˆobj1 å’Œ obj2 æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼‰ DevTools å»¶è¿Ÿå±•å¼€çš„å®ç°ç»†èŠ‚ æµè§ˆå™¨æ§åˆ¶å°å¯¹å¯¹è±¡çš„å¤„ç†æµç¨‹ï¼š æ‰“å°é˜¶æ®µï¼š console.log(obj) â†“ å­˜å‚¨å¯¹è±¡å¼•ç”¨ + å †æ ˆä¿¡æ¯ â†“ æ˜¾ç¤ºå¯¹è±¡çš„ç®€è¦è¡¨ç¤ºï¼ˆå¦‚ï¼š{...}ï¼‰ å±•å¼€é˜¶æ®µï¼š ç”¨æˆ·ç‚¹å‡»å±•å¼€ â†“ é€šè¿‡å¼•ç”¨è¯»å–å¯¹è±¡å½“å‰å±æ€§ â†“ éå†å¹¶æ˜¾ç¤ºå±æ€§å€¼ ä¸ºä»€ä¹ˆä¸ç«‹å³åºåˆ—åŒ–ï¼Ÿ å‡è®¾æœ‰ä¸€ä¸ªæ·±å±‚åµŒå¥—çš„å¤§å¯¹è±¡ï¼š const largeObject = { level1: { level2: { level3: { // ... æ•°ç™¾ä¸ªå±æ€§ data: new Array(10000).fill({ /* å¤æ‚å¯¹è±¡ */ }) } } } }; console.log(largeObject); å¦‚æœç«‹å³åºåˆ—åŒ–ï¼š éœ€è¦æ·±åº¦éå†æ•´ä¸ªå¯¹è±¡æ ‘ æ¶ˆè€—å¤§é‡ CPU å’Œå†…å­˜ é˜»å¡ä¸»çº¿ç¨‹ï¼Œå½±å“é¡µé¢å“åº” å»¶è¿Ÿå±•å¼€åˆ™åªåœ¨ç”¨æˆ·éœ€è¦æ—¶æ‰è¯»å–ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚ è§£å†³æ–¹æ¡ˆ æ–¹æ¡ˆ 1ï¼šJSON åºåˆ—åŒ–æ·±æ‹·è´ console.log('å¿«ç…§:', JSON.parse(JSON.stringify(obj))); åŸç†ï¼š JSON.stringify(obj) å°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸² JSON.parse(...) å°†å­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºæ–°å¯¹è±¡ æ–°å¯¹è±¡ä¸åŸå¯¹è±¡å®Œå…¨ç‹¬ç«‹ï¼Œä¸å…±äº«å¼•ç”¨ ä¼˜ç‚¹ï¼š å®Œå…¨éš”ç¦»ï¼Œæ‰“å°çš„æ˜¯çœŸå®çš„å¿«ç…§ è¯­æ³•ç®€å•ï¼Œå®¹æ˜“ç†è§£ ç¼ºç‚¹ï¼š æ— æ³•åºåˆ—åŒ–å‡½æ•°ã€Symbolã€undefined å¾ªç¯å¼•ç”¨ä¼šæŠ›å‡ºé”™è¯¯ æ— æ³•å¤„ç†ç‰¹æ®Šå¯¹è±¡ï¼ˆDateã€RegExpã€Mapã€Set ç­‰ä¼šè¢«è½¬æ¢æˆ–ä¸¢å¤±ï¼‰ ç¤ºä¾‹ï¼š const obj = { name: 'test', fn: () =&gt; {}, // ä¼šè¢«å¿½ç•¥ undef: undefined, // ä¼šè¢«å¿½ç•¥ date: new Date(), // è½¬æ¢ä¸ºå­—ç¬¦ä¸² map: new Map() // è½¬æ¢ä¸º {} }; console.log('åŸå¯¹è±¡:', obj); console.log('JSON å¿«ç…§:', JSON.parse(JSON.stringify(obj))); // è¾“å‡º: { name: 'test', date: '2024-01-01T00:00:00.000Z', map: {} } é€‚ç”¨åœºæ™¯ï¼šè°ƒè¯•çº¯æ•°æ®å¯¹è±¡ï¼ˆPOJOï¼‰ æ–¹æ¡ˆ 2ï¼šstructuredClone() console.log('å¿«ç…§:', structuredClone(obj)); åŸç†ï¼šä½¿ç”¨ç»“æ„åŒ–å…‹éš†ç®—æ³•ï¼Œè¿™æ˜¯ HTML æ ‡å‡†å®šä¹‰çš„æ·±æ‹·è´ç®—æ³•ã€‚ ä¼˜ç‚¹ï¼š æ”¯æŒæ›´å¤šæ•°æ®ç±»å‹ï¼šMapã€Setã€Dateã€RegExpã€ArrayBufferã€TypedArray ç­‰ å¤„ç†å¾ªç¯å¼•ç”¨ æ€§èƒ½è¾ƒå¥½ ç¼ºç‚¹ï¼š ä»ä¸æ”¯æŒå‡½æ•°ã€DOM èŠ‚ç‚¹ã€Error å¯¹è±¡ éœ€è¦è¾ƒæ–°çš„æµè§ˆå™¨ç‰ˆæœ¬ æµè§ˆå™¨å…¼å®¹æ€§ï¼š Chrome 98+ (2022 å¹´ 2 æœˆ) Firefox 94+ (2021 å¹´ 11 æœˆ) Safari 15.4+ (2022 å¹´ 3 æœˆ) ç¤ºä¾‹ï¼š const obj = { name: 'test', date: new Date(), map: new Map([['key', 'value']]), set: new Set([1, 2, 3]) }; console.log('structuredClone:', structuredClone(obj)); // å®Œæ•´ä¿ç•™ Dateã€Mapã€Set çš„ç±»å‹å’Œå€¼ é€‚ç”¨åœºæ™¯ï¼šåŒ…å«å¤æ‚æ•°æ®ç»“æ„ï¼ˆMapã€Setã€Date ç­‰ï¼‰çš„å¯¹è±¡ æ–¹æ¡ˆ 3ï¼šå±•å¼€è¿ç®—ç¬¦ï¼ˆæµ…æ‹·è´ï¼‰ console.log('å¯¹è±¡å¿«ç…§:', { ...obj }); console.log('æ•°ç»„å¿«ç…§:', [...arr]); åŸç†ï¼šåˆ›å»ºæ–°å¯¹è±¡ï¼Œå¤åˆ¶ç¬¬ä¸€å±‚å±æ€§ã€‚ ä¼˜ç‚¹ï¼š è¯­æ³•ç®€æ´ æ€§èƒ½æœ€å¥½ æ”¯æŒæ‰€æœ‰ç±»å‹ ç¼ºç‚¹ï¼š ä»…æµ…æ‹·è´ï¼ŒåµŒå¥—å¯¹è±¡ä»æ˜¯å¼•ç”¨ ç¤ºä¾‹ï¼š const obj = { name: 'test', nested: { value: 1 } }; const shallow = { ...obj }; obj.nested.value = 2; console.log(shallow.nested.value); // 2ï¼ˆnested ä»æ˜¯å¼•ç”¨ï¼‰ é€‚ç”¨åœºæ™¯ï¼šæ‰å¹³ç»“æ„çš„å¯¹è±¡ æ–¹æ¡ˆ 4ï¼šç›´æ¥æ‰“å°å€¼æˆ–å­—ç¬¦ä¸²åŒ– // æ–¹å¼ 1ï¼šæ‰“å°ç‰¹å®šå­—æ®µ console.log('createdBy:', obj.createdBy); // æ–¹å¼ 2ï¼šJSON å­—ç¬¦ä¸²ï¼ˆæ ¼å¼åŒ–ï¼‰ console.log('JSON å­—ç¬¦ä¸²:', JSON.stringify(obj, null, 2)); // æ–¹å¼ 3ï¼šæ¨¡æ¿å­—ç¬¦ä¸² console.log(`createdBy=${obj.createdBy}, status=${obj.status}`); ä¼˜ç‚¹ï¼š æœ€ç›´æ¥ï¼Œæ— é¢å¤–å¼€é”€ åŸºæœ¬ç±»å‹ä¸å—å¼•ç”¨å½±å“ JSON å­—ç¬¦ä¸²æ˜“äºå¤åˆ¶å’Œåˆ†äº« é€‚ç”¨åœºæ™¯ï¼š åªå…³æ³¨ç‰¹å®šå­—æ®µ éœ€è¦æŸ¥çœ‹æ•´ä½“ JSON ç»“æ„ éœ€è¦å¤åˆ¶æ•°æ®ç”¨äºæµ‹è¯• æ–¹æ¡ˆ 5ï¼šconsole.table() console.table(obj); console.table([obj1, obj2, obj3]); åŸç†ï¼šä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºæ•°æ®ï¼Œå†…éƒ¨ä¼šè‡ªåŠ¨åºåˆ—åŒ–å½“å‰å€¼ã€‚ ä¼˜ç‚¹ï¼š å¯è§†åŒ–æ•ˆæœå¥½ è‡ªåŠ¨åºåˆ—åŒ–ï¼Œä¸å—å¼•ç”¨å½±å“ é€‚åˆå¯¹æ¯”å¤šä¸ªå¯¹è±¡ ç¤ºä¾‹ï¼š const users = [ { id: 1, name: 'Alice', age: 25 }, { id: 2, name: 'Bob', age: 30 }, { id: 3, name: 'Charlie', age: 35 } ]; console.table(users); // è¾“å‡ºä¸€ä¸ªè¡¨æ ¼ï¼Œåˆ—ä¸º idã€nameã€age é€‚ç”¨åœºæ™¯ï¼šæ•°ç»„æˆ–å¯¹è±¡åˆ—è¡¨çš„è°ƒè¯• æ–¹æ¡ˆ 6ï¼šè°ƒè¯•å™¨æ–­ç‚¹ debugger; console.log(obj); æˆ–åœ¨ Chrome DevTools ä¸­è®¾ç½®æ–­ç‚¹ã€‚ ä¼˜ç‚¹ï¼š åœ¨æ–­ç‚¹å¤„æŸ¥çœ‹å˜é‡çš„å‡†ç¡®çŠ¶æ€ å¯ä»¥é€æ­¥æ‰§è¡Œï¼Œè§‚å¯Ÿå˜é‡å˜åŒ– å¯ä»¥ä½¿ç”¨ DevTools çš„æ‰€æœ‰åŠŸèƒ½ é€‚ç”¨åœºæ™¯ï¼šå¤æ‚çš„è°ƒè¯•åœºæ™¯ï¼Œéœ€è¦é€æ­¥è·Ÿè¸ª æ–¹æ¡ˆå¯¹æ¯” æ–¹æ¡ˆ æ·±åº¦æ‹·è´ æ€§èƒ½ ç±»å‹æ”¯æŒ ä»£ç å¤æ‚åº¦ é€‚ç”¨åœºæ™¯ JSON åºåˆ—åŒ– æ˜¯ ä¸­ç­‰ çº¯æ•°æ®ï¼ˆä¸æ”¯æŒå‡½æ•°ã€undefinedã€Symbolï¼‰ ä½ å¸¸è§„æ•°æ®å¯¹è±¡ structuredClone æ˜¯ ä¸­ç­‰ è¾ƒå¹¿æ³›ï¼ˆæ”¯æŒ Mapã€Setã€Dateï¼Œä¸æ”¯æŒå‡½æ•°ï¼‰ ä½ å¤æ‚æ•°æ®ç»“æ„ å±•å¼€è¿ç®—ç¬¦ å¦ï¼ˆæµ…æ‹·è´ï¼‰ å¿« æ‰€æœ‰ç±»å‹ ä½ æ‰å¹³å¯¹è±¡ ç›´æ¥æ‰“å°å€¼ - æœ€å¿« åŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸² ä½ æŸ¥çœ‹ç‰¹å®šå­—æ®µ console.table æ˜¯ï¼ˆè‡ªåŠ¨ï¼‰ å¿« å¯åºåˆ—åŒ–ç±»å‹ ä½ åˆ—è¡¨/è¡¨æ ¼æ•°æ® æ–­ç‚¹è°ƒè¯• - - æ‰€æœ‰ç±»å‹ ä¸­ç­‰ å¤æ‚è°ƒè¯•æµç¨‹ æ¨èç­–ç•¥ï¼š é»˜è®¤é€‰æ‹©ï¼šJSON.parse(JSON.stringify(obj)) - é€‚ç”¨äº 90% çš„åœºæ™¯ å¤æ‚å¯¹è±¡ï¼šstructuredClone(obj) - åŒ…å« Mapã€Setã€Date ç­‰ç±»å‹ ç®€å•æŸ¥çœ‹ï¼šç›´æ¥æ‰“å°å­—æ®µæˆ–ä½¿ç”¨ JSON.stringify(obj, null, 2) åˆ—è¡¨æ•°æ®ï¼šconsole.table(arr) å¤æ‚è°ƒè¯•ï¼šä½¿ç”¨æ–­ç‚¹è°ƒè¯•å™¨ ç›¸å…³çŸ¥è¯†ç‚¹ Vue å“åº”å¼æ•°æ®è®¿é—® Vue 3 çš„ ref import { ref } from 'vue'; const count = ref(0); // é”™è¯¯ï¼šç›´æ¥è®¿é—® ref console.log(count); // RefImpl { _value: 0, ... } // æ­£ç¡®ï¼šé€šè¿‡ .value è®¿é—® console.log(count.value); // 0 // ä¿®æ”¹å€¼ count.value++; Vue 3 çš„ reactive import { reactive } from 'vue'; const state = reactive({ count: 0 }); // æ­£ç¡®ï¼šç›´æ¥è®¿é—®å±æ€§ console.log(state.count); // 0 // ä¿®æ”¹å€¼ state.count++; è·å–åŸå§‹å€¼ import { toRaw, reactive } from 'vue'; const state = reactive({ count: 0 }); const raw = toRaw(state); // raw æ˜¯éå“åº”å¼çš„åŸå§‹å¯¹è±¡ console.log(raw); ä» Vue ç»„ä»¶è¿ç§»ä»£ç çš„æ³¨æ„äº‹é¡¹ åœ¨ Vue æ¨¡æ¿ä¸­ï¼Œref ä¼šè‡ªåŠ¨è§£åŒ…ï¼š &lt;template&gt; &lt;!-- è‡ªåŠ¨è§£åŒ…ï¼Œæ— éœ€ .value --&gt; &lt;div&gt;{{ count }}&lt;/div&gt; &lt;/template&gt; &lt;script setup&gt; import { ref } from 'vue'; const count = ref(0); // åœ¨ JS ä¸­å¿…é¡»ä½¿ç”¨ .value function increment() { count.value++; // æ­£ç¡® // count++; // é”™è¯¯ } &lt;/script&gt; è¿ç§»åˆ°çº¯ JavaScript æ—¶å¿…é¡»æ‰‹åŠ¨æ·»åŠ  .valueã€‚ æµè§ˆå™¨ä¸ Node.js çš„ console å®ç°å·®å¼‚ æµè§ˆå™¨ï¼ˆChromeï¼‰ const obj = { value: 1 }; console.log(obj); obj.value = 2; // å±•å¼€æ—¶æ˜¾ç¤º { value: 2 } å®ç°åŸç†ï¼š å­˜å‚¨å¯¹è±¡å¼•ç”¨ å»¶è¿Ÿè¯»å–å±æ€§ ä¼˜åŒ–æ€§èƒ½å’Œå†…å­˜ Node.js const obj = { value: 1 }; console.log(obj); obj.value = 2; // è¾“å‡º { value: 1 } å®ç°åŸç†ï¼š ç«‹å³è°ƒç”¨ util.inspect() åºåˆ—åŒ–å¯¹è±¡ä¸ºå­—ç¬¦ä¸² æ˜¾ç¤ºæ‰“å°æ—¶åˆ»çš„å‡†ç¡®å€¼ é€‰æ‹©å»ºè®® å¼€å‘è°ƒè¯•ï¼šä½¿ç”¨æµè§ˆå™¨ DevToolsï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ æœåŠ¡å™¨æ—¥å¿—ï¼šNode.js ç¯å¢ƒï¼Œè¾“å‡ºå‡†ç¡® CI/CD æµ‹è¯•ï¼šNode.js ç¯å¢ƒï¼Œå¯é æ€§é«˜ å…¶ä»–æœ‰ç”¨çš„ console æ–¹æ³• console.dir() æ˜¾ç¤ºå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ï¼‰ï¼š const obj = { a: 1 }; Object.defineProperty(obj, 'hidden', { value: 'secret', enumerable: false }); console.log(obj); // { a: 1 } console.dir(obj); // { a: 1, hidden: 'secret' } console.assert() æ–­è¨€è°ƒè¯•ï¼Œæ¡ä»¶ä¸º false æ—¶æ‰“å°é”™è¯¯ï¼š const value = 5; console.assert(value === 10, 'value åº”è¯¥ç­‰äº 10ï¼Œä½†å®é™…æ˜¯', value); // Assertion failed: value åº”è¯¥ç­‰äº 10ï¼Œä½†å®é™…æ˜¯ 5 console.trace() æ‰“å°å½“å‰çš„è°ƒç”¨å †æ ˆï¼š function foo() { function bar() { console.trace('è°ƒç”¨å †æ ˆ'); } bar(); } foo(); // è¾“å‡ºå®Œæ•´çš„è°ƒç”¨é“¾ï¼šbar -&gt; foo -&gt; &lt;anonymous&gt; console.time() / console.timeEnd() æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´ï¼š console.time('æ•°ç»„å¤„ç†'); const arr = new Array(1000000).fill(0).map((_, i) =&gt; i * 2); console.timeEnd('æ•°ç»„å¤„ç†'); // æ•°ç»„å¤„ç†: 23.456ms console.group() / console.groupEnd() åˆ†ç»„æ˜¾ç¤ºæ—¥å¿—ï¼š console.group('ç”¨æˆ·ä¿¡æ¯'); console.log('å§“å:', 'Alice'); console.log('å¹´é¾„:', 25); console.groupEnd(); æ€»ç»“ æ ¸å¿ƒè¦ç‚¹ å¼•ç”¨é™·é˜±ï¼šconsole.log(obj) åœ¨æµè§ˆå™¨ä¸­å­˜å‚¨çš„æ˜¯å¯¹è±¡å¼•ç”¨ï¼Œå±•å¼€æ—¶è¯»å–çš„æ˜¯å½“å‰å€¼ ç¯å¢ƒå·®å¼‚ï¼šæµè§ˆå™¨å»¶è¿Ÿå±•å¼€ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼ŒNode.js ç«‹å³åºåˆ—åŒ–ï¼ˆå‡†ç¡®æ€§ä¼˜å…ˆï¼‰ è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨æ·±æ‹·è´ï¼ˆJSON æˆ– structuredCloneï¼‰æ‰“å°å¿«ç…§ï¼Œæˆ–ç›´æ¥æ‰“å°å­—æ®µå€¼ Vue ç‰¹æ®Šæ€§ï¼šä» Vue è¿ç§»ä»£ç æ—¶æ³¨æ„ ref éœ€è¦ .value è®¿é—® è°ƒè¯•æœ€ä½³å®è·µ é»˜è®¤æ–¹æ¡ˆï¼š console.log('å¿«ç…§:', JSON.parse(JSON.stringify(obj))); å¤æ‚å¯¹è±¡ï¼š console.log('å¿«ç…§:', structuredClone(obj)); æŸ¥çœ‹å­—æ®µï¼š console.log('å­—æ®µ:', obj.field); åˆ—è¡¨æ•°æ®ï¼š console.table(arrayOfObjects); å¤æ‚åœºæ™¯ï¼šä½¿ç”¨ DevTools æ–­ç‚¹è°ƒè¯•å™¨ å‚è€ƒèµ„æ–™ MDN - console Chrome DevTools Console API Reference structuredClone() - Web APIs Vue 3 Reactivity API ","link":"https://blog.rakuyo.dev/console-log-reference-trap-and-devtools-lazy-expansion/"},{"title":"ARM Mac å®‰è£… Java 8 å¤‡å¿˜","content":"æœ€è¿‘éœ€è¦åœ¨ ARM Mac ä¸Šè£… Java 8ï¼Œç ”ç©¶äº†ä¸€åœˆå‘ç°ç›´æ¥ç”¨ Azul Zulu çš„åŸç”Ÿ ARM ç‰ˆæœ¬æœ€çœäº‹ã€‚ å¿«é€Ÿå®‰è£… ç›´æ¥ä¸Šå‘½ä»¤ï¼š # æ·»åŠ  cask-versions ä»“åº“ brew tap homebrew/cask-versions # å®‰è£… Zulu 8 brew install --cask zulu8 è£…å®Œä¹‹å JDK åœ¨ /Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Homeã€‚ å¦‚æœéœ€è¦è®¾ç½® JAVA_HOMEï¼Œåœ¨ ~/.zshrc æˆ– ~/.bashrc é‡ŒåŠ ä¸Šï¼š export JAVA_HOME='/Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Home' éªŒè¯ä¸€ä¸‹ï¼š java -version åº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š openjdk version &quot;1.8.0_xxx&quot; OpenJDK Runtime Environment (Zulu 8.xx.x.x-CA-macosx-aarch64) OpenJDK 64-Bit Server VM (Zulu 8.xx.x.x-CA-macosx-aarch64) æ³¨æ„è¾“å‡ºé‡Œçš„ aarch64ï¼Œè¯´æ˜è¿™æ˜¯ ARM åŸç”Ÿç‰ˆæœ¬ã€‚ Oracle JDK vs OpenJDK é¡ºä¾¿è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆé€‰ OpenJDK è€Œä¸æ˜¯ Oracle JDKã€‚ ä»æˆæƒè§’åº¦çœ‹ï¼ŒOracle JDK ä» 2019 å¹´å¼€å§‹æ”¶è´¹ï¼Œ2023 å¹´è¿˜æ”¹æˆæŒ‰å‘˜å·¥æ•°è®¡è´¹ã€‚OpenJDK æ˜¯å®Œå…¨å…è´¹çš„å¼€æºé¡¹ç›®ï¼Œç”± Oracleã€Red Hat å’Œç¤¾åŒºä¸€èµ·ç»´æŠ¤ã€‚ æŠ€æœ¯ä¸Šï¼Œä» Java 11 å¼€å§‹ä¸¤è€…ç”¨çš„æ˜¯åŒä¸€å¥—ä»£ç ï¼ŒåŠŸèƒ½å’Œæ€§èƒ½åŸºæœ¬æ²¡åŒºåˆ«ã€‚ æ‰€ä»¥å¯¹äº Java 8 æ¥è¯´ï¼Œç”¨ OpenJDK çš„å‘è¡Œç‰ˆï¼ˆæ¯”å¦‚ Zuluï¼‰å°±è¡Œï¼Œæ—¢çœé’±åˆä¸å½±å“ä½¿ç”¨ã€‚ ä¸ºä»€ä¹ˆç”¨ Zulu çš„ ARM åŸç”Ÿç‰ˆæœ¬ è¿™ä¸ªæ–¹æ¡ˆæ˜¯ä» Stack Overflow è¿™ä¸ªå›ç­” é‡Œçœ‹åˆ°çš„ã€‚ ä¹‹å‰å¯èƒ½ä¼šæƒ³åˆ°ç”¨ Rosetta 2 è·‘ x86 ç‰ˆæœ¬çš„ JDK 8ï¼Œä½†ç°åœ¨ä¸å¤ªå»ºè®®è¿™ä¹ˆåšï¼š æ€§èƒ½é—®é¢˜ï¼šRosetta 2 æ¯•ç«Ÿæ˜¯è½¬è¯‘å±‚ï¼ŒåŸç”Ÿ ARM è·‘èµ·æ¥è‚¯å®šæ›´å¿« å…¼å®¹æ€§é£é™©ï¼šæ ¹æ® Apple çš„å¼€å‘è€…æ–‡æ¡£ï¼ŒmacOS 28ï¼ˆé¢„è®¡ 2027 å¹´å‘å¸ƒï¼‰ä¼šå¤§å¹…ç¼©å‡ Rosetta 2 çš„æ”¯æŒèŒƒå›´ï¼Œåˆ°æ—¶å€™åªä¼šä¿ç•™ç»™ä¸€äº›è€æ¸¸æˆç”¨ã€‚ç°åœ¨å¦‚æœç”¨ x86 ç‰ˆæœ¬ï¼Œä»¥åå¯èƒ½ä¼šé‡åˆ°éº»çƒ¦ ç›´æ¥ç”¨ ARM åŸç”Ÿç‰ˆæœ¬ï¼Œä¸€æ­¥åˆ°ä½ã€‚ å°ç»“ ARM Mac è£… Java 8ï¼Œç”¨ Azul Zulu çš„ ARM åŸç”Ÿç‰ˆæœ¬å°±å¥½ã€‚ç®€å•ç›´æ¥ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒä»¥åçš„å…¼å®¹æ€§é—®é¢˜ã€‚ ","link":"https://blog.rakuyo.dev/install-java8-on-arm-mac/"},{"title":"è§£å†³ swift-collections 1.3.0 åœ¨ Xcode 26.1 ä¸‹çš„ Lifetime ç‰¹æ€§ç¼–è¯‘é”™è¯¯","content":"æœ€è¿‘åœ¨ vibe coding ä¸€æ¬¾ macOS Appï¼Œåå« â€œHassanâ€ï¼Œå…·ä½“åšä»€ä¹ˆçš„æš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚é¡¹ç›®åœ¨ä» Xcode 16.4 å‡çº§åˆ° 26.1 åé‡åˆ°äº†ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼ŒèŠ±è´¹å‡ ä¸ªå°æ—¶ç ”ç©¶æ˜ç™½åå†³å®šæ°´ä¸€ç¯‡æ–‡ç« ï¼Œæ•´ç†ä¸€ä¸‹è¿™å‡ ä¸ªå°æ—¶çš„æ”¶è·ã€‚ ç°åœ¨ Hassan å·²ç»ä¸Šæ¶å•¦ï¼è¯¦è§ å®˜ç½‘ã€‚ é—®é¢˜æè¿° å¼€å‘ç¯å¢ƒ å…ˆäº¤ä»£ä¸€äº›æˆ‘çš„å¼€å‘ç¯å¢ƒï¼š macOS Tahoe 26.1 (25B78) Xcode 26.1 (17B55) Tuist 4.90.0 swift-collections 1.3.0 é—®é¢˜è¡¨ç° Hassan ä½¿ç”¨äº† Swift Collections 1.3.0ã€‚å…¶åœ¨ Xcode 16.4 (16F6) ä¸‹ç¼–è¯‘ä¸€åˆ‡æ­£å¸¸ï¼Œä½†åˆ‡æ¢åˆ° Xcode 26.1 åï¼Œç¼–è¯‘å¤±è´¥å¹¶æŠ¥é”™ï¼š /Users/rakuyo/Hassan/Tuist/.build/checkouts/swift-collections/Sources/InternalCollectionsUtilities/autogenerated/LifetimeOverride.swift:104:2 '@_lifetime' attribute is only valid when experimental feature Lifetimes is enabled /Users/rakuyo/Hassan/Tuist/.build/checkouts/swift-collections/Sources/InternalCollectionsUtilities/autogenerated/LifetimeOverride.swift:107:6 A function cannot return a ~Escapable result é—®é¢˜åˆ†æ æ ¹æœ¬åŸå›  çœ‹äº†ä¸€ä¸‹ä»£ç ï¼Œå‘ç°æŠ¥é”™çš„åœ°æ–¹ç”¨äº† #if compiler(&gt;=6.2) åšæ¡ä»¶ç¼–è¯‘ï¼š Xcode 16.4 çš„ç¼–è¯‘å™¨ç‰ˆæœ¬å°äº 6.2ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†ä»£ç æ ¹æœ¬ä¸ä¼šç¼–è¯‘ Xcode 26.1 çš„ç¼–è¯‘å™¨è¾¾åˆ°äº† 6.2ï¼Œå°±è§¦å‘äº†è¿™éƒ¨åˆ†ä»£ç çš„ç¼–è¯‘ swift-collections çš„ Package.swift æ–‡ä»¶ ç¿»äº†ä¸€ä¸‹ swift-collections çš„æºç ï¼Œè¿”ç°å®ƒæœ‰ä¸¤ä¸ª Package.swift æ–‡ä»¶ï¼š é»˜è®¤çš„ Package.swift Swift 6.0 ç‰ˆæœ¬ä½¿ç”¨çš„ Package@swift-6.0.swift å…³é”®çš„åŒºåˆ«åœ¨äºï¼š Package.swift æ–‡ä»¶ä¸­åŒ…å«äº† .enableExperimentalFeature(&quot;Lifetimes&quot;) é…ç½® Package@swift-6.0.swift æ–‡ä»¶ä¸­æ²¡æœ‰è¿™ä¸ªé…ç½® å…³äº @_lifetime ç‰¹æ€§ @_lifetime æ˜¯ Swift 6.2 å¼•å…¥çš„å®éªŒæ€§ç‰¹æ€§ï¼Œç”¨äºå¤„ç†ç”Ÿå‘½å‘¨æœŸä¾èµ–å…³ç³»ã€‚è™½ç„¶ 6.2 é‡Œå·²ç»æœ‰äº†ï¼Œä½†å®ƒè¿˜ä¸æ˜¯æ­£å¼çš„è¯­è¨€ç‰¹æ€§ï¼Œæ‰€ä»¥éœ€è¦æ˜¾å¼å¼€å¯ã€‚ å®˜æ–¹è®ºå›é‡Œæœ‰è®¨è®ºï¼šExperimental support for lifetime dependencies in Swift 6.2 and beyond è§£å†³é—®é¢˜ æœ€åˆçš„æ€è·¯ ä¸€å¼€å§‹ï¼Œæˆ‘è®¤ä¸ºé—®é¢˜å‡ºåœ¨ SPM æˆ– Tuist é”™è¯¯åœ°é€‰æ‹©äº† Package@swift-6.0.swift æ–‡ä»¶ã€‚å› ä¸ºæˆ‘çš„é¡¹ç›®è®¾ç½®çš„æ˜¯ Swift 5.9ï¼ŒBuild Settings é‡Œä¹Ÿæ˜¯ 5.9ï¼Œæˆ‘è®¤ä¸ºåº”è¯¥ä½¿ç”¨é»˜è®¤çš„ Package.swiftï¼ˆåŒ…å«äº† Lifetimes ç‰¹æ€§çš„å¯ç”¨ï¼‰ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰ç¼–è¯‘é”™è¯¯ã€‚ æ·±å…¥è°ƒæŸ¥ ä½†æ˜¯ç»§ç»­å¾€ä¸‹æŸ¥ï¼Œå‘ç°è¿™äº‹å„¿æ¯”æƒ³çš„å¤æ‚ï¼š SPM ä½¿ç”¨å·¥å…·é“¾çš„ Swift ç‰ˆæœ¬ SPM åœ¨ä¸‹è½½ä¾èµ–æ—¶ï¼Œä½¿ç”¨çš„æ˜¯ å·¥å…·é“¾ çš„ Swift ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ swift --version çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯é¡¹ç›®ä¸­ Build Settings é…ç½®çš„ Swift ç‰ˆæœ¬ï¼Œå®ƒåªå½±å“é¡¹ç›®çš„ç¼–è¯‘ï¼Œå’Œ SPM ç”¨å“ªä¸ª Package.swift æ— å…³ã€‚ macOS çš„ Swift å·¥å…·é“¾é™åˆ¶ macOS ä¸Šæ²¡æ³•æŠ›å¼€ Xcode å•ç‹¬è£…æˆ–é…ç½® Swift å·¥å…·é“¾ã€‚Swift å·¥å…·é“¾æ˜¯è·Ÿ Xcode ç»‘å®šçš„ã€‚ macOS Tahoe ä¸ Xcode ç‰ˆæœ¬çš„é™åˆ¶ macOS Tahoe æ— æ³•ä½¿ç”¨ Xcode 15 Xcode 16.14 å°±å·²ç»æ˜¯ Swift 6.0+ çš„ç‰ˆæœ¬ å¦‚æœæƒ³åœ¨ Swift 5.x çš„åŸºç¡€ä¸Šä½¿ç”¨ SPMï¼Œå°±å¿…é¡»ä½¿ç”¨ Xcode 15.0ï¼Œä½†è¿™åœ¨ macOS Tahoe ä¸Šæ˜¯ä¸å¯èƒ½çš„ swift-tools-version çš„å®é™…ä½œç”¨ é¡¹ç›®çš„ Package.swift æ–‡ä»¶é¡¶éƒ¨çš„ // swift-tools-version: 5.9 å¹¶ä¸èƒ½å†³å®šç”¨å“ªä¸ª Package.swift æ–‡ä»¶ã€‚è¿™ä¸ªå£°æ˜åªæ˜¯æŒ‡å®šäº†è§£æ Package.swift æ‰€éœ€çš„æœ€ä½ SPM å·¥å…·ç‰ˆæœ¬ã€‚ é‚£ä¹ˆå•ç‹¬å®‰è£… Swift 5.10.1 toolchain è¡Œä¸è¡Œï¼Ÿ æ—¢ç„¶ Xcode è‡ªå¸¦çš„å·¥å…·é“¾æ˜¯ Swift 6.0+ï¼Œé‚£èƒ½ä¸èƒ½å•ç‹¬è£…ä¸ª Swift 5.10.1 çš„ toolchainï¼Ÿ ä½¿ç”¨ swiftly å®‰è£… toolchain swiftly æ˜¯ Swift å®˜æ–¹çš„å·¥å…·é“¾ç®¡ç†å·¥å…·ï¼Œå¯ä»¥è£…ä¸åŒç‰ˆæœ¬çš„ Swift toolchainã€‚ è¯•äº†ä¸€ä¸‹ï¼Œç”¨ Swift 5.10.1 toolchain è·‘ SPM ä¸‹è½½ä¾èµ–ï¼Œç»“æœåˆæŠ¥é”™äº†ï¼š Computing version for https://github.com/devxoul/Then.git error: Invalid manifest (compiled with: [&quot;/Users/rakuyo/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/bin/swiftc&quot;, &quot;-vfsoverlay&quot;, &quot;/var/folders/56/hxctgzds50b8p0fw6myh2y500000gn/T/TemporaryDirectory.qkPC2f/vfs.yaml&quot;, &quot;-L&quot;, &quot;/Users/rakuyo/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/lib/swift/pm/ManifestAPI&quot;, &quot;-lPackageDescription&quot;, &quot;-Xlinker&quot;, &quot;-rpath&quot;, &quot;-Xlinker&quot;, &quot;/Users/rakuyo/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/lib/swift/pm/ManifestAPI&quot;, &quot;-target&quot;, &quot;arm64-apple-macosx12.0&quot;, &quot;-sdk&quot;, &quot;/Applications/Xcode-26.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.1.sdk&quot;, &quot;-F&quot;, &quot;/Applications/Xcode-26.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/Library/Frameworks&quot;, &quot;-I&quot;, &quot;/Applications/Xcode-26.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/usr/lib&quot;, &quot;-L&quot;, &quot;/Applications/Xcode-26.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/usr/lib&quot;, &quot;-swift-version&quot;, &quot;5&quot;, &quot;-I&quot;, &quot;/Users/rakuyo/Library/Developer/Toolchains/swift-5.10.1-RELEASE.xctoolchain/usr/lib/swift/pm/ManifestAPI&quot;, &quot;-sdk&quot;, &quot;/Applications/Xcode-26.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.1.sdk&quot;, &quot;-package-description-version&quot;, &quot;5.0.0&quot;, &quot;/Package.swift&quot;, &quot;-Xfrontend&quot;, &quot;-disable-implicit-concurrency-module-import&quot;, &quot;-Xfrontend&quot;, &quot;-disable-implicit-string-processing-module-import&quot;, &quot;-o&quot;, &quot;/var/folders/56/hxctgzds50b8p0fw6myh2y500000gn/T/TemporaryDirectory.EKOhFy/then-manifest&quot;]) error: fatalError error: compile command failed due to signal 6 (use -v to see invocation) /Applications/Xcode-26.1.0.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.1.sdk/System/Library/Frameworks/Foundation.framework/Modules/Foundation.swiftmodule/arm64e-apple-macos.swiftinterface:1114:149: error: expected ',' separator public mutating func transform&lt;E&gt;(updating range: inout Swift.Range&lt;Foundation.AttributedString.Index&gt;, body: (inout Foundation.AttributedString) throws(E) -&gt; Swift.Void) throws(E) where E : Swift.Error çœ‹æŠ¥é”™ä¿¡æ¯å°±çŸ¥é“äº†ï¼Œè™½ç„¶ç”¨äº† Swift 5.10.1 çš„ç¼–è¯‘å™¨ï¼Œä½† SPM è¿˜æ˜¯åœ¨é“¾æ¥ Xcode 26.1 çš„ SDKã€‚Swift 5.10.1 çš„ç¼–è¯‘å™¨çœ‹ä¸æ‡‚ macOS 26.1 SDK é‡Œçš„æ–°è¯­æ³•ï¼ˆæ¯”å¦‚ throws(E) è¿™ç§ç±»å‹åŒ–æŠ›å‡ºï¼‰ï¼Œæ‰€ä»¥ç¼–è¯‘å¤±è´¥ã€‚ ç»“è®º å•ç‹¬è£… Swift 5.10.1 toolchain ä¹Ÿä¸è¡Œï¼š SPM è™½ç„¶ç”¨äº†æ—§ç‰ˆæœ¬çš„ Swift ç¼–è¯‘å™¨ ä½†å®ƒè¿˜æ˜¯é“¾æ¥åˆ°äº† Xcode 26.1 çš„ SDK æ—§ç‰ˆæœ¬ç¼–è¯‘å™¨å¤„ç†ä¸äº†æ–°ç‰ˆæœ¬ SDK çš„è¯­æ³• Swift toolchain å’Œ Xcode SDK ä¹‹é—´æœ‰ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ å®˜æ–¹ Issues çš„å‘ç° è°ƒæŸ¥çš„æ—¶å€™ç¿»äº†ä¸‹ swift-collections çš„ Issuesï¼Œæ‰¾åˆ°äº†ç›¸å…³è®¨è®ºï¼š#546ã€‚ çœ‹èµ·æ¥ç¤¾åŒºé‡Œä¹Ÿæœ‰äººé‡åˆ°ç±»ä¼¼é—®é¢˜ï¼Œä½†å®˜æ–¹å¹¶æ²¡æœ‰åœ¨ Package@swift-6.0.swift é‡Œé»˜è®¤åŠ ä¸Š .enableExperimentalFeature(&quot;Lifetimes&quot;) é…ç½®ã€‚ è§£å†³æ–¹æ¡ˆ æŠ˜è…¾äº†ä¸€åœˆï¼Œæœ€åçš„ç»“è®ºå°±æ˜¯ï¼š åªèƒ½ç”¨ Package@swift-6.0.swiftï¼šå› ä¸ºå·¥å…·é“¾æ˜¯ Swift 6.0+ï¼ŒSPM ä¼šè‡ªåŠ¨é€‰è¿™ä¸ªæ–‡ä»¶ å¿…é¡»æ˜¾å¼å¯ç”¨ Lifetimes ç‰¹æ€§ï¼šå¾—åœ¨é¡¹ç›®é…ç½®é‡ŒåŠ ä¸Š -enable-experimental-feature Lifetimes ç¼–è¯‘å‚æ•° å…·ä½“é…ç½®çœ‹ä½ ç”¨ä»€ä¹ˆæ„å»ºå·¥å…·ï¼š ä½¿ç”¨ Tuist åœ¨ Tuist çš„é¡¹ç›®é…ç½®ä¸­ï¼Œéœ€è¦ä¸ºä¾èµ– swift-collections çš„ target æ·»åŠ ç¼–è¯‘å‚æ•°ï¼š .target( name: &quot;YourTarget&quot;, // ... å…¶ä»–é…ç½® settings: .settings( base: [ &quot;OTHER_SWIFT_FLAGS&quot;: &quot;$(inherited) -enable-experimental-feature Lifetimes&quot; ] ) ) ä½¿ç”¨ Xcode é¡¹ç›® åœ¨ Build Settings ä¸­ï¼Œæ‰¾åˆ° &quot;Other Swift Flags&quot;ï¼Œæ·»åŠ ï¼š -enable-experimental-feature Lifetimes æ„å¤–æ”¶è·ï¼šTuist çš„ Swift ç‰ˆæœ¬é»˜è®¤é…ç½® è°ƒæŸ¥çš„æ—¶å€™è¿˜å‘ç°äº†ä¸ª Tuist ç›¸å…³çš„äº‹æƒ…ã€‚ Tuist é»˜è®¤ç”¨çš„æ˜¯ SWIFT_VERSION = 5.0ã€‚æƒ³ç”¨ Swift 6.0 çš„è¯ï¼Œä¹Ÿå¾—æ˜¾å¼æŒ‡å®šã€‚ ç›¸å…³ä¿¡æ¯ï¼š PRï¼š#4679 ä»£ç å®šä¹‰ï¼šDefaultSettingsProvider.swift ç¤¾åŒºè®¨è®ºï¼šCan't change Swift version for targets (from 5 to 6) ç”¨ Tuist å¹¶ä¸”æƒ³ç”¨ Swift 6.0 çš„è¯ï¼Œå¾—åœ¨é…ç½®é‡Œæ˜ç¡®æŒ‡å®šï¼š .target( name: &quot;YourTarget&quot;, // ... å…¶ä»–é…ç½® settings: .settings( base: [ &quot;SWIFT_VERSION&quot;: &quot;6.0&quot; ] ) ) æ€»ç»“ è¿™æ¬¡æŠ˜è…¾ä¸‹æ¥ï¼Œå¯¹ SPM çš„å·¥ä½œæœºåˆ¶ç®—æ˜¯æœ‰äº†æ›´æ·±çš„ç†è§£ï¼š SPM ç”¨çš„æ˜¯å·¥å…·é“¾ç‰ˆæœ¬ï¼šSPM æ ¹æ® swift --version çš„ç‰ˆæœ¬ï¼ˆä¹Ÿå°±æ˜¯å·¥å…·é“¾ç‰ˆæœ¬ï¼‰æ¥é€‰ Package.swift æ–‡ä»¶ï¼Œä¸æ˜¯é¡¹ç›®é…ç½®çš„ Swift ç‰ˆæœ¬ Package@swift-X.X.swift çš„ä¼˜å…ˆçº§ï¼šå·¥å…·é“¾ç‰ˆæœ¬æ»¡è¶³æ¡ä»¶æ—¶ï¼ŒSPM ä¼šä¼˜å…ˆç”¨å¸¦ç‰ˆæœ¬åç¼€çš„ Package.swift æ–‡ä»¶ å®éªŒæ€§ç‰¹æ€§å¾—æ˜¾å¼å¯ç”¨ï¼šå³ä½¿ä»£ç é‡Œç”¨äº†å®éªŒæ€§ç‰¹æ€§ï¼ŒPackage.swift é‡Œæ²¡å¯ç”¨çš„è¯ï¼Œä¹Ÿå¾—åœ¨é¡¹ç›®çº§åˆ«æ˜¾å¼å¯ç”¨ macOS çš„å·¥å…·é“¾é™åˆ¶ï¼šmacOS ä¸Š Swift å·¥å…·é“¾è·Ÿ Xcode æ˜¯ç»‘å®šçš„ï¼Œä¸åƒ Linux é‚£æ ·èƒ½çµæ´»åˆ‡æ¢ Toolchain ä¸ SDK çš„å…¼å®¹æ€§ï¼šå•ç‹¬è£…äº†æ—§ç‰ˆæœ¬ Swift toolchain ä¹Ÿæ²¡ç”¨ï¼Œå®ƒå¯èƒ½è·Ÿæ–°ç‰ˆæœ¬ Xcode SDK ä¸å…¼å®¹ ","link":"https://blog.rakuyo.dev/swift-collections-lifetime-feature-compilation-error/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹","content":"æœ¬ç¯‡æ˜¯è®¡ç®—æœºç½‘ç»œç³»åˆ—çš„ç¬¬ä¸ƒç¯‡ã€‚åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»åˆ†åˆ«æ¢è®¨äº† IPã€DNSã€DHCPã€TCPã€HTTP ç­‰å…·ä½“çš„æŠ€æœ¯ç‚¹ã€‚ç„¶è€Œï¼Œè¿™äº›æŠ€æœ¯å¹¶éå­¤ç«‹å­˜åœ¨ï¼Œå®ƒä»¬æ˜¯ä¸€ä¸ªåºå¤§è€Œç²¾å¯†çš„ç³»ç»Ÿä¸­çš„æœ‰æœºç»„æˆéƒ¨åˆ†ã€‚ä¸ºäº†ç†è§£å®ƒä»¬å¦‚ä½•ååŒå·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®è§‚çš„æ¡†æ¶æ¥å®¡è§†æ•´ä¸ªç½‘ç»œä¸–ç•Œã€‚è¿™ä¸ªæ¡†æ¶ï¼Œå°±æ˜¯ç½‘ç»œåˆ†å±‚æ¨¡å‹ã€‚ ç»ˆäºè½®åˆ°åˆ†å±‚æ¨¡å‹äº†ã€‚å…¶å®åœ¨ç»å¤§å¤šæ•°è®²è®¡ç®—æœºç½‘ç»œçš„æ–‡ç« ä¸­éƒ½ä¼šåœ¨ä¸€å¼€å§‹å°±ä»‹ç»åˆ†å±‚æ¨¡å‹ï¼Œä½†æ˜¯æˆ‘æ¯æ¬¡è¯»åˆ°è¿™ç§æ–‡ç« æ—¶ï¼Œéƒ½ä¼šè¢«å…¶åºå¤§çš„æ¶æ„æ‰€é˜»æ‹¦ â€”â€” å®ƒå¤ªå®Œç¾ï¼Œä¹Ÿå¤ªå®Œæ•´ï¼Œæˆ‘è²Œä¼¼æ²¡æ³•ä¸€ä¸‹å­å®Œå…¨ç†è§£ä¸æ¥å—ã€‚æ‰€ä»¥æœ¬ç³»åˆ—æ–‡ç« å¹¶æ²¡æœ‰é€‰æ‹©ä»åˆ†å±‚æ¨¡å‹å…¥æ‰‹ï¼Œä¹Ÿæœ‰è¿™æ–¹é¢çš„åŸå› ã€‚ æœ¬æ–‡å°†ä½œä¸ºç³»åˆ—çš„ä¸€ä¸ªé˜¶æ®µæ€§æ€»ç»“ï¼Œæ¶‰åŠåˆ°ä¸šç•Œæœ€æ ¸å¿ƒçš„ä¸¤ä¸ªç½‘ç»œæ¨¡å‹â€”â€”OSI ä¸ƒå±‚æ¨¡å‹å’Œ TCP/IP æ¨¡å‹ã€‚æˆ‘ä»¬ä¸ä»…å°†ç†è§£å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Œæ›´å°†æ¢è®¨å®ƒä»¬ä¸ºä½•å¦‚æ­¤è®¾è®¡ã€å…³é”®åè®®çš„å†…éƒ¨ç»†èŠ‚ã€è®¾è®¡å“²å­¦çš„å·®å¼‚ï¼Œä»¥åŠå®ƒä»¬åœ¨ç°å®ä¸–ç•Œä¸­çš„å±€é™æ€§ï¼Œå¸®åŠ©ä½ å°†å…ˆå‰å­¦åˆ°çš„çŸ¥è¯†â€œèä¼šè´¯é€šâ€ï¼Œæ„å»ºä¸€ä¸ªç³»ç»Ÿæ€§çš„ç½‘ç»œçŸ¥è¯†ä½“ç³»ã€‚ å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP ä¸ºä»€ä¹ˆéœ€è¦ç½‘ç»œåˆ†å±‚ åœ¨æ·±å…¥æ¨¡å‹ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å›ç­”ä¸€ä¸ªæ ¹æœ¬é—®é¢˜ï¼šä¸ºä»€ä¹ˆç½‘ç»œé€šä¿¡éœ€è¦â€œåˆ†å±‚â€ï¼Ÿ æƒ³è±¡ä¸€ä¸ªæå…¶å¤æ‚çš„è·¨å›½å¯„é€åŒ…è£¹çš„æµç¨‹ã€‚å¦‚æœæˆ‘ä»¬å°†æ•´ä¸ªæµç¨‹è§†ä¸ºä¸€ä¸ªå•ä¸€çš„ã€å·¨å¤§çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆä»»ä½•ä¸€ä¸ªç¯èŠ‚çš„å¾®å°å˜åŠ¨ï¼ˆä¾‹å¦‚æ›´æ¢äº†è¿é€å¡è½¦ï¼‰ï¼Œéƒ½å¯èƒ½éœ€è¦é‡æ–°è®¾è®¡æ•´ä¸ªç³»ç»Ÿï¼Œè¿™æ— ç–‘æ˜¯ä½æ•ˆä¸”è„†å¼±çš„ã€‚ ä¸€ä¸ªæ›´åˆç†çš„è®¾è®¡æ˜¯å°†å…¶æ¨¡å—åŒ–ï¼Œå³åˆ†å±‚ã€‚æ¯ä¸€å±‚éƒ½åªå…³å¿ƒè‡ªå·±çš„ä»»åŠ¡ï¼Œå¹¶ä¸ºä¸Šä¸€å±‚æä¾›æœåŠ¡ï¼ŒåŒæ—¶ä½¿ç”¨ä¸‹ä¸€å±‚æä¾›çš„æœåŠ¡ã€‚è¿™ç§è®¾è®¡å¸¦æ¥äº†å‡ ä¸ªæ˜¾è€Œæ˜“è§çš„å¥½å¤„ï¼š ç®€åŒ–é—®é¢˜ï¼šå°†ä¸€ä¸ªå¤æ‚çš„å¤§é—®é¢˜åˆ†è§£ä¸ºå¤šä¸ªç®€å•çš„å°é—®é¢˜ã€‚ æ ‡å‡†åŒ–ï¼šæ¯ä¸€å±‚éƒ½å¯ä»¥å»ºç«‹ç»Ÿä¸€çš„æ ‡å‡†ï¼ˆå¦‚ RFCï¼‰ï¼Œåªè¦æ¥å£ä¸å˜ï¼Œä»»ä½•ä¸€æ–¹çš„å†…éƒ¨å®ç°å˜åŒ–éƒ½ä¸ä¼šå½±å“å…¶ä»–å±‚ã€‚ è§£è€¦åˆï¼šä¸åŒå±‚çš„æŠ€æœ¯å¯ä»¥ç‹¬ç«‹å‘å±•å’Œæ¼”è¿›ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç‰©ç†ä¼ è¾“ä»ç”µç¼†å‡çº§åˆ°å…‰çº¤ï¼Œè€Œæ— éœ€æ”¹å˜ä¸Šå±‚çš„ç½‘é¡µæµè§ˆä½“éªŒã€‚ æ˜“äºæ•™å­¦å’Œæ’é”™ï¼šå½“ç½‘ç»œå‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€å±‚æ’æŸ¥ï¼Œæå¤§åœ°æé«˜äº†æ•…éšœå®šä½çš„æ•ˆç‡ã€‚ å½“ç„¶ï¼Œåˆ†å±‚ä¹Ÿå¹¶éæ²¡æœ‰ä»£ä»·ï¼Œä¾‹å¦‚æ•°æ®åœ¨å„å±‚ä¹‹é—´ä¼ é€’ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚ä½†åœ¨ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œå…¶å¸¦æ¥çš„ç»“æ„æ€§ä¼˜åŠ¿è¿œå¤§äºæ€§èƒ½ä¸Šçš„å¾®å°æŸå¤±ã€‚ OSI ä¸ƒå±‚å‚è€ƒæ¨¡å‹ï¼šç†è®ºçš„ä¸°ç¢‘ OSI æ¨¡å‹ï¼ˆOpen Systems Interconnection modelï¼‰ æ˜¯ç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰æå‡ºçš„ä¸€ä¸ªæ¦‚å¿µæ¨¡å‹ï¼Œæ—¨åœ¨ä¸ºè®¡ç®—æœºç½‘ç»œæä¾›ä¸€ä¸ªæ ‡å‡†çš„ã€é€šç”¨çš„ä½“ç³»æ¶æ„ã€‚å®ƒè¢«èª‰ä¸ºç†è®ºä¸Šæœ€å®Œæ•´ã€æœ€ä¸¥è°¨çš„ç½‘ç»œæ¨¡å‹ï¼Œè™½ç„¶åœ¨å•†ä¸šä¸Šå¹¶æœªå–å¾—ç»å¯¹çš„æˆåŠŸï¼Œä½†å®ƒå¯¹äºç†è§£ç½‘ç»œé€šä¿¡çš„å„ä¸ªç¯èŠ‚å…·æœ‰æé«˜çš„æŒ‡å¯¼ä»·å€¼ã€‚ OSI æ¨¡å‹å°†ç½‘ç»œé€šä¿¡ç²¾ç¡®åœ°åˆ’åˆ†ä¸ºäº†ä¸ƒä¸ªå±‚æ¬¡ã€‚ä¸‹é¢æˆ‘ä»¬è‡ªé¡¶å‘ä¸‹é€å±‚è§£æå…¶åŠŸèƒ½ä¸æ ¸å¿ƒåè®®ã€‚ ç¬¬ä¸ƒå±‚ï¼šåº”ç”¨å±‚ (Application Layer) è¿™æ˜¯ç”¨æˆ·æœ€ç›´æ¥æ¥è§¦çš„ä¸€å±‚ï¼Œè´Ÿè´£ä¸ºåº”ç”¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡ã€‚å®ƒå®šä¹‰äº†åº”ç”¨ç¨‹åºä¹‹é—´å¦‚ä½•äº¤æ¢å’Œè§£é‡Šæ•°æ®ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ ã€Šè®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPSã€‹ ä¸­æ¢è®¨çš„ HTTP åè®®ï¼Œå°±å·¥ä½œåœ¨è¿™ä¸€å±‚ã€‚ ç¬¬å…­å±‚ï¼šè¡¨ç¤ºå±‚ (Presentation Layer) è¡¨ç¤ºå±‚ä¸»è¦å¤„ç†æ•°æ®çš„æ ¼å¼åŒ–ã€åŠ å¯†å’Œå‹ç¼©ï¼Œç¡®ä¿ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚æ‰€å‘é€çš„æ•°æ®èƒ½è¢«å¦ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚æ­£ç¡®ç†è§£ã€‚å®ƒå¦‚åŒä¸€ä¸ªâ€œç¿»è¯‘å®˜â€ã€‚ ç¬¬äº”å±‚ï¼šä¼šè¯å±‚ (Session Layer) è¿™ä¸€å±‚è´Ÿè´£å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢ä¸åŒè®¾å¤‡é—´çš„ä¼šè¯ï¼ˆSessionï¼‰ã€‚ ç¬¬å››å±‚ï¼šä¼ è¾“å±‚ (Transport Layer) ä¼ è¾“å±‚ä¸ºä¸¤ä¸ªä¸»æœºä¹‹é—´æä¾›ç«¯åˆ°ç«¯ï¼ˆend-to-endï¼‰çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚å…¶åè®®æ•°æ®å•å…ƒï¼ˆPDUï¼‰ç§°ä¸ºæ•°æ®æ®µ (Segment)ã€‚ ç¬¬ä¸‰å±‚ï¼šç½‘ç»œå±‚ (Network Layer) ç½‘ç»œå±‚è´Ÿè´£åœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¸ºæ•°æ®åŒ…é€‰æ‹©æœ€ä½³çš„è·¯ç”±è·¯å¾„ï¼Œå®ç°é€»è¾‘åœ°å€ï¼ˆIP åœ°å€ï¼‰çš„å¯»å€ã€‚å…¶ PDU ç§°ä¸ºæ•°æ®åŒ… (Packet)ã€‚ ç¬¬äºŒå±‚ï¼šæ•°æ®é“¾è·¯å±‚ (Data Link Layer) æ•°æ®é“¾è·¯å±‚è´Ÿè´£åœ¨ç›¸é‚»çš„ä¸¤ä¸ªç½‘ç»œèŠ‚ç‚¹ä¹‹é—´ä¼ è¾“æ•°æ®å¸§ã€‚å®ƒå¤„ç†ç‰©ç†åœ°å€ï¼ˆMAC åœ°å€ï¼‰çš„å¯»å€ã€‚å…¶ PDU ç§°ä¸ºæ•°æ®å¸§ (Frame)ã€‚ ç¬¬ä¸€å±‚ï¼šç‰©ç†å±‚ (Physical Layer) è¿™æ˜¯æ¨¡å‹çš„æœ€åº•å±‚ï¼Œè´Ÿè´£ä¼ è¾“åŸå§‹çš„äºŒè¿›åˆ¶æ¯”ç‰¹æµï¼ˆ0å’Œ1ï¼‰ã€‚å…¶ PDU ç§°ä¸ºæ¯”ç‰¹ (Bit)ã€‚ TCP/IP æ¨¡å‹ï¼šå®è·µçš„èƒœåˆ©è€… ä¸ OSI çš„ç†è®ºæ€§ä¸åŒï¼ŒTCP/IP æ¨¡å‹æ˜¯ä¼´éšç€äº’è”ç½‘çš„å®è·µå‘å±•è€Œæ¥çš„ï¼Œæ˜¯å½“å‰äº‹å®ä¸Šçš„å·¥ä¸šæ ‡å‡†ã€‚åœ¨æ·±å…¥å…¶ç»“æ„ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›ç­”ä¸€ä¸ªé—®é¢˜ï¼šå®ƒä¸ºä»€ä¹ˆå« â€œTCP/IPâ€ æ¨¡å‹ï¼Ÿ åå­—çš„ç”±æ¥ è¿™ä¸ªæ¨¡å‹å¾—åäºå…¶ä½“ç³»ä¸­çš„ä¸¤ä¸ªæœ€æ ¸å¿ƒã€æœ€åŸºç¡€çš„åè®®ï¼š TCP (ä¼ è¾“æ§åˆ¶åè®®)ï¼šå·¥ä½œåœ¨ä¼ è¾“å±‚ï¼Œæä¾›å¯é çš„ã€é¢å‘è¿æ¥çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚å®ƒå¦‚åŒç½‘ç»œé€šä¿¡çš„â€œè´¨é‡æ€»ç›‘â€ã€‚ IP (ç½‘é™…åè®®)ï¼šå·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œè´Ÿè´£æ•°æ®åŒ…çš„å¯»å€å’Œè·¯ç”±ã€‚å®ƒå¦‚åŒç½‘ç»œé€šä¿¡çš„â€œå…¨çƒé‚®æ”¿ç³»ç»Ÿâ€ã€‚ TCP å’Œ IP çš„é‡è¦æ€§å¦‚æ­¤ä¹‹é«˜ï¼Œä»¥è‡³äºå®ƒä»¬æˆä¸ºäº†æ•´ä¸ªåè®®æ—ï¼ˆProtocol Suiteï¼‰çš„ä»£åè¯ã€‚å› æ­¤ï¼Œæè¿°è¿™ä¸ªåè®®æ—æ¶æ„çš„æ¨¡å‹ï¼Œä¹Ÿå°±è‡ªç„¶è€Œç„¶åœ°è¢«ç§°ä¸º â€œTCP/IP æ¨¡å‹â€ã€‚ åˆ†å±‚ç»“æ„ TCP/IP æ¨¡å‹æ›´åŠ ç®€æ´å’Œå®ç”¨ï¼Œé€šå¸¸è¢«æè¿°ä¸ºå››å±‚æˆ–äº”å±‚æ¨¡å‹ã€‚ TCP/IP å››å±‚æ¨¡å‹ è¿™æ˜¯æœ€ç»å…¸çš„ TCP/IP æ¨¡å‹åˆ’åˆ†ï¼Œå®ƒå°†åŠŸèƒ½ç›¸è¿‘çš„å‡ ä¸ªå±‚è¿›è¡Œäº†åˆå¹¶ï¼Œæ›´ä¾§é‡äºæè¿°åè®®ç°‡çš„å®è§‚ç»“æ„ï¼š åº”ç”¨å±‚ (Application Layer)ï¼šå¯¹åº” OSI çš„åº”ç”¨å±‚ã€è¡¨ç¤ºå±‚ã€ä¼šè¯å±‚ã€‚åŒ…å«äº†æ‰€æœ‰é«˜å±‚åè®®ï¼Œå¦‚ HTTP, FTP, DNS ç­‰ã€‚ ä¼ è¾“å±‚ (Transport Layer)ï¼šå¯¹åº” OSI çš„ä¼ è¾“å±‚ã€‚è´Ÿè´£ç«¯åˆ°ç«¯çš„é€šä¿¡ï¼Œæ ¸å¿ƒæ˜¯ TCP å’Œ UDP åè®®ã€‚ ç½‘é™…å±‚ (Internet Layer)ï¼šå¯¹åº” OSI çš„ç½‘ç»œå±‚ã€‚æ ¸å¿ƒæ˜¯ IP åè®®ï¼Œè´Ÿè´£æ•°æ®åŒ…çš„å¯»å€å’Œè·¯ç”±ã€‚ ç½‘ç»œæ¥å£å±‚ (Network Interface Layer)ï¼šå¯¹åº” OSI çš„æ•°æ®é“¾è·¯å±‚å’Œç‰©ç†å±‚ã€‚è´Ÿè´£å¤„ç†ä¸ç‰©ç†ç½‘ç»œåª’ä»‹ï¼ˆå¦‚ä»¥å¤ªç½‘ã€Wi-Fiï¼‰ç›¸å…³çš„æ‰€æœ‰äº‹åŠ¡ã€‚ TCP/IP äº”å±‚æ¨¡å‹ ä¸ºäº†æ•™å­¦å’Œç†è§£ä¸Šçš„ä¾¿åˆ©ï¼Œä¸šç•Œæ›´å¸¸ä½¿ç”¨ä¸€ä¸ªäº”å±‚æ¨¡å‹ã€‚å®ƒå®é™…ä¸Šæ˜¯ OSI å’Œ TCP/IP å››å±‚æ¨¡å‹çš„ä¸€ä¸ªæŠ˜ä¸­ï¼Œå°†å››å±‚æ¨¡å‹ä¸­çš„â€œç½‘ç»œæ¥å£å±‚â€é‡æ–°æ‹†åˆ†ä¸ºâ€œæ•°æ®é“¾è·¯å±‚â€å’Œâ€œç‰©ç†å±‚â€ï¼Œä»è€Œèƒ½æ›´æ¸…æ™°åœ°æè¿°åº•å±‚çš„å·¥ä½œåŸç†ã€‚è¿™ä¸ªäº”å±‚æ¨¡å‹ä¹Ÿæ˜¯æˆ‘ä»¬åç»­æ–‡ç« å°†ä¸»è¦å‚ç…§çš„ç»“æ„ã€‚ åº”ç”¨å±‚ (Application Layer)ï¼šåŒå››å±‚æ¨¡å‹ï¼Œå¯¹åº” OSI çš„ä¸Šä¸‰å±‚ã€‚ ä¼ è¾“å±‚ (Transport Layer)ï¼šåŒå››å±‚æ¨¡å‹ï¼Œå¯¹åº” OSI çš„ä¼ è¾“å±‚ã€‚ ç½‘ç»œå±‚ (Network Layer)ï¼šåŒå››å±‚æ¨¡å‹çš„ç½‘é™…å±‚ï¼Œå¯¹åº” OSI çš„ç½‘ç»œå±‚ã€‚ æ•°æ®é“¾è·¯å±‚ (Data Link Layer)ï¼šå¯¹åº” OSI çš„æ•°æ®é“¾è·¯å±‚ã€‚ ç‰©ç†å±‚ (Physical Layer)ï¼šå¯¹åº” OSI çš„ç‰©ç†å±‚ã€‚ ä¸‹é¢çš„è¡¨æ ¼æ¸…æ™°åœ°å±•ç¤ºäº†ä¸‰è€…ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼š OSI ä¸ƒå±‚å‚è€ƒæ¨¡å‹ TCP/IP äº”å±‚æ¨¡å‹ TCP/IP å››å±‚æ¨¡å‹ åº”ç”¨å±‚ åº”ç”¨å±‚ åº”ç”¨å±‚ è¡¨ç¤ºå±‚ ä¼šè¯å±‚ ä¼ è¾“å±‚ ä¼ è¾“å±‚ ä¼ è¾“å±‚ ç½‘ç»œå±‚ ç½‘ç»œå±‚ ç½‘é™…å±‚ æ•°æ®é“¾è·¯å±‚ æ•°æ®é“¾è·¯å±‚ ç½‘ç»œæ¥å£å±‚ ç‰©ç†å±‚ ç‰©ç†å±‚ æ ¸å¿ƒåè®®æ·±åº¦å‰–æ ç†è§£äº†åˆ†å±‚ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ·±å…¥åè®®çš„å†…éƒ¨ï¼Œçœ‹çœ‹å®ƒä»¬æ˜¯å¦‚ä½•é€šè¿‡ç²¾å·§çš„è®¾è®¡æ¥å®Œæˆå„è‡ªä½¿å‘½çš„ã€‚ ç½‘ç»œå±‚æ ¸å¿ƒï¼šIPv4 å¤´éƒ¨ç»“æ„ æˆ‘ä»¬åœ¨ ã€Šè®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ã€‹ ä¸­å·²ç»åˆæ­¥è®¤è¯†äº† IP åè®®ï¼Œå®ƒæ˜¯æ•´ä¸ªç½‘ç»œå±‚çš„æ ¸å¿ƒã€‚ä¸ºäº†æ›´æ·±å…¥åœ°ç†è§£æ•°æ®åŒ…æ˜¯å¦‚ä½•è¢«è·¯ç”±çš„ï¼Œæˆ‘ä»¬æœ‰å¿…è¦è¯¦ç»†å‰–æå…¶å¤´éƒ¨ç»“æ„ï¼š 0 1 2 3 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |Version| IHL |Type of Service| Total Length | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Identification |Flags| Fragment Offset | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Time to Live | Protocol | Header Checksum | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Source Address | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Destination Address | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | Options | Padding | +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ ç‰ˆæœ¬ (Version)ï¼š4ä½ï¼ŒæŒ‡æ˜åè®®ç‰ˆæœ¬ï¼Œå¯¹ IPv4 æ¥è¯´å°±æ˜¯ 4ã€‚ é¦–éƒ¨é•¿åº¦ (IHL)ï¼š4ä½ï¼Œè¡¨ç¤º IP å¤´éƒ¨æœ‰å¤šå°‘ä¸ª 32 ä½å­—ï¼ˆ4å­—èŠ‚ï¼‰ã€‚ç”±äºè¯¥å­—æ®µæœ€å¤§å€¼ä¸º 15ï¼Œæ‰€ä»¥ IP å¤´éƒ¨æœ€é•¿ä¸º 15 * 4 = 60 å­—èŠ‚ã€‚ æœåŠ¡ç±»å‹ (Type of Service)ï¼š8ä½ï¼Œç”¨äºæŒ‡å®šæ•°æ®åŒ…çš„æœåŠ¡è´¨é‡ï¼ˆQoSï¼‰ï¼Œä¾‹å¦‚ä½å»¶è¿Ÿã€é«˜ååé‡æˆ–é«˜å¯é æ€§ã€‚ç°åœ¨é€šå¸¸è¢«å®šä¹‰ä¸º DSCPï¼ˆå·®åˆ†æœåŠ¡ä»£ç ç‚¹ï¼‰ã€‚ æ€»é•¿åº¦ (Total Length)ï¼š16ä½ï¼ŒæŒ‡æ˜æ•´ä¸ª IP æ•°æ®åŒ…ï¼ˆå¤´éƒ¨+æ•°æ®ï¼‰çš„æ€»é•¿åº¦ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚æœ€å¤§é•¿åº¦ä¸º 65535 å­—èŠ‚ã€‚ æ ‡è¯† (Identification)ã€æ ‡å¿— (Flags) å’Œ ç‰‡åç§» (Fragment Offset)ï¼šè¿™ä¸‰ä¸ªå­—æ®µå…±åŒç”¨äº IP åˆ†ç‰‡ã€‚å½“ä¸€ä¸ªæ•°æ®åŒ…çš„å¤§å°è¶…è¿‡äº†é“¾è·¯çš„æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTUï¼‰æ—¶ï¼Œå®ƒå¿…é¡»è¢«åˆ†å‰²æˆå¤šä¸ªå°çš„æ•°æ®åŒ…ï¼ˆåˆ†ç‰‡ï¼‰ã€‚ æ ‡è¯†ï¼š16ä½ï¼Œå”¯ä¸€æ ‡è¯†ä¸€ä¸ªåŸå§‹æ•°æ®åŒ…ã€‚åŒä¸€åŸå§‹æ•°æ®åŒ…çš„æ‰€æœ‰åˆ†ç‰‡éƒ½å…·æœ‰ç›¸åŒçš„æ ‡è¯†å·ã€‚ æ ‡å¿—ï¼š3ä½ã€‚ç¬¬ä¸€ä½ä¿ç•™ï¼›ç¬¬äºŒä½æ˜¯ DF (Don't Fragment)ï¼Œå¦‚æœç½® 1ï¼Œè¡¨ç¤ºç¦æ­¢åˆ†ç‰‡ï¼›ç¬¬ä¸‰ä½æ˜¯ MF (More Fragments)ï¼Œå¦‚æœç½® 1ï¼Œè¡¨ç¤ºåé¢è¿˜æœ‰æ›´å¤šåˆ†ç‰‡ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡åˆ™ä¸º 0ã€‚ ç‰‡åç§»ï¼š13ä½ï¼ŒæŒ‡æ˜å½“å‰åˆ†ç‰‡çš„æ•°æ®éƒ¨åˆ†åœ¨åŸå§‹æ•°æ®åŒ…ä¸­çš„ä½ç½®ã€‚ ç”Ÿå­˜æ—¶é—´ (Time to Live, TTL)ï¼š8ä½ï¼Œæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­çš„â€œå¯¿å‘½â€ã€‚æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨ï¼ŒTTL å€¼å‡ 1ã€‚å½“ TTL å˜ä¸º 0 æ—¶ï¼Œæ•°æ®åŒ…è¢«ä¸¢å¼ƒã€‚è¿™æœ‰æ•ˆé˜²æ­¢äº†æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­å› è·¯ç”±é”™è¯¯è€Œæ— é™å¾ªç¯ã€‚ åè®® (Protocol)ï¼š8ä½ï¼ŒæŒ‡æ˜è¯¥æ•°æ®åŒ…æ‰¿è½½çš„ä¸Šå±‚åè®®æ˜¯ä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œ6 ä»£è¡¨ TCPï¼Œ17 ä»£è¡¨ UDPã€‚æ¥æ”¶æ–¹æ®æ­¤å†³å®šå°†æ•°æ®äº¤ç»™å“ªä¸ªä¸Šå±‚æ¨¡å—å¤„ç†ã€‚ é¦–éƒ¨æ ¡éªŒå’Œ (Header Checksum)ï¼š16ä½ï¼Œç”¨äºæ£€éªŒ IP å¤´éƒ¨çš„å®Œæ•´æ€§ï¼Œä¸åŒ…å«æ•°æ®éƒ¨åˆ†ã€‚ç”±äº TTL åœ¨æ¯ä¸€è·³éƒ½ä¼šæ”¹å˜ï¼Œæ‰€ä»¥è·¯ç”±å™¨éœ€è¦é‡æ–°è®¡ç®—æ ¡éªŒå’Œã€‚ æºåœ°å€/ç›®æ ‡åœ°å€ (Source/Destination Address)ï¼šå„ 32 ä½ï¼Œæ ‡è¯†äº†æ•°æ®åŒ…çš„å‘é€æ–¹å’Œæ¥æ”¶æ–¹ã€‚ é€‰é¡¹ (Options) å’Œ å¡«å…… (Padding)ï¼šé€‰é¡¹æ˜¯å¯å˜é•¿çš„ï¼Œç”¨äºä¸€äº›ç‰¹æ®Šå¤„ç†ï¼Œå¦‚è®°å½•è·¯ç”±ã€‚å¡«å……ç”¨äºç¡®ä¿æ•´ä¸ª IP å¤´éƒ¨æ˜¯ 32 ä½çš„æ•´æ•°å€ã€‚ ä¼ è¾“å±‚æ ¸å¿ƒï¼šTCP ä¸ UDP ä¼ è¾“å±‚è´Ÿè´£ç«¯åˆ°ç«¯çš„é€šä¿¡ï¼Œå…¶ä¸¤å¤§æ ¸å¿ƒåè®® TCP å’Œ UDPï¼Œæˆ‘ä»¬å·²åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­åšäº†è¯¦ç»†çš„æ¢è®¨ã€‚ TCP é€šè¿‡åºåˆ—å·ã€ç¡®è®¤å·ã€æ ‡å¿—ä½ç­‰å¤´éƒ¨å…³é”®å­—æ®µï¼Œä»¥åŠä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹ç­‰ä¸¥è°¨çš„è¿æ¥ç®¡ç†æœºåˆ¶ï¼Œæä¾›äº†å¯é çš„ã€é¢å‘è¿æ¥çš„æœåŠ¡ã€‚å…³äºè¿™äº›å†…éƒ¨å·¥ä½œç»†èŠ‚ï¼Œå¼ºçƒˆå»ºè®®æ‚¨å›é¡¾ ã€Šè®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDPã€‹ï¼Œæœ¬æ–‡ä¸å†èµ˜è¿°ã€‚ ç½‘ç»œå±‚çš„è·¯ç”±åè®® IP åè®®åªè´Ÿè´£æ•°æ®åŒ…çš„æŠ•é€’ï¼Œä½†å¦‚ä½•ç¡®å®šæŠ•é€’è·¯å¾„ï¼Œåˆ™æ˜¯ç”±è·¯ç”±åè®®å†³å®šçš„ã€‚è·¯ç”±åè®®åœ¨è·¯ç”±å™¨ä¹‹é—´è¿è¡Œï¼Œå…±åŒæ„å»ºå’Œç»´æŠ¤è·¯ç”±è¡¨ã€‚å®ƒä»¬ä¸»è¦åˆ†ä¸ºä¸¤å¤§æµæ´¾ï¼š è·ç¦»çŸ¢é‡åè®® (Distance-Vector)ï¼šå¦‚ RIPã€‚æ¯ä¸ªè·¯ç”±å™¨åªçŸ¥é“ä¸å®ƒç›´æ¥ç›¸é‚»çš„é‚»å±…ï¼Œå¹¶ä¸å®ƒä»¬äº¤æ¢æ•´ä¸ªè·¯ç”±è¡¨ã€‚å®ƒå…³å¿ƒçš„æ˜¯â€œåˆ°æŸä¸ªç›®çš„åœ°æœ‰å¤šè¿œï¼ˆè·ç¦»ï¼‰â€å’Œâ€œåº”è¯¥ä»å“ªä¸ªæ–¹å‘ï¼ˆçŸ¢é‡ï¼‰èµ°â€ã€‚è¿™ç§æ–¹å¼ç®€å•ï¼Œä½†å®¹æ˜“äº§ç”Ÿè·¯ç”±ç¯è·¯ä¸”æ”¶æ•›æ…¢ã€‚ é“¾è·¯çŠ¶æ€åè®® (Link-State)ï¼šå¦‚ OSPFã€‚æ¯ä¸ªè·¯ç”±å™¨éƒ½æ‹¥æœ‰æ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘å›¾ã€‚å½“ç½‘ç»œçŠ¶æ€å˜åŒ–æ—¶ï¼Œè·¯ç”±å™¨ä¼šå‘æ‰€æœ‰å…¶ä»–è·¯ç”±å™¨å¹¿æ’­è¿™ä¸ªå˜åŒ–ã€‚å®ƒå…³å¿ƒçš„æ˜¯â€œæ•´ä¸ªç½‘ç»œçš„è¿æ¥çŠ¶æ€â€ã€‚è¿™ç§æ–¹å¼æ›´å¤æ‚ï¼Œä½†æ”¶æ•›å¿«ä¸”ä¸æ˜“äº§ç”Ÿç¯è·¯ã€‚ OSI ä¸ TCP/IPï¼šä¸€åœºç†è®ºä¸å®è·µçš„èµ›è·‘ ä¸€ä¸ªç»å…¸é—®é¢˜æ˜¯ï¼šä¸ºä»€ä¹ˆç†è®ºä¸Šæ›´å®Œç¾çš„ OSI æ¨¡å‹ï¼Œåœ¨å®è·µä¸­å´è¾“ç»™äº†æ›´â€œç²—ç³™â€çš„ TCP/IP æ¨¡å‹ï¼Ÿ æ—¶æœºå†³å®šä¸€åˆ‡ï¼šTCP/IP è¯ç”Ÿäº 20 ä¸–çºª 70 å¹´ä»£ï¼Œä¸ç¾å›½å›½é˜²éƒ¨çš„ ARPANET é¡¹ç›®ç´§å¯†ç»“åˆï¼Œç»è¿‡äº†é•¿æœŸçš„å®è·µæ£€éªŒã€‚å½“ OSI æ¨¡å‹åœ¨ 80 å¹´ä»£åæœŸå®Œæˆå…¶æ ‡å‡†åŒ–å·¥ä½œæ—¶ï¼ŒTCP/IP æ—©å·²åœ¨å­¦æœ¯ç•Œå’Œå†›äº‹é¢†åŸŸå¹¿æ³›éƒ¨ç½²ï¼Œå½¢æˆäº†å¼ºå¤§çš„äº‹å®æ ‡å‡†ã€‚ å“²å­¦å·®å¼‚ï¼šOSI éµå¾ªâ€œå…ˆåˆ¶å®šæ ‡å‡†ï¼Œå†è¿›è¡Œå®ç°â€çš„å­¦é™¢æ´¾å“²å­¦ï¼ŒåŠ›æ±‚å¤§è€Œå…¨ï¼Œå¯¼è‡´å…¶è¿‡äºå¤æ‚ã€‚è€Œ TCP/IP åˆ™æºäºâ€œå…ˆæœ‰å¯ç”¨å®ç°ï¼Œå†æç‚¼æ ‡å‡†â€çš„å·¥ç¨‹å¸ˆå“²å­¦ï¼Œæ›´æ³¨é‡è§£å†³å®é™…é—®é¢˜ï¼Œå› æ­¤æ›´ç®€æ´ã€é«˜æ•ˆã€‚ å®ç°å¤æ‚åº¦ï¼šOSI æ¨¡å‹çš„å¤æ‚æ€§ï¼ˆå°¤å…¶æ˜¯ä¼šè¯å±‚å’Œè¡¨ç¤ºå±‚ï¼‰ä½¿å¾—å…¶å®ç°éš¾åº¦å’Œè¿è¡Œå¼€é”€éƒ½å¾ˆå¤§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒTCP/IP å°†è¿™äº›åŠŸèƒ½äº¤ç”±åº”ç”¨å±‚è‡ªè¡Œå¤„ç†ï¼Œå¤§å¤§é™ä½äº†æ ¸å¿ƒç½‘ç»œçš„å¤æ‚åº¦ã€‚ æœ€ç»ˆï¼Œè¿™åœºèµ›è·‘ä»¥å®è·µæ´¾çš„èƒœåˆ©å‘Šç»ˆã€‚OSI è™½ç„¶è¾“æ‰äº†å¸‚åœºï¼Œä½†å®ƒæ¸…æ™°çš„å±‚æ¬¡åˆ’åˆ†å’Œä¸¥è°¨çš„å®šä¹‰ï¼Œä½¿å…¶æˆä¸ºäº†ç½‘ç»œæ•™è‚²å’Œç†è®ºåˆ†æä¸å¯æˆ–ç¼ºçš„â€œæ•™ç§‘ä¹¦â€ã€‚ åº”ç”¨æ¨¡å‹ï¼šä»ç†è®ºåˆ°å®è·µ ç†è§£äº†åˆ†å±‚æ¨¡å‹è¿™ä¸€â€œåœ°å›¾â€ï¼Œæˆ‘ä»¬ä¾¿æ‹¥æœ‰äº†åˆ†æå’Œè¯Šæ–­ç½‘ç»œé—®é¢˜çš„æ¡†æ¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸¤ä¸ªå…·ä½“çš„æ¡ˆä¾‹ï¼Œå°†è¿™äº›æŠ½è±¡çš„å±‚æ¬¡å’Œåè®®åº”ç”¨åˆ°å®é™…åœºæ™¯ä¸­ã€‚ç¬¬ä¸€ä¸ªæ¡ˆä¾‹å°†å±•ç¤ºä¸€æ¬¡æ ‡å‡†ç½‘ç»œè¯·æ±‚çš„å®Œæ•´æµç¨‹ï¼Œç¬¬äºŒä¸ªæ¡ˆä¾‹åˆ™å°†å‰–æä¸€ä¸ªå¸¸è§çš„å¼€å‘é™·é˜±ï¼Œä»¥å±•ç¤ºåˆ†å±‚æ¨¡å‹åœ¨æ’é”™ä¸­çš„æŒ‡å¯¼ä»·å€¼ã€‚ æ¡ˆä¾‹ä¸€ï¼šä¸€æ¬¡å®Œæ•´çš„ HTTP è¯·æ±‚ è¿™ä¸ªæ¡ˆä¾‹å°†è¿½è¸ªä¸€æ¬¡å…¸å‹çš„ã€è®¿é—®å¤–éƒ¨ç½‘ç«™çš„ HTTP è¯·æ±‚ï¼Œä»¥å±•ç¤ºæ•°æ®åŒ…å¦‚ä½•ç©¿è¶Šäº’è”ç½‘ã€‚ åœºæ™¯è®¾å®šï¼š ä½ çš„ç”µè„‘ï¼šIP 192.168.1.100 (æ­¤åœ°å€é€šå¸¸é€šè¿‡ DHCP æœåŠ¡åŠ¨æ€è·å–ï¼Œç›¸å…³ç»†èŠ‚è¯·å›é¡¾ ã€Šè®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ã€‹), MAC AA:AA:AA:AA:AA:AA å®¶åº­è·¯ç”±å™¨ï¼šå†…ç½‘ IP 192.168.1.1, MAC BB:BB:BB:BB:BB:BBï¼›å…¬ç½‘ IP 123.123.123.123 ç›®æ ‡ç½‘ç«™æœåŠ¡å™¨ï¼šIP 216.58.200.46, MAC CC:CC:CC:CC:CC:CC æ—…ç¨‹å¼€å§‹ï¼š DNS æŸ¥è¯¢ï¼šåœ¨ä¸€åˆ‡å¼€å§‹ä¹‹å‰ï¼Œæµè§ˆå™¨éœ€è¦çŸ¥é“ example.com çš„ IP åœ°å€ã€‚å®ƒä¼šå‘ DNS æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œå°†åŸŸåè§£æä¸º IP åœ°å€ 216.58.200.46ã€‚å…³äº DNS çš„è¯¦ç»†å·¥ä½œåŸç†ï¼Œè¯·å‚é˜… ã€Šè®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNSã€‹ã€‚ åº”ç”¨å±‚ï¼šä½ åœ¨æµè§ˆå™¨è¾“å…¥ http://example.comã€‚æµè§ˆå™¨æ„å»ºä¸€ä¸ª HTTP GET è¯·æ±‚æŠ¥æ–‡ã€‚ ä¼ è¾“å±‚ï¼šæ“ä½œç³»ç»Ÿä¸ºè¯¥è¯·æ±‚åˆ†é…ä¸€ä¸ªä¸´æ—¶çš„æºç«¯å£ï¼ˆå¦‚ 54321ï¼‰ï¼Œç›®æ ‡ç«¯å£ä¸º HTTP çš„æ ‡å‡†ç«¯å£ 80ã€‚ç„¶åï¼Œå®ƒå°† HTTP æŠ¥æ–‡å°è£…è¿›ä¸€ä¸ª TCP æ•°æ®æ®µï¼Œå¹¶å†™å…¥ TCP å¤´éƒ¨ï¼ˆåŒ…å«æº/ç›®æ ‡ç«¯å£ç­‰ä¿¡æ¯ï¼‰ã€‚ ç½‘ç»œå±‚ï¼šæ“ä½œç³»ç»Ÿç»§ç»­å°è£…ï¼Œæ·»åŠ  IP å¤´éƒ¨ï¼Œå½¢æˆ IP æ•°æ®åŒ…ã€‚å¤´éƒ¨ä¿¡æ¯åŒ…æ‹¬æº IP (192.168.1.100) å’Œç›®æ ‡ IP (216.58.200.46)ã€‚ æ•°æ®é“¾è·¯å±‚ (ç¬¬ä¸€è·³ï¼šç”µè„‘ -&gt; è·¯ç”±å™¨)ï¼š æ“ä½œç³»ç»ŸæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œå‘ç°ç›®æ ‡ IP 216.58.200.46 ä¸åœ¨æœ¬åœ°ç½‘ç»œï¼Œéœ€å‘å¾€é»˜è®¤ç½‘å…³ (192.168.1.1)ã€‚ æ“ä½œç³»ç»Ÿä½¿ç”¨ ARP åè®®æŸ¥è¯¢ 192.168.1.1 å¯¹åº”çš„ MAC åœ°å€ï¼Œå¾—åˆ°è·¯ç”±å™¨çš„ MAC BB:BB:BB:BB:BB:BBã€‚ æœ€ç»ˆï¼Œå®ƒæ„å»ºä¸€ä¸ªä»¥å¤ªç½‘å¸§ï¼Œå¤´éƒ¨åŒ…å«æº MAC (AA:AA...) å’Œç›®æ ‡ MAC (BB:BB...)ï¼Œå¹¶å°† IP æ•°æ®åŒ…ä½œä¸ºå…¶â€œè´§ç‰©â€ã€‚ ç‰©ç†å±‚ï¼šç”µè„‘ç½‘å¡å°†è¯¥æ•°æ®å¸§è½¬æ¢ä¸ºç”µä¿¡å·ï¼Œé€šè¿‡ç½‘çº¿å‘é€å‡ºå»ã€‚ åœ¨è·¯ç”±å™¨ä¸Š (å…³é”®ä¸­è½¬)ï¼š è·¯ç”±å™¨çš„æ•°æ®é“¾è·¯å±‚æ¥æ”¶åˆ°æ•°æ®å¸§ï¼Œæ£€æŸ¥ç›®æ ‡ MAC æ˜¯è‡ªå·±ï¼Œäºæ˜¯â€œæ‹†å¼€â€å¸§ï¼Œå–å‡º IP æ•°æ®åŒ…ï¼Œå¹¶å°†å…¶å‘ä¸Šä¼ é€’åˆ°ç½‘ç»œå±‚ã€‚ è·¯ç”±å™¨çš„ç½‘ç»œå±‚æ‰§è¡Œ NAT (ç½‘ç»œåœ°å€è½¬æ¢)ã€‚å®ƒå°† IP åŒ…çš„æº IP ä» 192.168.1.100 ä¿®æ”¹ä¸ºè‡ªå·±çš„å…¬ç½‘ IP 123.123.123.123ï¼Œå¹¶è®°å½•ä¸‹è¿™ä¸ªæ˜ å°„å…³ç³»ï¼Œä»¥ä¾¿å“åº”å›æ¥æ—¶èƒ½æ­£ç¡®è½¬å‘ã€‚ è·¯ç”±å™¨å‡†å¤‡å°†ä¿®æ”¹åçš„ IP åŒ…å‘å¾€äº’è”ç½‘ã€‚å®ƒæŸ¥è¯¢è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œæ‰¾åˆ°ä¸‹ä¸€è·³çš„åœ°å€ï¼Œå¹¶æ„å»ºä¸€ä¸ªæ–°çš„æ•°æ®é“¾è·¯å±‚å¸§ï¼ˆæ­¤æ—¶çš„ç›®æ ‡ MAC å°†æ˜¯ä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„ MACï¼‰ï¼Œç„¶åå‘é€å‡ºå»ã€‚ åœ¨äº’è”ç½‘ä¸­ï¼šæ•°æ®åŒ…ç»è¿‡å¤šä¸ªè·¯ç”±å™¨çš„å¤šæ¬¡è½¬å‘ï¼Œæ¯ä¸€è·³éƒ½é‡å¤ç€â€œè§£å°è£…-æŸ¥è·¯ç”±-å†å°è£…â€çš„è¿‡ç¨‹ï¼Œä½† IP å¤´éƒ¨çš„æº/ç›®æ ‡ IP å§‹ç»ˆä¸å˜ï¼ˆé™¤äº† NAT ç½‘å…³ï¼‰ã€‚ æŠµè¾¾æœåŠ¡å™¨ï¼šæœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®ï¼Œè‡ªåº•å‘ä¸Šè¿›è¡Œè§£å°è£…ï¼Œæœ€ç»ˆå°† HTTP è¯·æ±‚æŠ¥æ–‡é€è¾¾ Web æœåŠ¡å™¨åº”ç”¨ã€‚æœåŠ¡å™¨å¤„ç†è¯·æ±‚åï¼Œå†ä»¥åŒæ ·çš„æ–¹å¼å°†å“åº”æ•°æ®å°è£…å¹¶å‘å›ã€‚ æ¡ˆä¾‹äºŒï¼šä» localhost åˆ°å±€åŸŸç½‘çš„è¿æ¥é—®é¢˜ æœ¬åšå®¢åŸºäº Gridea å®ç°ï¼Œè¯¥å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªä¾¿æ·çš„â€œé¢„è§ˆâ€åŠŸèƒ½ï¼Œç‚¹å‡»åä¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:4000 è¿™æ ·çš„åœ°å€ï¼Œç”¨äºå®æ—¶æŸ¥çœ‹æ–‡ç« æ•ˆæœã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨æœ¬åœ°ç”µè„‘ä¸Šè¿è¡Œè‰¯å¥½ï¼Œä½†å½“ä½œè€…å¸Œæœ›ä½¿ç”¨å…¶ä»–è®¾å¤‡ï¼ˆå¦‚æ‰‹æœºï¼‰é¢„è§ˆåœ°å€æ–‡ç« æ—¶å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ï¼Œå› ä¸ºè¿™ä¸ªåœ°å€åœ¨å…¶ä»–è®¾å¤‡ä¸Šæ˜¯ â€œæ‰“ä¸å¼€â€ çš„ã€‚ é—®é¢˜çš„æ¼”è¿› åˆæ¬¡å°è¯•ï¼šä¸€ä¸ªç›´æ¥çš„æƒ³æ³•æ˜¯åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­è¾“å…¥ http://localhost:4000ã€‚è¿™ä¸ªå°è¯•å¿…ç„¶ä¼šå¤±è´¥ã€‚å…¶åŸå› æ˜¯ localhost æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¯å›åœ°å€ï¼Œå®ƒæŒ‡å‘è®¾å¤‡è‡ªèº«ã€‚æ‰‹æœºè®¿é—® localhostï¼Œè®¿é—®çš„æ˜¯æ‰‹æœºè‡ªå·±ï¼Œè€Œéæä¾›æœåŠ¡çš„ç”µè„‘ã€‚ äºŒæ¬¡å°è¯•ï¼šåœ¨ç†è§£äº† localhost çš„å±€é™æ€§åï¼ŒåŸºäºå’±ä»¬å·²ç»å­¦ä¹ è¿‡çš„è®¡ç®—æœºç½‘ç»œçŸ¥è¯†ï¼Œä¸‹ä¸€æ­¥è‡ªç„¶æ˜¯å°è¯•ä½¿ç”¨ç”µè„‘çš„å±€åŸŸç½‘ IP åœ°å€ã€‚åœ¨ macOS ä¸Šæˆ‘ä»¬å¯ä»¥é€šè¿‡ â€œè®¾ç½® -&gt; ç½‘ç»œâ€ æŸ¥åˆ°ç”µè„‘çš„ IPï¼Œå‡è®¾ä¸º 192.168.1.100ï¼Œäºæ˜¯åœ¨æ‰‹æœºä¸Šè®¿é—® http://192.168.1.100:4000ã€‚ç„¶è€Œï¼Œè¿™ç§å°è¯•ä¹Ÿä¼šå¤±è´¥ï¼Œæµè§ˆå™¨ä¼šæ˜¾ç¤ºè¿æ¥è¶…æ—¶æˆ–æ— æ³•è®¿é—®ã€‚ è¿™å°±å¼•å‡ºäº†é—®é¢˜çš„æ ¸å¿ƒï¼šåœ¨ç½‘ç»œå±‚é¢ä¸Šï¼Œæ•°æ®åŒ…å·²ç»èƒ½å¤Ÿä»æ‰‹æœºè·¯ç”±åˆ°ç›®æ ‡ä¸»æœºï¼Œä¸ºä»€ä¹ˆè¿æ¥ä¾ç„¶æ— æ³•å»ºç«‹ï¼Ÿè¿™è¡¨æ˜é—®é¢˜å¾ˆå¯èƒ½å‡ºåœ¨æ›´é«˜å±‚ï¼Œå³è¿è¡Œåœ¨ä¸»æœºä¸Šçš„æœåŠ¡ç¨‹åºæœ¬èº«ã€‚ éªŒè¯ç½‘ç»œå±‚ (Layer 3) åŠä»¥ä¸‹æ˜¯å¦é€šç•… åœ¨æ€€ç–‘ä¸Šå±‚åº”ç”¨é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç™¾åˆ†ä¹‹ç™¾ç¡®è®¤åŸºç¡€ç½‘ç»œæ˜¯è¿é€šçš„ã€‚ping å‘½ä»¤æ˜¯éªŒè¯ç½‘ç»œå±‚è¿é€šæ€§çš„æœ€ä½³å·¥å…·ï¼Œå®ƒä½¿ç”¨ ICMP åè®®å·¥ä½œã€‚æˆ‘ä»¬å¯ä»¥åœ¨ iPhone ä¸Šå®‰è£…ä»»æ„ä¸€æ¬¾ç½‘ç»œè°ƒè¯•å·¥å…·ï¼ˆæ¯”å¦‚ iNetToolsï¼‰ç„¶åæ‰§è¡Œï¼š ping 192.168.1.100 å¦‚æœ ping æˆåŠŸæ”¶åˆ°å›å¤ï¼Œæˆ‘ä»¬å°†è·å¾—ä¸€æ¡è‡³å…³é‡è¦çš„ä¿¡æ¯ï¼šä»æ‰‹æœºåˆ°ç”µè„‘çš„ ç½‘ç»œå±‚åŠä»¥ä¸‹çš„ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚æ˜¯å®Œå…¨é€šç•…çš„ã€‚æ•°æ®åŒ…ç¡®å®å·²ç»æˆåŠŸæŠµè¾¾äº†ç›®æ ‡ä¸»æœºçš„ç½‘ç»œåè®®æ ˆã€‚è¿™å°±å…è®¸æˆ‘ä»¬æ’é™¤æ‰æ‰€æœ‰åº•å±‚ç½‘ç»œé—®é¢˜ï¼ˆå¦‚ Wi-Fi éš”ç¦»ã€IP å†²çªã€å­ç½‘é”™è¯¯ç­‰ï¼‰ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åˆ°æ›´é«˜å±‚æ¬¡ã€‚ èšç„¦ä¼ è¾“å±‚ (Layer 4) çš„å¯èƒ½æ€§ æ—¢ç„¶ç½‘ç»œè·¯å¾„æ²¡æœ‰é—®é¢˜ï¼Œæ•°æ®åŒ…åœ¨ä¼ è¾“å±‚â€œæ¶ˆå¤±â€çš„å¯èƒ½æ€§å°±å¤§å¤§å¢åŠ ã€‚åœ¨è¿™ä¸€å±‚ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå®ä½“åœ¨å·¥ä½œï¼šæ“ä½œç³»ç»Ÿå†…æ ¸ï¼ˆé˜²ç«å¢™ï¼‰ å’Œ åº”ç”¨ç¨‹åºæœ¬èº«ã€‚ å¯èƒ½æ€§ Aï¼šè¢«é˜²ç«å¢™æ‹¦æˆªã€‚ç”µè„‘çš„é˜²ç«å¢™å¯èƒ½è®¾å®šäº†è§„åˆ™ï¼Œå…è®¸ ICMP åŒ…ï¼ˆpingï¼‰é€šè¿‡ï¼Œä½†é˜»æ­¢äº†é’ˆå¯¹ 4000 ç«¯å£çš„ TCP è¿æ¥è¯·æ±‚ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸åˆç†çš„æ€€ç–‘ç‚¹ã€‚ å¯èƒ½æ€§ Bï¼šç«¯å£ä¸Šæ²¡æœ‰æœåŠ¡åœ¨ç›‘å¬ã€‚åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ï¼Œéœ€è¦å‘æ“ä½œç³»ç»Ÿå†…æ ¸ç”³è¯·ç›‘å¬ä¸€ä¸ªæˆ–å¤šä¸ªå…·ä½“çš„â€œåœ°å€-ç«¯å£â€å¯¹ã€‚å¦‚æœç¨‹åºåªç”³è¯·ç›‘å¬ 127.0.0.1:4000ï¼Œé‚£ä¹ˆå½“ä¸€ä¸ªç›®æ ‡åœ°å€æ˜¯ 192.168.1.100:4000 çš„æ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œå†…æ ¸ä¼šå‘ç°æ²¡æœ‰ä»»ä½•ç¨‹åºåœ¨ç­‰å¾…è¿™ä¸ªæ•°æ®åŒ…ï¼Œäºæ˜¯åªèƒ½å°†å…¶ä¸¢å¼ƒã€‚ ä½¿ç”¨å·¥å…·åšå‡ºæœ€ç»ˆè£å®š ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå·¥å…·æ¥åŒºåˆ†åˆ°åº•æ˜¯å¯èƒ½æ€§ A è¿˜æ˜¯ Bã€‚lsof å‘½ä»¤çš„ä½œç”¨æ­£åœ¨äºæ­¤ï¼Œå®ƒèƒ½ç›´æ¥æŸ¥è¯¢æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå‘Šè¯‰æˆ‘ä»¬â€œå“ªä¸ªè¿›ç¨‹æ­£åœ¨ç›‘å¬å“ªä¸ªåœ°å€çš„å“ªä¸ªç«¯å£â€ï¼Œä»è€Œç»•è¿‡æ‰€æœ‰çŒœæµ‹ã€‚ lsof -i :4000 å…¶è¾“å‡ºç»“æœï¼š COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME Gridea 13682 rakuyo 50u IPv4 0x7e41bc65e0e51533 0t0 TCP localhost:terabase (LISTEN) è¿™ä¸ªç»“æœæ˜ç¡®åœ°å‘Šè¯‰æˆ‘ä»¬ï¼ŒGridea è¿›ç¨‹ç›‘å¬çš„åœ°å€æ˜¯ localhostã€‚è¿™ç›´æ¥è¯å®äº†å¯èƒ½æ€§ Bã€‚æ•°æ®åŒ…å¹¶éè¢«é˜²ç«å¢™æ‹¦æˆªï¼Œè€Œæ˜¯åœ¨åˆ°è¾¾å†…æ ¸åï¼Œå› æ‰¾ä¸åˆ°å¯¹åº”çš„ç›‘å¬ç¨‹åºè€Œè¢«ä¸¢å¼ƒã€‚è‡³æ­¤ï¼Œé—®é¢˜æ ¹æºè¢«ç²¾å‡†å®šä½ã€‚ è§£å†³æ–¹æ¡ˆ è¯Šæ–­å‡ºæ ¹æºåï¼Œè§£å†³æ–¹æ¡ˆä¾¿æ˜¯åœ¨æœåŠ¡å±‚é¢è¿›è¡Œä¿®æ­£ã€‚ä½†æ˜¯å¾ˆå¯æƒœçš„æ˜¯ Gridea å¹¶æ²¡æœ‰æä¾›ä¿®æ”¹çš„é€‰é¡¹ã€‚å¦åˆ™æˆ‘ä»¬å¯ä»¥å°†é»˜è®¤çš„ localhost æˆ– 127.0.0.1 ä¿®æ”¹ä¸º 0.0.0.0ï¼Œå®ç°ç›‘å¬åœ°å€çš„ä¿®æ”¹ã€‚ 0.0.0.0 æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åœ°å€ï¼Œå®ƒæŒ‡ç¤ºæ“ä½œç³»ç»Ÿç›‘å¬æœ¬æœºæ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼ŒåŒ…æ‹¬ç¯å›åœ°å€å’Œæ‰€æœ‰å±€åŸŸç½‘åœ°å€ã€‚ è¿™ä¸ªæ’æŸ¥è¿‡ç¨‹æ¸…æ™°åœ°å±•ç¤ºäº†åˆ†å±‚æ¨¡å‹åœ¨è§£å†³å®é™…é—®é¢˜æ—¶çš„æŒ‡å¯¼ä½œç”¨ã€‚è‹¥ä¸ç†è§£ç½‘ç»œå±‚çš„åœ°å€å’Œç›‘å¬æœºåˆ¶ï¼Œå¼€å‘è€…å¯èƒ½ä¼šé™·å…¥åå¤æ£€æŸ¥é˜²ç«å¢™ã€ç½‘ç»œè®¾ç½®çš„æ— æ•ˆå¾ªç¯ä¸­ã€‚è€Œé€šè¿‡è¿ç”¨æ­£ç¡®çš„ç†è®ºçŸ¥è¯†å’Œè¯Šæ–­å·¥å…·ï¼Œåˆ™å¯ä»¥å¿«é€Ÿã€ç²¾å‡†åœ°å®šä½é—®é¢˜æ ¹æºã€‚ åˆ†å±‚è§†è§’ä¸‹çš„ç½‘ç»œå®‰å…¨ åˆ†å±‚æ¨¡å‹ä¹Ÿä¸ºæˆ‘ä»¬ç†è§£å’Œåº”å¯¹ç½‘ç»œå®‰å…¨é—®é¢˜æä¾›äº†ä¸€ä¸ªæ¸…æ™°çš„æ¡†æ¶ã€‚æ”»å‡»å¯èƒ½å‘ç”Ÿåœ¨ä»»ä½•ä¸€å±‚ï¼š æ•°æ®é“¾è·¯å±‚å®‰å…¨ï¼šæ”»å‡»è€…åœ¨å±€åŸŸç½‘å†…ï¼Œå¯ä»¥é€šè¿‡ ARP æ¬ºéª—æ¥å†’å……ç½‘å…³ï¼Œçªƒå¬æˆ–ç¯¡æ”¹æµé‡ï¼›æˆ–è€…é€šè¿‡ MAC æ³›æ´ªæ”»å‡»è€—å°½äº¤æ¢æœºçš„ MAC åœ°å€è¡¨ï¼Œä½¿å…¶å˜ä¸ºâ€œé›†çº¿å™¨â€ï¼Œä»è€Œå—…æ¢æ•´ä¸ªç½‘ç»œçš„æµé‡ã€‚ ç½‘ç»œå±‚å®‰å…¨ï¼šæ”»å‡»è€…å¯ä»¥ä¼ªé€ æº IP åœ°å€ï¼ˆIP æ¬ºéª—ï¼‰æ¥éšè—èº«ä»½æˆ–å«ç¥¸ä»–äººã€‚ç»å…¸çš„ DDoS æ”»å‡»ï¼ˆå¦‚ SYN Floodï¼‰ä¹Ÿåˆ©ç”¨äº† IP å±‚çš„æœºåˆ¶ï¼Œå‘é€å¤§é‡ä¼ªé€ æº IP çš„è¿æ¥è¯·æ±‚ï¼Œè€—å°½æœåŠ¡å™¨èµ„æºã€‚ ä¼ è¾“å±‚å®‰å…¨ï¼šç«¯å£æ‰«ææ˜¯é»‘å®¢æ¢æµ‹ç›®æ ‡ä¸»æœºå¼€æ”¾æœåŠ¡çš„ä¸»è¦æ‰‹æ®µï¼Œå®ƒç›´æ¥ä½œç”¨äºä¼ è¾“å±‚çš„ç«¯å£ã€‚ åº”ç”¨å±‚å®‰å…¨ï¼šè¿™æ˜¯æœ€å¹¿ä¸ºäººçŸ¥çš„æ”»å‡»é¢ï¼ŒåŒ…æ‹¬ SQL æ³¨å…¥ã€è·¨ç«™è„šæœ¬ï¼ˆXSSï¼‰ã€CSRF ç­‰ï¼Œå®ƒä»¬éƒ½åˆ©ç”¨äº†åº”ç”¨ç¨‹åºè‡ªèº«çš„é€»è¾‘æ¼æ´ã€‚ ä¸ºäº†åº”å¯¹è¿™äº›å¨èƒï¼Œå®‰å…¨åè®®ä¹Ÿä½œç”¨äºä¸åŒå±‚é¢ã€‚ä¾‹å¦‚ï¼ŒIPsec å·¥ä½œåœ¨ç½‘ç»œå±‚ï¼Œæä¾›ç«¯åˆ°ç«¯çš„åŠ å¯†å’Œè®¤è¯ã€‚è€Œæˆ‘ä»¬ç†ŸçŸ¥çš„ TLS/SSL åˆ™æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒé€»è¾‘ä¸Šä½äºåº”ç”¨å±‚å’Œä¼ è¾“å±‚ä¹‹é—´ï¼Œä¸ºä¸Šå±‚çš„åº”ç”¨æ•°æ®æä¾›åŠ å¯†ã€å®Œæ•´æ€§ä¿æŠ¤å’Œèº«ä»½è®¤è¯ã€‚æ­¤å¤–ï¼Œå¦ä¸€ç§å¼ºå¤§çš„å®‰å…¨å·¥å…·æ˜¯ VPNï¼ˆè™šæ‹Ÿä¸“ç”¨ç½‘ç»œï¼‰ã€‚æŠ€æœ¯å¦‚ WireGuard é€šè¿‡åˆ›å»ºä¸€å¼ è™šæ‹Ÿç½‘å¡ï¼Œå¹¶åœ¨ç½‘ç»œå±‚å¯¹æ‰€æœ‰æ•°æ®è¿›è¡ŒåŠ å¯†å°è£…ï¼Œå½¢æˆä¸€ä¸ªå®‰å…¨çš„â€œéš§é“â€ã€‚æ‰€æœ‰è¿›å‡ºä½ è®¾å¤‡çš„æµé‡éƒ½é€šè¿‡è¿™ä¸ªéš§é“ä¼ è¾“ï¼Œä»è€Œæœ‰æ•ˆåœ°ä¿æŠ¤äº†é€šä¿¡çš„ç§å¯†æ€§å’Œå®Œæ•´æ€§ï¼ŒæŠµå¾¡äº†ä¸­é—´äººæ”»å‡»ã€‚æ›´æ·±å…¥çš„æ¢è®¨å¯ä»¥å‚è§ ã€Šè®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuardã€‹ã€‚ æ¨¡å‹çš„å±€é™æ€§ä¸äº‰è®® åˆ†å±‚æ¨¡å‹æ˜¯å®Œç¾çš„å—ï¼Ÿå¹¶éå¦‚æ­¤ã€‚åœ¨å­¦æœ¯å’Œå·¥ç¨‹å®è·µä¸­ï¼Œå®ƒä»¬ä¹Ÿå­˜åœ¨ä¸€äº›äº‰è®®ï¼š å½’å±äº‰è®®ï¼šæœ‰äº›é‡è¦åè®®éš¾ä»¥è¢«å®Œç¾åœ°å½’å…¥æŸä¸€å±‚ã€‚ä¾‹å¦‚ï¼ŒARP åè®®é€šè¿‡ IP åœ°å€æŸ¥è¯¢ MAC åœ°å€ï¼Œå®ƒä¼¼ä¹æ¨ªè·¨äº†ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚ã€‚ICMP åè®®ï¼ˆping å‘½ä»¤æ‰€ä½¿ç”¨çš„åè®®ï¼‰è¢« IP åè®®æ‰¿è½½ï¼Œä½†å®ƒæœ¬èº«æ˜¯ä¸ºç½‘ç»œå±‚æä¾›æ§åˆ¶å’Œé”™è¯¯ä¿¡æ¯çš„ï¼Œå…¶ä½ç½®ä¹Ÿå­˜åœ¨äº‰è®®ã€‚ æ•ˆç‡é—®é¢˜ï¼šä¸¥æ ¼çš„åˆ†å±‚ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ã€‚åœ¨ä¸€äº›é«˜æ€§èƒ½è®¡ç®—åœºæ™¯ä¸­ï¼Œä¸ºäº†è¿½æ±‚æè‡´çš„ä½å»¶è¿Ÿï¼Œå¯èƒ½ä¼šå‡ºç°â€œè·¨å±‚â€æ“ä½œï¼Œç»•è¿‡æŸäº›åè®®æ ˆä»¥åŠ é€Ÿæ•°æ®å¤„ç†ã€‚ æ¨¡å‹ä¸ç°å®çš„è„±èŠ‚ï¼šOSI æ¨¡å‹çš„ä¼šè¯å±‚å’Œè¡¨ç¤ºå±‚åœ¨ç°å®ä¸­å¾ˆå°‘è¢«ç‹¬ç«‹å®ç°ï¼Œå®ƒä»¬çš„åŠŸèƒ½å¾€å¾€è¢«åº”ç”¨å±‚è‡ªèº«æ‰€åŒ…å«ï¼Œè¿™ä¹Ÿæ˜¯ TCP/IP æ¨¡å‹å°†å…¶åˆå¹¶çš„åŸå› ã€‚ ç†è§£è¿™äº›å±€é™æ€§ï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬æ›´è¾©è¯åœ°çœ‹å¾…è¿™äº›æ¨¡å‹ï¼Œè®¤è¯†åˆ°å®ƒä»¬æ˜¯ç”¨äºç†è§£å¤æ‚ç³»ç»Ÿçš„å¼ºå¤§å·¥å…·ï¼Œè€Œéä¸€æˆä¸å˜çš„æ•™æ¡ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„æ·±åº¦å‰–æï¼Œæˆ‘ä»¬ä¸ä»…äº†è§£äº† OSI å’Œ TCP/IP æ¨¡å‹æ˜¯ä»€ä¹ˆï¼Œæ›´æ¢è®¨äº†å®ƒä»¬çš„è®¾è®¡å“²å­¦ã€å†å²æ¼”è¿›ã€åè®®ç»†èŠ‚ã€å®è·µæµç¨‹ä¹ƒè‡³ç†è®ºå±€é™ã€‚ ç½‘ç»œåˆ†å±‚æ¨¡å‹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§â€œåˆ†è€Œæ²»ä¹‹â€çš„å·¥ç¨‹æ™ºæ…§ã€‚å®ƒå°†ä¸€ä¸ªä¸å¯èƒ½å®Œæˆçš„å¤æ‚ä»»åŠ¡ï¼Œæ‹†è§£ä¸ºä¸€ç³»åˆ—å®šä¹‰æ¸…æ™°ã€å¯ä»¥ç®¡ç†çš„å­ä»»åŠ¡ã€‚ç†è§£è¿™äº›åˆ†å±‚æ¨¡å‹ï¼Œå°±åƒæ˜¯æ‹¿åˆ°äº†ä¸€å¼ é«˜ç²¾åº¦çš„ç½‘ç»œä¸–ç•Œåœ°å›¾ã€‚å½“æˆ‘ä»¬å†å»å®¡è§†ä¹‹å‰æ–‡ç« ä¸­è®¨è®ºçš„ HTTPã€TCPã€IPã€DHCP ç­‰åè®®æ—¶ï¼Œä¾¿èƒ½æ¸…æ™°åœ°çŸ¥é“å®ƒä»¬åœ¨æ•´ä¸ªé€šä¿¡æµç¨‹ä¸­æ‰€å¤„çš„ä½ç½®å’Œæ‰®æ¼”çš„è§’è‰²ã€‚æœ‰äº†è¿™ä¸ªâ€œä¸–ç•Œè§‚â€ï¼Œæˆ‘ä»¬åç»­æ¢ç´¢æ›´å¤æ‚çš„ç½‘ç»œæŠ€æœ¯æ—¶ï¼Œæ‰èƒ½åšåˆ°èƒ¸æœ‰æˆç«¹ï¼Œæ¸¸åˆƒæœ‰ä½™ã€‚ ","link":"https://blog.rakuyo.dev/computer-network-osi-and-tcpip-models/"},{"title":"Vibe Coding çš„ä¸¤é¢ï¼šä¸€å‘¨ä½“éªŒçš„ç”œèœœä¸æŒ£æ‰","content":"Vibe Codingï¼Œä¹Ÿå°±æ˜¯ â€œæ°›å›´ç¼–ç¨‹â€ è¿™ä¸ªæ¦‚å¿µå·²ç»ç«äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œå¯æƒœä¸»åŒ…ä¹‹å‰ç¢äºç§ç§åŸå› ä¸€ç›´æ²¡èƒ½æ‰¾åˆ°æœºä¼šäº²è‡ªè¯•ä¸€ä¸‹ã€‚ä¸è¿‡å°±åœ¨ä¸Šå‘¨æ­£å¥½è¦åšä¸€ä¸ªæ–°çš„ç³»ç»Ÿï¼Œç»™äº†æˆ‘å°è¯• Vibe Coding çš„æœºä¼šã€‚ç°åœ¨ç³»ç»Ÿå·²ç»æ­å»ºå®Œæ¯•ï¼Œæœ¬æ–‡å°±ç”¨æ¥è®°å½•è¿™ä¸€å‘¨å¤šä¸€ç‚¹çš„ â€œæ°›å›´ç¼–ç¨‹â€ ä½“éªŒå§ã€‚ ä»€ä¹ˆæ˜¯æ°›å›´ç¼–ç¨‹ (vibe coding)ï¼Ÿ å¼•ç”¨ Google Cloud ä¸Šå¯¹ Vibe Coding çš„ä»‹ç»ï¼š æ°›å›´ç¼–ç¨‹ (vibe coding) æ˜¯ä¸€ç§æ–°å…´çš„è½¯ä»¶å¼€å‘å®è·µï¼Œå®ƒä½¿ç”¨äººå·¥æ™ºèƒ½ (AI) æ ¹æ®è‡ªç„¶è¯­è¨€æç¤ºç”ŸæˆåŠŸèƒ½ä»£ç ï¼Œä»è€ŒåŠ å¿«å¼€å‘é€Ÿåº¦ï¼Œå¹¶è®©åº”ç”¨æ„å»ºå˜å¾—æ›´åŠ å®¹æ˜“ï¼Œå¯¹äºé‚£äº›ç¼–ç¨‹ç»éªŒæœ‰é™çš„ç”¨æˆ·å°¤å…¶å¦‚æ­¤ã€‚ è¯¥æœ¯è¯­ç”± AI ç ”ç©¶äººå‘˜ Andrej Karpathy äº 2025 å¹´åˆåˆ›é€ ï¼Œç”¨äºæè¿°ä¸€ç§å·¥ä½œæµï¼Œå…¶ä¸­å¼€å‘è€…çš„ä¸»è¦è§’è‰²ä»é€è¡Œç¼–å†™ä»£ç è½¬å˜ä¸ºé€šè¿‡å¯¹è¯é£æ ¼æ›´æµ“çš„è¿‡ç¨‹æŒ‡å¯¼ AI åŠ©ç†ç”Ÿæˆã€å®Œå–„å’Œè°ƒè¯•åº”ç”¨ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥è…¾å‡ºæ—¶é—´å’Œç²¾åŠ›æ€è€ƒå¤§æ–¹å‘æˆ–åº”ç”¨çš„ä¸»è¦ç›®æ ‡ï¼Œè€Œ AI åˆ™è´Ÿè´£ç¼–å†™å®é™…ä»£ç ã€‚ åœ¨å®è·µä¸­ï¼Œæ°›å›´ç¼–ç¨‹é€šå¸¸æœ‰ä¸¤ç§ä¸»è¦çš„åº”ç”¨æ–¹å¼ï¼š â€œçº¯â€æ°›å›´ç¼–ç¨‹ï¼šåœ¨è¿™ç§æœ€æ¢ç´¢æ€§çš„å½¢å¼ä¸­ï¼Œç”¨æˆ·å¯èƒ½ä¼šå®Œå…¨ä¿¡ä»» AI çš„è¾“å‡ºèƒ½å¤ŸæŒ‰é¢„æœŸå·¥ä½œã€‚æ­£å¦‚ Karpathy æ‰€æè¿°çš„é‚£æ ·ï¼Œè¿™å°±å¥½æ¯”æ˜¯â€œå¿˜è®°äº†ä»£ç çš„å­˜åœ¨â€ï¼Œå› æ­¤å®ƒæœ€é€‚åˆç”¨äºå¿«é€Ÿæ„æ€ï¼Œæˆ–è€…ä»–æ‰€è¯´çš„â€œå‘¨æœ«å³å…´é¡¹ç›®â€ï¼Œåœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œé€Ÿåº¦æ˜¯é¦–è¦ç›®æ ‡ã€‚ Responsible AI è¾…åŠ©å¼€å‘ï¼šè¿™æ˜¯è¯¥æ¦‚å¿µçš„å®é™…ä¸“ä¸šåº”ç”¨ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒAI å·¥å…·å……å½“åŠŸèƒ½å¼ºå¤§çš„åä½œè€…æˆ–â€œç¼–ç¨‹æ­æ¡£â€ã€‚ç”¨æˆ·ä¼šæŒ‡å¯¼ AI æ“ä½œï¼Œç„¶åå®¡æŸ¥ã€æµ‹è¯•å¹¶ç†è§£ AI ç”Ÿæˆçš„ä»£ç ï¼Œå› æ­¤å¯¹æœ€ç»ˆäº§å“æ‹¥æœ‰å®Œå…¨çš„æ‰€æœ‰æƒã€‚ åœ¨æˆ‘è¿™ä¸€å‘¨å¤šçš„å·¥ä½œæ—¶é—´é‡Œï¼Œæˆ‘æ‰ç”¨çš„ç®—æ˜¯ä»‹äºè¿™ä¸¤ç§æ¨¡å¼ä¸­é—´çš„ç¬¬ä¸‰ç§æ¨¡å¼ï¼š å‘ AI æè¿°ä»»åŠ¡ï¼ŒæŒ‡å¯¼ AI æ“ä½œï¼Œè®¾å®šæ¶æ„ï¼ˆå“ªäº›ä»£ç è¯¥æ”¾åœ¨å“ªä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼‰ï¼ŒåŒæ—¶æ¡†å®šé™åˆ¶ï¼ˆæ¯”å¦‚äº›è®¸ä»£ç æ ¼å¼ï¼‰ã€‚ ä¸€äº›å¹¶ä¸å…¨é¢çš„å®¡æŸ¥ï¼Œç„¶åå°½é‡ä¸å»ç†è§£ AI æ‰€ç¼–å†™çš„ä»£ç çš„å…·ä½“ç»†èŠ‚ã€‚ æ‰“ä¸ªæ¯”æ–¹å°±æ˜¯ï¼š æˆ‘è¦æ±‚ AI æ”¶æ‹¾ä¹¦æ¶ï¼Œç¬¬ä¸€å±‚æ”¾ç¼–ç¨‹ç±»ä¹¦ç±ï¼Œç¬¬äºŒå±‚æ”¾å°è¯´ï¼Œç¬¬ä¸‰å±‚... å¹¶ä¸”æŒ‰ç…§ä»é«˜åˆ°ä½æ’åºã€‚ æœ€ç»ˆ AI æ’å¥½äº†ï¼Œæˆ‘çœ‹äº†ä¸€çœ¼ç¡®å®æ˜¯ä»é«˜åˆ°ä½æ’åºï¼Œä¹Ÿæ˜¯æŒ‰ç…§ç¼–ç¨‹ç±»ã€å°è¯´... çš„é¡ºåºæ”¾ç½®ã€‚ ä½†æ˜¯æˆ‘æ²¡æœ‰å»å…·ä½“çš„äº†è§£æ¯å±‚éƒ½æœ‰å“ªäº›ä¹¦ã€‚ æˆ‘åšäº†ä¸ªä»€ä¹ˆç³»ç»Ÿï¼Ÿ æˆ‘è¿™ä¸ªçš„ä»»åŠ¡æ˜¯è¦å¼€å‘ä¸€ä¸ªå°ç³»ç»Ÿï¼Œå®ƒçš„ä½œç”¨æ˜¯å°½å¯èƒ½åœ°å°† â€œGitLab MR Reviewâ€ è¿™ä»¶äº‹è‡ªåŠ¨åŒ–èµ·æ¥ï¼Œå¹¶ä¸”æ¥å…¥ AI ä¸æ€ç é€¸è¾…åŠ© Reviewã€‚è¿™å¥—ç³»ç»Ÿçš„è¿è¡Œæµç¨‹åŸºæœ¬å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»»åŠ¡æ‹†è§£ ä»æµç¨‹å›¾ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªç³»ç»Ÿéœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š å®ƒéœ€è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ Dockerã€‚ æœ‰ä¸€ç³»åˆ—å›´ç»• GitLab çš„åŠŸèƒ½ã€‚ ç›‘å¬ MR ä¸­çš„ä¸€äº›è¡Œä¸ºäº‹ä»¶ã€‚ è¯„è®ºçš„å‘å¸ƒã€‚ æ ‡ç­¾çš„ä¿®æ”¹ã€‚ åœ¨ MR ä¸­å‘å¸ƒè¯„è®ºã€‚ ä¸º MR è¯„è®ºè¯„è®ºæ·»åŠ  emojiï¼ˆæœªåœ¨æµç¨‹å›¾ä¸­ä½“ç°ï¼‰ã€‚ ä¸º MR è®¾ç½®æ ‡ç­¾ã€‚ é€šè¿‡ api è§¦å‘ GitLab-CI æµæ°´çº¿ã€‚ å°è£…å¤šä¸ª Review è¾…åŠ©ç³»ç»Ÿã€‚ AI apiã€‚ æ€ç é€¸ apiã€‚ ç¬¬ä¸‰æ–¹é€šçŸ¥ç³»ç»Ÿã€‚ è¿™é‡Œæˆ‘æ¥å…¥çš„æ˜¯å…¶ä»–éƒ¨é—¨æä¾›çš„ä¼ä¸šå¾®ä¿¡æœºå™¨äººå‘é€æ¶ˆæ¯æ¥å£ã€‚ æŠ€æœ¯æ ˆ ç†Ÿæ‚‰æˆ‘çš„éƒ½çŸ¥é“ï¼Œæˆ‘ä¹‹å‰æœ‰ python + Flask å¼€å‘åç«¯ç³»ç»Ÿçš„ç»éªŒï¼Œæ‰€ä»¥æœ¬æ¬¡è¿™ä¸ªå°å‹ç³»ç»Ÿä¸»åŒ…ä¹Ÿé‡‡ç”¨äº†ç›¸åŒçš„ç³»ç»Ÿæ¶æ„è®¾è®¡ã€‚ å…¶ä½™ä¸‰æ–¹åº“æ–¹é¢ä¸»è¦ç”¨åˆ°äº†ä»¥ä¸‹è¿™äº›ï¼š flask-redis python-gitlab python-dotenv dynaconf dataclasses-json å…¶ä¸­æœ€åä¸¤ä¸ªæ˜¯ AI æ¨èä½¿ç”¨çš„ï¼Œä¸»åŒ…ä¹‹å‰å¹¶æœªæ¥è§¦è¿‡ã€‚ AI å®¢æˆ·ç«¯æ–¹é¢æˆ‘ä¸»è¦çš„ä»¥ä¸‹è¿™äº›ï¼š å®¢æˆ·ç«¯ æ¨¡å‹ æ˜¯å¦å…è´¹ ä½¿ç”¨å æ¯” Gemini-CLI gemini-2.5-pro âœ… 75% Gemini-CLI gemini-2.5-flash âœ… 10% Qwen-Code CLI Qwen/Qwen3-Coder-480B-A35B-Instruct âœ… 15% ä¹Ÿå°±æ˜¯è¯´äº¤ç»™ AI çš„å·¥ä½œä¸­ï¼Œ75% æ˜¯ä½¿ç”¨ â€œå…è´¹ç‰ˆçš„ Gemini-CLI + gemini-2.5-pro æ¨¡å‹â€ å®Œæˆçš„ã€‚ ä¹‹æ‰€ä»¥ç”¨å…è´¹çš„ AIï¼Œä¸»è¦åŸå› è¿˜æ˜¯ç©·ã€‚éè¦è¯´å¾—å¥½å¬ä¸€ç‚¹å°±æ˜¯æƒ³çœ‹çœ‹ AI çš„ä¸‹é™åœ¨å“ªé‡Œï¼Œåˆæˆ–è€…å¤§éƒ¨åˆ†äººåº”è¯¥ç”¨çš„éƒ½æ˜¯å…è´¹çš„ AIã€‚ å¦å¤–éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨è¿™æ¬¡å·¥ä½œæˆ‘æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„ mcpï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„ AI é…ç½®æ–‡ä»¶ï¼Œæ¯”å¦‚ GEMINI.md ç­‰ã€‚ æœ€ç»ˆæ•ˆæœæ€ä¹ˆæ ·ï¼Ÿ æŠ›å»é¡¹ç›®åˆå§‹æ¡†æ¶çš„æ­å»ºä»¥åŠéƒ¨ç½²ï¼Œå‡ ä¹æ‰€æœ‰ä¸šåŠ¡é€»è¾‘æˆ‘éƒ½æ˜¯æä¾›ä»»åŠ¡æè¿°ä¹‹å è®© AI ç»™æˆ‘å®ç°çš„ã€‚é‚£ä¹ˆç»“è®ºä¹Ÿå°±åƒæ ‡é¢˜è¯´çš„è¿™æ ·ï¼Œå¯¹äºæˆ‘è¿™æ ·ä¸€ä¸ªåˆæ¬¡å°è¯• Vibe Coding çš„å°ç™½è€Œè¨€ï¼Œå¯ä»¥è¯´æ˜¯ â€œåˆçˆ±åˆæ¨â€ï¼Œæ„Ÿè§‰ä¹Ÿæ˜¯å’Œäº’è”ç½‘ä¸Šå¤§éƒ¨åˆ†äººçš„æ„Ÿå—ä¸€æ ·ã€‚ çˆ±åœ¨å“ªé‡Œï¼Ÿ AI çš„å¼ºå¤§æ— éœ€å¤šè¨€ï¼Œå¯ä»¥è¯´ 80% çš„ä»»åŠ¡å®ƒéƒ½å®Œæˆçš„å¾ˆå¥½ï¼š æˆ‘æ²¡æœ‰çœ‹è¿‡ python-gitlab çš„æ–‡æ¡£ï¼Œæˆ‘åªéœ€è¦å‘Šè¯‰ AI è¦ä½¿ç”¨è¿™ä¸ªæ¡†æ¶ï¼Œå®ƒå‡ ä¹å°±å¯ä»¥ä½¿ç”¨æ­£ç¡®çš„ APIï¼Œè€Œå°±åœ¨å»å¹´ï¼Œç½‘é¡µç‰ˆå…è´¹çš„ ChatGPT è¿˜åšä¸åˆ°è¿™ä¸€ç‚¹ã€‚ åªéœ€è¦å‘Šè¯‰ AI â€œæˆ‘å¸Œæœ›å®ç°é…ç½®çƒ­æ›´æ–°ï¼Œè¿™æ ·åœ¨æˆ‘ä¿®æ”¹é…ç½®æ—¶å°±ä¸éœ€è¦å†é‡å¯ Docker æœåŠ¡äº†â€ã€‚å®ƒå°±ç»™æˆ‘æ¨èäº† dynaconf è¿™ä¸ªæ¡†æ¶ï¼Œä»£æ›¿æœç´¢å¼•æ“çš„åŒæ—¶è¿˜å¸®æˆ‘å®ç°äº†éœ€æ±‚ã€‚ è¿™ä¸ªå°ç³»ç»Ÿè™½ç„¶ç®€å•ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸€ä¸ªéœ€è¦ç”¨åˆ°ç®—æ³•çš„åœ°æ–¹ï¼šåœ¨ä½¿ç”¨ AI è¾…åŠ© Review æ—¶ï¼Œå¦‚æœä»£ç  diff è¿‡é•¿ä¼šå¯¼è‡´è¶…å‡ºæ¨¡å‹çš„ä¸Šä¸‹æ–‡ï¼Œæ­¤æ—¶éœ€è¦åˆ†ç‰‡å¤šæ¬¡æé—®ã€‚åœ¨è¿™ç‚¹ä¸Š AI å¤„ç†çš„ä¹Ÿå¾ˆå¥½ï¼Œè®©æˆ‘çœŸæ­£æ„Ÿå—åˆ°äº†ä»€ä¹ˆæ˜¯ â€œé¢å‘ç»“æœè€Œä¸é¢å‘å®ç°ç»†èŠ‚â€ã€‚ æ¨åˆåœ¨å“ªé‡Œï¼Ÿ è°ƒç”¨ python-gitlab ä¸­çš„æ–¹æ³•æ—¶ï¼Œæœ‰è¿‡å¥½å‡ æ¬¡ä½¿ç”¨äº†é”™è¯¯çš„è¿”å›å€¼çš„æƒ…å†µã€‚éœ€è¦æˆ‘æ‰‹åŠ¨æŸ¥çœ‹æºç åå†å‘Šè¯‰ AI æ­£ç¡®çš„è¿”å›ç±»å‹æ˜¯ä»€ä¹ˆã€‚ AI ç¨³å®šæ€§å¯ä»¥è¯´æ˜¯è®©äººæ‰æ‘¸ä¸é€ï¼šå®ƒèƒ½å¾ˆå¥½çš„æ¨èä½ é€šè¿‡ dataclasses-json è§£å†³ â€œæ¥å£å‚æ•°é©¼å³°å¼å‘½åâ€ ä¸ â€œpython å±æ€§ä¸‹åˆ’çº¿å¼å‘½åâ€ çš„çŸ›ç›¾ï¼Œä½†æ˜¯å®ƒæƒ³ä¸åˆ°å°† Model è½¬ JSON æ—¶ä½¿ç”¨çš„æ–¹æ³•æ”¹ä¸º dataclasses-json ä¸“ç”¨çš„æ–¹æ³•ã€‚ å¯¹äº &quot;\\n&quot; æ¢è¡Œç¬¦ä¼šçŠ¯ä¸€äº›éš¾ä»¥ç†è§£çš„é”™è¯¯ï¼Œç‰¹åˆ«æ˜¯å¤„ç†å¤šè¡Œå­—ç¬¦ä¸²æ—¶ï¼Œä¼šç›´æ¥ä½¿ç”¨æ¢è¡Œæ¥ä»£æ›¿å­—ç¬¦ä¸²çš„ &quot;\\n&quot;ã€‚ ... å¦‚æœè¯´ä¸Šé¢çš„è¿˜æ˜¯ä¸€äº› â€œå°ç»†èŠ‚â€ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„å°±æ˜¯é’ˆå¯¹ Qwen çš„åæ§½äº†ï¼š Qwen-Code CLI è™½è¯´æ˜¯åŸºäºå¼€æºçš„ Gemini-CLI è¿›è¡Œå¼€å‘ï¼Œä½†æ˜¯è¿™ä¸¤è€…çš„å·®è·è¿˜æ˜¯å¾ˆå¤§ã€‚åœ¨å¼€å‘æ€ç é€¸ API å°è£…æ¨¡å—æ—¶ï¼Œæˆ‘ç›´æ¥è®© AI å»è¯»å®Œæ•´çš„ swagger json æ–‡æ¡£ï¼Œè¿™ä»½æ–‡æ¡£éå¸¸å¤§ï¼Œè¶³è¶³æœ‰ 3ä¸‡ 8 åƒè¡Œ ä¹‹å¤šã€‚æˆ‘ä¸€å¼€å§‹è®© Qwen-Code CLI å»è¯»å–ï¼Œç›´æ¥å ç”¨äº†å°†è¿‘ 20% çš„ä¸Šä¸‹æ–‡ï¼Œè€Œä¸”è¯»å–æ—¶é—´éå¸¸é•¿ï¼ˆQwen çš„æ¨¡å‹æ˜¯åˆ†æ‰¹å¤šæ¬¡è¯»å–ï¼‰ã€‚åæ¥æˆ‘è¯•äº†ä»¥ä¸‹ç”¨ Gemini-CLI å»è¯»å–ï¼Œç»“æœå‘ç°å ç”¨çš„å ä¸‹æ–‡éå¸¸å°ï¼Œè€Œä¸”è¯»å–é€Ÿåº¦éå¸¸å¿«ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ ¹æ®æ–‡æ¡£å‡†ç¡®å›ç­”å‡ºæˆ‘çš„é—®é¢˜ï¼Œå®Œæˆåç»­çš„ä»»åŠ¡å¼€å‘ã€‚ å¹¶ä¸”åœ¨æˆ‘è®© Qwen æ ¹æ®è¿™ä»½ swagger æ–‡æ¡£æ‰€æè¿°çš„ï¼Œæ€ç é€¸ api æ‰€æä¾›çš„èƒ½åŠ›ï¼Œæ¥å›ç­”æˆ‘èƒ½å¦å®ç°æŸäº›éœ€æ±‚æ—¶ï¼Œå®ƒä¹Ÿç»™å‡ºäº†é”™è¯¯çš„ç­”æ¡ˆï¼šå®é™…ä¸Šæ˜¯ä¸èƒ½æ»¡è¶³æˆ‘çš„éœ€æ±‚çš„ã€‚å åŠ å½“æ—¶æˆ‘å› ä¸ºç¼ºå°‘ api-key æ— æ³•ç›´æ¥éªŒè¯ AI ç¼–å†™çš„é€»è¾‘ï¼Œæœ€ç»ˆå¯¼è‡´äº†å°†è¿‘ä¸¤å¤©çš„å·¥ä½œå®Œå…¨ç™½åšã€‚ Gemini è™½è¯´æ¯” Qwen è¦å¼ºï¼Œä½†æ˜¯åœ¨ â€œæé—®çš„è‰ºæœ¯â€ æ–¹é¢ä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„ç‚¹çš„ï¼š ä½ éœ€è¦å°½å¯èƒ½åœ°æåŠæ‰€æœ‰ç»†èŠ‚ï¼Œå°±åƒæ˜¯ä¸Šé¢æåˆ°çš„ dataclasses-json çš„ä¾‹å­ï¼Œä½ æ²¡æœ‰åœ¨æé—®æ—¶è¯´ â€œåŒæ—¶ä¿®æ”¹æ‰€æœ‰ Model è½¬ JSON æ—¶ä½¿ç”¨çš„æ–¹æ³•â€ï¼Œé‚£ä¹ˆ AI å°±æœ‰å¯èƒ½ä¸ä¼šå»ä¿®æ”¹ â€”â€” ä½†æ˜¯å¦‚æœä½ åƒæˆ‘ä¸€æ ·ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªåº“ï¼Œä¸çŸ¥é“è¦å»ä¿®æ”¹è¿™ä¸ªåœ°æ–¹ï¼Œé‚£å°±ä¼šåƒæˆ‘ä¸€æ ·é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼›åˆæˆ–è€…æŠŠå®ƒå†™å…¥åˆ°ä¸€ä¸ªé€šç”¨è§„åˆ™é‡Œï¼šæ¯æ¬¡ç±»ä¼¼çš„ä¿®æ”¹ï¼Œéƒ½è¦æ£€æŸ¥è°ƒç”¨é€»è¾‘æ˜¯å¦éœ€è¦ä¿®æ”¹ã€‚ å…ˆåˆ—å‡ºæ–¹æ¡ˆå†å®é™…ä¿®æ”¹ï¼Œä¼šæ¯”ä¸€å¼€å§‹å°±è®©å®ƒä¿®æ”¹æ•ˆæœå¥½å¾ˆå¤šã€‚è¿™ä¸€ç‚¹åœ¨è¿‡å»å¾ˆå¤šäººçš„æ–‡ç« ä¸­éƒ½æœ‰æåˆ°ï¼Œäº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¿™ä¸å…‰èƒ½å‡å°‘ä»£ç å›æ»šçš„æ¬¡æ•°ï¼Œä¹Ÿèƒ½è®©ä½ å»å®¡æŸ¥ AI æ˜¯å¦çœŸæ­£çš„ç†è§£äº†ä½ çš„éœ€æ±‚ã€‚ åªè®© AI ä½¿ç”¨ä¸­æ–‡å›ç­”è¿˜ä¸å¤Ÿï¼Œè¿™ä¸è¶³ä»¥è®©å®ƒç†è§£å®ƒæ˜¯åœ¨ä¸ºä¸€ä¸ªä¸­å›½äººæ‰“å·¥ã€‚ä½ è¿˜éœ€è¦å‘Šè¯‰å®ƒ â€œæ—¥å¿—å’Œæ³¨é‡Šéƒ½ä½¿ç”¨ä¸­æ–‡â€ã€‚ æ„å¤–çš„ï¼Œåˆç†ä½¿ç”¨æ ‡ç‚¹ç¬¦å·ï¼Œæ¯”å¦‚å¥å·ï¼Œå¯ä»¥è®© AI æ›´å¥½çš„ç†è§£ä½ çš„æ„æ€ï¼Œæ¯”å¦‚è¿™å¥è¯æ˜¯å¦ç»“æŸäº†ï¼Ÿ ... è¯¸å¦‚æ­¤ç±»çš„ç‚¹è¿˜æœ‰å¾ˆå¤šï¼Œæ€»çš„æ¥è¯´å°±æ˜¯ï¼š ä½ çœŸçš„çœŸçš„çœŸçš„çœŸçš„éœ€è¦å‘ AI æè¿°çš„å¾ˆç»†å¾ˆç»†å¾ˆç»†ï¼Œæœ‰çš„æ—¶å€™è¿™çœŸçš„å¾ˆç´¯å¾ˆè¾›è‹¦ã€‚ ä»¥ä¸Šç§ç§å¯¼è‡´çš„é—®é¢˜å°±æ˜¯ï¼š å¦‚æœä½ æ˜¯ä¸€ä¸ªå¶å°”ä¸¢å¤±ä¸€äº›å°ç»†èŠ‚ï¼Œæˆ–è€…æ ¹æœ¬å°±æ˜¯ä¸€ä¸ªç²—å¿ƒå¤§æ„çš„äººï¼Œé‚£ä¹ˆ AI çš„ä½¿ç”¨ä½“éªŒå°†ä¼šå¤§æ‰“æŠ˜æ‰£ï¼› å…‰æœ‰ä¸¥è°¨è¿˜ä¸å¤Ÿï¼Œä½ è¿˜éœ€è¦è¶³å¤Ÿçš„è€å¿ƒå»ç»„ç»‡æ¯æ¬¡çš„æé—®å†…å®¹ï¼Œè¿˜è¦æœ‰ä¸€å®šç¨‹åº¦ä¸Šçš„è¯­æ–‡è¡¨è¾¾èƒ½åŠ›ã€è¯­è¨€ç»„ç»‡èƒ½åŠ›ï¼ˆç»ä¸æ­¢å¤§å®¶å¹³æ—¶æ—¥å¸¸çš„å£å¤´äº¤æµï¼‰ã€‚å¯¹äºé‚£äº›å¹³æ—¶åœ¨äº’è”ç½‘ä¸Šä¹ æƒ¯ä½¿ç”¨ä¹¦é¢è¡¨è¾¾æ–¹å¼è€Œéå£è¯­åŒ–æè¿°çš„äººæ¥è¯´ä¼šæœ‰ä¸€å®šçš„ä¼˜åŠ¿ã€‚ç›¸ååˆ™ä¼šé¢ä¸´ä¸å°‘çš„é—®é¢˜ã€‚ å¦å¤–ï¼Œå…‰è®© AI åˆ—å‡ºè®¡åˆ’è¿˜ä¸å¤Ÿï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå–œæ¬¢ â€œèƒ¡ç¼–â€ çš„é€šç—…ã€‚å¯¹æ­¤æˆ‘çš„è§£å†³æ–¹æ¡ˆæ˜¯å‘Šè¯‰å®ƒ â€œå¦‚æœæœ‰å“ªäº›ä¸ç¡®å®šï¼Œæˆ–è€…æ˜¯æ¨æµ‹ä¸œè¥¿ï¼Œè¯·ä½¿ç”¨ # TODO æ ‡è®°ï¼Œå¹¶åœ¨ä¿®æ”¹å®Œæˆåå‘æˆ‘æ±‡æŠ¥ã€‚â€ï¼Œè¿™æ ·å®ƒè™½ç„¶è¿˜ä¼šæ‰§è¡Œä¸€äº›æ¨æµ‹ï¼Œä½†æ˜¯è‡³å°‘æˆ‘å¯ä»¥æ›´å¥½çš„åˆ†è¾¨å“ªäº›æ˜¯å®ƒæ¨æµ‹çš„ä¸œè¥¿ï¼Œä»¥ä¾¿åœ¨åç»­çš„å¯¹è¯ä¸­å¸®åŠ©å®ƒè§£å†³è¿™äº› TODOã€‚ Prompt åœ¨è¿™é‡Œè´´ä¸€ä¸‹æˆ‘åšè¿™ä¸ªé¡¹ç›®æ—¶æœ€å¸¸ç”¨çš„æç¤ºè¯ï¼š æˆ‘æ¯å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œéƒ½ä¼š /clearï¼Œç„¶åä½¿ç”¨æ–°çš„æç¤ºè¯å¼€å¯ä¸€ä¸ªæ–°çš„ä¼šè¯ã€‚ ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ python å¼€å‘å·¥ç¨‹å¸ˆï¼Œå°¤å…¶ç†Ÿæ‚‰ flask æ¡†æ¶ã€‚ç°åœ¨æˆ‘ä»¬æ‰€å¤„çš„å·¥ä½œç›®å½•æ­£æ˜¯ä¸€ä¸ª flask python åç«¯é¡¹ç›®ã€‚ &lt;!-- æè¿°å…·ä½“çš„éœ€æ±‚æˆ–è€…ä»»åŠ¡ --&gt; ä¸€äº›è§„èŒƒè¦æ±‚ï¼š 1. å§‹ç»ˆç”¨ä¸­æ–‡å›å¤æˆ‘ï¼Œå¹¶ä¸”æ—¥å¿—ã€ä»£ç æ³¨é‡Šéƒ½ä½¿ç”¨ä¸­æ–‡ã€‚ 2. æ‰€ä»¥æ—¥å¿—éƒ½åº”è¯¥ä½¿ç”¨ `logging` æ¡†æ¶å®ç°ï¼Œæ¯”å¦‚ `logging.info(f&quot;...&quot;)`ã€‚ 3. python æ–‡ä»¶çš„å¼€å¤´ä¸éœ€è¦åŒ…å« python ç‰ˆæœ¬æ³¨é‡Šçš„å†…å®¹ã€‚ 4. ç§æœ‰æ–¹æ³•æ”¾åœ¨æ–‡ä»¶çš„æœ€åé¢ï¼Œè¶Šæ˜¯å·¥å…·æ€§è´¨çš„æ–¹æ³•è¶Šé åã€‚ 5. è°ƒç”¨æ–¹æ³•æ—¶å€™ï¼Œå¦‚æœå‚æ•°å¤šäºä¸¤ä¸ªï¼Œåˆ™å¿…é¡»æ˜¾å¼æŒ‡å®šå‚æ•°ï¼›å¦‚æœåªæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆä¸è¦æ·»åŠ å‚æ•°åç§°ã€‚ 6. ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°çš„æ•°é‡æœ€å¤šä¸º 5 ä¸ªï¼ˆåŒ…æ‹¬ `self`ï¼‰ï¼Œå¦‚æœè¶…è¿‡ï¼Œåˆ™åº”è¯¥ä»¥**ç±»å‹**çš„æ–¹å¼å»å®šä¹‰ï¼Œå¹¶æ”¾åœ¨å¯¹åº”æ¨¡å—çš„ `/models/param` æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä¸”æ¯ä¸ªå±æ€§éƒ½åº”è¯¥æœ‰æ³¨é‡Šã€‚ 7. å¦‚æœæœ‰å“ªäº›ä¸ç¡®å®šï¼Œæˆ–è€…æ˜¯æ¨æµ‹ä¸œè¥¿ï¼Œè¯·ä½¿ç”¨ `# TODO` æ ‡è®°ï¼Œå¹¶åœ¨ä¿®æ”¹å®Œæˆåå‘æˆ‘æ±‡æŠ¥ã€‚ 8. è¯·ä½ åšä»»ä½•ä¿®æ”¹å‰ï¼Œå…ˆå‘æˆ‘ç¡®è®¤ä½ çš„è®¡åˆ’ï¼Œå½“æˆ‘è®¤å¯ä½ çš„è®¡åˆ’åï¼Œå†å®æ–½ä½ çš„ä¿®æ”¹ã€‚ 9. ä¸è¦åˆ›å»º `Optional[List[...]]` å¯é€‰å€¼æ•°ç»„ï¼Œä½¿ç”¨ç©ºæ•°ç»„ `[]` ä»£æ›¿ã€‚ 10. æ–‡ä»¶çš„æœ«å°¾è¦æœ‰ä¸€ä¸ªå•ç‹¬çš„ç©ºè¡Œã€‚ 11. æ³¨é‡Šä½¿ç”¨ Google é£æ ¼ã€‚ èŠä¸€äº› â€œç†æƒ³ä¸»ä¹‰â€ è¯´æˆ‘ä¸Šç­ä¸ä¸ºäº†é’±æ˜¯å‡çš„ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ˜¯çœŸçš„å–œæ¬¢æ•²ä»£ç ï¼Œå–œæ¬¢é€šè¿‡ä»£ç å»åšäº§å“ã€‚ æœ€æ—©çš„æ—¶å€™è®©æˆ‘å›ç­”ä¸ºä»€ä¹ˆé€‰æ‹©åšç¨‹åºå‘˜è€Œä¸æ˜¯äº§å“ç»ç†ï¼Œæˆ‘çš„å›ç­”æ˜¯ â€œç›¸æ¯”è¾ƒäº§å“ï¼Œç¨‹åºå‘˜å¯ä»¥é€šè¿‡è‡ªå·±åŒæ‰‹äº²è‡ªå®ç°è‡ªå·±çš„æƒ³æ³•ï¼Œè¿™æ›´é…·â€ã€‚ä½†æ˜¯åšäº†è¿™ä¹ˆå¤šå¹´ç¨‹åºå‘˜ï¼Œå†™äº†è¿™ä¹ˆå¤šå¹´ä»£ç ä¹‹åï¼Œæˆ‘å·²ç»ä¸çŸ¥é“æˆ‘æ˜¯æ›´å–œæ¬¢æ•²ä»£ç è¿˜æ˜¯æ›´å–œæ¬¢åšäº§å“äº†ã€‚ Vibe Coding å¯¹äºæˆ‘è€Œè¨€å°±åƒæ˜¯ â€œäº§å“ç»ç†è®© AI å¸®æˆ‘å®ç°äº†æˆ‘çš„æƒ³æ³•â€ï¼Œæˆ‘è§‰å¾—è¿™ä¹Ÿèƒ½ç®—æ˜¯ â€œäº²æ‰‹â€ï¼Œä½†æ˜¯å°±æ„Ÿè§‰... æœ‰ç‚¹å¥‡æ€ªã€‚åœ¨è¿‡å»æˆ‘å¾ˆå–œæ¬¢å›è¿‡å¤´å»å¯¹ç€è‡ªå·±å†™çš„æ¡†æ¶æˆ–ç»„ä»¶ â€œçŠ¯èŠ±ç—´â€ï¼Œæ„Ÿæ…¨æˆ‘çœŸå‰å®³ï¼Œèƒ½å†™å‡ºè¿™ä¹ˆä¼˜é›…çš„ä»£ç ï¼ŒåŒæ—¶æ¬£èµæ•´ä¸ªäº§å‡ºã€‚æˆ‘è§‰å¾—è¿™ä¸ç®—è‡ªå¤§ï¼Œåªæ˜¯æˆå°±æ„Ÿä¸æ»¡è¶³æ„Ÿçš„ä¸€ç§ä½“ç°ï¼Œå¯¹å¤–æˆ‘è¿˜æ˜¯ä¼šè™šå¿ƒæ¥å—ä»»ä½•çš„æ‰¹è¯„çš„ã€‚ ä½†æ˜¯å¯¹äº AI äº§å‡ºçš„ä»£ç ï¼Œæˆ‘è§‰å¾—å®ƒå¾ˆéš¾è®©æˆ‘äº§ç”Ÿæˆå°±æ„Ÿä¸æ»¡è¶³æ„Ÿï¼Œç›®å‰è¿˜æ²¡æœ‰å‘ç°åŸå› ã€‚æˆ–è®¸ç­‰åˆ°å“ªå¤©æˆ‘èƒ½ç”¨ AI å¼€å‘è½¯ä»¶å¹¶ä¸”æŒ£åˆ°é’±çš„æ—¶å€™ï¼Œæˆ‘çš„æƒ³æ³•æ‰èƒ½æœ‰æ‰€æ”¹è§‚ï¼Ÿæ„Ÿè§‰æˆ‘ç°åœ¨è¿˜å¤„äº â€œå†™ä»£ç  = ç©ç©å…·â€ï¼Œæˆ–è€…æ˜¯ â€œåšç©å…·â€ çš„é˜¶æ®µï¼Œè‡³äºåœ¨è¿™ä¸ªé˜¶æ®µé‡ŒåŠ ä¸Š AI åä¼šå˜æˆä»€ä¹ˆï¼Œæˆ‘æš‚æ—¶è¿˜æ²¡åŠæ³•å¾ˆå¥½çš„å»è¡¨è¾¾æè¿°å®ƒã€‚ æ€»ç»“ AI ç¼–ç¨‹ 100% å¯ä»¥åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨ï¼Œè€Œ Vibe Coding åœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿèƒ½å¾ˆå¥½çš„å®Œæˆå·¥ä½œã€‚ â€œç†Ÿæ‚‰ç¼–ç¨‹çš„äººâ€ ä¸ â€œä¼šç¼–ç¨‹çš„äººâ€ åœ¨ä½¿ç”¨ AI è¿›è¡Œå¼€å‘æ—¶æœ€ç»ˆåº”è¯¥éƒ½èƒ½å®Œæˆå·¥ä½œï¼Œä½†æ˜¯æ•ˆç‡ç»å¯¹æ˜¯ä¼šæœ‰å¾ˆå¤§å¾ˆå¤§çš„å·®åˆ«çš„ï¼Œè‡³äº â€œä¸ä¼šç¼–ç¨‹çš„äººâ€ èƒ½ä¸èƒ½åˆ©ç”¨ AI æ¥å®Œæˆä¸€ä¸ªé¡¹ç›®ï¼Œå°±ä¸å¾—è€ŒçŸ¥äº†ï¼ˆç¬‘ï¼‰ã€‚è‡³å°‘ï¼Œåœ¨å½“ä¸‹è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œæˆ‘æ˜¯è¿™ä¹ˆè®¤ä¸ºçš„ã€‚ ","link":"https://blog.rakuyo.dev/vibe-coding-sweet-struggle/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP","content":"TCP ä¸ UDP æ˜¯ç½‘ç»œä¼ è¾“å±‚çš„ä¸¤å¤§æ ¸å¿ƒåè®®ï¼Œå®ƒä»¬ä»¥æˆªç„¶ä¸åŒçš„æ–¹å¼å®šä¹‰äº†æ•°æ®åœ¨åº”ç”¨ç¨‹åºé—´çš„ä¼ è¾“ã€‚TCP å¦‚åŒä¸€æ¬¡é€šè¯ï¼Œè¿½æ±‚å¯é ä¸å®Œæ•´ï¼›UDP åˆ™åƒä¸€å¼ æ˜ä¿¡ç‰‡ï¼Œä¸»å¼ é«˜æ•ˆä¸è¿…æ·ã€‚æ­£æ˜¯è¿™ä¸¤ç§è®¾è®¡å“²å­¦çš„å·®å¼‚ï¼Œå†³å®šäº†å®ƒä»¬åœ¨ç½‘é¡µæµè§ˆã€æ–‡ä»¶ä¼ è¾“ã€è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ¸¸æˆç­‰ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æäºŒè€…çš„æ ¸å¿ƒæœºåˆ¶ä¸å…³é”®å·®å¼‚ã€‚ æœ¬ç³»åˆ—å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹ TCPï¼šå¯é çš„â€œç”µè¯é€šè¯â€ å¦‚æœè¯´ UDP åƒä¸€å¼ éšæ‰‹å¯„å‡ºçš„æ˜ä¿¡ç‰‡ï¼Œé‚£ä¹ˆ TCP (Transmission Control Protocol, ä¼ è¾“æ§åˆ¶åè®®) å°±æ˜¯ä¸€é€šä¸¥è°¨çš„å›½é™…é•¿é€”ç”µè¯ã€‚åœ¨é€šè¯å¼€å§‹å‰ï¼Œä½ å¿…é¡»å…ˆæ‹¨å·ã€ç­‰å¾…å¯¹æ–¹æ¥å¬ã€åŒæ–¹ç¡®è®¤èº«ä»½å¹¶éƒ½è¯´â€œå–‚ï¼Œå¬å¾—åˆ°å—ï¼Ÿâ€ä¹‹åï¼Œæ‰ä¼šå¼€å§‹çœŸæ­£çš„äº¤è°ˆã€‚é€šè¯ç»“æŸåï¼Œè¿˜è¦ç¤¼è²Œåœ°é“åˆ«ï¼Œç¡®ä¿åŒæ–¹éƒ½çŸ¥æ™“é€šè¯ç»“æŸã€‚ è¿™ä¸ªè¿‡ç¨‹è™½ç„¶ç¹çï¼Œä½†å®ƒç¡®ä¿äº†æ•´ä¸ªå¯¹è¯çš„å®Œæ•´æ€§å’Œæœ‰åºæ€§ï¼Œè¿™æ­£æ˜¯ TCP çš„æ ¸å¿ƒè®¾è®¡å“²å­¦ã€‚ æ ¸å¿ƒç‰¹æ€§ï¼šé¢å‘è¿æ¥ä¸å¯é  é¢å‘è¿æ¥ (Connection-Oriented)ï¼šåœ¨å‘é€ä»»ä½•åº”ç”¨æ•°æ®ä¹‹å‰ï¼Œé€šä¿¡åŒæ–¹ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰å¿…é¡»å…ˆé€šè¿‡ä¸€ä¸ªæ ‡å‡†åŒ–çš„è¿‡ç¨‹å»ºç«‹ä¸€ä¸ªè™šæ‹Ÿçš„è¿æ¥ã€‚æ‰€æœ‰åç»­çš„æ•°æ®äº¤æ¢éƒ½åœ¨è¿™ä¸ªå·²å»ºç«‹çš„è¿æ¥ä¸Šè¿›è¡Œã€‚ å¯é ä¼ è¾“ (Reliable)ï¼šTCP æä¾›äº†ä¸€ç³»åˆ—å¤æ‚çš„æœºåˆ¶æ¥ä¿è¯æ•°æ®èƒ½å¤Ÿå‡†ç¡®ã€æœ‰åºåœ°ä»å‘é€æ–¹ä¼ è¾“åˆ°æ¥æ”¶æ–¹ã€‚å®ƒæ‰¿è¯ºâ€œä¸ä¸¢åŒ…ã€ä¸å¤±åºã€æ— å·®é”™ã€æ— é‡å¤â€ã€‚ è¿™ä¸€åˆ‡çš„å¯é æ€§ï¼Œéƒ½å§‹äºé‚£ä¸ªè‘—åçš„â€œä¸‰æ¬¡æ¡æ‰‹â€è¿‡ç¨‹ã€‚ä½†åœ¨æ·±å…¥æµç¨‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆäº†è§£æ„æˆè¿™æ¬¡â€œæ¡æ‰‹â€çš„å‡ ä¸ªå…³é”®â€œé›¶ä»¶â€ã€‚ TCP æŠ¥æ–‡ï¼šä¸€æ¬¡é€šè¯çš„â€œä¿¡å°â€ TCP é€šä¿¡çš„æ•°æ®å•å…ƒè¢«ç§°ä¸ºæŠ¥æ–‡æ®µ (Segment)ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªé«˜åº¦ç»“æ„åŒ–çš„ä¿¡å°ï¼Œå…¶â€œä¿¡å°çš®â€ï¼Œä¹Ÿå°±æ˜¯ TCP å¤´éƒ¨ (Header)ï¼ŒåŒ…å«äº†æ‰€æœ‰ç”¨äºæ§åˆ¶é€šä¿¡çš„å…ƒä¿¡æ¯ã€‚ä¸‹è¡¨æ˜¯å…¶ä¸»è¦å­—æ®µçš„æ¦‚è§ˆï¼š å­—æ®µ è‹±æ–‡åç§° ç®€ç§° å¤§å° æè¿° æºç«¯å£ Source Port sport 16 bits æ ‡è¯†å‘é€æ–¹åº”ç”¨ç¨‹åºçš„ç«¯å£å· ç›®æ ‡ç«¯å£ Destination Port dport 16 bits æ ‡è¯†æ¥æ”¶æ–¹åº”ç”¨ç¨‹åºçš„ç«¯å£å· åºåˆ—å· Sequence Number seq 32 bits æ ‡è®°æœ¬æŠ¥æ–‡æ®µæ•°æ®ç¬¬ä¸€ä¸ªå­—èŠ‚åœ¨æ•°æ®æµä¸­çš„ä½ç½® ç¡®è®¤å· Acknowledgment Number ack 32 bits æœŸæœ›æ”¶åˆ°çš„å¯¹æ–¹ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºåˆ—å· æ•°æ®åç§» Data Offset - 4 bits TCP å¤´éƒ¨è‡ªèº«çš„é•¿åº¦ï¼Œå•ä½ä¸º4å­—èŠ‚ï¼ˆ32ä½ï¼‰ ä¿ç•™ Reserved - 6 bits æœªä½¿ç”¨çš„ä¿ç•™ä½ï¼Œå¿…é¡»ä¸º 0 æ ‡å¿—ä½ Flags - 6 bits ç”¨äºæ§åˆ¶è¿æ¥çŠ¶æ€ï¼Œå¦‚ SYN, ACK, FIN çª—å£å¤§å° Window Size win 16 bits ç”¨äºæµé‡æ§åˆ¶ï¼Œè¡¨ç¤ºæ¥æ”¶æ–¹è¿˜èƒ½æ¥æ”¶å¤šå°‘æ•°æ® æ ¡éªŒå’Œ Checksum csum 16 bits ç”¨äºæ£€æŸ¥å¤´éƒ¨å’Œæ•°æ®çš„ä¼ è¾“é”™è¯¯ ç´§æ€¥æŒ‡é’ˆ Urgent Pointer - 16 bits å½“URGæ ‡å¿—ä½ä¸º1æ—¶æœ‰æ•ˆ é€‰é¡¹ Options - å¯å˜ ç”¨äºæºå¸¦é¢å¤–çš„æ§åˆ¶ä¿¡æ¯ åœ¨ç†è§£åç»­çš„æ¡æ‰‹æµç¨‹æ—¶ï¼Œæˆ‘ä»¬æ— éœ€å…³æ³¨æ‰€æœ‰ç»†èŠ‚ï¼Œåªéœ€å°†æ³¨æ„åŠ›é›†ä¸­åœ¨æœ€é‡è¦çš„å››ä¸ªâ€œè§’è‰²â€ä¸Šï¼šSYN å’Œ ACK è¿™ä¸¤ä¸ªæ ‡å¿—ä½ï¼Œä»¥åŠ seq å’Œ ack è¿™ä¸¤ä¸ªæ ¸å¿ƒç¼–å·ã€‚ SYN å’Œ ACK æ˜¯ TCP æŠ¥æ–‡å¤´ä¸­çš„ä¸¤ä¸ªéå¸¸é‡è¦çš„æ ‡å¿—ä½ (Flags)ï¼Œå®ƒä»¬å°±åƒæ˜¯é€šä¿¡åŒæ–¹ç”¨æ¥è¡¨è¾¾æ„å›¾çš„â€œä¿¡å·æ——â€ã€‚ SYN (Synchronize Sequence Numbers - åŒæ­¥åºåˆ—å·) å«ä¹‰ï¼šè¿™ä¸ªæ ‡å¿—ä½ç”¨äºå‘èµ·å’Œå»ºç«‹è¿æ¥ã€‚å½“ä¸€æ–¹æƒ³è¦ä¸å¦ä¸€æ–¹å»ºç«‹è¿æ¥æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ª SYN æ ‡å¿—ä½ç½®ä¸º 1 çš„æŠ¥æ–‡ã€‚è¿™å¯ä»¥ç†è§£ä¸ºåœ¨è¯´ï¼šâ€œä½ å¥½ï¼Œæˆ‘æƒ³å’Œä½ å»ºç«‹é€šä¿¡ï¼Œæˆ‘ä»¬æ¥åŒæ­¥ä¸€ä¸‹åˆå§‹çš„åºåˆ—å·å§ï¼â€ ACK (Acknowledgment - ç¡®è®¤) å«ä¹‰ï¼šè¿™ä¸ªæ ‡å¿—ä½ç”¨äºç¡®è®¤æ”¶åˆ°æ•°æ®ã€‚å½“ ACK æ ‡å¿—ä½ç½®ä¸º 1 æ—¶ï¼Œæ„å‘³ç€æŠ¥æ–‡ä¸­çš„â€œç¡®è®¤å·â€å­—æ®µæœ‰æ•ˆã€‚å®ƒå‘Šè¯‰å¯¹æ–¹ï¼šâ€œä½ ä¹‹å‰å‘é€çš„æ•°æ®æˆ‘å·²ç»æ”¶åˆ°äº†ã€‚â€ åœ¨è¿æ¥å»ºç«‹ä¹‹åï¼Œå‡ ä¹æ‰€æœ‰çš„ TCP æŠ¥æ–‡éƒ½ä¼šå°† ACK ä½ç½®ä¸º 1ã€‚ è€Œ seq å’Œ ack æ˜¯ TCP å®ç°å¯é ä¼ è¾“çš„åŸºçŸ³ï¼Œå®ƒä»¬å…±åŒè§£å†³äº†ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼šåœ¨ä¸å¯é çš„ç½‘ç»œä¸Šï¼Œå¦‚ä½•ä¿è¯æ•°æ®ä¸ä¸¢ã€ä¸ä¹±ã€ä¸é‡ã€‚ seq (Sequence Number - åºåˆ—å·) ä½œç”¨ï¼šå®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ç»™æ•°æ®åŒ…è¿›è¡Œç¼–å·ã€‚TCP æŠŠè¦ä¼ è¾“çš„æ•°æ®çœ‹ä½œä¸€ä¸ªè¿ç»­çš„å­—èŠ‚æµï¼Œseq å°±æ˜¯è¿™ä¸ªæµä¸­æ¯ä¸€ä¸ªæ•°æ®åŒ…é‡Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„ç¼–å·ã€‚ è®¾è®¡åŸå› ï¼š ä¿è¯é¡ºåºï¼šç½‘ç»œä¼ è¾“ä¸­ï¼Œæ•°æ®åŒ…å¯èƒ½ä¼šå› ä¸ºè·¯ç”±ä¸åŒè€Œå¤±åºåˆ°è¾¾ã€‚æ¥æ”¶æ–¹å¯ä»¥æ ¹æ® seq å·å¯¹æ•°æ®åŒ…è¿›è¡Œé‡æ–°æ’åºï¼Œä»è€Œæ¢å¤å‡ºåŸå§‹çš„ã€æœ‰åºçš„æ•°æ®ã€‚ ä¸¢åŒ…æ£€æµ‹ï¼šæ¥æ”¶æ–¹å¦‚æœå‘ç°æ”¶åˆ°çš„ seq å·ä¸è¿ç»­ï¼ˆæ¯”å¦‚æ”¶åˆ°äº† 100 å’Œ 300ï¼Œä½†æ²¡æ”¶åˆ° 200ï¼‰ï¼Œå°±çŸ¥é“ä¸­é—´æœ‰æ•°æ®åŒ…ä¸¢å¤±äº†ï¼Œå¯ä»¥è¯·æ±‚å‘é€æ–¹é‡ä¼ ã€‚ ack (Acknowledgment Number - ç¡®è®¤å·) ä½œç”¨ï¼šå®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰å‘é€æ–¹æˆ‘æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·æ˜¯å¤šå°‘ã€‚è¿™ä¸ªè®¾è®¡éå¸¸å·§å¦™ï¼Œå› ä¸ºå®ƒéšå«åœ°ç¡®è®¤äº†åœ¨è¿™ä¸ªç¼–å·ä¹‹å‰çš„æ‰€æœ‰æ•°æ®éƒ½å·²æˆåŠŸæ”¶åˆ°ã€‚ è®¾è®¡åŸå› ï¼š é«˜æ•ˆç¡®è®¤ï¼šå¦‚æœå‘é€æ–¹å‘é€äº† 100ã€200ã€300 ä¸‰ä¸ªåŒ…ï¼Œæ¥æ”¶æ–¹åªéœ€å›å¤ä¸€ä¸ª ack=400ï¼Œå°±ä»£è¡¨â€œ100ã€200ã€300 æˆ‘éƒ½æ”¶åˆ°äº†ï¼Œè¯·ä» 400 å¼€å§‹å‘â€ã€‚è¿™æ¯”ä¸ºæ¯ä¸ªåŒ…éƒ½å•ç‹¬å›å¤ä¸€æ¬¡ç¡®è®¤è¦é«˜æ•ˆå¾—å¤šã€‚ å»ºç«‹å¯é è¿æ¥ï¼šå®ƒæ˜¯å‘é€æ–¹åˆ¤æ–­å¯¹æ–¹æ˜¯å¦æˆåŠŸæ”¶åˆ°æ•°æ®çš„å”¯ä¸€ä¾æ®ã€‚ ä¸‰æ¬¡æ¡æ‰‹ï¼šåŒæ­¥åºåˆ—å·ä¸äº¤æ¢èƒ½åŠ› ç†è§£äº†ä¸Šè¿°å‡ ä¸ªæ ¸å¿ƒâ€œè¯æ±‡â€åï¼Œæˆ‘ä»¬å†æ¥å®¡è§†ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ï¼Œå®ƒçš„æ¯ä¸€æ­¥éƒ½å˜å¾—æœ‰æ®å¯å¾ªã€‚å…¶æœ¬è´¨ï¼Œæ˜¯é€šè¿‡ä¸‰æ¬¡é€šä¿¡ï¼Œå®Œæˆä¸¤ä¸ªæ ¸å¿ƒä»»åŠ¡ï¼š äº¤æ¢å¹¶ç¡®è®¤åŒæ–¹çš„åˆå§‹åºåˆ—å· (ISN)ï¼Œä¸ºåç»­æ•°æ®çš„æœ‰åºä¼ è¾“æ‰“ä¸‹åŸºç¡€ã€‚ ç¡®è®¤åŒæ–¹éƒ½å…·å¤‡å¯é çš„å‘é€å’Œæ¥æ”¶èƒ½åŠ›ã€‚ ç¬¬ä¸€æ¬¡æ¡æ‰‹ (Client -&gt; Server): å†…å®¹: å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª TCP æŠ¥æ–‡ï¼Œå…¶ä¸­ SYN æ ‡å¿—ä½ç½®ä¸º 1ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªéšæœºçš„åˆå§‹åºåˆ—å· seq=xã€‚ ç›®çš„: å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¡¨æ˜â€œæˆ‘æƒ³è¦å»ºç«‹è¿æ¥â€ï¼Œå¹¶å‘ŠçŸ¥è‡ªå·±çš„èµ·å§‹åºåˆ—å·ã€‚ çŠ¶æ€: å®¢æˆ·ç«¯è¿›å…¥ SYN_SENT çŠ¶æ€ã€‚ ç¬¬äºŒæ¬¡æ¡æ‰‹ (Server -&gt; Client): å†…å®¹: æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN åŒ…åï¼Œå›å¤ä¸€ä¸ªæŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡ä¸­ SYN å’Œ ACK æ ‡å¿—ä½éƒ½ç½®ä¸º 1ã€‚æœåŠ¡å™¨ä¹Ÿé€‰æ‹©ä¸€ä¸ªè‡ªå·±çš„éšæœºåˆå§‹åºåˆ—å· seq=yï¼ŒåŒæ—¶å°†ç¡®è®¤å· ack è®¾ç½®ä¸º x+1ã€‚ ç›®çš„: æœåŠ¡å™¨é€šè¿‡ ACK=1 å’Œ ack=x+1 å‘Šè¯‰å®¢æˆ·ç«¯ï¼šâ€œä½ çš„è¯·æ±‚æˆ‘æ”¶åˆ°äº†â€ã€‚é€šè¿‡ SYN=1 å’Œ seq=y è¡¨æ˜ï¼šâ€œæˆ‘ä¹ŸåŒæ„å»ºç«‹è¿æ¥ï¼Œè¿™æ˜¯æˆ‘çš„èµ·å§‹åºåˆ—å·â€ã€‚ çŠ¶æ€: æœåŠ¡å™¨è¿›å…¥ SYN_RCVD çŠ¶æ€ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡å™¨å·²ç¡®è®¤å®¢æˆ·ç«¯çš„å‘é€èƒ½åŠ›æ­£å¸¸ã€‚ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ (Client -&gt; Server): å†…å®¹: å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ SYN-ACK åŒ…åï¼Œå‘é€æœ€åä¸€ä¸ªç¡®è®¤æŠ¥æ–‡ã€‚è¯¥æŠ¥æ–‡ ACK æ ‡å¿—ä½ç½®ä¸º 1ï¼Œseq è®¾ç½®ä¸º x+1ï¼Œå¹¶å°†ç¡®è®¤å· ack è®¾ç½®ä¸º y+1ã€‚ ç›®çš„: å®¢æˆ·ç«¯é€šè¿‡ ACK=1 å’Œ ack=y+1 å‘Šè¯‰æœåŠ¡å™¨ï¼šâ€œä½ çš„å›åº”æˆ‘å·²æ”¶åˆ°ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹é€šä¿¡äº†â€ã€‚ çŠ¶æ€: æ­¤æŠ¥æ–‡å‘é€åï¼Œå®¢æˆ·ç«¯è¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚æœåŠ¡å™¨æ”¶åˆ°åï¼Œä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚è¿æ¥æ­£å¼å»ºç«‹ã€‚æ­¤æ—¶ï¼ŒåŒæ–¹éƒ½ç¡®è®¤äº†å¯¹æ–¹çš„æ”¶å‘èƒ½åŠ›æ­£å¸¸ã€‚ è¯´åˆ°è¿™é‡Œï¼Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼šâ€œä¸ºä»€ä¹ˆè¦äº¤æ¢ seq å’Œ ack å‘¢ï¼Ÿâ€ æœ¬è´¨æ˜¯åŒå‘ç¡®è®¤ï¼šTCP æ˜¯ä¸€ä¸ªå…¨åŒå·¥çš„åè®®ï¼Œæ„å‘³ç€é€šä¿¡åŒæ–¹éƒ½å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚å› æ­¤ï¼Œæ¯ä¸€æ–¹éƒ½å¿…é¡»æœ‰è‡ªå·±çš„ seq å·æ¥æ ‡è®°è‡ªå·±å‘é€çš„æ•°æ®ï¼Œä¹Ÿå¿…é¡»æœ‰è‡ªå·±çš„ ack å·æ¥ç¡®è®¤æ”¶åˆ°çš„å¯¹æ–¹æ•°æ®ã€‚ ä¸‰æ¬¡æ¡æ‰‹å°±æ˜¯äº¤æ¢å’Œç¡®è®¤å½¼æ­¤çš„åˆå§‹åºåˆ—å·ï¼ˆISNï¼‰çš„è¿‡ç¨‹ï¼š ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å‘é€ SYN å’Œè‡ªå·±çš„ seq=xã€‚å®ƒåœ¨è¯´ï¼šâ€œæˆ‘çš„åˆå§‹åºåˆ—å·æ˜¯ xï¼Œä½ æ”¶åˆ°äº†å—ï¼Ÿâ€ ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šæœåŠ¡å™¨å›å¤ SYNã€è‡ªå·±çš„ seq=y å’Œ ack=x+1ã€‚å®ƒåœ¨è¯´ï¼šâ€œæˆ‘æ”¶åˆ°äº†ä½ çš„ xï¼Œæ‰€ä»¥æˆ‘ç¡®è®¤ä½ çš„ä¸‹ä¸€ä¸ªåº”è¯¥æ˜¯ x+1ã€‚åŒæ—¶ï¼Œæˆ‘çš„åˆå§‹åºåˆ—å·æ˜¯ yï¼Œä½ æ”¶åˆ°äº†å—ï¼Ÿâ€ ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šå®¢æˆ·ç«¯å›å¤ ACK å’Œ ack=y+1ã€‚å®ƒåœ¨è¯´ï¼šâ€œæˆ‘æ”¶åˆ°äº†ä½ çš„ yï¼Œæ‰€ä»¥æˆ‘ç¡®è®¤ä½ çš„ä¸‹ä¸€ä¸ªåº”è¯¥æ˜¯ y+1ã€‚â€ ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡ï¼Ÿ æœ€æ ¸å¿ƒçš„åŸå› ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢æ—©å·²å¤±æ•ˆçš„ã€æ—§çš„è¿æ¥è¯·æ±‚çªç„¶åˆé€è¾¾æœåŠ¡å™¨ï¼Œä»è€Œå¼•å‘é”™è¯¯ã€‚ æƒ³è±¡ä¸€ä¸ªç½‘ç»œæœ‰äº›å»¶è¿Ÿçš„åœºæ™¯ï¼š å®¢æˆ·ç«¯å‘é€äº†ç¬¬ä¸€ä¸ªè¿æ¥è¯·æ±‚ SYNï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º è¯·æ±‚Aï¼‰ï¼Œä½†å®ƒåœ¨ç½‘ç»œä¸­è¢«å¡ä½äº†ï¼Œè¿Ÿè¿Ÿæ²¡æœ‰åˆ°è¾¾æœåŠ¡å™¨ã€‚ å®¢æˆ·ç«¯ç­‰äº†ä¸€ä¼šå„¿æ²¡æ”¶åˆ°å›åº”ï¼Œä»¥ä¸ºä¸¢åŒ…äº†ï¼Œäºæ˜¯åˆå‘é€äº†ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ SYNï¼ˆè¯·æ±‚Bï¼‰ã€‚ è¯·æ±‚B é¡ºåˆ©åˆ°è¾¾ï¼ŒæœåŠ¡å™¨æ­£å¸¸å›åº”ï¼ŒåŒæ–¹é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹äº†è¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç„¶åæ­£å¸¸å…³é—­äº†è¿æ¥ã€‚ å°±åœ¨è¿™æ—¶ï¼Œé‚£ä¸ªè¢«å¡äº†å¾ˆä¹…çš„ è¯·æ±‚A ç»ˆäºæŠµè¾¾äº†æœåŠ¡å™¨ã€‚ å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨æ”¶åˆ° è¯·æ±‚A åï¼Œä¼šè¯¯ä»¥ä¸ºæ˜¯å®¢æˆ·ç«¯åˆå‘èµ·äº†ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ã€‚å®ƒä¼šç«‹å³åˆ†é…èµ„æºï¼Œå»ºç«‹è¿æ¥ï¼Œç„¶åå‚»å‚»åœ°ç­‰å¾…å®¢æˆ·ç«¯å‘æ¥æ•°æ®ã€‚ä½†æ­¤æ—¶çš„å®¢æˆ·ç«¯å¯¹æ­¤ä¸€æ— æ‰€çŸ¥ï¼Œå®ƒæ ¹æœ¬ä¸ä¼šç†ä¼šæœåŠ¡å™¨çš„ç¡®è®¤ï¼Œæ›´ä¸ä¼šå‘é€ä»»ä½•æ•°æ®ã€‚ ç»“æœå°±æ˜¯ï¼ŒæœåŠ¡å™¨å•æ–¹é¢å¼€å¯äº†ä¸€ä¸ªâ€œç©ºè¿æ¥â€ï¼Œç™½ç™½æµªè´¹äº†ç³»ç»Ÿèµ„æºï¼Œç›´åˆ°è¶…æ—¶åæ‰å…³é—­ã€‚è€Œä¸‰æ¬¡æ¡æ‰‹ï¼Œé€šè¿‡å¢åŠ ç¬¬ä¸‰æ¬¡å®¢æˆ·ç«¯çš„æœ€ç»ˆç¡®è®¤ï¼Œå®Œç¾åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚æœåŠ¡å™¨åªæœ‰åœ¨æ”¶åˆ°å®¢æˆ·ç«¯å¯¹è‡ªå·±çš„ SYN çš„æœ€ç»ˆ ACK ä¹‹åï¼Œæ‰ä¼šç¡®ä¿¡è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ã€å…¨æ–°çš„è¿æ¥è¯·æ±‚ã€‚ è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹é¢çš„æ—¶åºå›¾æ¥è¡¨ç¤ºï¼š TCP å¯é æ€§çš„åŸºçŸ³ TCP çš„å¯é æ€§å¹¶éå•ä¸€åŠŸèƒ½ï¼Œè€Œæ˜¯ä¸€ä¸ªç”±å¤šç§æœºåˆ¶ååŒå·¥ä½œçš„å¤æ‚ç³»ç»Ÿã€‚è¿™äº›æœºåˆ¶ç›¸äº’é…åˆï¼Œå…±åŒç¡®ä¿äº†æ•°æ®ä¼ è¾“çš„å®Œæ•´æ€§ã€æœ‰åºæ€§ã€æ— å·®é”™å’Œé«˜æ•ˆæ€§ã€‚ åºåˆ—å· (Sequence Numbers) ä¸ç¡®è®¤åº”ç­” (Acknowledgements, ACK)ï¼šTCP å°†å‘é€çš„æ•°æ®åˆ†å‰²æˆä¸€ä¸ªä¸ªå°çš„æ•°æ®æ®µï¼ˆSegmentï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªå­—èŠ‚éƒ½åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„åºåˆ—å·ã€‚æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œä¼šå‘é€ä¸€ä¸ª ACK æŠ¥æ–‡ä½œä¸ºå›åº”ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç¡®è®¤å·ï¼Œå‘Šè¯‰å‘é€æ–¹â€œæˆ‘å·²ç»æ”¶åˆ°äº†ä½ åˆ°å“ªä¸ªåºåˆ—å·ä¸ºæ­¢çš„æ‰€æœ‰æ•°æ®ï¼Œè¯·ä»ä¸‹ä¸€ä¸ªåºåˆ—å·å¼€å§‹å‘â€ã€‚è¿™ç§â€œæœ‰é—®æœ‰ç­”â€çš„æœºåˆ¶æ˜¯ä¿è¯æ•°æ®ä¸ä¸¢å¤±çš„åŸºç¡€ã€‚ è¶…æ—¶é‡ä¼  (Timeout Retransmission)ï¼šå¦‚æœåœ¨å‘é€æ•°æ®åçš„ä¸€æ®µæ—¶é—´å†…ï¼ˆè¿™ä¸ªæ—¶é—´æ˜¯åŠ¨æ€è®¡ç®—çš„ï¼‰æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ ACKï¼Œå‘é€æ–¹å°±ä¼šè®¤ä¸ºæ•°æ®åŒ…å¯èƒ½åœ¨è·¯ä¸Šä¸¢å¤±äº†ï¼Œäºæ˜¯ä¼šé‡æ–°å‘é€è¿™ä¸ªæ•°æ®åŒ…ã€‚ æµé‡æ§åˆ¶ (Flow Control)ï¼šæ¥æ”¶æ–¹ä¼šé€šè¿‡ TCP å¤´éƒ¨ä¸­çš„â€œçª—å£å¤§å° (Window Size)â€å­—æ®µï¼Œå‘Šè¯‰å‘é€æ–¹è‡ªå·±å½“å‰è¿˜èƒ½æ¥æ”¶å¤šå°‘æ•°æ®ã€‚å‘é€æ–¹åˆ™æ ¹æ®è¿™ä¸ªçª—å£å¤§å°æ¥è°ƒæ•´è‡ªå·±çš„å‘é€é€Ÿç‡ï¼Œç¡®ä¿ä¸ä¼šå› ä¸ºå‘é€è¿‡å¿«è€Œå¯¼è‡´æ¥æ”¶æ–¹å¤„ç†ä¸è¿‡æ¥ï¼Œé€ æˆæ•°æ®æº¢å‡ºã€‚ æ‹¥å¡æ§åˆ¶ (Congestion Control)ï¼šæµé‡æ§åˆ¶å…³å¿ƒçš„æ˜¯â€œç‚¹å¯¹ç‚¹â€çš„é€Ÿç‡åŒ¹é…ï¼Œè€Œæ‹¥å¡æ§åˆ¶åˆ™ç€çœ¼äºæ•´ä¸ªç½‘ç»œçš„å¥åº·çŠ¶å†µã€‚TCP é€šè¿‡ä¸€ç³»åˆ—ç®—æ³•ï¼ˆå¦‚æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ç­‰ï¼‰æ¥æ¢æµ‹ç½‘ç»œçš„æ‹¥å µç¨‹åº¦ï¼Œå¹¶ä¸»åŠ¨è°ƒæ•´å‘é€é€Ÿç‡ï¼Œé¿å…å› è‡ªèº«æµé‡è¿‡å¤§è€ŒåŠ å‰§ç½‘ç»œæ‹¥å µï¼Œæœ€ç»ˆå¯¼è‡´å¤§è§„æ¨¡ä¸¢åŒ…ã€‚ å››æ¬¡æŒ¥æ‰‹ï¼šç¤¼è²Œåœ°â€œæŒ‚æ–­ç”µè¯â€ ä¸å»ºç«‹è¿æ¥åŒæ ·é‡è¦çš„æ˜¯ï¼Œå¦‚ä½•å®‰å…¨ã€å®Œæ•´åœ°æ–­å¼€è¿æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºâ€œå››æ¬¡æŒ¥æ‰‹â€ï¼Œå› ä¸ºå®ƒéœ€è¦å››æ¬¡ä¿¡æ¯äº¤æ¢æ¥ç¡®ä¿åŒæ–¹çš„æ•°æ®éƒ½å·²ä¼ è¾“å®Œæ¯•ã€‚ ç¬¬ä¸€æ¬¡æŒ¥æ‰‹ (FIN)ï¼šå®¢æˆ·ç«¯å†³å®šå…³é—­è¿æ¥ï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡ï¼Œè¡¨ç¤ºâ€œæˆ‘çš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•äº†â€ã€‚æ­¤æ—¶å®¢æˆ·ç«¯è¿›å…¥ FIN_WAIT_1 çŠ¶æ€ã€‚ ç¬¬äºŒæ¬¡æŒ¥æ‰‹ (ACK)ï¼šæœåŠ¡å™¨æ”¶åˆ° FIN æŠ¥æ–‡åï¼Œå›å¤ä¸€ä¸ª ACK æŠ¥æ–‡ï¼Œè¡¨ç¤ºâ€œæ”¶åˆ°äº†ä½ çš„å…³é—­è¯·æ±‚â€ã€‚ä½†æ­¤æ—¶æœåŠ¡å™¨å¯èƒ½è¿˜æœ‰æœªå‘é€å®Œçš„æ•°æ®ï¼Œæ‰€ä»¥å®ƒè¿˜ä¸èƒ½ç«‹å³å…³é—­è¿æ¥ã€‚æ­¤æ—¶ï¼ŒæœåŠ¡å™¨è¿›å…¥ CLOSE_WAIT çŠ¶æ€ï¼Œå®¢æˆ·ç«¯æ”¶åˆ° ACK åè¿›å…¥ FIN_WAIT_2 çŠ¶æ€ã€‚ ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹ (FIN)ï¼šæœåŠ¡å™¨å°†æ‰€æœ‰å‰©ä½™æ•°æ®å‘é€å®Œæ¯•åï¼Œä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN æŠ¥æ–‡ï¼Œè¡¨ç¤ºâ€œæˆ‘è¿™è¾¹çš„æ•°æ®ä¹Ÿå‘å®Œäº†ï¼Œå¯ä»¥å…³é—­äº†â€ã€‚æœåŠ¡å™¨éšä¹‹è¿›å…¥ LAST_ACK çŠ¶æ€ã€‚ ç¬¬å››æ¬¡æŒ¥æ‰‹ (ACK)ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ FIN æŠ¥æ–‡åï¼Œå›å¤æœ€åä¸€ä¸ª ACK æŠ¥æ–‡è¿›è¡Œç¡®è®¤ã€‚å‘é€å®Œæ¯•åï¼Œå®¢æˆ·ç«¯ä¼šè¿›å…¥ TIME_WAIT çŠ¶æ€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆé€šå¸¸æ˜¯ 2MSLï¼Œä¸¤å€çš„æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´ï¼‰ä»¥ç¡®ä¿æœåŠ¡å™¨æ”¶åˆ°äº†è¿™ä¸ª ACKï¼Œé˜²æ­¢ç½‘ç»œä¸­å¯èƒ½å­˜åœ¨çš„å»¶è¿ŸæŠ¥æ–‡é€ æˆé—®é¢˜ã€‚æœåŠ¡å™¨æ”¶åˆ° ACK ååˆ™ç›´æ¥è¿›å…¥ CLOSED çŠ¶æ€ã€‚è‡³æ­¤ï¼Œè¿æ¥è¢«å®Œå…¨æ–­å¼€ã€‚ ä¸€å®šæ˜¯æŒ¥å››æ¬¡æ‰‹å— ğŸ‘‹ï¼Ÿ æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ä»é€»è¾‘ä¸Šä»¥åŠè¡Œä¸ºä¸Šæ¥çœ‹å¾…â€œå››æ¬¡æŒ¥æ‰‹â€è¿™ä»¶äº‹ï¼š ä»é€»è¾‘ä¸Šçœ‹ï¼šTCP åè®®ä¸€å®šä¼šæŒ‰ç…§é€»è¾‘è¿›è¡Œå®Œæ•´çš„å››ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥ä»è¿™ä¸ªè§’åº¦ä¸Šæ¥çœ‹ï¼Œä¸€å®šæ˜¯â€œå››æ¬¡æŒ¥æ‰‹â€ã€‚å››ä¸ªè¿‡ç¨‹åˆ†åˆ«æ˜¯ï¼š å®¢æˆ·ç«¯å…³é—­å‘é€é€šé“ã€‚ æœåŠ¡å™¨ç¡®è®¤å®¢æˆ·ç«¯å…³é—­å‘é€é€šé“ã€‚ æœåŠ¡å™¨å…³é—­å‘é€é€šé“ã€‚ å®¢æˆ·ç«¯ç¡®è®¤æœåŠ¡å™¨å…³é—­å‘é€é€šé“ã€‚ ä»è¡Œä¸ºä¸Šçœ‹ï¼šä½†æ˜¯å¦‚æœæŠ“åŒ…çš„è¯ï¼Œä½ å¯èƒ½ä¼šå‘ç°åªæœ‰ä¸‰ä¸ªæŠ¥æ–‡æ®µçš„æƒ…å†µï¼Œå¹¶ä¸”è¿™ç§æƒ…å†µè¿˜ä¸å°‘è§ã€‚è¿™æ˜¯å› ä¸ºå½“ç¬¬äºŒæ¬¡æŒ¥æ‰‹æ—¶ï¼Œå¦‚æœæœåŠ¡å™¨æ²¡æœ‰å‰©ä½™è¦å‘é€ç»™å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œé‚£ä¹ˆ TCP å°±ä¼šå°†ç¬¬äºŒã€ä¸‰æ¬¡æŒ¥æ‰‹è¿›è¡Œåˆå¹¶ï¼Œæ‰€ä»¥æœ€ç»ˆåªæœ‰ä¸‰ä¸ªæŠ¥æ–‡æ®µã€‚ç›¸å…³é€»è¾‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š TCP çŠ¶æ€æœºï¼šè¿æ¥çš„ç”Ÿå‘½å‘¨æœŸ ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹æè¿°äº† TCP è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„å…³é”®æ—¶åˆ»ã€‚ä½†ä¸€ä¸ªå®Œæ•´çš„ TCP è¿æ¥ç”Ÿå‘½å‘¨æœŸï¼Œè¿œä¸æ­¢è¿™å‡ ä¸ªç¬é—´ã€‚å®ƒç”±ä¸€ç³»åˆ—ç²¾ç¡®å®šä¹‰çš„çŠ¶æ€ç»„æˆï¼Œè¿™äº›çŠ¶æ€ä¹‹é—´çš„è½¬æ¢å…±åŒæ„æˆäº†ä¸€ä¸ªâ€œçŠ¶æ€æœº (State Machine)â€ã€‚è¿™ä¸ªæ¨¡å‹æ¸…æ™°åœ°å±•ç¤ºäº†ä»è¿æ¥çš„èŒèŠ½åˆ°æœ€ç»ˆæ¶ˆäº¡çš„å…¨è¿‡ç¨‹ã€‚ ä¸‹é¢çš„æµç¨‹å›¾æç»˜äº† TCP ä¸­æ‰€æœ‰çŠ¶æ€ä»¥åŠå®ƒä»¬ä¹‹é—´å¯èƒ½çš„è½¬æ¢ï¼š è¿™å¼ å›¾çœ‹èµ·æ¥å¤æ‚ï¼Œä½†å®ƒå…¶å®æ˜¯å°†æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„æ¡æ‰‹å’ŒæŒ¥æ‰‹è¿‡ç¨‹ï¼Œä»¥åŠä¸€äº›ä¸­é—´çŠ¶æ€ï¼Œä¸²è”æˆäº†ä¸€å¹…å®Œæ•´çš„åœ°å›¾ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›çŠ¶æ€å½’ä¸ºå‡ ç±»æ¥ç†è§£ï¼š è¿æ¥å»ºç«‹: LISTEN: ä»…å­˜åœ¨äºæœåŠ¡ç«¯ã€‚å½“æœåŠ¡å™¨åº”ç”¨ç¨‹åºè°ƒç”¨ listen() å‡½æ•°åï¼Œè¿›å…¥æ­¤çŠ¶æ€ï¼Œè¡¨ç¤ºå·²å‡†å¤‡å¥½æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚ä¸€æ—¦æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡ï¼Œå°†å‘é€ SYN+ACK å¹¶è¿›å…¥ SYN_RCVD çŠ¶æ€ã€‚ SYN_SENT: å®¢æˆ·ç«¯åœ¨è°ƒç”¨ connect() å‡½æ•°åï¼Œå‘é€ SYN æŠ¥æ–‡è¯·æ±‚å»ºç«‹è¿æ¥ï¼Œéšå³è¿›å…¥æ­¤çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œå®¢æˆ·ç«¯ç­‰å¾…æ¥æ”¶æœåŠ¡å™¨çš„ SYN+ACK æŠ¥æ–‡ã€‚å¦‚æœæ”¶åˆ°ï¼Œåˆ™å‘é€ ACK å¹¶è¿›å…¥ ESTABLISHED çŠ¶æ€ï¼›å¦‚æœè¶…æ—¶æœªæ”¶åˆ°ï¼Œåˆ™ä¼šé‡ä¼  SYN æŠ¥æ–‡ã€‚ SYN_RCVD: æœåŠ¡ç«¯åœ¨ LISTEN çŠ¶æ€ä¸‹æ”¶åˆ°å®¢æˆ·ç«¯çš„ SYN æŠ¥æ–‡åï¼Œä¼šå‘é€ SYN+ACK æŠ¥æ–‡å¹¶è¿›å…¥æ­¤çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼ŒæœåŠ¡ç«¯ç­‰å¾…æ¥æ”¶å®¢æˆ·ç«¯çš„æœ€ç»ˆ ACK æŠ¥æ–‡ã€‚ä¸€æ—¦æ”¶åˆ° ACKï¼Œè¿æ¥å³å»ºç«‹ï¼Œè¿›å…¥ ESTABLISHED çŠ¶æ€ã€‚ æ•°æ®ä¼ è¾“: ESTABLISHED: è¿æ¥å·²æˆåŠŸå»ºç«‹ï¼ŒåŒæ–¹å¯ä»¥è‡ªç”±åœ°è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚è¿™æ˜¯ TCP è¿æ¥æœ€ä¸»è¦ã€æœ€æ´»è·ƒçš„çŠ¶æ€ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹å®Œæˆåè¿›å…¥æ­¤çŠ¶æ€ã€‚ è¿æ¥æ–­å¼€: FIN_WAIT_1: ä¸»åŠ¨å…³é—­æ–¹ï¼ˆå³å‘èµ·å…³é—­è¿æ¥çš„ä¸€æ–¹ï¼Œå¯èƒ½æ˜¯å®¢æˆ·ç«¯ä¹Ÿå¯èƒ½æ˜¯æœåŠ¡ç«¯ï¼‰å‘é€ FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œä¸»åŠ¨å…³é—­æ–¹ç­‰å¾…æ¥æ”¶å¯¹æ–¹å¯¹ FIN æŠ¥æ–‡çš„ ACKã€‚ä¸€æ—¦æ”¶åˆ° ACKï¼Œåˆ™è¿›å…¥ FIN_WAIT_2 çŠ¶æ€ã€‚ CLOSE_WAIT: è¢«åŠ¨å…³é—­æ–¹ï¼ˆå³æ”¶åˆ°å¯¹æ–¹ FIN æŠ¥æ–‡çš„ä¸€æ–¹ï¼‰åœ¨æ”¶åˆ° FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ã€‚æ­¤æ—¶ï¼ŒTCP å±‚å·²ç»æ¥æ”¶åˆ°å¯¹æ–¹å…³é—­å‘é€é€šé“çš„è¯·æ±‚ï¼Œå¹¶å‘åº”ç”¨å±‚æŠ¥å‘Šè¿æ¥å·²ä¸­æ–­ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œè¢«åŠ¨å…³é—­æ–¹ä¼šç­‰å¾…æœ¬åœ°åº”ç”¨å±‚å¤„ç†å®Œæ‰€æœ‰å‰©ä½™æ•°æ®å¹¶è°ƒç”¨ close() å‡½æ•°ï¼Œç„¶åå‘é€è‡ªå·±çš„ FIN æŠ¥æ–‡ï¼Œè¿›å…¥ LAST_ACK çŠ¶æ€ã€‚ FIN_WAIT_2: ä¸»åŠ¨å…³é—­æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹å¯¹å…¶ FIN æŠ¥æ–‡çš„ ACK åè¿›å…¥æ­¤çŠ¶æ€ã€‚æ­¤æ—¶ï¼Œä¸»åŠ¨å…³é—­æ–¹å·²ç»å®Œæˆäº†æ•°æ®å‘é€ï¼Œå¹¶ä¸”ä¹Ÿæ”¶åˆ°äº†å¯¹æ–¹å¯¹å…¶å…³é—­è¯·æ±‚çš„ç¡®è®¤ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œå®ƒå°†ç­‰å¾…æ¥æ”¶è¢«åŠ¨å…³é—­æ–¹å‘é€çš„ FIN æŠ¥æ–‡ã€‚ä¸€æ—¦æ”¶åˆ°å¯¹æ–¹çš„ FIN æŠ¥æ–‡ï¼Œä¸»åŠ¨å…³é—­æ–¹å°†å‘é€æœ€ç»ˆçš„ ACK å¹¶è¿›å…¥ TIME_WAIT çŠ¶æ€ã€‚ LAST_ACK: è¢«åŠ¨å…³é—­æ–¹åœ¨å‘é€å®Œæ‰€æœ‰å‰©ä½™æ•°æ®å¹¶å‘é€è‡ªå·±çš„ FIN æŠ¥æ–‡åè¿›å…¥æ­¤çŠ¶æ€ã€‚åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œè¢«åŠ¨å…³é—­æ–¹ç­‰å¾…æ¥æ”¶ä¸»åŠ¨å…³é—­æ–¹å¯¹å…¶ FIN æŠ¥æ–‡çš„æœ€ç»ˆ ACKã€‚ä¸€æ—¦æ”¶åˆ°æ­¤ ACKï¼Œè¿æ¥å³å®Œå…¨å…³é—­ï¼Œè¿›å…¥ CLOSED çŠ¶æ€ã€‚ TIME_WAIT: ä¸»åŠ¨å…³é—­æ–¹åœ¨æ”¶åˆ°å¯¹æ–¹çš„ FIN å¹¶å‘é€äº†æœ€åä¸€ä¸ª ACK åè¿›å…¥æ­¤çŠ¶æ€ã€‚è¿™æ˜¯çŠ¶æ€æœºä¸­ä¸€ä¸ªè‡³å…³é‡è¦çš„çŠ¶æ€ã€‚ TIME_WAIT çŠ¶æ€çš„æ·±æ„ TIME_WAIT çŠ¶æ€ï¼Œä¹Ÿå¸¸è¢«ç§°ä¸º 2MSL ç­‰å¾…çŠ¶æ€ï¼Œæ˜¯ TCP å¯é æ€§çš„æœ€åä¸€é“å±éšœã€‚ä¸»åŠ¨å…³é—­è¿æ¥çš„ä¸€æ–¹ï¼Œåœ¨å‘é€æœ€åä¸€ä¸ª ACK åï¼Œå¿…é¡»åœ¨è¿™ä¸ªçŠ¶æ€åœç•™ä¸¤å€çš„ MSL (Maximum Segment Lifetime, æœ€å¤§æŠ¥æ–‡æ®µç”Ÿå­˜æ—¶é—´)ã€‚MSL æ˜¯ç½‘ç»œä¸­ä»»ä½• IP æ•°æ®åŒ…èƒ½å¤Ÿå­˜æ´»çš„æœ€é•¿æ—¶é—´ã€‚ è¿™ä¸ªç­‰å¾…æœºåˆ¶æœ‰ä¸¤ä¸ªæ ¸å¿ƒç›®çš„ï¼š ç¡®ä¿æœ€åä¸€ä¸ª ACK æŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾å¯¹æ–¹ï¼šå¦‚æœè¿™ä¸ª ACK åœ¨ç½‘ç»œä¸­ä¸¢å¤±äº†ï¼Œå¯¹æ–¹ï¼ˆå¤„äº LAST_ACK çŠ¶æ€ï¼‰ä¼šå› ä¸ºæ”¶ä¸åˆ°ç¡®è®¤è€Œè¶…æ—¶é‡ä¼  FIN æŠ¥æ–‡ã€‚å¦‚æœä¸»åŠ¨å…³é—­æ–¹æ­¤æ—¶å·²ç»å½»åº•å…³é—­ï¼ˆè¿›å…¥ CLOSEDï¼‰ï¼Œå®ƒå°†æ— æ³•å“åº”è¿™ä¸ªé‡ä¼ çš„ FINï¼Œå¯¼è‡´å¯¹æ–¹æ— æ³•æ­£å¸¸å…³é—­ã€‚TIME_WAIT çŠ¶æ€çš„å­˜åœ¨ï¼Œç¡®ä¿äº†å®ƒæœ‰è¶³å¤Ÿçš„æ—¶é—´æ¥å¤„ç†è¿™ç§æƒ…å†µï¼Œé‡æ–°å‘é€ ACKï¼Œå¸®åŠ©å¯¹æ–¹é¡ºåˆ©å…³é—­ã€‚ é˜²æ­¢â€œæ—§è¿æ¥â€çš„å»¶è¿ŸæŠ¥æ–‡å¹²æ‰°æ–°è¿æ¥ï¼šå‡è®¾æ²¡æœ‰ TIME_WAITï¼Œä¸€ä¸ªè¿æ¥ï¼ˆä¾‹å¦‚ï¼Œæºç«¯å£ 10000 -&gt; ç›®æ ‡ç«¯å£ 80ï¼‰åˆšå…³é—­ï¼Œé©¬ä¸Šåˆç”¨å®Œå…¨ç›¸åŒçš„å››å…ƒç»„ï¼ˆæºIPã€æºç«¯å£ã€ç›®æ ‡IPã€ç›®æ ‡ç«¯å£ï¼‰å»ºç«‹äº†ä¸€ä¸ªæ–°è¿æ¥ã€‚æ­¤æ—¶ï¼Œå¦‚æœå‰ä¸€ä¸ªè¿æ¥ä¸­è¿·è·¯çš„ã€å»¶è¿Ÿçš„æ•°æ®åŒ…çªç„¶åˆ°è¾¾ï¼Œå®ƒå¯èƒ½ä¼šè¢«æ–°è¿æ¥é”™è¯¯åœ°æ¥æ”¶ï¼Œé€ æˆæ•°æ®æ··ä¹±ã€‚ç­‰å¾… 2MSL çš„æ—¶é—´ï¼Œè¶³ä»¥è®©æœ¬æ¬¡è¿æ¥ä¸­æ‰€æœ‰åœ¨ç½‘ç»œä¸­â€œæ¸¸è¡â€çš„æŠ¥æ–‡æ®µéƒ½è‡ªè¡Œæ¶ˆäº¡ï¼Œä»è€Œä¿è¯æ–°è¿æ¥çš„ç¯å¢ƒæ˜¯â€œå¹²å‡€â€çš„ã€‚ UDPï¼šè½»å¿«çš„â€œæ˜ä¿¡ç‰‡â€ ä¸ TCP ä¸¥è°¨çš„é€šè¯æ¨¡å¼æˆªç„¶ç›¸åï¼ŒUDP (User Datagram Protocol, ç”¨æˆ·æ•°æ®æŠ¥åè®®) å¥‰è¡Œçš„æ˜¯æç®€ä¸»ä¹‰ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€å¼ æ˜ä¿¡ç‰‡ï¼šå†™å¥½åœ°å€ã€è´´ä¸Šé‚®ç¥¨ï¼Œç„¶åç›´æ¥æŠ•è¿›é‚®ç­’ã€‚ä½ ä¸ä¼šå…ˆæ‰“ç”µè¯ç¡®è®¤æ”¶ä»¶äººæ˜¯å¦åœ¨å®¶ï¼Œä¹Ÿä¸ä¼šæ”¶åˆ°å¯¹æ–¹çš„å›ä¿¡ç¡®è®¤ã€‚ è¿™ç§â€œå‘å®Œå³èµ°â€çš„æ¨¡å¼ï¼Œæ­£æ˜¯ UDP çš„æ ¸å¿ƒã€‚ æ ¸å¿ƒç‰¹æ€§ï¼šæ— è¿æ¥ä¸å°½åŠ›è€Œä¸º æ— è¿æ¥ (Connectionless)ï¼šUDP åœ¨å‘é€æ•°æ®ä¹‹å‰ï¼Œä¸éœ€è¦è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹æ¥å»ºç«‹è¿æ¥ã€‚å®ƒç›´æ¥å°†æ•°æ®æ‰“åŒ…æˆâ€œæ•°æ®æŠ¥ (Datagram)â€å°±å‘é€å‡ºå»ã€‚ å°½åŠ›è€Œä¸º (Best-Effort)ï¼šUDP ä¸æä¾›ä»»ä½•å¯é æ€§ä¿è¯ã€‚å®ƒä¸ä¿è¯æ•°æ®åŒ…ä¸€å®šèƒ½åˆ°è¾¾ç›®çš„åœ°ï¼Œä¸ä¿è¯æ•°æ®åŒ…çš„é¡ºåºï¼Œä¹Ÿä¸ä¼šè¿›è¡Œæµé‡æ§åˆ¶æˆ–æ‹¥å¡æ§åˆ¶ã€‚å¦‚æœç½‘ç»œæ‹¥å µå¯¼è‡´ä¸¢åŒ…ï¼ŒUDP ä¸ä¼šè¿›è¡Œé‡ä¼ ã€‚è¿™ç§çœ‹ä¼¼â€œä¸è´Ÿè´£ä»»â€çš„ç‰¹æ€§ï¼Œæ­£æ˜¯å…¶é€Ÿåº¦å’Œæ•ˆç‡çš„æ¥æºã€‚ UDP æŠ¥æ–‡ç»“æ„ UDP çš„æç®€ä¸»ä¹‰ä¹Ÿä½“ç°åœ¨å…¶æŠ¥æ–‡å¤´éƒ¨ä¸Šã€‚å®ƒçš„å¤´éƒ¨å›ºå®šåªæœ‰ 8 ä¸ªå­—èŠ‚ï¼Œå¼€é”€æå°ï¼Œæ‰€æœ‰å­—æ®µä¸€ç›®äº†ç„¶ï¼š å­—æ®µ è‹±æ–‡åç§° ç®€ç§° å¤§å° æè¿° æºç«¯å£ Source Port sport 16 bits æ ‡è¯†å‘é€æ–¹åº”ç”¨ç¨‹åºçš„ç«¯å£å·ï¼ˆæ­¤å­—æ®µå¯é€‰ï¼‰ ç›®æ ‡ç«¯å£ Destination Port dport 16 bits æ ‡è¯†æ¥æ”¶æ–¹åº”ç”¨ç¨‹åºçš„ç«¯å£å· é•¿åº¦ Length len 16 bits UDP å¤´éƒ¨å’Œæ•°æ®çš„æ€»é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ æ ¡éªŒå’Œ Checksum csum 16 bits ç”¨äºç®€å•çš„é”™è¯¯æ£€æµ‹ï¼ˆæ­¤å­—æ®µå¯é€‰ï¼‰ é€‚ç”¨åœºæ™¯ UDP çš„é«˜æ•ˆå’Œä½å»¶è¿Ÿç‰¹æ€§ï¼Œä½¿å…¶åœ¨ä»¥ä¸‹åœºæ™¯ä¸­å¤‡å—é’çï¼š å®æ—¶é€šä¿¡ï¼šåœ¨çº¿æ¸¸æˆã€è§†é¢‘ä¼šè®®ã€è¯­éŸ³é€šè¯ï¼ˆVoIPï¼‰ã€ç›´æ’­ç­‰ã€‚åœ¨è¿™äº›åº”ç”¨ä¸­ï¼Œæœ€æ–°çš„æ•°æ®è¿œæ¯”æ—§æ•°æ®é‡è¦ã€‚æˆ‘ä»¬æ›´èƒ½å®¹å¿ç”»é¢å¶å°”çš„èŠ±å±ï¼ˆä¸¢åŒ…ï¼‰ï¼Œä¹Ÿæ— æ³•æ¥å—ä¸ºäº†ç­‰ä¸€ä¸ªä¸¢å¤±çš„æ•°æ®åŒ…è€Œå¯¼è‡´æ•´ä¸ªç”»é¢å¡ä½ã€‚ æŸ¥è¯¢ç±»åè®®ï¼šå¦‚ DNSï¼ˆåŸŸåç³»ç»Ÿï¼‰æŸ¥è¯¢ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªç®€çŸ­çš„æŸ¥è¯¢è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›ä¸€ä¸ªç®€çŸ­çš„å“åº”ã€‚è¿™ç§â€œä¸€é—®ä¸€ç­”â€çš„æ¨¡å¼ä½¿ç”¨ UDP æ•ˆç‡æé«˜ã€‚ å¹¿æ’­ä¸å¤šæ’­ï¼šå½“éœ€è¦å‘ç½‘ç»œä¸­çš„å¤šä¸ªèŠ‚ç‚¹å‘é€ç›¸åŒçš„ä¿¡æ¯æ—¶ï¼ŒUDP çš„æ— è¿æ¥ç‰¹æ€§ä½¿å…¶éå¸¸é€‚åˆç”¨äºå¹¿æ’­å’Œå¤šæ’­ã€‚ å¯¹æ¯”ä¸é€‰æ‹©ï¼šTCP vs. UDP ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ¸…æ™°çš„è¡¨æ ¼æ¥æ€»ç»“ TCP å’Œ UDP çš„æ ¸å¿ƒå·®å¼‚ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬ç†è§£åœ¨ä¸åŒåœºæ™¯ä¸‹è¯¥å¦‚ä½•åšå‡ºé€‰æ‹©ã€‚ ç‰¹æ€§ TCP (ä¼ è¾“æ§åˆ¶åè®®) UDP (ç”¨æˆ·æ•°æ®æŠ¥åè®®) è¿æ¥æ€§ é¢å‘è¿æ¥ æ— è¿æ¥ å¯é æ€§ å¯é  ä¸å¯é ï¼ˆå°½åŠ›è€Œä¸ºï¼‰ ä¼ è¾“æ•ˆç‡ æ…¢ï¼Œå¼€é”€å¤§ å¿«ï¼Œå¼€é”€å° å¤´éƒ¨å¤§å° è‡³å°‘ 20 å­—èŠ‚ å›ºå®š 8 å­—èŠ‚ æ§åˆ¶æœºåˆ¶ æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ æ—  åº”ç”¨åœºæ™¯ ç½‘é¡µ(HTTP/S)ã€æ–‡ä»¶ä¼ è¾“(FTP)ã€é‚®ä»¶(SMTP) è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ¸¸æˆã€DNSã€ç›´æ’­ é€‰æ‹©çš„è‰ºæœ¯ï¼šä»ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼ŒTCP å’Œ UDP ä¹‹é—´æ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ä¹‹åˆ†ã€‚å®ƒä»¬æ˜¯ä¸ºè§£å†³ä¸åŒé—®é¢˜è€Œè®¾è®¡çš„ä¸¤ç§å·¥å…·ã€‚é€‰æ‹©å“ªç§åè®®ï¼Œå®Œå…¨å–å†³äºåº”ç”¨åœºæ™¯å¯¹å¯é æ€§å’Œå®æ—¶æ€§çš„æƒè¡¡ã€‚å¦‚æœä½ çš„åº”ç”¨ï¼ˆå¦‚é“¶è¡Œè½¬è´¦ï¼‰ç»ä¸èƒ½å®¹å¿ä»»ä½•æ•°æ®å·®é”™ï¼Œé‚£ä¹ˆ TCP æ˜¯ä¸äºŒä¹‹é€‰ï¼›å¦‚æœä½ çš„åº”ç”¨ï¼ˆå¦‚åœ¨çº¿æ¸¸æˆï¼‰æ›´çœ‹é‡å®æ—¶åé¦ˆï¼Œå¯ä»¥å®¹å¿å¶å°”çš„æ•°æ®ä¸¢å¤±ï¼Œé‚£ä¹ˆ UDP å°†æ˜¯æ›´æ˜æ™ºçš„é€‰æ‹©ã€‚ æ–°çš„æŒ‘æˆ˜ä¸æœªæ¥ï¼šQUIC æ—¢ç„¶ TCP å¦‚æ­¤å¯é ï¼Œä¸ºä»€ä¹ˆåƒ HTTP/3 è¿™æ ·çš„ç°ä»£åè®®åè€Œå¼€å§‹è½¬å‘åŸºäº UDP æ„å»ºï¼Ÿè¿™å¼•å‡ºäº† TCP ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„ç—›ç‚¹ã€‚ åœ¨ç³»åˆ—ç¬¬äº”ç¯‡ã€Šè®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPSã€‹ä¸­æˆ‘ä»¬æåˆ°ï¼ŒHTTP/2 è™½ç„¶é€šè¿‡å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œè§£å†³äº†åº”ç”¨å±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œä½†å®ƒæ— æ³•è§£å†³å…¶åº•å±‚ TCP åè®®è‡ªèº«çš„é˜Ÿå¤´é˜»å¡ (Head-of-Line Blocking) é—®é¢˜ã€‚åœ¨ä¸€æ¡ TCP è¿æ¥ä¸­ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆåç»­æ‰€æœ‰çš„æ•°æ®åŒ…ï¼ˆå³ä½¿å·²ç»åˆ°è¾¾ï¼‰éƒ½å¿…é¡»æ’é˜Ÿç­‰å¾…ï¼Œç›´åˆ°é‚£ä¸ªä¸¢å¤±çš„åŒ…è¢«æˆåŠŸé‡ä¼ ã€‚å¯¹äºé«˜å¹¶å‘çš„ç°ä»£ Web åº”ç”¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ€§èƒ½ç“¶é¢ˆã€‚ ä¸ºäº†ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒQUIC (Quick UDP Internet Connections) åè®®åº”è¿è€Œç”Ÿã€‚å®ƒæ˜¯ä¸€ä¸ªæ„å»ºåœ¨ UDP ä¹‹ä¸Šçš„ã€å…¨æ–°çš„ä¼ è¾“å±‚åè®®ã€‚ QUIC çš„è®¾è®¡éå¸¸å·§å¦™ï¼Œå®ƒç›¸å½“äºåœ¨ UDP çš„â€œå¿«è½¦é“â€ä¸Šï¼Œé‡æ–°å®ç°äº†ä¸€å¥—ç°ä»£åŒ–çš„å¯é ä¼ è¾“æœºåˆ¶ï¼š å†…ç½®å¤šè·¯å¤ç”¨ï¼šQUIC çš„æµæ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªæµçš„ä¸¢åŒ…å®Œå…¨ä¸ä¼šå½±å“å…¶ä»–æµçš„ä¼ è¾“ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†é˜Ÿå¤´é˜»å¡ã€‚ æ›´å¿«çš„è¿æ¥å»ºç«‹ï¼šå®ƒå°† TCP çš„ä¸‰æ¬¡æ¡æ‰‹å’Œ TLS çš„åŠ å¯†æ¡æ‰‹è¿‡ç¨‹åˆå¹¶ï¼Œå¤§å¤§å‡å°‘äº†å»ºç«‹å®‰å…¨è¿æ¥æ‰€éœ€çš„å¾€è¿”æ—¶é—´ã€‚ æ›´å¥½çš„æ‹¥å¡æ§åˆ¶ï¼šæ‹¥æœ‰æ¯”ä¼ ç»Ÿ TCP æ›´å…ˆè¿›çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚ QUIC ä»£è¡¨äº†ä¼ è¾“å±‚åè®®çš„æœªæ¥æ¼”è¿›æ–¹å‘ï¼Œå®ƒè¯•å›¾å°† TCP çš„å¯é æ€§ä¸ UDP çš„ä½å»¶è¿Ÿä¼˜åŠ¿é›†äºä¸€èº«ï¼Œä¸ºä¸‹ä¸€ä»£äº’è”ç½‘åº”ç”¨æä¾›æ›´åšå®çš„åŸºç¡€ã€‚ æ€»ç»“ TCP å’Œ UDP æ˜¯äº’è”ç½‘ä¼ è¾“å±‚æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªåè®®ï¼Œå®ƒä»¬å„è‡ªä»£è¡¨äº†ä¸€ç§æˆªç„¶ä¸åŒçš„è®¾è®¡å“²å­¦ã€‚ TCP å¦‚åŒä¸€ä½ä¸¥è°¨çš„å·¥ç¨‹å¸ˆï¼Œé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ã€åºåˆ—å·ã€ç¡®è®¤åº”ç­”ã€è¶…æ—¶é‡ä¼ ç­‰ä¸€ç³»åˆ—å¤æ‚æœºåˆ¶ï¼Œæ„å»ºäº†ä¸€ä¸ªå‡ ä¹ä¸‡æ— ä¸€å¤±çš„å¯é æ•°æ®é€šé“ã€‚å®ƒçš„åº§å³é“­æ˜¯ï¼šâ€œå®å¯æ…¢ï¼Œä¸å‡ºé”™â€ã€‚ UDP åˆ™åƒä¸€ä½è¿½æ±‚æè‡´é€Ÿåº¦çš„ä¿¡ä½¿ï¼Œå®ƒå¸ä¸‹äº†æ‰€æœ‰ä¿è¯å¯é æ€§çš„â€œåŒ…è¢±â€ï¼Œä»¥æœ€è½»é‡ã€æœ€ç›´æ¥çš„æ–¹å¼æŠ•é€’æ•°æ®ã€‚å®ƒçš„ä¿¡æ¡æ˜¯ï¼šâ€œå¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´â€ã€‚ æ­£æ˜¯è¿™ä¸¤ç§åè®®çš„å·®å¼‚åŒ–è®¾è®¡ä¸å…±å­˜ï¼Œæ‰å…±åŒæ”¯æ’‘èµ·äº†æˆ‘ä»¬ä»Šå¤©è¿™ä¸ªæ—¢éœ€è¦é«˜åº¦å¯é ï¼ˆå¦‚åœ¨çº¿äº¤æ˜“ï¼‰åˆéœ€è¦æè‡´å®æ—¶ï¼ˆå¦‚è§†é¢‘ç›´æ’­ï¼‰çš„ã€ä¸°å¯Œå¤šå½©çš„äº’è”ç½‘ä¸–ç•Œã€‚ ","link":"https://blog.rakuyo.dev/computer-network-tcp-and-udp/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS","content":"æœ¬ç³»åˆ—çš„å‰å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ¢è®¨äº†è®¾å¤‡å¦‚ä½•é€šè¿‡ IP åœ°å€è·å¾—èº«ä»½ã€å¦‚ä½•é€šè¿‡ DNS å°†åŸŸåè§£æä¸ºåœ°å€ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ DHCPã€NAT å’Œ VPN ç­‰æŠ€æœ¯æ¥å…¥å¹¶ç©¿æ¢­äºå¤æ‚çš„ç½‘ç»œç¯å¢ƒã€‚è‡³æ­¤ï¼Œæˆ‘ä»¬çš„è®¾å¤‡å·²ç»å…·å¤‡äº†â€œå®šä½â€å¹¶â€œè¿æ¥â€åˆ°ç›®æ ‡æœåŠ¡å™¨çš„èƒ½åŠ›ã€‚ æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™ä¸ªè¿æ¥å»ºç«‹ä¹‹åï¼Œåº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œé€šä¿¡æ‰€ä½¿ç”¨çš„â€œè¯­è¨€â€â€”â€”HTTP åè®®ï¼Œä»¥åŠå…¶å®‰å…¨ç‰ˆæœ¬ HTTPSã€‚è¿™ä¸¤ç§åè®®æ„æˆäº†ç°ä»£ä¸‡ç»´ç½‘çš„åŸºçŸ³ã€‚ æœ¬ç³»åˆ—å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹ å‰ç½®çŸ¥è¯†è¯´æ˜ï¼šåœ¨é˜…è¯»æœ¬æ–‡æ—¶ï¼Œæ‚¨ä¼šé‡åˆ° TCP å’Œ UDP è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚å®ƒä»¬æ˜¯ç½‘ç»œé€šä¿¡çš„ä¸¤ç§åŸºç¡€â€œè¿è¾“æ–¹å¼â€ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—çš„ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­æ·±å…¥æ¢è®¨ã€‚ä¸ºæ–¹ä¾¿æ‚¨ç†è§£æœ¬æ–‡ï¼Œæ‚¨å¯ä»¥æš‚æ—¶å°†å®ƒä»¬æƒ³è±¡ä¸ºï¼š TCPï¼šä¸€ç§å¯é çš„â€œç”µè¯é€šè¯â€ã€‚åœ¨é€šè¯å‰ï¼ŒåŒæ–¹å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œç¡®ä¿çº¿è·¯é€šç•…ï¼Œé€šè¯è¿‡ç¨‹ä¸­èƒ½ä¿è¯æ•°æ®æŒ‰é¡ºåºã€ä¸ä¸¢ä¸æ¼åœ°é€è¾¾ã€‚ UDPï¼šä¸€ç§ç®€å•çš„â€œæ˜ä¿¡ç‰‡â€ã€‚å®ƒç›´æ¥å°†æ•°æ®åŒ…å‘å‡ºï¼Œä¸ä¿è¯ä¸€å®šæˆ–æŒ‰åºåˆ°è¾¾ï¼Œä½†èƒœåœ¨å¿«æ·é«˜æ•ˆã€‚ æœ¬æ–‡ä¸­æåˆ°çš„ HTTP/1.1 å’Œ HTTP/2 éƒ½æ„å»ºåœ¨å¯é çš„ TCP ä¹‹ä¸Šï¼Œè€Œæœ€æ–°çš„ HTTP/3 åˆ™åˆ›é€ æ€§åœ°é€‰æ‹©äº† UDP ä½œä¸ºåŸºç¡€ã€‚å¸¦ç€è¿™ä¸ªåˆæ­¥å°è±¡ï¼Œæ‚¨å°±å¯ä»¥é¡ºåˆ©åœ°ç†è§£ä¸‹æ–‡å†…å®¹äº†ã€‚ HTTPï¼šæ„å»º Web çš„æ— çŠ¶æ€åè®® HTTP (HyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®) æ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼ã€åä½œå¼å’Œè¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿçš„åº”ç”¨å±‚åè®®ã€‚å®ƒæ˜¯ä¸‡ç»´ç½‘æ•°æ®é€šä¿¡çš„åŸºç¡€ã€‚ æ ¸å¿ƒç‰¹æ€§ åŸºäºâ€œè¯·æ±‚-å“åº”â€æ¨¡å¼ï¼šé€šä¿¡ç”±å®¢æˆ·ç«¯å‘èµ·ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨åœ¨å¤„ç†åè¿”å›ä¸€ä¸ª HTTP å“åº”ã€‚ æ— çŠ¶æ€ (Stateless)ï¼šåè®®æœ¬èº«ä¸ä¿å­˜ä»»ä½•å…³äºè¿‡å»è¯·æ±‚çš„ä¿¡æ¯ã€‚æœåŠ¡å™¨å¤„ç†æ¯ä¸ªè¯·æ±‚æ—¶ï¼Œéƒ½è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå…¨æ–°çš„ã€ç‹¬ç«‹çš„äº‹åŠ¡ï¼Œä¸ä¾èµ–äºä¹‹å‰çš„è¯·æ±‚ã€‚æ‚¨å¯ä»¥å°†å®ƒæƒ³è±¡æˆä¸€ä¸ªè®°å¿†åŠ›å¾ˆçŸ­çš„æ¥å¾…å‘˜ï¼Œå¤„ç†å®Œä½ çš„å½“å‰è¯·æ±‚åï¼Œç«‹åˆ»å°±ä¼šå¿˜è®°ä½ æ˜¯è°ã€‚ä¸ºäº†è®©å®ƒè®°ä½ä½ ï¼Œå°±éœ€è¦ Cookies è¿™æ ·çš„â€œèº«ä»½ç‰Œâ€æ¥å¸®å¿™ã€‚ çµæ´»å¯æ‰©å±•ï¼šé€šè¿‡è¯·æ±‚å¤´å’Œå“åº”å¤´ï¼ŒHTTP å…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œä¸ä»…ä»…æ˜¯ HTMLï¼Œè¿˜åŒ…æ‹¬å›¾ç‰‡ã€è§†é¢‘ã€JSON ç­‰ã€‚å…¶åŸºç¡€äº¤äº’æ¨¡å‹å¦‚ä¸‹æ‰€ç¤ºï¼š HTTP æŠ¥æ–‡ç»“æ„ HTTP é€šä¿¡ç”±çº¯æ–‡æœ¬çš„æŠ¥æ–‡ï¼ˆMessageï¼‰ç»„æˆï¼Œåˆ†ä¸ºè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ã€‚ ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆâ€œmessageâ€è¢«ç¿»è¯‘æˆäº†â€œæŠ¥æ–‡â€ï¼Ÿå…¶å®æ˜¯å› ä¸ºå‰è¾ˆä»¬æ²¿ç”¨äº†â€œç”µæŠ¥â€æ—¶ä»£çš„ç›¸å…³æ¦‚å¿µï¼Œé‚£æ—¶â€œæŠ¥æ–‡â€ä¸€è¯å°±å·²ç»è•´å«äº†â€œé€šè¿‡ç”µå­ä¿¡å·ä¼ é€’çš„ã€æœ‰ç‰¹å®šæ ¼å¼çš„æ–‡ä¹¦â€çš„æ„ä¹‰ã€‚å¦å¤–ï¼Œâ€œæŠ¥â€å­—è•´å«äº†éµå¾ªåè®®çš„è§„èŒƒæ€§ï¼Œè€Œâ€œæ–‡â€å­—åˆ™å¼ºè°ƒäº†å…¶å†…å®¹ä¸æ ¼å¼çš„ç»“æ„åŒ–ï¼Œå¦‚åŒä¸€ä»½ä¸¥è°¨çš„æ–‡ä¹¦ã€‚æ‰€ä»¥æœ€ç»ˆè¿™ä¸ªæ¦‚å¿µçš„ä¸­æ–‡è¢«è¯‘ä¸ºäº†â€œæŠ¥æ–‡â€ã€‚ è‡³äºä¸ºä½•è‹±è¯­æ²¿ç”¨é€šç”¨çš„â€œmessageâ€è€Œéæ›´ä¸“ä¸šçš„è¯ï¼Œæ˜¯å› ä¸ºâ€œmessageâ€æœ¬å°±æ˜¯æŒ‡ä»£é€šä¿¡å†…å®¹çš„åŸºç¡€è¯ï¼Œè€Œâ€œtelegraphâ€ï¼ˆç”µæŠ¥ï¼‰åˆ™æŒ‡é€šä¿¡ç³»ç»Ÿæœ¬èº«ï¼Œè€Œéå†…å®¹å•å…ƒã€‚è‹±è¯­ä¹ æƒ¯ç”¨é™å®šè¯ï¼ˆå¦‚ HTTP messageï¼‰æ¥æ˜ç¡®ä¸Šä¸‹æ–‡ï¼Œæ— éœ€æ›¿æ¢åŸºç¡€è¯ã€‚è¿™æ˜¯ä¸¤ç§è¯­è¨€åœ¨æŠ€æœ¯æœ¯è¯­æ¼”å˜ä¸Šçš„è·¯å¾„å·®å¼‚ã€‚ è¯·æ±‚æŠ¥æ–‡ (Request Message) ä¸€ä¸ªå…¸å‹çš„ HTTP GET è¯·æ±‚æŠ¥æ–‡ç»“æ„å¦‚ä¸‹ï¼š GET /path/to/resource/index.html HTTP/1.1 Host: www.example.com User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) ... Accept: text/html,*/* Accept-Language: en-US,en;q=0.5 å®ƒç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š è¯·æ±‚è¡Œ (Request Line)ï¼šåŒ…å«è¯·æ±‚æ–¹æ³•ï¼ˆGETï¼‰ã€è¯·æ±‚èµ„æºçš„è·¯å¾„ï¼ˆ/path/...ï¼‰å’Œ HTTP åè®®ç‰ˆæœ¬ï¼ˆHTTP/1.1ï¼‰ã€‚ è¯·æ±‚å¤´ (Headers)ï¼šä»¥é”®å€¼å¯¹å½¢å¼æä¾›å…³äºè¯·æ±‚çš„å…ƒæ•°æ®ï¼Œæˆ–å®¢æˆ·ç«¯è‡ªèº«çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ Host æŒ‡å®šäº†ç›®æ ‡æœåŠ¡å™¨çš„åŸŸåï¼ŒUser-Agent æè¿°äº†å®¢æˆ·ç«¯çš„ç±»å‹ã€‚ è¯·æ±‚ä½“ (Body)ï¼šå¯¹äº GET è¯·æ±‚ï¼Œè¯·æ±‚ä½“ä¸ºç©ºã€‚å¯¹äº POST æˆ– PUT è¯·æ±‚ï¼Œè¿™é‡Œä¼šåŒ…å«éœ€è¦æäº¤ç»™æœåŠ¡å™¨çš„æ•°æ®ï¼Œä¾‹å¦‚è¡¨å•ä¿¡æ¯æˆ– JSON æ•°æ®ã€‚ å¸¸è§çš„è¯·æ±‚æ–¹æ³•ï¼ˆMethodï¼‰æœ‰ï¼š æ–¹æ³• æè¿° GET è¯·æ±‚è·å–æŒ‡å®šèµ„æºã€‚ POST å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®ï¼Œè¯·æ±‚æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚ PUT ç”¨è¯·æ±‚ä¸­çš„æ•°æ®ä½“æ›¿æ¢ç›®æ ‡èµ„æºçš„å…¨éƒ¨å½“å‰å†…å®¹ã€‚ DELETE è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚ HEAD ä¸ GET ç±»ä¼¼ï¼Œä½†æœåŠ¡å™¨åœ¨å“åº”ä¸­åªè¿”å›å¤´éƒ¨ï¼Œä¸è¿”å›å®ä½“ä¸»ä½“å†…å®¹ã€‚ å“åº”æŠ¥æ–‡ (Response Message) æœåŠ¡å™¨åœ¨æ”¶åˆ°å¹¶å¤„ç†è¯·æ±‚åï¼Œä¼šè¿”å›ä¸€ä¸ªå“åº”æŠ¥æ–‡ï¼š HTTP/1.1 200 OK Date: Mon, 18 Aug 2025 10:00:00 GMT Content-Type: text/html; charset=UTF-8 Content-Length: 1270 &lt;!DOCTYPE html&gt; &lt;html&gt; ... &lt;/html&gt; å®ƒåŒæ ·ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š çŠ¶æ€è¡Œ (Status Line)ï¼šåŒ…å« HTTP åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆ200ï¼‰å’ŒçŠ¶æ€æè¿°ï¼ˆOKï¼‰ã€‚ å“åº”å¤´ (Headers)ï¼šæä¾›å…³äºå“åº”çš„å…ƒæ•°æ®ï¼Œå¦‚ Content-Type æŒ‡æ˜äº†å“åº”ä½“çš„åª’ä½“ç±»å‹ã€‚ å“åº”ä½“ (Body)ï¼šå®é™…è¿”å›çš„èµ„æºå†…å®¹ï¼Œä¾‹å¦‚ HTML æ–‡æ¡£ã€‚ çŠ¶æ€ç æ˜¯æœåŠ¡å™¨å¯¹è¯·æ±‚å¤„ç†ç»“æœçš„æ ‡å‡†åŒ–è¡¨ç¤ºï¼Œå¸¸è§çš„æœ‰ï¼š æœ‰ä¸€ä¸ªå¾ˆå¥½ç©çš„å°ç½‘ç«™åˆ†äº«ç»™å¤§å®¶ï¼šhttps://http.cat/ ï¼Œç”¨å¯çˆ±çš„çŒ«çŒ«è¡¨ç¤º HTTP çŠ¶æ€ç ã€‚ çŠ¶æ€ç  åç§° ç±»åˆ« æè¿° 200 OK æˆåŠŸ è¯·æ±‚å·²æˆåŠŸã€‚ 201 Created æˆåŠŸ è¯·æ±‚æˆåŠŸï¼Œå¹¶å› æ­¤åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„èµ„æºã€‚ 204 No Content æˆåŠŸ æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†è¯·æ±‚ï¼Œä½†æ²¡æœ‰è¿”å›ä»»ä½•å†…å®¹ã€‚ 301 Moved Permanently é‡å®šå‘ è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚ 302 Found é‡å®šå‘ è¯·æ±‚çš„èµ„æºè¢«ä¸´æ—¶é‡å®šå‘åˆ°å¦ä¸€ä¸ª URIã€‚ 304 Not Modified é‡å®šå‘ ç”¨äºç¼“å­˜ã€‚è¡¨ç¤ºèµ„æºæœªè¢«ä¿®æ”¹ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­ä½¿ç”¨å·²ç¼“å­˜çš„ç‰ˆæœ¬ã€‚ 400 Bad Request å®¢æˆ·ç«¯é”™è¯¯ ç”±äºè¯­æ³•æ— æ•ˆï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£è¯¥è¯·æ±‚ã€‚ 401 Unauthorized å®¢æˆ·ç«¯é”™è¯¯ è¯·æ±‚è¦æ±‚èº«ä»½éªŒè¯ã€‚å®¢æˆ·ç«¯éœ€è¦æä¾›å‡­æ®ã€‚ 403 Forbidden å®¢æˆ·ç«¯é”™è¯¯ æœåŠ¡å™¨ç†è§£è¯·æ±‚ï¼Œä½†æ‹’ç»æ‰§è¡Œã€‚ä¸ 401 ä¸åŒï¼Œèº«ä»½éªŒè¯æ— æ³•æ”¹å˜ç»“æœã€‚ 404 Not Found å®¢æˆ·ç«¯é”™è¯¯ æœåŠ¡å™¨æ‰¾ä¸åˆ°è¯·æ±‚çš„èµ„æºã€‚ 405 Method Not Allowed å®¢æˆ·ç«¯é”™è¯¯ æœåŠ¡å™¨çŸ¥é“è¯·æ±‚çš„æ–¹æ³•ï¼Œä½†ç›®æ ‡èµ„æºä¸æ”¯æŒè¯¥æ–¹æ³•ã€‚ 429 Too Many Requests å®¢æˆ·ç«¯é”™è¯¯ ç”¨æˆ·åœ¨ç»™å®šçš„æ—¶é—´å†…å‘é€äº†å¤ªå¤šçš„è¯·æ±‚ï¼ˆé€Ÿç‡é™åˆ¶ï¼‰ã€‚ 500 Internal Server Error æœåŠ¡å™¨é”™è¯¯ æœåŠ¡å™¨é‡åˆ°äº†ä¸€ä¸ªæœªæ›¾é¢„æ–™çš„çŠ¶å†µï¼Œå¯¼è‡´å…¶æ— æ³•å®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ã€‚ 502 Bad Gateway æœåŠ¡å™¨é”™è¯¯ ä½œä¸ºç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼Œä»ä¸Šæ¸¸æœåŠ¡å™¨æ”¶åˆ°äº†æ— æ•ˆçš„å“åº”ã€‚ 503 Service Unavailable æœåŠ¡å™¨é”™è¯¯ æœåŠ¡å™¨å½“å‰æ— æ³•å¤„ç†è¯·æ±‚ï¼ˆç”±äºè¶…è½½æˆ–åœæœºç»´æŠ¤ï¼‰ã€‚ ä¸ºäº†æ›´ç›´è§‚åœ°å¯¹æ¯”ï¼Œä¸‹è¡¨æ€»ç»“äº†è¯·æ±‚æŠ¥æ–‡ä¸å“åº”æŠ¥æ–‡çš„æ ¸å¿ƒåŒºåˆ«ï¼š æ„æˆéƒ¨åˆ† è¯·æ±‚æŠ¥æ–‡ (Request) å“åº”æŠ¥æ–‡ (Response) èµ·å§‹ï¼ˆè¡Œï¼‰ æ ¼å¼ï¼šæ–¹æ³• URI HTTPç‰ˆæœ¬ç¤ºä¾‹ï¼šGET /index.html HTTP/1.1 æ ¼å¼ï¼šHTTPç‰ˆæœ¬ çŠ¶æ€ç  æè¿°ç¤ºä¾‹ï¼šHTTP/1.1 200 OK é¦–éƒ¨ï¼ˆå¤´ï¼‰ æè¿°å®¢æˆ·ç«¯ä¿¡æ¯ã€è¯·æ±‚çš„èµ„æºç­‰ã€‚ç¤ºä¾‹ï¼šHost, User-Agent æè¿°æœåŠ¡å™¨ä¿¡æ¯ã€è¿”å›å†…å®¹çš„ç±»å‹ç­‰ã€‚ç¤ºä¾‹ï¼šContent-Type, Server æ­£æ–‡ï¼ˆä½“ï¼‰ é€šå¸¸ç”¨äº POST ç­‰æ–¹æ³•ï¼Œæºå¸¦æäº¤ç»™æœåŠ¡å™¨çš„æ•°æ®ã€‚GET è¯·æ±‚é€šå¸¸ä¸ºç©ºã€‚ åŒ…å«è¿”å›ç»™å®¢æˆ·ç«¯çš„å®é™…èµ„æºå†…å®¹ï¼Œå¦‚ HTML æ–‡æ¡£ã€JSON æ•°æ®ç­‰ã€‚ HTTP çš„ç‰ˆæœ¬æ¼”è¿›ä¸åå•†æœºåˆ¶ HTTP åè®®å¹¶éä¸€æˆä¸å˜ï¼Œå®ƒåœ¨è¿‡å»å‡ åå¹´ä¸­ç»å†äº†æ•°æ¬¡é‡è¦è¿­ä»£ï¼Œä»¥é€‚åº”æ—¥ç›Šå¤æ‚çš„ Web åº”ç”¨å’Œç”¨æˆ·å¯¹æ€§èƒ½çš„æ›´é«˜è¦æ±‚ã€‚ HTTP/1.0 ä¸ HTTP/1.1 HTTP/1.0 (1996)ï¼šä½œä¸ºæ—©æœŸç‰ˆæœ¬ï¼Œå…¶ä¸»è¦ç‰¹ç‚¹æ˜¯çŸ­è¿æ¥ã€‚æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œè¯·æ±‚å®Œæˆåç«‹å³æ–­å¼€ï¼Œæ•ˆç‡ä½ä¸‹ã€‚ HTTP/1.1 (1999)ï¼šè¿™æ˜¯ç»Ÿæ²»äº†äº’è”ç½‘è¿‘ 20 å¹´çš„ç»å…¸ç‰ˆæœ¬ã€‚å®ƒæœ€é‡è¦çš„æ”¹è¿›æ˜¯å¼•å…¥äº†æŒä¹…è¿æ¥ï¼ˆKeep-Aliveï¼‰ï¼Œå…è®¸åœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸Šå‘é€å¤šä¸ªè¯·æ±‚ï¼Œæå¤§åœ°å‡å°‘äº†è¿æ¥å»ºç«‹çš„å¼€é”€ã€‚ä½†å®ƒä¹Ÿå­˜åœ¨ä¸€ä¸ªè‘—åçš„é—®é¢˜â€”â€”é˜Ÿå¤´é˜»å¡ï¼ˆHead-of-Line Blockingï¼‰ï¼Œå³åœ¨ä¸€ä¸ªè¿æ¥ä¸Šï¼Œå‰ä¸€ä¸ªè¯·æ±‚çš„å“åº”å¿…é¡»å®Œå…¨æ¥æ”¶åï¼Œåç»­çš„è¯·æ±‚æ‰èƒ½è¢«å¤„ç†ï¼Œå¯¼è‡´æ•ˆç‡ç“¶é¢ˆã€‚ HTTP/2 (2015) HTTP/2 çš„ç›®æ ‡æ˜¯å½»åº•è§£å†³ HTTP/1.1 çš„æ€§èƒ½é—®é¢˜ï¼Œå…¶æ ¸å¿ƒæ”¹è¿›åŒ…æ‹¬ï¼š äºŒè¿›åˆ¶åˆ†å¸§ï¼šå°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶å¯¹å®ƒä»¬é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼ç¼–ç ï¼Œè§£ææ•ˆç‡æ›´é«˜ã€‚ å¤šè·¯å¤ç”¨ (Multiplexing)ï¼šè¿™æ˜¯ HTTP/2 æœ€å…·é©å‘½æ€§çš„ç‰¹æ€§ã€‚å®ƒå…è®¸åœ¨å•ä¸ª TCP è¿æ¥ä¸ŠåŒæ—¶ã€å¹¶è¡Œåœ°å‘é€å’Œæ¥æ”¶å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œå½»åº•è§£å†³äº†é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚ å¤´éƒ¨å‹ç¼© (HPACK)ï¼šä½¿ç”¨ç‰¹å®šç®—æ³•å‹ç¼©å†—ä½™çš„è¯·æ±‚å¤´å’Œå“åº”å¤´ï¼Œå‡å°‘äº†ä¼ è¾“çš„æ•°æ®é‡ã€‚ HTTP/3 (2022) HTTP/3 çš„æ¼”è¿›æ›´è¿›ä¸€æ­¥ï¼Œå®ƒå°†åº•å±‚çš„ä¼ è¾“åè®®ä» TCP æ¢æˆäº† QUICã€‚ åŸºäº QUICï¼šQUIC æ˜¯ä¸€ä¸ªåŸºäº UDP çš„æ–°ä¼ è¾“åè®®ï¼Œå®ƒæ•´åˆäº† TCP çš„å¯é æ€§ã€TLS çš„å®‰å…¨æ€§ä»¥åŠæ›´å¤šæ–°ç‰¹æ€§ã€‚ è§£å†³ TCP é˜Ÿå¤´é˜»å¡ï¼šHTTP/2 è™½ç„¶è§£å†³äº†åº”ç”¨å±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œä½†æ— æ³•è§£å†³ TCP åè®®æœ¬èº«çš„é˜Ÿå¤´é˜»å¡ï¼ˆä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œæ•´ä¸ªè¿æ¥éƒ½è¦ç­‰å¾…é‡ä¼ ï¼‰ã€‚QUIC åŸºäº UDPï¼Œä¸€ä¸ªæµçš„ä¸¢åŒ…ä¸ä¼šå½±å“å…¶ä»–æµï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ æ›´å¿«çš„è¿æ¥å»ºç«‹ï¼šQUIC å°† TCP å’Œ TLS çš„æ¡æ‰‹è¿‡ç¨‹åˆå¹¶ï¼Œå‡å°‘äº†å»ºç«‹è¿æ¥æ‰€éœ€çš„å¾€è¿”æ—¶é—´ï¼ˆRTTï¼‰ï¼Œè®©è¿æ¥æ›´å¿«ã€‚ ç‰ˆæœ¬åå•†ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å¦‚ä½•â€œå¯¹æš—å·â€ï¼Ÿ æ—¢ç„¶æœ‰è¿™ä¹ˆå¤šç‰ˆæœ¬ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ˜¯å¦‚ä½•ç¡®å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„å‘¢ï¼Ÿè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºåè®®åå•†ã€‚ HTTP/2 çš„åå•†ï¼šè¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚è™½ç„¶ HTTP/2 çš„åè®®è§„èŒƒæœ¬èº«å¹¶ä¸å¼ºåˆ¶åŠ å¯†ï¼ˆå­˜åœ¨æ˜æ–‡çš„ h2c æ¨¡å¼ï¼‰ï¼Œä½†æ‰€æœ‰ä¸»æµæµè§ˆå™¨éƒ½è¾¾æˆäº†ä¸€ä¸ªå…±è¯†ï¼šåªæ”¯æŒé€šè¿‡ HTTPS è¿è¡Œçš„ HTTP/2ã€‚è¿™æ—¢æ˜¯ä¸ºäº†æ¨åŠ¨å…¨ç½‘åŠ å¯†ï¼Œä¹Ÿæ˜¯ä¸ºäº†ç»•è¿‡å¯èƒ½ä¸æ”¯æŒæ–°åè®®çš„æ—§ç½‘ç»œè®¾å¤‡ã€‚å› æ­¤ï¼Œåœ¨æµè§ˆå™¨å®è·µä¸­ï¼ŒHTTP/2 çš„åå•†å‡ ä¹æ€»æ˜¯é€šè¿‡ TLS çš„ä¸€ä¸ªæ‰©å±• ALPN (Application-Layer Protocol Negotiation) æ¥å®ç°ã€‚åœ¨ TLS æ¡æ‰‹æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå‘Šè¯‰æœåŠ¡å™¨å®ƒæ”¯æŒçš„åè®®åˆ—è¡¨ï¼ˆå¦‚ [&quot;h2&quot;, &quot;http/1.1&quot;]ï¼‰ï¼ŒæœåŠ¡å™¨åˆ™ä»ä¸­é€‰æ‹©ä¸€ä¸ªå®ƒä¹Ÿæ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ï¼Œå¹¶åœ¨ TLS æ¡æ‰‹å®Œæˆæ—¶é€šçŸ¥å®¢æˆ·ç«¯ã€‚ HTTP/3 çš„åå•†ï¼šç”±äº HTTP/3 è¿è¡Œåœ¨ä¸åŒçš„åè®®ï¼ˆUDPï¼‰ä¸Šï¼Œå®ƒçš„å‘ç°æœºåˆ¶æœ‰æ‰€ä¸åŒã€‚é€šå¸¸ï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡ HTTP/1.1 æˆ– HTTP/2 çš„å“åº”å¤´ Alt-Svc (Alternative Service) æ¥â€œå¹¿æ’­â€è‡ªå·±çš„ HTTP/3 æœåŠ¡åœ°å€ã€‚ä¾‹å¦‚ï¼ŒAlt-Svc: h3=&quot;:443&quot;ã€‚æµè§ˆå™¨æ”¶åˆ°åï¼Œå°±ä¼šå°è¯•åœ¨åå°å»ºç«‹ä¸€ä¸ªåˆ°è¯¥åœ°å€çš„ QUIC è¿æ¥ï¼Œå¹¶åœ¨åç»­è¯·æ±‚ä¸­å‡çº§åˆ° HTTP/3ã€‚ HTTPSï¼šä¸ºå¯¹è¯åŠ ä¸Šå®‰å…¨å°å° HTTP åè®®æœ¬èº«æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œè¿™æ„å‘³ç€ä»»ä½•åœ¨ä¼ è¾“è·¯å¾„ä¸Šçš„ä¸­é—´èŠ‚ç‚¹ï¼ˆå¦‚è·¯ç”±å™¨ã€ISPï¼‰éƒ½èƒ½è½»æ˜“åœ°è¯»å–ã€ç”šè‡³ç¯¡æ”¹é€šä¿¡å†…å®¹ã€‚è¿™å¸¦æ¥äº†ä¸‰å¤§å®‰å…¨é£é™©ï¼š çªƒå¬é£é™© (Eavesdropping)ï¼šé€šä¿¡å†…å®¹å¯èƒ½è¢«ç¬¬ä¸‰æ–¹çªƒå¬ã€‚ ç¯¡æ”¹é£é™© (Tampering)ï¼šé€šä¿¡å†…å®¹åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¯èƒ½è¢«ä¿®æ”¹ã€‚ å†’å……é£é™© (Impersonation)ï¼šæ— æ³•éªŒè¯é€šä¿¡å¯¹æ–¹çš„çœŸå®èº«ä»½ï¼Œå¯èƒ½è¿æ¥åˆ°ä¼ªé€ çš„æœåŠ¡å™¨ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒHTTPS (HTTP Secure) åº”è¿è€Œç”Ÿã€‚ HTTPS çš„æ ¸å¿ƒ HTTPS å¹¶éä¸€ä¸ªå…¨æ–°çš„åè®®ï¼Œå®ƒçš„ç»“æ„æ˜¯ HTTPS = HTTP + TLS/SSLã€‚å®ƒåœ¨æ ‡å‡†çš„ HTTP åº”ç”¨å±‚å’Œ TCP ä¼ è¾“å±‚ä¹‹é—´ï¼Œå¢åŠ äº†ä¸€ä¸ªåŠ å¯†ã€è®¤è¯å’Œå®Œæ•´æ€§ä¿æŠ¤çš„ TLS/SSL å®‰å…¨å±‚ã€‚ SSL (Secure Sockets Layer) æ˜¯ TLS (Transport Layer Security) çš„å‰èº«ï¼Œç”±äºå­˜åœ¨å®‰å…¨æ¼æ´ç°å·²å¼ƒç”¨ã€‚ æˆ‘ä»¬ç›®å‰å®é™…ä½¿ç”¨çš„éƒ½æ˜¯ TLS åè®®ï¼Œä½†å‡ºäºå†å²ä¹ æƒ¯ï¼Œäººä»¬å¸¸å°†äºŒè€…å¹¶ç§°ä¸º TLS/SSLã€‚ è¿™ä¸ªå®‰å…¨å±‚ä¸»è¦æä¾›ä¸‰å¤§æ ¸å¿ƒå®‰å…¨ä¿éšœï¼š åŠ å¯† (Encryption)ï¼šç¡®ä¿é€šä¿¡å†…å®¹æ— æ³•è¢«çªƒå¬ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ã€‚å› ä¸ºéå¯¹ç§°åŠ å¯†è™½ç„¶æ›´çµæ´»ï¼Œä½†è®¡ç®—å¼€é”€å·¨å¤§ï¼Œé€Ÿåº¦è¿‡æ…¢ï¼Œä¸é€‚åˆåŠ å¯†æµ·é‡çš„åº”ç”¨æ•°æ®ã€‚è€Œå¯¹ç§°åŠ å¯†é€Ÿåº¦æå¿«ï¼Œæ­£é€‚åˆæ­¤åœºæ™¯ã€‚ èº«ä»½éªŒè¯ (Authentication)ï¼šé€šè¿‡æ•°å­—è¯ä¹¦ï¼Œå®¢æˆ·ç«¯å¯ä»¥éªŒè¯æœåŠ¡å™¨çš„èº«ä»½ï¼Œç¡®ä¿è¿æ¥åˆ°çš„æ˜¯é¢„æœŸçš„ã€çœŸå®çš„æœåŠ¡å™¨ï¼Œé˜²æ­¢å†’å……ã€‚ æ•°æ®å®Œæ•´æ€§ (Integrity)ï¼šé€šè¿‡æ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ TLS æ¡æ‰‹æœºåˆ¶ å½“æµè§ˆå™¨è®¿é—®ä¸€ä¸ª HTTPS ç½‘ç«™æ—¶ï¼Œåœ¨çœŸæ­£å‘é€ HTTP è¯·æ±‚ä¹‹å‰ï¼Œå®ƒå¿…é¡»å…ˆä¸æœåŠ¡å™¨å®Œæˆä¸€æ¬¡ TLS æ¡æ‰‹ï¼Œä»¥å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„ä¿¡é“ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨æ¦‚å¿µä¸Šå¯ä»¥åˆ†ä¸ºå‡ ä¸ªæ­¥éª¤ï¼Œå…¶äº¤äº’æµç¨‹å¯é€šè¿‡ä»¥ä¸‹åºåˆ—å›¾æ¥æè¿°ï¼š å®¢æˆ·ç«¯é—®å€™ (Client Hello)ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¿æ¥ï¼Œå¹¶å‘é€å®ƒæ”¯æŒçš„åŠ å¯†ç®—æ³•åˆ—è¡¨ã€TLS ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ æœåŠ¡å™¨å“åº”ä¸èº«ä»½è¯æ˜ (Server Hello &amp; Certificate)ï¼šæœåŠ¡å™¨ä»ä¸­é€‰æ‹©ä¸€å¥—åŒæ–¹éƒ½æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œç„¶åå°†å…¶æ•°å­—è¯ä¹¦ï¼ˆåŒ…å«äº†æœåŠ¡å™¨çš„å…¬é’¥å’Œç”±æƒå¨è¯ä¹¦é¢å‘æœºæ„ CA çš„ç­¾åï¼‰å‘é€ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯éªŒè¯ä¸å¯†é’¥äº¤æ¢ï¼ˆéå¯¹ç§°åŠ å¯†çš„åº”ç”¨ï¼‰ï¼š å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼ˆæ˜¯å¦ç”±å—ä¿¡ä»»çš„ CA ç­¾å‘ã€æ˜¯å¦è¿‡æœŸã€åŸŸåæ˜¯å¦åŒ¹é…ç­‰ï¼‰ã€‚ éªŒè¯é€šè¿‡åï¼Œå®¢æˆ·ç«¯ç”Ÿæˆä¸€ä¸ªç”¨äºæœ¬æ¬¡ä¼šè¯çš„â€œæš—å·â€ï¼ˆpre-master secretï¼‰ï¼Œç„¶åä½¿ç”¨ä»è¯ä¹¦ä¸­è·å–çš„æœåŠ¡å™¨å…¬é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚ ç”Ÿæˆä¼šè¯å¯†é’¥ä¸å»ºç«‹å®‰å…¨ä¿¡é“ï¼šæœåŠ¡å™¨ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†ï¼Œæ˜¯å…¨ç½‘å”¯ä¸€èƒ½è·å–è¯¥â€œæš—å·â€çš„å®ä½“ã€‚éšåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨è¿™ä¸ªå…±äº«çš„â€œæš—å·â€ï¼Œé€šè¿‡ç›¸åŒçš„ç®—æ³•ï¼Œå„è‡ªç”Ÿæˆå‡ºå®Œå…¨ä¸€æ ·çš„å¯¹ç§°ä¼šè¯å¯†é’¥ã€‚æ¡æ‰‹å®Œæˆã€‚ å®‰å…¨é€šä¿¡ï¼šåç»­æ‰€æœ‰çš„ HTTP æ•°æ®éƒ½å°†ä½¿ç”¨è¿™ä¸ªå¯¹ç§°å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œå®ç°å®‰å…¨çš„é€šä¿¡ã€‚ åœ¨è¿™ä¸ªæµç¨‹ä¸­ï¼Œéå¯¹ç§°åŠ å¯†ï¼ˆå…¬é’¥/ç§é’¥ï¼‰è¢«å·§å¦™åœ°ç”¨äºå®‰å…¨åœ°åå•†å’Œäº¤æ¢å¯¹ç§°åŠ å¯†æ‰€ä½¿ç”¨çš„å¯†é’¥ï¼Œå…¼é¡¾äº†å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚è¿™å°±åƒç”¨ä¸€æŠŠéå¸¸å¤æ‚ã€å¼€é”å¾ˆæ…¢ä½†æ— æ³•è¢«å¤åˆ¶çš„é’¥åŒ™ï¼ˆéå¯¹ç§°åŠ å¯†ï¼‰ï¼Œå»æ‰“å¼€ä¸€ä¸ªä¿é™©ç®±ï¼Œä»é‡Œé¢å–å‡ºä¸€æŠŠå¼€é—¨åˆå¿«åˆæ–¹ä¾¿çš„æ™®é€šé’¥åŒ™ï¼ˆå¯¹ç§°åŠ å¯†ï¼‰ï¼Œç„¶åé”ä¸Šä¿é™©ç®±ï¼Œä»¥åè¿›å‡ºéƒ½ç”¨è¿™æŠŠæ™®é€šé’¥åŒ™ã€‚ TLS æ¡æ‰‹ä¸â€œä¸‰æ¬¡æ¡æ‰‹â€çš„åŒºåˆ« éœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒTLS æ¡æ‰‹ä¸æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ TCPâ€œä¸‰æ¬¡æ¡æ‰‹â€ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ä½†é‡è¦çš„æ··æ·†ç‚¹ï¼Œå®ƒä»¬æ˜¯ä¸¤ä¸ªå‘ç”Ÿåœ¨ä¸åŒé˜¶æ®µã€ç›®çš„ä¹Ÿå®Œå…¨ä¸åŒçš„è¿‡ç¨‹ï¼š ä¸‰æ¬¡æ¡æ‰‹ (TCP Handshake)ï¼šå‘ç”Ÿåœ¨ä¼ è¾“å±‚ï¼Œç›®çš„æ˜¯å»ºç«‹ä¸€ä¸ªå¯é çš„é€šä¿¡è¿æ¥ï¼Œç¡®ä¿åŒæ–¹éƒ½å‡†å¤‡å¥½äº†æ”¶å‘æ•°æ®ã€‚å®ƒä¸å…³å¿ƒå†…å®¹æ˜¯å¦åŠ å¯†ã€‚ TLS æ¡æ‰‹ (TLS Handshake)ï¼šå‘ç”Ÿåœ¨ TCP è¿æ¥å»ºç«‹ä¹‹åï¼Œç›®çš„æ˜¯åœ¨å·²æœ‰çš„å¯é è¿æ¥ä¸Šï¼Œå†å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„åŠ å¯†ä¿¡é“ï¼Œåå•†åç»­é€šä¿¡è¦ä½¿ç”¨çš„åŠ å¯†å¯†é’¥ã€‚ ç®€å•æ¥è¯´ï¼Œå…ˆæœ‰ TCP ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹èµ·â€œç‰©ç†é€šè¯çº¿è·¯â€ï¼Œå†æœ‰ TLS æ¡æ‰‹åœ¨è¿™æ¡çº¿è·¯ä¸Šçº¦å®šâ€œåŠ å¯†æš—å·â€ã€‚ èä¼šè´¯é€šï¼šè¿æ¥ç³»åˆ—çŸ¥è¯† HTTP/HTTPS ä½œä¸ºåº”ç”¨å±‚åè®®ï¼Œå…¶è¿è¡Œç¦»ä¸å¼€åº•å±‚ç½‘ç»œè®¾æ–½çš„æ”¯æŒã€‚ åè®®ã€ç«¯å£ä¸ DNS çš„ååŒå·¥ä½œï¼šåœ¨ç¬¬äºŒç¯‡æ–‡ç« ä¸­æˆ‘ä»¬äº†è§£åˆ°ï¼ŒURL https://www.example.com ä¸­çš„ https éƒ¨åˆ†ï¼Œæ­£æ˜¯å‘Šè¯‰æµè§ˆå™¨éœ€è¦é€šè¿‡ 443 ç«¯å£ï¼ˆå›é¡¾ç¬¬ä¸€ç¯‡ï¼‰è¿æ¥åˆ°ç”± DNS è§£æå‡ºçš„ IP åœ°å€ï¼Œå¹¶å¯åŠ¨ä¸Šæ–‡æ‰€è¿°çš„ TLS æ¡æ‰‹æµç¨‹ã€‚ åº”ç”¨å±‚åŠ å¯†ä¸ç½‘ç»œå±‚åŠ å¯†ï¼šHTTPS vs. WireGuardï¼šåœ¨ç¬¬å››ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥äº† WireGuardã€‚ç°åœ¨å¯ä»¥æ¸…æ™°åœ°å¯¹æ¯”äºŒè€…çš„åŒºåˆ«ï¼š HTTPS åœ¨åº”ç”¨å±‚å·¥ä½œï¼Œå®ƒä¿æŠ¤çš„æ˜¯å•ä¸ªåº”ç”¨ç¨‹åºï¼ˆå¦‚æµè§ˆå™¨ï¼‰ä¸å•ä¸ªç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å†…å®¹ã€‚å®ƒä¸å…³å¿ƒæ•°æ®åŒ…å¦‚ä½•è·¯ç”±ï¼Œåªå…³å¿ƒåº”ç”¨æ•°æ®çš„å®‰å…¨ã€‚ WireGuard åœ¨ç½‘ç»œå±‚å·¥ä½œï¼Œå®ƒä¿æŠ¤çš„æ˜¯è®¾å¤‡ä¸VPN æœåŠ¡å™¨ä¹‹é—´çš„æ‰€æœ‰ IP æµé‡ã€‚ä¸€æ—¦è¿æ¥ï¼Œæ— è®ºæ˜¯ HTTP è¯·æ±‚ã€DNS æŸ¥è¯¢è¿˜æ˜¯å…¶ä»–ä»»ä½•ç½‘ç»œæ´»åŠ¨ï¼Œéƒ½ä¼šè¢«å°è£…åœ¨åŠ å¯†éš§é“ä¸­ã€‚å®ƒæä¾›çš„æ˜¯å…¨é¢çš„ç½‘ç»œé“¾è·¯çº§å®‰å…¨ã€‚ æ€»ç»“ HTTP å®šä¹‰äº† Web å†…å®¹äº¤æ¢çš„åŸºæœ¬è§„åˆ™ï¼Œè€Œ HTTPS åˆ™ä¸ºå…¶å¢åŠ äº†è‡³å…³é‡è¦çš„å®‰å…¨ä¿éšœã€‚ç†è§£è¿™ä¸¤ç§åè®®çš„åŸç†ã€ç»“æ„ä»¥åŠå®ƒä»¬åœ¨æ•´ä¸ªç½‘ç»œåè®®æ ˆä¸­çš„ä½ç½®ï¼Œæ˜¯ç†è§£ç°ä»£äº’è”ç½‘è¿ä½œæ–¹å¼çš„å…³é”®ã€‚å®ƒä»¬ä¸åº•å±‚çš„ IPã€DNSã€TCP/UDP ç­‰åè®®ååŒå·¥ä½œï¼Œå…±åŒæ„æˆäº†æˆ‘ä»¬æ¯å¤©éƒ½åœ¨ä½¿ç”¨çš„ã€å¤æ‚è€Œåˆé«˜æ•ˆçš„å…¨çƒä¿¡æ¯ç½‘ç»œã€‚ ","link":"https://blog.rakuyo.dev/computer-network-http-and-https/"},{"title":"å°† ARouter çš„æ€æƒ³å¸¦å…¥ Swiftï¼šç”¨å£°æ˜å¼è¯­æ³•æ„å»ºç±»å‹å®‰å…¨çš„ API è¯·æ±‚","content":"æœ€è¿‘è¯»åˆ°å–µç¥çš„ã€Šç¼–è¯‘å™¨ï¼Œé ä½ äº†ï¼ä½¿ç”¨ç±»å‹æ”¹å–„çŠ¶æ€è®¾è®¡ã€‹ï¼Œæ·±å—å¯å‘ã€‚è¿™ç¯‡æ–‡ç« è®©æˆ‘æ„è¯†åˆ°ï¼Œæˆ‘åœ¨è®¾è®¡ RaAPIWrapper æ—¶ï¼Œä¸ºäº†è§£å†³ä¸€äº›å·¥ç¨‹é—®é¢˜è€Œé‡‡ç”¨çš„æ–¹æ¡ˆï¼Œåœ¨ä¸ç»æ„é—´ä¸â€œç±»å‹å³çŠ¶æ€â€çš„è®¾è®¡æ€æƒ³ä¸è°‹è€Œåˆã€‚ æˆ‘ä¹‹å‰è¿˜æ²¡æœ‰æ­£å¼ä»‹ç»è¿‡è¿™ä¸ªåº“ï¼Œæ‰€ä»¥å€Ÿæ­¤æœºä¼šï¼Œæ­£å¼ä¸å¤§å®¶åˆ†äº« RaAPIWrapper çš„è®¾è®¡ï¼Œç‰¹åˆ«æ˜¯å®ƒä¸ºäº†è§£å†³ç‰¹å®šé—®é¢˜è€Œé‡‡ç”¨çš„æ¶æ„ï¼Œä»¥åŠè¿™äº›å†³ç­–åœ¨äº‹åçœ‹æ¥ï¼Œæ˜¯å¦‚ä½•â€œç¢°å·§â€å®ç°äº†æ›´å…ˆè¿›çš„è®¾è®¡æ¨¡å¼ã€‚ RaAPIWrapper çš„è¯ç”Ÿ RaAPIWrapper çš„è®¾è®¡åˆè¡·ï¼Œæºäºå¯¹ç°æœ‰ç½‘ç»œåº“ Moya çš„åæ€ï¼Œä»¥åŠå¯¹ Android è·¯ç”±æ¡†æ¶ ARouter è®¾è®¡æ¨¡å¼çš„å€Ÿé‰´ã€‚ ä¸ºä½•ä¸ç›´æ¥ç”¨ Moyaï¼Ÿ åœ¨ Swift ç¤¾åŒºï¼ŒMoya æ˜¯ä¸€ä¸ªéå¸¸ä¼˜ç§€çš„ç±»å‹å®‰å…¨ç½‘ç»œåº“ï¼Œå®ƒé€šè¿‡ enum å’Œ protocol çš„ç»„åˆï¼Œè§£å†³äº†å¤§é‡ API ç®¡ç†ä¸­çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œåœ¨æ·±åº¦ä½¿ç”¨åï¼Œæˆ‘ä»¬å‘ç° Moya çš„è®¾è®¡åœ¨æŸäº›æ–¹é¢å­˜åœ¨ä¼˜åŒ–ç©ºé—´ã€‚ Moya çš„æ ¸å¿ƒæ˜¯ TargetType åè®®ï¼Œä¸€ä¸ª API çš„å®Œæ•´å®šä¹‰éœ€è¦ä½ åœ¨ enum çš„ switch ä¸­ï¼Œä¸º path, method, task ç­‰å¤šä¸ªå±æ€§åˆ†åˆ«æä¾›å®ç°ã€‚è¿™å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼š ä¸€ä¸ª API çš„æ ¸å¿ƒä¿¡æ¯ï¼ˆå¦‚è¯·æ±‚æ–¹æ³•ã€è·¯å¾„ã€å‚æ•°ï¼‰è¢«åˆ†æ•£åœ¨äº†å¤šä¸ªä»£ç å—ä¸­ã€‚ å½“é¡¹ç›® API æ•°é‡å¢å¤šæ—¶ï¼Œå¼€å‘è€…éœ€è¦åœ¨ä¸€ä¸ªåºå¤§çš„ switch è¯­å¥ä¸­ä¸æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸Šä¸‹è·³è½¬ï¼Œæ‰èƒ½æ‹¼å‡‘å‡ºä¸€ä¸ª API çš„å®Œæ•´æ ·è²Œã€‚è¿™é™ä½äº†ä»£ç çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œä¹Ÿæ˜¯ RaAPIWrapper å¸Œæœ›è§£å†³çš„æ ¸å¿ƒç—›ç‚¹ã€‚ ä¸è¿‡éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒRaAPIWrapper çš„ç›®çš„å¹¶éå…¨ç›˜å¦å®š Moyaï¼Œå½“å‰ä¹Ÿä¸å…·å¤‡æ›¿ä»£ Moya çš„èƒ½åŠ›ã€‚Moya ä¾ç„¶æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ç½‘ç»œæ‰§è¡Œå±‚ï¼Œå°¤å…¶åœ¨æ’ä»¶åŒ–ã€è¯·æ±‚æ‰§è¡Œç­‰é¢†åŸŸã€‚RaAPIWrapper çš„è®¾è®¡åˆè¡·æ˜¯ä¸“æ³¨äºè§£å†³ API å®šä¹‰çš„å†…èšæ€§é—®é¢˜ï¼Œå®ƒè¢«è®¾è®¡ä¸ºä¸€ä¸ªä¸Šå±‚çš„â€œAPI å®šä¹‰å±‚â€ï¼Œå¯ä»¥ä¸åƒ Moya è¿™æ ·çš„æˆç†Ÿç½‘ç»œåº“ååŒå·¥ä½œï¼Œå½¢æˆä¼˜åŠ¿äº’è¡¥ã€‚ ARouter æ˜¯ä»€ä¹ˆï¼Ÿ ARouter æ˜¯ Android ç”Ÿæ€ä¸­ä¸€ä¸ªè‘—åçš„è·¯ç”±æ¡†æ¶ï¼Œç”±é˜¿é‡Œå·´å·´å¼€å‘å¹¶å¼€æºã€‚è¯¥æ¡†æ¶é€šè¿‡æ³¨è§£ (@Route) çš„æ–¹å¼ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä»¥ä¸€ç§æå…¶å£°æ˜å¼å’Œè§£è€¦çš„æ–¹å¼å®šä¹‰é¡µé¢è·¯å¾„ã€‚åœ¨ README ä¸­æœ‰å¦‚ä¸‹çš„ç¤ºä¾‹ï¼š @Route(path = &quot;/test/activity&quot;) public class Test1Activity extends Activity { ... } æˆ‘éå¸¸æ¬£èµè¿™ç§å°†â€œè·¯ç”±â€ä»å…·ä½“çš„å®ç°ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå˜æˆä¸€ä¸ªé›†ä¸­ã€é™æ€ã€æ˜“äºç®¡ç†çš„è®¾è®¡ã€‚ äºæ˜¯ï¼Œä¸€ä¸ªæƒ³æ³•åœ¨æˆ‘è„‘ä¸­èŒç”Ÿï¼šæˆ‘èƒ½å¦å°†è¿™ç§ä¼˜é›…çš„ã€åŸºäºæ³¨è§£çš„å£°æ˜å¼è¯­æ³•ï¼Œä»â€œé¡µé¢è·¯ç”±â€é¢†åŸŸè¿ç§»åˆ°â€œAPI å®šä¹‰â€é¢†åŸŸï¼Ÿ è¿™ä¸ªæƒ³æ³•ï¼Œæˆä¸ºäº† RaAPIWrapper çš„èµ·ç‚¹ã€‚æˆ‘çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªç½‘ç»œå±‚ï¼Œå®ƒåº”è¯¥å…·å¤‡ä»¥ä¸‹ç‰¹è´¨ï¼š API å£°æ˜åŒ–ï¼šAPI çš„å®šä¹‰åº”è¯¥åƒ ARouter çš„è·¯ç”±ä¸€æ ·ï¼Œé€šè¿‡ç±»ä¼¼æ³¨è§£çš„è¯­æ³•é™„åŠ åˆ°ä¸€ä¸ªé™æ€å±æ€§ä¸Šï¼Œè€Œä¸æ˜¯æ•£è½åœ¨å„ä¸ªä¸šåŠ¡ä»£ç ä¸­å»æ‰‹åŠ¨æ‹¼æ¥ URLã€‚ é›†ä¸­åŒ–ç®¡ç†ï¼šæ‰€æœ‰å•ä¸ª API å®šä¹‰æ‰€éœ€è¦çš„å†…å®¹éƒ½åº”è¯¥è¢«æ¸…æ™°åœ°ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä¸ä¼šæ•£è½åœ¨å¤šä¸ªåœ°æ–¹ï¼ŒæŸ¥æ‰¾èµ·æ¥è¦éå¸¸æ–¹ä¾¿ã€‚ å®šä¹‰ä¸å®ç°è§£è€¦ï¼šAPI çš„â€œå®šä¹‰â€åº”è¯¥ä¸å…¶â€œå¦‚ä½•è¢«è¯·æ±‚â€å®Œå…¨åˆ†ç¦»ã€‚å®šä¹‰éƒ¨åˆ†åªå…³å¿ƒ API çš„å…ƒæ•°æ®ï¼ˆè·¯å¾„ã€æ–¹æ³•ã€å‚æ•°ç»“æ„ï¼‰ï¼Œè€Œåº•å±‚çš„ç½‘ç»œè¯·æ±‚åº“ï¼ˆæ˜¯ Alamofire è¿˜æ˜¯ URLSessionï¼‰å¯ä»¥éšæ—¶è¢«æ›¿æ¢ï¼Œè€Œä¸å½±å“å®šä¹‰ã€‚ åƒå®šä¹‰è·¯ç”±ä¸€æ ·å®šä¹‰ API ä¸ºäº†å®ç°ä¸Šè¿°ç›®æ ‡ï¼Œæˆ‘å°† RaAPIWrapper çš„æ ¸å¿ƒæ¶æ„è®¾è®¡ä¸ºä¸€ä¸ªå£°æ˜å¼çš„ API â€œåœ°å€ç°¿â€ï¼š é¡¹ç›®å¸¦æœ‰ä¸€ä¸ªç”¨äºæ¼”ç¤ºçš„ Playgroundï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯¥é¡¹ç›®è¿›ä¸€æ­¥äº†è§£æœ¬æ¡†æ¶ã€‚ @GET(&quot;/api/v1/no_param&quot;) static var noParamAPI: APIParameterBuilder&lt;()&gt;? = nil @POST(&quot;/api/v1/tuple_param&quot;) static var tupleParamAPI: APIParameterBuilder&lt;(id: Int, name: String?)&gt;? = .init { // `Dictionary` and `Array` can be used directly as parameters. [&quot;id&quot;: $0.id, &quot;name&quot;: $0.name] } @POST(&quot;/post&quot;) static var postWithModel: APIParameterBuilder&lt;Arg&gt;? = .init { // When the parameter `Arg` complies with the `APIParameter` (`Encodable &amp; Hashable`) protocol, // it can be used directly as a parameter. $0 } å°±åƒ ARouter çš„ @Route(&quot;/path/to/page&quot;) ä¸€æ ·ï¼Œæœ€æ ¸å¿ƒçš„ä¿¡æ¯åº”è¯¥åœ¨å£°æ˜çš„é‚£ä¸€åˆ»å°±ä¸€ç›®äº†ç„¶ã€‚è¿™ç§æ–¹å¼çš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼š é«˜åº¦å¯è¯»ï¼šä½ å¯ä»¥åƒ Moya ä¸€æ ·å°†å¤šä¸ªæ¥å£å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä»»ä½•äººæ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå°±èƒ½ç«‹åˆ»äº†è§£æ¨¡å—ä¸­æœ‰å“ªäº›å¯ç”¨çš„ APIã€‚ é«˜å†…èšæ€§ï¼šæ‚¨ä¸ç”¨å†é€šè¿‡å¤šæ¬¡è·³è½¬ï¼Œæ‰èƒ½è·å–åˆ°ä¸€ä¸ªæ¥å£çš„å…¨éƒ¨ä¿¡æ¯ï¼Œæ‰€æœ‰ä¿¡æ¯éƒ½å®šä¹‰åœ¨ä¸€èµ·ã€‚ æ˜“äºç»´æŠ¤ï¼šä¿®æ”¹ã€æ·»åŠ æˆ–åºŸå¼ƒä¸€ä¸ª APIï¼Œéƒ½åªéœ€è¦åœ¨è¿™ä¸ªâ€œåœ°å€ç°¿â€ä¸­è¿›è¡Œï¼Œè€Œä¸éœ€è¦æ·±å…¥åˆ°ä¸šåŠ¡é€»è¾‘ä¸­å»å¯»æ‰¾é‚£äº›é›¶æ•£çš„ URL å­—ç¬¦ä¸²ã€‚ å¤©ç„¶è§£è€¦ï¼š@GET å’Œ @POST çš„å®šä¹‰ï¼ŒåªåŒ…å«äº† API çš„å…ƒä¿¡æ¯ã€‚å®ƒæœ¬èº«å¹¶ä¸å…³å¿ƒç½‘ç»œè¯·æ±‚æ˜¯å¦‚ä½•å‘å‡ºçš„ã€‚åº•å±‚çš„å®ç°è¢« RaAPIWrapper çš„æ‰§è¡Œå±‚æ‰€å°è£…ï¼Œè¿™ä¸ºåç»­æ›¿æ¢ç½‘ç»œåº“æˆ–å¢åŠ ç»Ÿä¸€çš„è¯·æ±‚å¤„ç†é€»è¾‘ï¼ˆå¦‚åŠ å¯†ã€åŠ ç­¾ï¼‰æä¾›äº†æå¤§çš„ä¾¿åˆ©ã€‚ æ ¸å¿ƒè®¾è®¡ï¼šä¸€ä¸ªå£°æ˜å¼çš„ API å®šä¹‰ åœ¨ç¡®ç«‹äº†â€œå£°æ˜å¼ã€é«˜å†…èšä½è€¦åˆâ€è¿™äº›æ ¸å¿ƒè®¾è®¡ç†å¿µä¹‹åï¼Œæˆ‘éœ€è¦å¯»æ‰¾ä¸€äº›è¶³å¤Ÿå¼ºå¤§çš„æŠ€æœ¯æ‰‹æ®µæ¥æ”¯æ’‘å®ƒã€‚@propertyWrapper å±æ€§åŒ…è£…å™¨ä¸ Swift çš„æ³›å‹ç³»ç»Ÿæ­£æ˜¯å®ç°è¿™äº›ç†å¿µçš„æœ€ä½³æ–¹æ¡ˆã€‚ æœ€åˆæˆ‘ä½¿ç”¨æ³›å‹ï¼Œåªæ˜¯æƒ³æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥é¿å… switch è¯­å¥å’Œå¢å¼ºä»£ç çš„æ‰©å±•æ€§ï¼Œä½†æœ€ç»ˆçš„æˆæœå´æ„å¤–åœ°ä¸â€œç±»å‹å³çŠ¶æ€â€æ€æƒ³ç›¸å¥‘åˆã€‚è¿™å¯¹æˆ‘æ¥è¯´ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåœ¨å®è·µä¸­å­¦ä¹ å’Œå‘ç°çš„è¿‡ç¨‹ã€‚ @propertyWrapper å±æ€§åŒ…è£…å™¨ @GETã€@POST æ˜¯åŸºäºä¸€ä¸ªåä¸º API çš„é€šç”¨å±æ€§åŒ…è£…å™¨ï¼ˆ@propertyWrapperï¼‰æ„å»ºçš„ã€‚ æˆ‘ä»¬ä»¥ @POST ä¸ºä¾‹ï¼Œå®ƒçš„å®šä¹‰éå¸¸ç®€å•ï¼Œåªæ˜¯ä¸€ä¸ªç±»å‹åˆ«åï¼ˆtypealiasï¼‰ï¼š // file: Sources/Core/Wrapper/HTTPMethod/POST.swift public enum PostHTTPMethod: APIHTTPMethodWrapper { public static var httpMethod: APIHTTPMethod { &quot;POST&quot; } } /// Encapsulates the data needed to request the `POST` api. public typealias POST&lt;Parameter&gt; = API&lt;Parameter, PostHTTPMethod&gt; çœŸæ­£çš„æ ¸å¿ƒåœ¨äº API è¿™ä¸ªç±»ã€‚å®ƒæ˜¯ä¸€ä¸ªæ³›å‹å±æ€§åŒ…è£…å™¨ï¼Œæ¥å—ä¸¤ä¸ªç±»å‹å‚æ•°ï¼šParameter ä»£è¡¨ API çš„å‚æ•°ç±»å‹ï¼ŒHTTPMethod åˆ™æ˜¯ä¸€ä¸ªéµå¾ª APIHTTPMethodWrapper åè®®çš„ç±»å‹ï¼Œç”¨äºæä¾›å…·ä½“çš„ HTTP è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ &quot;POST&quot;ï¼‰ã€‚ // file: Sources/Core/Wrapper/API.swift @propertyWrapper public class API&lt;Parameter, HTTPMethod: APIHTTPMethodWrapper&gt; { public var wrappedValue: APIParameterBuilder&lt;Parameter&gt;? public let path: String // ... other properties public init( wrappedValue: APIParameterBuilder&lt;Parameter&gt;?, _ path: String, // ... other parameters ) { self.wrappedValue = wrappedValue self.path = path // ... } public var projectedValue: API&lt;Parameter, HTTPMethod&gt; { self } } @propertyWrapper çš„è®¾è®¡è¦ç‚¹åœ¨äºï¼š åˆå§‹åŒ–æ—¶æ•è·ä¿¡æ¯ï¼šå½“æˆ‘ä»¬å†™ä¸‹ @POST(&quot;/post&quot;) æ—¶ï¼ŒSwift ç¼–è¯‘å™¨ä¼šè°ƒç”¨ API çš„ init(wrappedValue:_:) æ–¹æ³•ã€‚è·¯å¾„ &quot;/post&quot; ä½œä¸ºå‚æ•°è¢«ä¼ å…¥ï¼Œå¹¶ä¿å­˜åœ¨ path å±æ€§ä¸­ã€‚wrappedValue åˆ™æ˜¯æˆ‘ä»¬èµ‹ç»™é™æ€å˜é‡çš„ APIParameterBuilder å®ä¾‹ï¼Œå®ƒåŒ…å«äº†å‚æ•°çš„æ„å»ºé€»è¾‘ã€‚ åˆ†ç¦»â€œå®šä¹‰â€ä¸â€œæ‰§è¡Œâ€ï¼šAPI åŒ…è£…å™¨é€šè¿‡ projectedValue æš´éœ²äº†è‡ªèº«ã€‚è¿™æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ $ ç¬¦å·ï¼ˆå¦‚ BasicAPI.$postWithModelï¼‰æ—¶ï¼Œæˆ‘ä»¬è·å–åˆ°çš„æ˜¯ API è¿™ä¸ªåŒ…è£…å™¨å¯¹è±¡æœ¬èº«ã€‚è¿™ä¸ªå¯¹è±¡å·²ç»åŒ…å«äº†æ„å»ºä¸€ä¸ªå®Œæ•´è¯·æ±‚æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼šè·¯å¾„ã€HTTP æ–¹æ³•ã€ä»¥åŠå‚æ•°æ„å»ºå™¨ã€‚è¿™å°±å®ç°äº† API â€œå®šä¹‰â€ä¸â€œæ‰§è¡Œâ€çš„åˆ†ç¦»â€”â€”å®šä¹‰æ—¶åªå…³å¿ƒå…ƒæ•°æ®ï¼Œæ‰§è¡Œæ—¶é€šè¿‡ $ è·å–åˆ°ä¸€ä¸ªå¯æ‰§è¡Œçš„è¯·æ±‚å¯¹è±¡ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ@propertyWrapper ä¸ä»…æä¾›äº†å£°æ˜å¼çš„è¯­æ³•ï¼Œæ›´åœ¨åº•å±‚å®Œæˆäº†ä¿¡æ¯çš„èšåˆä¸å°è£…ï¼Œæ˜¯å®ç° API é«˜å†…èšè®¾è®¡çš„å…³é”®ã€‚ â€œç±»å‹é©±åŠ¨â€æ€æƒ³ å¦‚æœè¯´ @propertyWrapper æä¾›äº†éª¨æ¶ï¼Œé‚£ä¹ˆæ³›å‹ç³»ç»Ÿåˆ™ä¸ºè¿™ä¸ªéª¨æ¶æä¾›äº†æ ¸å¿ƒçš„ç±»å‹å®‰å…¨ä¿éšœã€‚å¦‚ä»Šå›é¡¾ï¼Œæˆ‘æ‰æ„è¯†åˆ°è¿™ä¸ªä¸ºè§£å†³æ‰©å±•æ€§é—®é¢˜è€Œé€‰æ‹©çš„æ–¹æ¡ˆï¼Œå…¶æœ¬è´¨æ°å¥½å°±æ˜¯â€œç±»å‹å³çŠ¶æ€â€æ€æƒ³çš„ä½“ç°ï¼Œå¹¶ä¸”è¿™ä¸€æ€æƒ³åŒæ—¶è¿ç”¨åœ¨äº† API çš„ä¸¤ä¸ªæ³›å‹å‚æ•° HTTPMethod å’Œ Parameter ä¹‹ä¸Šã€‚ æˆ‘ä»¬å†æ¬¡å®¡è§† API çš„å®šä¹‰ï¼šAPI&lt;Parameter, HTTPMethod: APIHTTPMethodWrapper&gt;ã€‚ é¦–å…ˆï¼ŒHTTPMethod å‚æ•°æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼ˆå¦‚ &quot;POST&quot;ï¼‰ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»å‹ã€‚ä¾‹å¦‚ PostHTTPMethod è¿™ä¸ªç±»å‹ï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨å°±æ˜¯é€šè¿‡éµå¾ª APIHTTPMethodWrapper åè®®æ¥æºå¸¦ &quot;POST&quot; è¿™ä¸ªå­—ç¬¦ä¸²ã€‚é€šè¿‡ typealias POST&lt;P&gt; = API&lt;P, PostHTTPMethod&gt;ï¼Œæˆ‘ä»¬å°† POST è¿™ä¸ªåˆ«åä¸ PostHTTPMethod è¿™ä¸ªâ€œçŠ¶æ€ç±»å‹â€æ°¸ä¹…ç»‘å®šã€‚è¿™æ ·ï¼Œè¯·æ±‚æ–¹æ³•å°±åœ¨ç±»å‹å±‚é¢è¢«å›ºå®šä¸‹æ¥ï¼Œæœç»äº†ä¼ å…¥é”™è¯¯å­—ç¬¦ä¸²çš„å¯èƒ½æ€§ã€‚æ­¤å¤–è¿™ç§å†™æ³•è¿˜æœ‰å¾ˆå¤šå¥½å¤„ï¼š åˆ©äºæ‰©å±•ï¼Œå¯ä»¥å¾ˆç®€å•çš„å®šä¹‰å¤šä¸ª HTTP Methodã€‚ é€šè¿‡ extension + where PostHTTPMethod = ...ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„ HTTP Method å®šä¹‰ä¸åŒçš„è¯·æ±‚æ–¹æ³•ã€‚æ¯”å¦‚ä¸šåŠ¡å±‚é¢è§„å®š GET è¯·æ±‚ä¸å…è®¸æºå¸¦å‚æ•°ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®šä¹‰ä¸å¸¦å‚æ•°çš„ request() æ–¹æ³•ã€‚ åœ¨ä¸šåŠ¡å±‚éœ€è¦è·å–åˆ° HTTP Method æ—¶ï¼Œå¯ä»¥é¿å… switch caseã€‚ å…¶æ¬¡ï¼ŒParameter å‚æ•°ä»¥ä¸€ç§æ›´åŠ¨æ€çš„æ–¹å¼åº”ç”¨äº†åŒæ ·çš„æ€æƒ³ã€‚è§‚å¯Ÿ API çš„å®šä¹‰ï¼š // API with no parameters @GET(&quot;/api/v1/no_param&quot;) static var noParamAPI: APIParameterBuilder&lt;()&gt;? = nil // API with parameters @POST(&quot;/api/v1/tuple_param&quot;) static var tupleParamAPI: APIParameterBuilder&lt;(id: Int, name: String?)&gt;? = .init { ... } æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ @GET æˆ– @POST ä¸­æ˜¾å¼æŒ‡å®š Parameter çš„ç±»å‹ã€‚è¿™é‡Œçš„æœºåˆ¶æ˜¯ Swift çš„ç±»å‹æ¨æ–­ã€‚ å½“æˆ‘ä»¬å£°æ˜ static var noParamAPI: APIParameterBuilder&lt;()&gt;? æ—¶ï¼ŒSwift ç¼–è¯‘å™¨ä¼šåˆ†æå˜é‡çš„ç±»å‹ã€‚å®ƒçœ‹åˆ° APIParameterBuilder&lt;()&gt;ï¼Œä¾¿ä¼šæ¨æ–­å‡º API åŒ…è£…å™¨çš„ Parameter æ³›å‹å‚æ•°å°±æ˜¯ ()ï¼ˆå³ Voidï¼‰ã€‚ åŒç†ï¼Œå½“å£°æ˜ tupleParamAPI çš„ç±»å‹ä¸º APIParameterBuilder&lt;(id: Int, name: String?)&gt;? æ—¶ï¼Œç¼–è¯‘å™¨å°±ç¡®åˆ‡åœ°çŸ¥é“ï¼Œè¿™ä¸ª API çš„å‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªå…ƒç»„ (id: Int, name: String?)ã€‚ è¿™ç§è®¾è®¡å¸¦æ¥äº†æ˜¾è‘—çš„ä¼˜åŠ¿ï¼š API åˆçº¦åŒ–ï¼šAPI çš„å‚æ•°ç±»å‹ï¼ˆå®ƒçš„â€œçŠ¶æ€â€ï¼‰è¢«å›ºåŒ–åœ¨äº†å®šä¹‰ä¸­ï¼Œæˆä¸ºä¸€ä¸ªä¸å¯æ”¹å˜çš„â€œåˆçº¦â€ã€‚ ç¼–è¯‘æœŸå®‰å…¨ï¼šå½“ä½ è°ƒç”¨ API æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå¼ºåˆ¶æ‰§è¡Œè¿™ä»½åˆçº¦ã€‚ å¯¹äº $noParamAPIï¼Œè°ƒç”¨ request() æ–¹æ³•æ—¶å¦‚æœè¯•å›¾ä¼ å…¥å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ã€‚ å¯¹äº $tupleParamAPIï¼Œè°ƒç”¨ request(with:) æ–¹æ³•æ—¶ï¼Œä½ å¿…é¡»ä¼ å…¥ä¸€ä¸ª (id: Int, name: String?) ç±»å‹çš„å…ƒç»„ï¼Œå‚æ•°åã€ç±»å‹ã€æ•°é‡ã€å¯é€‰æ€§ç¨æœ‰å·®æ± ï¼Œéƒ½æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ è¿™ä¸ä¼ ç»Ÿ Moya ä¸­ä½¿ç”¨ [String: Any] ä½œä¸ºå‚æ•°çš„æ–¹å¼å½¢æˆäº†é²œæ˜å¯¹æ¯”ã€‚å­—å…¸æ˜¯ç±»å‹ä¸å®‰å…¨çš„ï¼Œå¼€å‘è€…å¾ˆå®¹æ˜“åœ¨è¿è¡Œæ—¶å› ä¸ºæ‹¼é”™ keyã€ä¼ é”™ value ç±»å‹è€Œå¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚è€Œ RaAPIWrapper å°†è¿™ç§æ½œåœ¨çš„è¿è¡Œæ—¶é”™è¯¯æå‰åˆ°äº†ç¼–è¯‘æœŸï¼Œè¿™æ­£æ˜¯è¯¥è®¾è®¡çš„å…³é”®ä¼˜åŠ¿ä¹‹ä¸€ã€‚ æœ€åï¼ŒAPIParameterBuilder&lt;Input&gt; æ‰®æ¼”äº†ç±»å‹è½¬æ¢çš„è§’è‰²ã€‚å®ƒæ¥æ”¶å¼ºç±»å‹çš„ Inputï¼ˆå³ Parameterï¼‰ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªé—­åŒ…ï¼Œå°†å…¶è½¬æ¢ä¸ºç½‘ç»œå±‚æ‰€éœ€çš„ã€ç»è¿‡ç±»å‹æ“¦é™¤çš„ any APIParameter æ ¼å¼ã€‚è¿™ä½¿å¾— API çš„å®šä¹‰å¯ä»¥ä¿æŒç±»å‹çº¯å‡€ï¼Œè€Œå°†å‚æ•°æ„å»ºçš„ç»†èŠ‚å°è£…åœ¨äº†æ„å»ºå™¨å†…éƒ¨ã€‚ å›é¡¾ä¸å±•æœ› è®¾è®¡çš„å¾—ä¸å¤± é€šè¿‡ç»„åˆè¿ç”¨ @propertyWrapper çš„å£°æ˜å¼è¯­æ³•å’Œä»¥æ³›å‹ä¸ºæ ¸å¿ƒçš„ç±»å‹ç³»ç»Ÿï¼ŒRaAPIWrapper æˆåŠŸåœ°å°† API å®šä¹‰ä»åˆ†æ•£ã€æ˜“é”™çš„å­—ç¬¦ä¸²å’Œå­—å…¸ï¼Œè½¬å˜æˆäº†é›†ä¸­çš„ã€ç±»å‹å®‰å…¨çš„ API â€œåœ°å€ç°¿â€ã€‚è¿™ä¸ªä»¥æå‡ä»£ç å†…èšæ€§å’Œå¯ç»´æŠ¤æ€§ä¸ºç›®æ ‡çš„å°è¯•ï¼Œæœ€ç»ˆæ”¶è·äº†ç¼–è¯‘æœŸå®‰å…¨è¿™ä¸€å…³é”®ä¼˜åŠ¿ã€‚ ä¸è¿‡ï¼Œæ­£å¦‚ä¸€äº›æ‰¹åˆ¤æ€§å£°éŸ³æŒ‡å‡ºçš„ï¼Œä»»ä½•ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ Swift å¼ºç±»å‹ APIï¼Œéƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šåˆ©ç”¨äº†â€œç±»å‹å³çŠ¶æ€â€ã€‚RaAPIWrapper çš„åˆ›æ–°æ›´å¤šåœ¨äºå…¶è¯­æ³•å’Œæ¨¡å¼ï¼Œè€Œéæ€æƒ³æœ¬èº«ã€‚å¹¶ä¸”è¿™ç§â€œäº‹åè¯¸è‘›äº®â€çš„å›é¡¾ä¹Ÿè®©æˆ‘æ„è¯†åˆ°åœ¨æŠ€æœ¯æ–¹é¢æˆ‘è¿˜å·®çš„å¾ˆè¿œï¼Œè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚ æ¸…æ™°çš„å®šä½ï¼šAPI å®šä¹‰å±‚ æ›´é‡è¦çš„æ˜¯ï¼Œå¿…é¡»æ˜ç¡® RaAPIWrapper çš„å®šä½æ˜¯ä¸€ä¸ª API å®šä¹‰çš„åŒ…è£…å±‚ï¼ˆWrapperï¼‰ï¼Œè€Œéä¸€ä¸ªå¤§è€Œå…¨çš„ç½‘ç»œè¯·æ±‚æ¡†æ¶ã€‚ è¿™ä¸€å®šä½æ„å‘³ç€å®ƒåˆ»æ„åœ°ä¿æŒäº†èŒè´£çš„å•ä¸€ã€‚å®ƒåªåšä¸€ä»¶äº‹ï¼šä»¥ç±»å‹å®‰å…¨å’Œé«˜å†…èšçš„æ–¹å¼ï¼Œæ„å»ºå‡ºä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚å…ƒæ•°æ®ã€‚è‡³äºè¿™ä¸ªå…ƒæ•°æ®å¦‚ä½•è¢«æ‰§è¡Œã€å¦‚ä½•å¤„ç†å›è°ƒã€å¦‚ä½•å®ç°æ’ä»¶ã€å¦‚ä½•ç®¡ç†é€šç”¨è¯·æ±‚å¤´ç­‰é—®é¢˜ï¼Œåˆ™å®Œå…¨äº¤ç”±å…¶èƒŒåçš„æ‰§è¡Œå±‚æ¥å¤„ç†ã€‚ è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»çš„è®¾è®¡ï¼Œæ°å¥½å›ç­”äº†â€œä¸ºä½•ä¸ç›´æ¥ç”¨ Moyaâ€çš„é—®é¢˜ï¼š æ‚¨å¯ä»¥ç»§ç»­ä½¿ç”¨ Moyaï¼šMoya å°±æ˜¯ä¸€ä¸ªéå¸¸å‡ºè‰²çš„æ‰§è¡Œå±‚ã€‚å¼€å‘è€…å®Œå…¨å¯ä»¥å°† RaAPIWrapper ä½œä¸º API â€œåˆçº¦â€å±‚ï¼Œå°†ç”Ÿæˆçš„è¯·æ±‚æ•°æ®ä¼ é€’ç»™ Moya Providerï¼Œç»§ç»­äº«å— Moya å¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿå’Œè¯·æ±‚ç®¡ç†èƒ½åŠ›ã€‚ æ‹¥æŠ±å˜åŒ–ï¼šå¦‚æœæœªæ¥å›¢é˜Ÿå¸Œæœ›ä» Moya è¿ç§»åˆ° URLSessionï¼Œæˆ–å…¶å®ƒæ–°çš„ç½‘ç»œåº“ï¼Œæ‚¨åªéœ€è¦æ›´æ¢æ‰§è¡Œå±‚çš„å®ç°ï¼Œè€Œæ‰€æœ‰ç”¨ RaAPIWrapper å®šä¹‰çš„ API ä»£ç éƒ½æ— éœ€æ”¹åŠ¨ã€‚ æœªæ¥è§„åˆ’ ç›®å‰ï¼ŒRaAPIWrapper å°šä¸è‡ªå¸¦æ‰§è¡Œå±‚ï¼Œä¹Ÿæœªé›†æˆæ’ä»¶ç³»ç»Ÿã€‚æœªæ¥çš„è§„åˆ’æ˜¯æä¾›ä¸€ä¸ªåŸºäº Alamofire çš„å®˜æ–¹é»˜è®¤æ‰§è¡Œå±‚ï¼Œå¹¶é€æ­¥å®Œå–„å…¶åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ›´åŠ å¼€ç®±å³ç”¨çš„ç½‘ç»œè§£å†³æ–¹æ¡ˆã€‚ ","link":"https://blog.rakuyo.dev/RaAPIWrapper/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard","content":"åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„ç»“å°¾ï¼Œæˆ‘ä»¬æ¢è®¨äº†å¤šç§å†…ç½‘ç©¿é€æŠ€æœ¯ï¼Œå¹¶åˆæ­¥ä»‹ç»äº† WireGuard ä½œä¸ºä¸€ç§ç°ä»£åŒ– VPN è§£å†³æ–¹æ¡ˆçš„ä¼˜åŠ¿ã€‚å…¶å®åœ¨æ›´æ—©ä¹‹å‰ï¼Œæˆ‘ä»¬å°±äº²æ‰‹ç¼–è¯‘è¿‡ WireGuard åœ¨ iOS ç«¯çš„ SDKï¼Œä¹Ÿä½¿ç”¨ WireGuard å®ç°è¿‡ç¾¤æ™– NAS çš„å…¬ç½‘è®¿é—®ã€‚ æœ¬æ–‡å°†ä»¥ macOS ç¯å¢ƒä¸ºåŸºç¡€ï¼Œæ·±å…¥ WireGuard å†…éƒ¨ï¼Œä»å†…æ ¸äº¤äº’çš„åº•å±‚ç»†èŠ‚å‡ºå‘ï¼Œè§£æ„è™šæ‹Ÿç½‘å¡çš„å®ç°æœºåˆ¶ï¼Œå¹¶è¯¦ç»†å‰–æå…¶å¯†ç å­¦å’Œè·¯ç”±è®¾è®¡ã€‚ æœ¬ç³»åˆ—å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹ è™šæ‹Ÿç½‘å¡ï¼šç”¨æˆ·ç©ºé—´ä¸å†…æ ¸çš„å¥‘çº¦ è¦ç†è§£ WireGuard çš„å·¥ä½œåŸç†ï¼Œé¦–å…ˆéœ€è¦è§£å†³ä¸€ä¸ªæ ¹æœ¬æ€§é—®é¢˜ï¼šåƒ WireGuard è¿™æ ·çš„æ™®é€šåº”ç”¨ç¨‹åºï¼Œæ˜¯è¿è¡Œåœ¨æ“ä½œç³»ç»Ÿçš„â€œç”¨æˆ·ç©ºé—´â€çš„ï¼Œè€Œç½‘ç»œæ•°æ®åŒ…çš„æ”¶å‘ã€è·¯ç”±é€‰æ‹©ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œéƒ½ç”±æ“ä½œç³»ç»Ÿçš„â€œå†…æ ¸ç©ºé—´â€ç‰¢ç‰¢æŒæ§ã€‚é‚£ä¹ˆï¼Œä¸€ä¸ªç”¨æˆ·ç©ºé—´çš„ç¨‹åºï¼Œæ˜¯å¦‚ä½•èƒ½â€œæ‹¦æˆªâ€å¹¶â€œå¤„ç†â€æœ¬åº”ç”±å†…æ ¸ç›´æ¥å‘é€åˆ°ç‰©ç†ç¡¬ä»¶çš„IPæ•°æ®åŒ…å‘¢ï¼Ÿ ç­”æ¡ˆå°±æ˜¯è™šæ‹Ÿç½‘å¡ (Virtual Network Interface)ï¼Œå®ƒæ˜¯ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´åœ¨ç½‘ç»œå±‚é¢è¾¾æˆçš„ä¸€ç§â€œå¥‘çº¦â€ã€‚è¿™ä¸ªæ ¸å¿ƒæ€æƒ³åœ¨ä¸åŒæ“ä½œç³»ç»Ÿä¸Šæ˜¯å…±é€šçš„ï¼Œä½†å…·ä½“å®ç°æœ‰æ‰€å·®å¼‚ã€‚ å†…æ ¸çš„â€œå§”æ‰˜â€ï¼šutun æ¥å£ åœ¨ macOS ä¸Šï¼Œå¥‘çº¦çš„å®ç°è€…æ˜¯ utun è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚ä¸ Linux ä¸‹æœ‰æ˜ç¡®è®¾å¤‡æ–‡ä»¶è·¯å¾„çš„ tun è®¾å¤‡ä¸åŒï¼Œutun æ¥å£æ˜¯ç”±ç¨‹åºåœ¨è¿è¡Œæ—¶é€šè¿‡å‘å†…æ ¸å‘å‡ºç‰¹å®šè¯·æ±‚æ¥åŠ¨æ€åˆ›å»ºçš„ã€‚WireGuard è¿™æ ·çš„åº”ç”¨ä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œè¯·æ±‚å†…æ ¸åˆ›å»ºä¸€ä¸ª utun ç±»å‹çš„ç½‘ç»œæ¥å£ï¼Œå¹¶è·å¾—ä¸€ä¸ªç”¨äºä¸å…¶é€šä¿¡çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼‰ã€‚ è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå°±æ˜¯è¿™ä»½â€œå¥‘çº¦â€çš„å®ä½“ã€‚å®ƒå¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå°±åƒä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶å¥æŸ„ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œ read() å’Œ write() æ“ä½œã€‚ä½†å®ƒçš„å¦ä¸€ç«¯ï¼Œè¿æ¥çš„å´æ˜¯å†…æ ¸ç½‘ç»œåè®®æ ˆä¸­ä¸€ä¸ªæ–°åˆ›å»ºçš„ã€åŠŸèƒ½å®Œæ•´çš„è™šæ‹Ÿç½‘ç»œæ¥å£ï¼ˆä¾‹å¦‚ utun0 æˆ– wg0ï¼‰ã€‚ å½“è¿™ä¸ªæ¥å£è¢« ifconfig å‘½ä»¤æ¿€æ´»å¹¶åˆ†é…äº†IPåœ°å€ï¼ˆå¦‚ 10.8.0.1ï¼‰åï¼Œå®ƒå°±ä¼šå‡ºç°åœ¨ ifconfig çš„è¾“å‡ºä¸­ï¼Œå¯¹äºå†…æ ¸çš„è·¯ç”±ã€é˜²ç«å¢™ç­‰å­ç³»ç»Ÿæ¥è¯´ï¼Œå®ƒä¸ä¸€å¼ çœŸå®çš„ç‰©ç†ç½‘å¡å¹¶æ— äºŒè‡´ã€‚ ä¸‹é¢æ˜¯è¿™ä¸ªè¿‡ç¨‹çš„ä¼ªä»£ç è¡¨ç¤ºï¼Œå®ƒè¢« WireGuard å®¢æˆ·ç«¯åœ¨åå°è‡ªåŠ¨å¤„ç†äº†ï¼š // 1. å‘å†…æ ¸è¯·æ±‚åˆ›å»ºè™šæ‹Ÿæ¥å£ï¼Œè·å–æ–‡ä»¶æè¿°ç¬¦ int vpn_fd = request_virtual_interface(&quot;wg0&quot;); // 2. ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ä¸ºæ¥å£é…ç½®IPåœ°å€å¹¶æ¿€æ´» system(&quot;ifconfig wg0 inet 10.8.0.1/24 up&quot;); // 3. è¿›å…¥ä¸»å¾ªç¯ï¼Œåƒè¯»å†™æ–‡ä»¶ä¸€æ ·å¤„ç†ç½‘ç»œåŒ… while(1) { // ä»å†…æ ¸çš„ wg0 æ¥å£è¯»å–ä¸€ä¸ªIPåŒ… int nread = read(vpn_fd, packet_buffer, sizeof(packet_buffer)); // ... å¯¹ packet_buffer è¿›è¡ŒåŠ å¯†å¤„ç† ... // é€šè¿‡ç‰©ç†ç½‘å¡çš„UDP socketå‘é€å‡ºå» sendto(udp_socket, encrypted_packet, ...); } æ•°æ®åŒ…çš„â€œå¥‘çº¦â€å±¥è¡Œè¿‡ç¨‹ è¿™ä»½å¥‘çº¦çš„å±¥è¡Œè¿‡ç¨‹ï¼Œå³æ•°æ®åŒ…çš„æµè½¬ï¼Œæ˜¯ç†è§£ä¸€åˆ‡çš„å…³é”®ï¼š ä¸‹è¡Œï¼ˆå‘é€æ•°æ®ï¼‰ï¼š ä¸€ä¸ªä¸Šå±‚åº”ç”¨ï¼ˆå¦‚æµè§ˆå™¨ï¼‰è¯•å›¾è®¿é—® 10.8.0.2ã€‚ å†…æ ¸æ ¹æ®å…¶ä¸»è·¯ç”±è¡¨ï¼ˆå¯é€šè¿‡ netstat -nr æŸ¥çœ‹ï¼‰ï¼Œå‘ç°ç›®æ ‡åœ°å€ 10.8.0.2 åŒ¹é… 10.8.0.0/24 dev utun0 è¿™æ¡è§„åˆ™ï¼ˆè¿™æ¡è§„åˆ™é€šå¸¸ç”± wg-quick è„šæœ¬è‡ªåŠ¨æ·»åŠ ï¼‰ã€‚ å†…æ ¸å°†è¿™ä¸ªåŸå§‹çš„ã€æœªç»ä»»ä½•ä¿®æ”¹çš„IPæ•°æ®åŒ…ï¼Œä½œä¸ºä¸€ä¸ªå­—èŠ‚æµï¼Œâ€œå†™å…¥â€ åˆ°ä¸ utun0 å…³è”çš„é‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸­ã€‚ WireGuard è¿›ç¨‹ä¸€ç›´åœ¨ç”¨æˆ·ç©ºé—´é€šè¿‡ read() ç³»ç»Ÿè°ƒç”¨é˜»å¡å¼åœ°è¯»å–è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚ä¸€æ—¦å†…æ ¸å†™å…¥æ•°æ®ï¼ŒWireGuard è¿›ç¨‹å°±ä¼šè¢«å”¤é†’ï¼Œå¹¶è¯»å‡ºå®Œæ•´çš„IPæ•°æ®åŒ…ã€‚ ä¸Šè¡Œï¼ˆæ¥æ”¶æ•°æ®ï¼‰ï¼š WireGuard è¿›ç¨‹é€šè¿‡ç‰©ç†ç½‘å¡æ”¶åˆ°äº†ä¸€ä¸ªæ¥è‡ªå¯¹ç«¯çš„ã€åŠ å¯†çš„UDPåŒ…ã€‚ åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆè§£å¯†ï¼Œè¿˜åŸå‡ºåŸå§‹çš„IPæ•°æ®åŒ…ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªä» 10.8.0.2 å‘å¾€ 10.8.0.1 çš„ICMPå“åº”åŒ…ï¼‰ã€‚ WireGuard è¿›ç¨‹å°†è¿™ä¸ªåŸå§‹IPæ•°æ®åŒ…çš„å­—èŠ‚æµï¼Œé€šè¿‡ write() ç³»ç»Ÿè°ƒç”¨ â€œå†™å…¥â€ åˆ°å®ƒæŒæœ‰çš„æ–‡ä»¶æè¿°ç¬¦ä¸­ã€‚ æ•°æ®è¢«å†™å…¥åï¼Œä¼šç«‹åˆ»å‡ºç°åœ¨å†…æ ¸ç©ºé—´çš„ utun0 æ¥å£ä¸Šï¼Œä»¿ä½›å®ƒåˆšä»å¤–éƒ¨ç½‘ç»œåˆ°è¾¾ã€‚éšåï¼Œå†…æ ¸çš„ç½‘ç»œåè®®æ ˆä¼šæ¥ç®¡å®ƒï¼Œè¿›è¡Œåç»­çš„è·¯ç”±ã€åˆ†å‘ç»™ä¸Šå±‚åº”ç”¨ç­‰æ“ä½œã€‚ ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£æ•°æ®åŒ…åœ¨ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ä¹‹é—´çš„æµè½¬è¿‡ç¨‹ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„åºåˆ—å›¾ï¼š WireGuard çš„è®¾è®¡å“²å­¦ä¸æ ¸å¿ƒæœºåˆ¶ ç†è§£äº†è™šæ‹Ÿç½‘å¡å¦‚ä½•ä½œä¸ºç”¨æˆ·ç©ºé—´ä¸å†…æ ¸çš„æ¡¥æ¢åï¼Œæˆ‘ä»¬å†æ¥æ·±å…¥æ¢è®¨ WireGuard æœ¬èº«çš„è®¾è®¡ã€‚å…¶è®¾è®¡å“²å­¦ä½“ç°åœ¨å…¶æå…¶ç®€æ˜çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡è§£è¯»è¿™ä»½æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±èƒ½æŒæ¡å…¶æ ¸å¿ƒæœºåˆ¶ã€‚ WireGuard æœ¬è´¨ä¸Šæ˜¯æ— çŠ¶æ€å’Œæ— è¿æ¥çš„ã€‚å®ƒä¸åƒ TCP æˆ– OpenVPN é‚£æ ·éœ€è¦ç»´æŒä¸€ä¸ªé•¿æœŸçš„ã€æœ‰æ˜ç¡® â€œè¿æ¥/æ–­å¼€â€ çŠ¶æ€çš„ä¼šè¯ã€‚é€šä¿¡åŒæ–¹ä»…é€šè¿‡åŸºäº Noise åè®®æ¡†æ¶çš„æ¡æ‰‹æ¥äº¤æ¢æœ€æ–°çš„ä¼šè¯å¯†é’¥ã€‚å¦‚æœä¸€æ®µæ—¶é—´æ²¡æœ‰æµé‡ï¼ŒåŒæ–¹ä¸ä¼šæœ‰ä»»ä½•é€šä¿¡ã€‚ä¸€æ—¦æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œå®ƒä¼šå°è¯•ä½¿ç”¨ç°æœ‰çš„ä¼šè¯å¯†é’¥ï¼Œå¦‚æœå¯†é’¥å·²è¿‡æœŸï¼Œåˆ™ä¼šé™é»˜åœ°å‘èµ·ä¸€æ¬¡æ–°çš„æ¡æ‰‹ã€‚è¿™ç§è®¾è®¡å¯¹ç§»åŠ¨è®¾å¤‡å’Œä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒæä¸ºå‹å¥½ã€‚ ä¸€ä¸ªå…¸å‹çš„ WireGuard é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ wg0.confï¼‰ç”±è‹¥å¹²ä¸ªâ€œå—ï¼ˆsectionï¼‰â€ç»„æˆï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯ [Interface] å—å’Œ [Peer] å—ã€‚ [Interface] å—ï¼šå®šä¹‰éš§é“ç«¯ç‚¹ [Interface] å—ç”¨äºé…ç½®éš§é“çš„â€œæœ¬åœ°â€è¿™ä¸€ç«¯ï¼Œä¹Ÿå°±æ˜¯ä½ æ­£åœ¨é…ç½®çš„è¿™å°æœºå™¨ä¸Šçš„ wg0 è™šæ‹Ÿç½‘å¡ã€‚ [Interface] # æœ¬æœºçš„ç§é’¥ PrivateKey = [ç§é’¥å†…å®¹] # æœ¬æœºåœ¨ VPN ç½‘ç»œä¸­çš„å†…ç½‘ IP åœ°å€ Address = 10.8.0.1/24 # ç›‘å¬çš„ UDP ç«¯å£ ListenPort = 51820 PrivateKeyï¼šä¸€æ®µ Base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œæ˜¯è¯¥æ¥å£çš„ç§é’¥ã€‚è¿™æ˜¯æ¥å£çš„å”¯ä¸€èº«ä»½å‡­è¯ï¼Œç»ä¸èƒ½æ³„éœ²ã€‚ä¸ä¹‹é…å¯¹çš„å…¬é’¥ï¼ˆç”±ç§é’¥ç”Ÿæˆï¼‰å°†åˆ†å‘ç»™å…¶ä»–å¯¹ç«¯ï¼ˆPeerï¼‰ã€‚ Addressï¼šåˆ†é…ç»™è¯¥æ¥å£çš„è™šæ‹Ÿ IP åœ°å€ã€‚è¯·æ³¨æ„ï¼Œè¿™æ˜¯åœ¨ WireGuard æ„å»ºçš„è™šæ‹Ÿç½‘ç»œå†…éƒ¨çš„åœ°å€ï¼Œè€Œéæœºå™¨çš„ç‰©ç† IPã€‚æˆ‘ä»¬åœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€Šè®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ã€‹ä¸­å·²ç»è¯¦ç»†è®¨è®ºè¿‡ IP åœ°å€çš„æ¦‚å¿µã€‚ ListenPortï¼šæŒ‡å®š WireGuard åœ¨å“ªä¸ªç‰©ç†ç½‘ç»œç«¯å£ä¸Šç›‘å¬æ¥è‡ªå…¶ä»–å¯¹ç«¯çš„å…¥ç«™è¿æ¥ã€‚è¿™æ˜¯ä¸€ä¸ª UDP ç«¯å£ï¼Œå› ä¸º WireGuard å®Œå…¨åŸºäº UDP åè®®ã€‚åŒæ ·ï¼Œå…³äºç«¯å£çš„æ¦‚å¿µï¼Œæ‚¨ä¹Ÿå¯ä»¥å›é¡¾ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚ [Peer] å—ï¼šå®šä¹‰é€šä¿¡å¯¹ç«¯ [Peer] å—å®šä¹‰äº†è¯¥æ¥å£å¸Œæœ›è¿æ¥çš„ â€œå¯¹ç«¯â€ æˆ– â€œä¼™ä¼´â€ã€‚ä½ å¯ä»¥æœ‰å¤šä¸ª [Peer] å—ï¼Œæ¯ä¸€ä¸ªå—ä»£è¡¨ä¸€ä¸ªä½ å¸Œæœ›ä¸ä¹‹é€šä¿¡çš„èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªä¸­å¿ƒæœåŠ¡å™¨æˆ–å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼‰ã€‚ [Peer] # å¯¹ç«¯çš„å…¬é’¥ PublicKey = [å¯¹ç«¯å…¬é’¥å†…å®¹] # å…è®¸é€šè¿‡è¯¥å¯¹ç«¯è·¯ç”±çš„IPåœ°å€èŒƒå›´ AllowedIPs = 10.8.0.2/32 # å¯¹ç«¯çš„å…¬ç½‘åœ°å€å’Œç«¯å£ï¼ˆä»…å®¢æˆ·ç«¯éœ€è¦ï¼‰ Endpoint = server.public.ip.address:51820 # NAT ç©¿é€å¿ƒè·³åŒ…ï¼ˆä»…å®¢æˆ·ç«¯éœ€è¦ï¼‰ PersistentKeepalive = 25 PublicKeyï¼šå¯¹ç«¯çš„å…¬é’¥ï¼Œä¸å¯¹ç«¯ [Interface] ä¸­ PrivateKey ç›¸å¯¹åº”ã€‚WireGuard ä¾é è¿™å¯¹å¯†é’¥æ¥éªŒè¯å¯¹æ–¹çš„èº«ä»½å¹¶åŠ å¯†æ•°æ®ã€‚ Endpointï¼šå¯¹ç«¯çš„å…¬ç½‘ IP:ç«¯å£ã€‚è¿™æ˜¯ä½ çš„æ¥å£å°†æ•°æ®åŒ…å‘å¾€çš„å®é™…ç½‘ç»œåœ°å€ã€‚é€šå¸¸ï¼Œåªæœ‰éœ€è¦ä¸»åŠ¨å‘èµ·è¿æ¥çš„ä¸€æ–¹ï¼ˆå¦‚å®¢æˆ·ç«¯ï¼‰æ‰éœ€è¦é…ç½®æ­¤é¡¹ã€‚æœåŠ¡å™¨ç«¯å› ä¸ºæ˜¯è¢«åŠ¨ç›‘å¬ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸ºæ¯ä¸ª Peer æŒ‡å®š Endpointã€‚ PersistentKeepaliveï¼šä¸€ä¸ªå¯é€‰çš„ä¾¿æºåŠŸèƒ½ï¼Œç”¨äºç»´æŒ NAT æ˜ å°„ã€‚å®ƒä¼šæ¯éš”æŒ‡å®šç§’æ•°ï¼ˆä¾‹å¦‚25ç§’ï¼‰å‘å¯¹ç«¯å‘é€ä¸€ä¸ªâ€œå¿ƒè·³åŒ…â€ï¼Œè¿™å¯¹äºå¤„äº NAT è®¾å¤‡ï¼ˆå¦‚å®¶ç”¨è·¯ç”±å™¨ï¼‰åé¢çš„å®¢æˆ·ç«¯éå¸¸é‡è¦ï¼Œå¯ä»¥é˜²æ­¢è¿æ¥ä¸­æ–­ã€‚æˆ‘ä»¬åœ¨ç³»åˆ—ç¬¬ä¸‰ç¯‡æ–‡ç« ã€Šè®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ã€‹ä¸­æ¢è®¨è¿‡ NAT çš„å·¥ä½œåŸç†ã€‚ AllowedIPsï¼šè¿™æ˜¯ WireGuard æœ€å…·é©å‘½æ€§çš„è®¾è®¡ï¼Œä¹Ÿæ˜¯å…¶ CryptoKey è·¯ç”±æœºåˆ¶çš„æ ¸å¿ƒã€‚è¿™ä¸ªå‚æ•°åŒæ—¶æ‰¿æ‹…äº†è·¯ç”±å’Œå®‰å…¨ä¸¤é¡¹å…³é”®èŒè´£ï¼š è·¯ç”±åŠŸèƒ½ï¼ˆå‡ºç«™ï¼‰ï¼šå®ƒå‘Šè¯‰æœ¬åœ°çš„ wg0 æ¥å£ï¼šâ€œå½“æœ‰ä¸€ä¸ªIPåŒ…éœ€è¦å‘é€ï¼Œå¦‚æœå®ƒçš„ç›®æ ‡IPåœ°å€å±äº AllowedIPs çš„èŒƒå›´ï¼Œé‚£ä¹ˆå°±åº”è¯¥é€šè¿‡éš§é“ï¼ŒåŠ å¯†åå‘é€ç»™è¿™ä¸ª [Peer]â€ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯é…ç½® AllowedIPs = 0.0.0.0/0 æ„å‘³ç€å°†æ‰€æœ‰å‡ºç«™æµé‡éƒ½è·¯ç”±åˆ°è¿™ä¸ª Peerï¼ˆå³ä¸­å¿ƒæœåŠ¡å™¨ï¼‰ã€‚ å®‰å…¨åŠŸèƒ½ï¼ˆå…¥ç«™ï¼‰ï¼šå®ƒå®šä¹‰äº†ä¸€ä¸ªâ€œç™½åå•â€ã€‚å½“ä»è¿™ä¸ª Peer æ”¶åˆ°ä¸€ä¸ªè§£å¯†åçš„æ•°æ®åŒ…æ—¶ï¼ŒWireGuard ä¼šæ£€æŸ¥å…¶æºIPåœ°å€ã€‚åªæœ‰å½“æºIPåœ°å€å±äº AllowedIPs èŒƒå›´æ—¶ï¼Œè¿™ä¸ªåŒ…æ‰ä¼šè¢«æ¥å—ï¼Œå¦åˆ™å°†è¢«é™é»˜ä¸¢å¼ƒã€‚ è¿™ç§å°†å¯†ç å­¦èº«ä»½ï¼ˆå…¬é’¥ï¼‰ä¸è·¯ç”±ç­–ç•¥ï¼ˆAllowedIPsï¼‰ç´§å¯†ç»‘å®šçš„è®¾è®¡ï¼Œå°±æ˜¯ CryptoKey è·¯ç”±ã€‚å®ƒæå¤§åœ°ç®€åŒ–äº†ä¼ ç»Ÿ VPN å¤æ‚çš„è·¯ç”±è¡¨å’Œé˜²ç«å¢™ç­–ç•¥ï¼Œä½¿å¾—ç½‘ç»œæ‹“æ‰‘å®Œå…¨ç”±å¯†é’¥å’Œ AllowedIPs é™æ€å®šä¹‰ï¼Œæ¸…æ™°ä¸”å®‰å…¨ã€‚å¹¶ä¸”å¦‚æœæ”¶åˆ°ä¸€ä¸ªæ— æ³•è§£å¯†ï¼Œæˆ–è€…è§£å¯†åæºåœ°å€ä¸åŒ¹é…ä»»ä½• Peer çš„ AllowedIPs çš„æ•°æ®åŒ…ï¼ŒWireGuard ä¼šé™é»˜ä¸¢å¼ƒå®ƒã€‚è¿™ä½¿å¾— WireGuard å¯¹ç½‘ç»œæ‰«æå·¥å…·æ¥è¯´æ˜¯â€œéšå½¢â€çš„ã€‚ è®©æˆ‘ä»¬å¯¹ â€œé™é»˜ä¸¢å¼ƒâ€ å’Œ â€œæ‹’ç»â€ åšä¸€ä¸‹æŠ€æœ¯å±‚é¢çš„æ¯”è¾ƒï¼š æ‹’ç»ï¼šå½“æ•°æ®åŒ…å‘å¾€ä¸€ä¸ªå…³é—­çš„ç«¯å£æ—¶ï¼Œæ“ä½œç³»ç»Ÿé€šå¸¸ä¼šå›å¤ä¸€æ¡ ICMP Port Unreachable æ¶ˆæ¯ã€‚è¿™ä¸ªå“åº”æ˜ç¡®åœ°å‘ŠçŸ¥äº†å‘é€æ–¹ï¼šç«¯å£å­˜åœ¨ï¼Œä½†æ˜¯å…³é—­çš„ã€‚ é™é»˜ä¸¢å¼ƒï¼šWireGuard çš„è¡Œä¸ºåˆ™ä¸åŒã€‚å®ƒæ¥æ”¶æ‰€æœ‰å‘åˆ°ç›‘å¬ç«¯å£çš„æ•°æ®åŒ…ï¼Œä½†åªå¤„ç†èƒ½å¤Ÿè¢«æ­£ç¡®è§£å¯†å’ŒéªŒè¯çš„ã€‚å¯¹äºæ‰€æœ‰æ— æ•ˆæ•°æ®åŒ…ï¼Œå®ƒåœ¨å†…éƒ¨ç›´æ¥ä¸¢å¼ƒï¼Œä¸äº§ç”Ÿä»»ä½•å¯¹å¤–å“åº”ã€‚å¯¹äºç½‘ç»œæ‰«æå·¥å…·è€Œè¨€ï¼Œè¿™ç§â€œæ— å“åº”â€çš„çŠ¶æ€ä¸æ•°æ®åŒ…åœ¨ä¼ è¾“é€”ä¸­è¢«é˜²ç«å¢™æ‹¦æˆªæˆ–ç½‘ç»œæ³¢åŠ¨å¯¼è‡´ä¸¢å¤±æ˜¯æ— æ³•åŒºåˆ†çš„ã€‚å› æ­¤ï¼Œæ‰«æå·¥å…·æ— æ³•ç¡®è®¤ç«¯å£çš„çœŸå®çŠ¶æ€ï¼Œä»è€Œå¤§å¤§æå‡äº† WireGuard çš„éšè”½æ€§ã€‚ å¯†ç å­¦åŸºçŸ³ï¼šå›ºå®šçš„ç°ä»£åŠ å¯†å¥—ä»¶ WireGuard åœ¨å®‰å…¨ä¸Šçš„ä¸€ä¸ªæ ¸å¿ƒè®¾è®¡æ˜¯ â€œå›ºæ‰§å·±è§â€ï¼ˆOpinionatedï¼‰ï¼Œè¿™æ­£æ˜¯å…¶å“è¶Šä¹‹å¤„ã€‚å®ƒä¸åƒ IPsec æˆ–è€… OpenVPN é‚£æ ·æä¾›ä¸€ä¸ªåºå¤§çš„ã€å¯åå•†çš„åŠ å¯†ç®—æ³•åˆ—è¡¨ï¼Œè€Œæ˜¯åšå®šåœ°é€‰æ‹©äº†å”¯ä¸€ä¸€å¥—å›ºå®šçš„ã€æœ€å…ˆè¿›çš„å¯†ç å­¦åŸè¯­ã€‚è¿™ç§â€œå›ºæ‰§â€å¹¶éé™åˆ¶ï¼Œè€Œæ˜¯æ·±æ€ç†Ÿè™‘åçš„å®‰å…¨ä¸æ€§èƒ½ä¿éšœï¼š â€œå¯†ç å­¦åŸè¯­â€ æŒ‡çš„æ˜¯æ„å»ºæ›´å¤æ‚å¯†ç ç³»ç»Ÿæ—¶æ‰€ä½¿ç”¨çš„ã€æ ‡å‡†åŒ–çš„åŸºç¡€ç®—æ³•æ¨¡å—ã€‚å®ƒä»¬æ˜¯åŠŸèƒ½å•ä¸€çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªåŸè¯­ç”¨äºè§£å†³ä¸€ä¸ªç‰¹å®šçš„å¯†ç å­¦é—®é¢˜ï¼Œä¾‹å¦‚â€œå¯†é’¥äº¤æ¢â€ã€â€œå¯¹ç§°åŠ å¯†â€æˆ–â€œæ¶ˆæ¯è®¤è¯â€ã€‚ æè‡´çš„ç®€æ´ä¸å¯å®¡è®¡æ€§ï¼šWireGuard çš„æ ¸å¿ƒä»£ç åº“ä»…æœ‰çº¦ 4000 è¡Œï¼Œè€Œ OpenVPN å’Œ IPsec åˆ™é«˜è¾¾æ•°åä¸‡è¡Œã€‚è¿™ç§å·¨å¤§çš„å·®å¼‚ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå¾—ç›Šäºå…¶å›ºå®šä¸”ç²¾ç®€çš„å¯†ç å­¦å¥—ä»¶ã€‚ä»£ç é‡è¶Šå°ï¼Œå°±è¶Šå®¹æ˜“è¿›è¡Œå®‰å…¨å®¡è®¡ï¼Œå‘ç°å¹¶ä¿®å¤æ½œåœ¨çš„æ¼æ´ï¼Œä»è€Œå¤§å¤§é™ä½äº†æ”»å‡»é¢ã€‚ æœç»é…ç½®é”™è¯¯ä¸é™çº§æ”»å‡»ï¼šåœ¨ä¼ ç»Ÿçš„ VPN åè®®ä¸­ï¼Œç”¨æˆ·æˆ–ç®¡ç†å‘˜éœ€è¦ä»ä¸€å¤§å †åŠ å¯†ç®—æ³•ä¸­è¿›è¡Œé€‰æ‹©ï¼Œè¿™ææ˜“å› é…ç½®ä¸å½“è€Œå¼•å…¥å®‰å…¨æ¼æ´ï¼Œç”šè‡³é­å—â€œé™çº§æ”»å‡»â€ï¼ˆæ”»å‡»è€…å¼ºåˆ¶è¿æ¥ä½¿ç”¨è¾ƒå¼±çš„åŠ å¯†ç®—æ³•ï¼‰ã€‚WireGuard åˆ™å®Œå…¨è§„é¿äº†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒåªæä¾›ä¸€å¥—ç»è¿‡ä¸¥æ ¼å®¡æŸ¥çš„ã€ç°ä»£ä¸”å®‰å…¨çš„ç®—æ³•ç»„åˆï¼Œä»æ ¹æœ¬ä¸Šæ¶ˆé™¤äº†è¿™ç±»é£é™©ã€‚ å“è¶Šçš„æ€§èƒ½è¡¨ç°ï¼šWireGuard æ‰€é€‰ç”¨çš„å¯†ç å­¦åŸè¯­ï¼ˆå¦‚ ChaCha20-Poly1305 å’Œ Curve25519ï¼‰éƒ½æ˜¯ä¸ºç°ä»£ CPU ä¼˜åŒ–è®¾è®¡çš„ï¼Œå®ƒä»¬èƒ½å¤Ÿä»¥æé«˜çš„æ•ˆç‡å®ŒæˆåŠ å¯†å’Œè§£å¯†æ“ä½œï¼Œå¹¶ä¸”å¤©ç„¶æ”¯æŒâ€œæ’å®šæ—¶é—´ï¼ˆConstant-Timeï¼‰â€ä»£ç ï¼Œæœ‰æ•ˆæŠµå¾¡æ—è·¯æ”»å‡»ã€‚è¿™ä½¿å¾— WireGuard åœ¨ååé‡å’Œå»¶è¿Ÿæ–¹é¢é€šå¸¸ä¼˜äº OpenVPN å’Œ IPsecã€‚ é¢å‘æœªæ¥çš„å®‰å…¨æ€§ï¼šWireGuard ä»ä¸€å¼€å§‹å°±æ‹¥æŠ±äº†æœ€æ–°çš„å¯†ç å­¦ç ”ç©¶æˆæœï¼Œæ‘’å¼ƒäº†é‚£äº›å¯èƒ½å­˜åœ¨å†å²é—ç•™é—®é¢˜æˆ–æ€§èƒ½ç“¶é¢ˆçš„æ—§æœ‰ç®—æ³•ã€‚è¿™ç¡®ä¿äº†å®ƒåœ¨å½“å‰ä¹ƒè‡³å¯é¢„è§çš„æœªæ¥éƒ½å…·å¤‡å¼ºå¤§çš„å®‰å…¨æ€§ã€‚ æ­£æ˜¯è¿™ç§å¯¹â€œå°‘å³æ˜¯å¤šâ€çš„æ·±åˆ»ç†è§£å’Œå¯¹ç°ä»£å¯†ç å­¦çš„åšå®šé€‰æ‹©ï¼Œè®© WireGuard æˆä¸ºäº†ä¸€ä¸ªæ›´å®‰å…¨ã€æ›´å¿«é€Ÿã€æ›´æ˜“äºéƒ¨ç½²å’Œç»´æŠ¤çš„ VPN è§£å†³æ–¹æ¡ˆã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæ›´æ˜¯ä¸€ç§ç†å¿µçš„èƒœåˆ©ã€‚ ä»¥ä¸‹æ˜¯ WireGuard æ‰€é‡‡ç”¨çš„å›ºå®šå¯†ç å­¦åŸè¯­ï¼š ä½œç”¨ åŸè¯­åç§° è¯´æ˜ å¯†é’¥äº¤æ¢ Curve25519 (ECDH) åŸºäºæ¤­åœ†æ›²çº¿è¿ªè²-èµ«å°”æ›¼åè®®ï¼Œè®©é€šä¿¡åŒæ–¹èƒ½åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„ç½‘ç»œä¸Šï¼Œå®‰å…¨ã€é«˜æ•ˆåœ°è®¡ç®—å‡ºä¸€ä¸ªç”¨äºåŠ å¯†çš„å…±äº«å¯†é’¥ã€‚ å¯¹ç§°åŠ å¯† ChaCha20 ä¸€ç§æµå¼åŠ å¯†ç®—æ³•ï¼Œç”¨äºé«˜é€Ÿåœ°åŠ å¯†å’Œè§£å¯†æµç»éš§é“çš„æ•°æ®ã€‚å®ƒä»¥å…¶åœ¨é€šç”¨CPUä¸Šçš„å“è¶Šæ€§èƒ½å’Œé«˜å®‰å…¨æ€§è€Œé—»åã€‚ æ¶ˆæ¯è®¤è¯ Poly1305 è¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ç®—æ³•ã€‚å®ƒä¸ºæ¯ä¸ªæ•°æ®åŒ…ç”Ÿæˆä¸€ä¸ªç®€çŸ­çš„â€œæ ‡ç­¾â€ï¼Œç”¨äºéªŒè¯æ•°æ®çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ï¼Œç¡®ä¿æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ å“ˆå¸Œ BLAKE2s ä¸€ä¸ªé€Ÿåº¦æå¿«ä¸”é«˜åº¦å®‰å…¨çš„å“ˆå¸Œå‡½æ•°ï¼Œåœ¨åè®®çš„å¤šç§åœºæ™¯ä¸­ç”¨äºç”Ÿæˆæ•°æ®çš„â€œæŒ‡çº¹â€ï¼Œä¾‹å¦‚ç”¨äºå¯†é’¥æ´¾ç”Ÿå’Œå…¬é’¥å“ˆå¸Œã€‚ å¯†é’¥æ´¾ç”Ÿ HKDF åŸºäºå“ˆå¸Œçš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ã€‚å®ƒèƒ½ä»ä¸€ä¸ªåˆå§‹çš„å¯†é’¥ææ–™ï¼ˆå¦‚å¯†é’¥äº¤æ¢çš„ç»“æœï¼‰ä¸­ï¼Œå®‰å…¨åœ°æ´¾ç”Ÿå‡ºå¤šä¸ªç”¨äºä¸åŒç›®çš„çš„ã€ç‹¬ç«‹çš„åŠ å¯†å¯†é’¥ã€‚ è¿™å¥—ç»„åˆä¸ä»…æ€§èƒ½å“è¶Šï¼Œä¸”åœ¨è®¾è®¡ä¸Šå°±éå¸¸é€‚åˆç¼–å†™æˆ**â€œæ’å®šæ—¶é—´ï¼ˆConstant-Timeï¼‰â€**ä»£ç ï¼ˆå³æ— è®ºå¤„ç†ä»€ä¹ˆæ•°æ®ï¼Œå…¶è¿ç®—æ—¶é—´éƒ½ä¿æŒä¸€è‡´ï¼‰ï¼Œèƒ½æœ‰æ•ˆæŠµæŠ—æ—è·¯æ”»å‡»ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒæ¶ˆé™¤äº†å› é…ç½®é”™è¯¯æˆ–é™çº§æ”»å‡»å¯¼è‡´çš„å®‰å…¨é£é™©ï¼Œå¤§å¤§æå‡äº†åè®®çš„å¥å£®æ€§ã€‚ **æ—è·¯æ”»å‡»ï¼ˆSide-Channel Attackï¼‰**æ˜¯ä¸€ç§ä¸ç›´æ¥æ”»å‡»åŠ å¯†ç®—æ³•æ•°å­¦é€»è¾‘çš„æ”»å‡»æ–¹å¼ï¼Œå®ƒè½¬è€Œé€šè¿‡åˆ†æåŠ å¯†è®¾å¤‡åœ¨è¿ç®—æ—¶äº§ç”Ÿçš„ç‰©ç†â€œå‰¯äº§å“â€æ¥çªƒå–ä¿¡æ¯ã€‚ **æ—¶åºæ”»å‡»ï¼ˆTiming Attackï¼‰**æ˜¯æ—è·¯æ”»å‡»ä¸­æœ€è‘—åçš„ä¸€ç§ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šç²¾ç¡®æµ‹é‡åŠ å¯†æ“ä½œæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚å¦‚æœä»£ç å®ç°ä¸å½“ï¼Œå¤„ç†ä¸åŒæ•°æ®æ—¶è¿ç®—æ—¶é—´å‡ºç°å¾®å°å·®å¼‚ï¼Œæ”»å‡»è€…å°±å¯èƒ½é€šè¿‡åˆ†æè¿™äº›å·®å¼‚ï¼Œé€æ­¥åæ¨å‡ºå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚ å½“ WireGuard åŠ å…¥åï¼šé‡å¡‘æ•°æ®ä¹‹æ—… åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„ç»“å°¾ï¼Œæˆ‘ä»¬æç»˜äº†ä¸€å°è®¾å¤‡ä»å¼€æœºåˆ°è®¿é—® www.google.com çš„æ ‡å‡†æµç¨‹ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°† WireGuardï¼ˆé…ç½®ä¸ºå…¨å±€éš§é“æ¨¡å¼ï¼Œå³ AllowedIPs = 0.0.0.0/0ï¼‰åŠ å…¥è¿™ä¸ªåœºæ™¯ï¼Œåˆ†æå¯ç”¨ WireGuard åï¼Œæ•°æ®åŒ…çš„æµå‘ä¼šå‘ç”Ÿä½•ç§å˜åŒ–ã€‚ åŸºç¡€è¿æ¥ï¼ˆä¸å˜ï¼‰ï¼š è·¯ç”±å™¨å°±ä½ï¼šè·¯ç”±å™¨é€šè¿‡ DHCP/PPPoE ä» ISP è·å–å…¬ç½‘ IPã€‚ è®¾å¤‡å…¥ç½‘ï¼šä½ çš„ç”µè„‘é€šè¿‡ DHCP ä»è·¯ç”±å™¨è·å–å†…ç½‘ IP 192.168.1.100ã€å­ç½‘æ©ç å’Œé»˜è®¤ç½‘å…³ 192.168.1.1ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å’ŒåŸæ¥ä¸€æ ·ã€‚è¿™æ˜¯å»ºç«‹éš§é“çš„åŸºç¡€ã€‚ éš§é“å»ºç«‹ï¼ˆæ–°æ­¥éª¤ï¼‰ï¼š ä½ åœ¨ç”µè„‘ä¸Šå¯åŠ¨ WireGuard å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯æ ¹æ®é…ç½®ï¼Œé€šè¿‡ç‰©ç†ç½‘ç»œï¼ˆWi-Fi/ä»¥å¤ªç½‘ï¼‰å‘è¿œç«¯ WireGuard æœåŠ¡å™¨ï¼ˆæ‹¥æœ‰å…¬ç½‘ IPï¼‰å‘èµ·æ¡æ‰‹ï¼Œå»ºç«‹èµ·ä¸€æ¡åŠ å¯†éš§é“ã€‚ å¯åŠ¨åï¼Œwg-quick è„šæœ¬ä¼šè‡ªåŠ¨ä¿®æ”¹ä½ ç”µè„‘çš„ä¸»è·¯ç”±è¡¨ï¼Œæ·»åŠ ä¸€æ¡ä¼˜å…ˆçº§æé«˜çš„è§„åˆ™ï¼Œå†…å®¹æ˜¯ï¼šâ€œæ‰€æœ‰ç›®æ ‡åœ°å€ä¸º 0.0.0.0/0ï¼ˆå³ä»»ä½•åœ°å€ï¼‰çš„æµé‡ï¼Œéƒ½å¿…é¡»ç»ç”± wg0 è¿™ä¸ªè™šæ‹Ÿç½‘å¡å‘é€ã€‚â€è¿™æ˜¯å®ç°æµé‡è½¬å‘çš„æ ¸å¿ƒæ­¥éª¤ã€‚ åŸŸåè§£æï¼ˆè·¯å¾„æ”¹å˜ï¼‰ï¼š ä½ åœ¨æµè§ˆå™¨è¾“å…¥ www.google.comã€‚æ“ä½œç³»ç»Ÿéœ€è¦è§£æåŸŸåï¼Œäºæ˜¯åˆ›å»ºä¸€ä¸ª DNS æŸ¥è¯¢è¯·æ±‚ã€‚ æ“ä½œç³»ç»ŸæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œå‘ç°è¿™ä¸ª DNS è¯·æ±‚ï¼ˆæ— è®ºå‘å¾€å“ªä¸ª DNS æœåŠ¡å™¨ï¼‰ä¹ŸåŒ¹é… 0.0.0.0/0 è§„åˆ™ã€‚å› æ­¤ï¼ŒDNS è¯·æ±‚åŒ…è¢«ç›´æ¥äº¤ç»™ wg0 è™šæ‹Ÿç½‘å¡ï¼Œè€Œä¸æ˜¯å‘å¾€ç‰©ç†ç½‘ç»œçš„é»˜è®¤ç½‘å…³ 192.168.1.1ã€‚ WireGuard è¿›ç¨‹ä» wg0 æ¥å£è¯»åˆ°è¿™ä¸ª DNS åŒ…ï¼Œå°†å…¶åŠ å¯†ï¼Œå¥—ä¸Šä¸€ä¸ª UDP åŒ…çš„å¤–å£³ï¼Œç„¶åé€šè¿‡ç‰©ç†ç½‘å¡å‘å¾€ WireGuard æœåŠ¡å™¨ã€‚ WireGuard æœåŠ¡å™¨æ”¶åˆ°åè§£å¯†ï¼Œä»£ä½ å‘å…¬å…± DNSï¼ˆå¦‚ 8.8.8.8ï¼‰æŸ¥è¯¢ï¼Œå¹¶å°†æ”¶åˆ°çš„ç»“æœåŠ å¯†åï¼Œæ²¿éš§é“å‘å›ç»™ä½ çš„ç”µè„‘ã€‚ è®¿é—®å…¬ç½‘ï¼ˆäºŒæ¬¡å°è£…ï¼‰ï¼š æµè§ˆå™¨æ‹¿åˆ°äº† Google çš„ IP åœ°å€ 142.250.199.68ï¼Œäºæ˜¯æ„å»ºä¸€ä¸ªç›®æ ‡ä¸ºæ­¤ IP çš„ HTTP è¯·æ±‚åŒ…ã€‚ è·¯ç”±å†³ç­–å†æ¬¡ç”Ÿæ•ˆï¼šæ“ä½œç³»ç»ŸæŸ¥è¯¢è·¯ç”±è¡¨ï¼Œ142.250.199.68 ä¾ç„¶åŒ¹é… 0.0.0.0/0 è§„åˆ™ï¼Œäºæ˜¯è¿™ä¸ª HTTP åŒ…ä¹Ÿè¢«ç›´æ¥äº¤ç»™äº† wg0 è™šæ‹Ÿç½‘å¡ã€‚ ç¬¬ä¸€æ¬¡å°è£…ï¼ˆWireGuardï¼‰ï¼šWireGuard è¿›ç¨‹è¯»åˆ°è¿™ä¸ª HTTP åŒ…ï¼Œç”¨ ChaCha20 å¯¹å…¶åŠ å¯†ï¼Œå¹¶å°è£…æˆä¸€ä¸ªå‘å¾€ WireGuard æœåŠ¡å™¨å…¬ç½‘åœ°å€çš„ UDP åŒ…ã€‚è¿™ä¸ª UDP åŒ…çš„æº IP æ˜¯ä½ çš„å†…ç½‘ IP 192.168.1.100ã€‚ ç¬¬äºŒæ¬¡å°è£…ï¼ˆè·¯ç”±å™¨ NATï¼‰ï¼šè¿™ä¸ª UDP åŒ…è¢«äº¤ç»™ç‰©ç†ç½‘å¡ï¼Œå‘å¾€å±€åŸŸç½‘çš„é»˜è®¤ç½‘å…³ 192.168.1.1ã€‚è·¯ç”±å™¨æ”¶åˆ°è¿™ä¸ª UDP åŒ…åï¼Œå¹¶ä¸çŸ¥é“é‡Œé¢æ˜¯ä»€ä¹ˆï¼Œå®ƒåªåšä¸€ä»¶äº‹ï¼šæ‰§è¡Œ NATï¼Œå°† UDP åŒ…çš„æº IP ä» 192.168.1.100 æ›¿æ¢ä¸ºä½ çš„å®¶åº­å…¬ç½‘ IPï¼Œç„¶åå°†å…¶å‘é€åˆ° WireGuard æœåŠ¡å™¨ã€‚ å‡ºå£ï¼šæœ€ç»ˆï¼Œä½ çš„è¯·æ±‚ä» WireGuard æœåŠ¡å™¨é‚£é‡Œè¿›å…¥å…¬å…±äº’è”ç½‘ï¼Œè®¿é—® Googleã€‚Google æœåŠ¡å™¨çœ‹åˆ°çš„è®¿é—®æ¥æºæ˜¯ä½ çš„ WireGuard æœåŠ¡å™¨çš„ IPï¼Œè€Œä¸æ˜¯ä½ çš„å®¶åº­å…¬ç½‘ IPã€‚ é€šè¿‡è¿™ä¸ªæµç¨‹ï¼ŒWireGuard å€ŸåŠ©è™šæ‹Ÿç½‘å¡å’Œè·¯ç”±è¡¨ï¼Œåœ¨æ“ä½œç³»ç»Ÿå±‚é¢ â€œåŠ«æŒâ€ äº†æ‰€æœ‰å¯¹å¤–æµé‡ï¼Œå°†ä½ çš„è®¾å¤‡å®Œå…¨ç½®äºä¸€ä¸ªå®‰å…¨çš„ã€åŠ å¯†çš„è™šæ‹Ÿç½‘ç»œä¸­ï¼Œå½»åº•æ”¹å˜äº†æ•°æ®çš„æµå‘å’Œä½ åœ¨äº’è”ç½‘ä¸Šçš„â€œèº«ä»½â€ã€‚ä¸‹é¢çš„åºåˆ—å›¾è¯¦ç»†æç»˜äº†è¿™ä¸€ç»è¿‡é‡å¡‘çš„æ•°æ®ä¹‹æ—…ï¼š æ€»ç»“ WireGuard ä»¥å…¶ç‹¬ç‰¹çš„è®¾è®¡ï¼Œå°†å¤æ‚çš„ VPN æŠ€æœ¯ç®€åŒ–ä¸ºæ˜“äºç†è§£å’Œå®¡è®¡çš„é…ç½®ã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œæ›´æ˜¯å­¦ä¹ ç°ä»£ç½‘ç»œåŸç†ã€å¯†ç å­¦åº”ç”¨å’Œå†…æ ¸äº¤äº’çš„ç»ä½³èŒƒä¾‹ã€‚ é€šè¿‡è™šæ‹Ÿç½‘å¡è¿™ä¸€å·§å¦™çš„â€œå¥‘çº¦â€ï¼Œå®ƒåœ¨ç”¨æˆ·ç©ºé—´å®ç°äº†å¯¹å†…æ ¸ç½‘ç»œæµçš„å®Œå…¨æŒæ§ã€‚è€Œå…¶åŸºäºå…¬é’¥çš„ CryptoKey è·¯ç”±æœºåˆ¶ï¼Œåˆ™ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å‰æ‰€æœªæœ‰çš„ã€å…¼å…·å®‰å…¨ä¸ç®€æ´çš„ç½‘ç»œæ„å»ºæ–¹å¼ã€‚æŒæ¡äº†å®ƒï¼Œä½ å°±æ‹¥æœ‰äº†åœ¨å¤æ‚çš„å…¬å…±äº’è”ç½‘ä¹‹ä¸Šï¼Œçµæ´»åœ°æ„å»ºå±äºè‡ªå·±çš„ã€å®‰å…¨é«˜é€Ÿçš„ç§äººç½‘ç»œçš„èƒ½åŠ›ã€‚ ","link":"https://blog.rakuyo.dev/computer-network-virtual-nic-and-wireguard/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€","content":"æœ¬ç¯‡æ˜¯è®¡ç®—æœºç½‘ç»œç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œä¸»è¦è®² DHCP å’Œå†…ç½‘ç©¿é€ã€‚åœ¨æ¢ç´¢å¹¿é˜”çš„å¤–ç½‘ä¹‹å‰ï¼Œå…ˆæŠŠå†…ç½‘ç›¸å…³çš„å†…å®¹åšä¸ªæ”¶å°¾ã€‚ å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹ å±€åŸŸç½‘çš„è‡ªåŠ¨é…ç½®ï¼šDHCP çš„ä¸–ç•Œ ä»»ä½•è®¾å¤‡è¦æ¥å…¥ç½‘ç»œï¼Œé¦–è¦ä»»åŠ¡æ˜¯è·å–ä¸€ä¸ªæœ‰æ•ˆçš„ç½‘ç»œé…ç½®ï¼ŒåŒ…æ‹¬ IP åœ°å€ã€å­ç½‘æ©ç ç­‰ä¿¡æ¯ã€‚æ‰‹åŠ¨ä¸ºæ¯å°è®¾å¤‡é…ç½®è¿™äº›ä¿¡æ¯ä¸ä»…æ•ˆç‡ä½ä¸‹ï¼Œè¿˜ææ˜“å‡ºé”™ã€‚ä¸ºæ­¤ï¼ŒDHCPï¼ˆåŠ¨æ€ä¸»æœºé…ç½®åè®®ï¼‰åº”è¿è€Œç”Ÿï¼Œå®ƒå®ç°äº†ç½‘ç»œå‚æ•°çš„è‡ªåŠ¨åŒ–åˆ†é…ã€‚ DHCP çš„å·¥ä½œæµç¨‹ (DORA) DHCP (Dynamic Host Configuration Protocol) æ˜¯ä¸€ç§åŸºäº UDP çš„ç½‘ç»œç®¡ç†åè®®ï¼Œå…¶æ ¸å¿ƒå·¥ä½œæµç¨‹åŒ…å«å››ä¸ªæ­¥éª¤ï¼Œé€šå¸¸ç®€ç§°ä¸º DORA è¿‡ç¨‹ï¼š Discover (å‘ç°)ï¼šå®¢æˆ·ç«¯è®¾å¤‡å¯åŠ¨å¹¶æ¥å…¥ç½‘ç»œåï¼Œä»¥å¹¿æ’­å½¢å¼å‘é€ä¸€ä¸ª DHCP Discover æŠ¥æ–‡ï¼Œåœ¨ç‰©ç†ç½‘æ®µå†…å¯»æ‰¾å¯ç”¨çš„ DHCP æœåŠ¡å™¨ã€‚ Offer (æä¾›)ï¼šæ‰€æœ‰æ”¶åˆ° Discover æŠ¥æ–‡çš„ DHCP æœåŠ¡å™¨ï¼Œä¼šä»å…¶åœ°å€æ± ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„ IP åœ°å€ï¼Œå¹¶è¿åŒå…¶ä»–ç½‘ç»œé…ç½®ä¸€èµ·ï¼Œæ„å»ºä¸€ä¸ª DHCP Offer æŠ¥æ–‡ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚ Request (è¯·æ±‚)ï¼šå®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ª Offerï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªæ”¶åˆ°çš„ï¼‰ï¼Œç„¶åå‘ç½‘ç»œå¹¿æ’­ä¸€ä¸ª DHCP Request æŠ¥æ–‡ï¼Œæ­£å¼è¯·æ±‚ä½¿ç”¨è¯¥åœ°å€ï¼Œå¹¶å‘ŠçŸ¥æ‰€æœ‰æœåŠ¡å™¨å®ƒçš„é€‰æ‹©ã€‚ Acknowledge (ç¡®è®¤)ï¼šè¢«é€‰æ‹©çš„ DHCP æœåŠ¡å™¨æ”¶åˆ° Request æŠ¥æ–‡åï¼Œæ‰§è¡Œæœ€ç»ˆçš„ç»‘å®šæ“ä½œï¼Œå¹¶å‘é€ DHCP Acknowledge æŠ¥æ–‡ç»™å®¢æˆ·ç«¯ï¼Œæ­£å¼ç¡®è®¤é…ç½®ç”Ÿæ•ˆã€‚ç§Ÿçº¦å¼€å§‹è®¡æ—¶ã€‚ æ•´ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä¸‹é¢çš„åºåˆ—å›¾æ¥æ¦‚æ‹¬ï¼š DHCP åœ¨å®è·µä¸­çš„è§’è‰² ç†è®ºä¸Šï¼ŒDHCP æœåŠ¡å¯ä»¥ç”±ç½‘ç»œä¸­çš„ä»»ä½•æœåŠ¡å™¨æä¾›ã€‚åœ¨ç»å¤§å¤šæ•°å®¶åº­å’Œå°å‹ç½‘ç»œä¸­ï¼ŒDHCP æœåŠ¡å™¨åŠŸèƒ½éƒ½é›†æˆåœ¨è·¯ç”±å™¨å†…ã€‚è¿™å°æˆ‘ä»¬ç†Ÿæ‚‰çš„è®¾å¤‡ï¼Œå…¶å®åœ¨æ‰®æ¼”ç€ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„è§’è‰²ï¼š å¯¹å†…ï¼ˆLANï¼‰æ˜¯ DHCP æœåŠ¡å™¨ï¼šå®ƒç®¡ç†ç€ä¸€ä¸ªç§ç½‘åœ°å€æ± ï¼ˆå¦‚ 192.168.1.0/24ï¼‰ï¼Œä¸ºæ‰€æœ‰æ¥å…¥çš„ç”µè„‘ã€æ‰‹æœºç­‰è®¾å¤‡åˆ†é…å†…ç½‘ IP åœ°å€å’Œç›¸å…³é…ç½®ã€‚ å¯¹å¤–ï¼ˆWANï¼‰æ˜¯ DHCP å®¢æˆ·ç«¯ï¼šé‚£ä¹ˆï¼Œè·¯ç”±å™¨è‡ªèº«çš„å…¬ç½‘ IP åˆæ˜¯ä»ä½•è€Œæ¥çš„å‘¢ï¼Ÿå¾ˆå¤šæƒ…å†µä¸‹ï¼Œå®ƒåŒæ ·æ˜¯é€šè¿‡ DHCP è·å–çš„ã€‚æ­¤æ—¶ï¼Œè·¯ç”±å™¨æ‰®æ¼”ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå‘æ‚¨çš„äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼ˆISPï¼‰çš„ DHCP æœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚ISP çš„æœåŠ¡å™¨ä»å…¶ç®¡ç†çš„å…¬ç½‘ IP åœ°å€æ± ä¸­ï¼Œå–å‡ºä¸€ä¸ªåœ°å€â€œç§Ÿâ€ç»™æ‚¨çš„è·¯ç”±å™¨ã€‚ å› æ­¤ï¼ŒDHCP æ˜¯ä¸€ä¸ªé€šç”¨çš„åœ°å€åˆ†é…åè®®ï¼Œæ—¢è¢« ISP ç”¨æ¥åˆ†é…å…¬ç½‘ IPï¼Œä¹Ÿè¢«è·¯ç”±å™¨ç”¨æ¥åˆ†é…ç§ç½‘ IPã€‚å½“ç„¶ï¼Œé™¤ DHCP å¤–ï¼ŒISP ä¹Ÿå¸¸ç”¨ PPPoEï¼ˆéœ€è¦è´¦æˆ·å¯†ç æ‹¨å·ï¼‰ç­‰æ–¹å¼æ¥åˆ†é…å…¬ç½‘ IPã€‚ DHCP çš„æ ¸å¿ƒï¼šå‚æ•°è¯¦è§£ä¸å®è·µ DHCP åœ¨ Acknowledge é˜¶æ®µæä¾›çš„â€œå¤§ç¤¼åŒ…â€ä¸­ï¼ŒåŒ…å«äº†ä»¥ä¸‹è‡³å…³é‡è¦çš„ç½‘ç»œå‚æ•°ã€‚ç†è§£è¿™äº›å‚æ•°çš„ç†è®ºå’Œå®è·µï¼Œæ˜¯æŒæ¡ç½‘ç»œé…ç½®çš„å…³é”®ã€‚ IP åœ°å€ è®¾å¤‡åœ¨ç½‘ç»œä¸­çš„å”¯ä¸€æ•°å­—æ ‡è¯†ï¼Œç”¨äºå¯»å€å’Œæ•°æ®åŒ…è·¯ç”±ã€‚DHCP åˆ†é…çš„é€šå¸¸æ˜¯ç§æœ‰ IP åœ°å€ï¼Œä»…åœ¨å±€åŸŸç½‘ï¼ˆLANï¼‰å†…æœ‰æ•ˆã€‚ å­ç½‘æ©ç  (Subnet Mask) å­ç½‘æ©ç æ˜¯ä¸€ä¸ª 32 ä½æ•°å€¼ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯åˆ’åˆ† IP åœ°å€çš„ç½‘ç»œéƒ¨åˆ†å’Œä¸»æœºéƒ¨åˆ†ï¼Œæ˜¯è®¾å¤‡è¿›è¡Œè·¯ç”±å†³ç­–çš„åŸºç¡€ã€‚ å†å²èƒŒæ™¯ï¼šä»æœ‰ç±»åœ°å€åˆ°å­ç½‘åˆ’åˆ† åœ¨æ—©æœŸï¼ŒIP åœ°å€æ ¹æ®å…¶ç¬¬ä¸€ä¸ªå…«ä½å­—èŠ‚è¢«åˆ’åˆ†ä¸º Aã€Bã€C ç­‰æœ‰ç±»ï¼ˆClassfulï¼‰åœ°å€ï¼Œæ¯ä¸ªç±»åˆ«æœ‰å›ºå®šçš„ç½‘ç»œä½å’Œä¸»æœºä½ã€‚è¿™ç§æ–¹å¼ç¼ºä¹çµæ´»æ€§ï¼Œå¸¸å¸¸å¯¼è‡´å¤§é‡ IP åœ°å€è¢«æµªè´¹ã€‚ ä¾‹å¦‚ï¼Œæ—©æœŸçš„æœ‰ç±»ç½‘ç»œåˆ’åˆ†å¦‚ä¸‹ï¼š A ç±»åœ°å€ (é¦–ä½ä¸º0ï¼ŒèŒƒå›´ 1-126): é»˜è®¤å­ç½‘æ©ç  255.0.0.0ã€‚ä¸€ä¸ª A ç±»ç½‘ç»œå¯å®¹çº³è¶…è¿‡ 1600 ä¸‡å°ä¸»æœºï¼Œè‹¥åˆ†é…ç»™ä»…éœ€æ•°ç™¾åœ°å€çš„ç»„ç»‡ï¼Œæ˜¯å·¨å¤§çš„æµªè´¹ã€‚ B ç±»åœ°å€ (é¦–ä½ä¸º10ï¼ŒèŒƒå›´ 128-191): é»˜è®¤å­ç½‘æ©ç  255.255.0.0ã€‚ä¸€ä¸ª B ç±»ç½‘ç»œå¯å®¹çº³ 65,534 å°ä¸»æœºï¼Œå¯¹å¾ˆå¤šç»„ç»‡æ¥è¯´ä¾ç„¶è¿‡å¤§ã€‚ C ç±»åœ°å€ (é¦–ä½ä¸º110ï¼ŒèŒƒå›´ 192-223): é»˜è®¤å­ç½‘æ©ç  255.255.255.0ã€‚ä¸€ä¸ª C ç±»ç½‘ç»œä»…èƒ½å®¹çº³ 254 å°ä¸»æœºï¼Œå¯¹äºéœ€è¦ç¨å¤šè®¾å¤‡ï¼ˆå¦‚ 300 å°ï¼‰çš„ç»„ç»‡æ¥è¯´åˆå¤ªå°ã€‚ æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ç§â€œè¦ä¹ˆå¤ªå¤§ï¼Œè¦ä¹ˆå¤ªå°â€çš„åƒµåŒ–é—®é¢˜ï¼Œå­ç½‘æ©ç åº”è¿è€Œç”Ÿï¼Œå®ƒå…è®¸ç½‘ç»œç®¡ç†å‘˜æ ¹æ®å®é™…éœ€æ±‚ï¼Œçµæ´»åœ°å°†å¤§ç½‘ç»œåˆ’åˆ†ä¸ºå¤šä¸ªå°å­ç½‘ (Subnet)ï¼Œæå¤§åœ°æé«˜äº† IP åœ°å€çš„åˆ©ç”¨ç‡ã€‚ æ ¸å¿ƒåŸç†ï¼šç½‘ç»œåœ°å€ä¸ä¸»æœºåœ°å€ å­ç½‘æ©ç é€šè¿‡æŒ‰ä½ä¸ (bitwise AND) è¿ç®—æ¥æå–ç½‘ç»œåœ°å€ã€‚è¿™æ˜¯è®¾å¤‡è¿›è¡Œè·¯ç”±å†³ç­–çš„æ ¹æœ¬ä¾æ®ã€‚ è®¡ç®—ç½‘ç»œåœ°å€ï¼š å‡è®¾ IP åœ°å€ä¸º 192.168.1.100ï¼Œå­ç½‘æ©ç ä¸º 255.255.255.0 (/24)ã€‚ 11000000.10101000.00000001.01100100 (IP: 192.168.1.100) &amp; 11111111.11111111.11111111.00000000 (Mask: 255.255.255.0) ------------------------------------ 11000000.10101000.00000001.00000000 (Network ID: 192.168.1.0) è¿ç®—çš„æ ¸å¿ƒåœ¨äºï¼Œå­ç½‘æ©ç ä¸­ä¸º 1 çš„éƒ¨åˆ†ä¼šä¿ç•™ IP åœ°å€çš„ä½ï¼Œä¸º 0 çš„éƒ¨åˆ†ä¼šå°† IP åœ°å€çš„ä½æ¸…é›¶ï¼Œä»è€Œå¾—åˆ°çº¯ç²¹çš„ç½‘ç»œåœ°å€ã€‚ é‚£ä¹ˆå¦‚ä½•è®¡ç®—ä¸»æœºåœ°å€å‘¢ï¼Ÿä¸è®¡ç®—ç½‘ç»œåœ°å€ç›¸å¯¹åº”ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¡ç®—å‡ºåœ°å€ä¸­çš„ä¸»æœºéƒ¨åˆ†ã€‚è¿™éœ€è¦å¯¹å­ç½‘æ©ç è¿›è¡Œâ€œæŒ‰ä½éâ€ï¼ˆNOTï¼‰è¿ç®—ï¼ˆå³ 1 å˜ 0ï¼Œ0 å˜ 1ï¼‰ï¼Œå¾—åˆ°åæ©ç ï¼Œç„¶åå†ä¸åŸ IP åœ°å€è¿›è¡Œâ€œæŒ‰ä½ä¸â€ã€‚ åæ©ç : NOT 255.255.255.0 -&gt; 0.0.0.255 è¿ç®—: 192.168.1.100 AND 0.0.0.255 -&gt; 0.0.0.100 è¿™ä¸ª 100 å°±æ˜¯è¿™å°è®¾å¤‡åœ¨è¯¥å­ç½‘ä¸­çš„ä¸»æœºæ ‡è¯†ã€‚å®Œæ•´çš„ IP åœ°å€å¯ä»¥çœ‹ä½œæ˜¯ç½‘ç»œåœ°å€ (192.168.1.0) + ä¸»æœºåœ°å€ (0.0.0.100) çš„ç»“æœã€‚ CIDR è¡¨ç¤ºæ³• åœ¨ç°ä»£ç½‘ç»œä¸­ï¼Œä½¿ç”¨æ— ç±»åˆ«åŸŸé—´è·¯ç”± (CIDR) è¡¨ç¤ºæ³•æ¥æŒ‡å®šå­ç½‘æ©ç æ›´ä¸ºå¸¸è§ã€‚å®ƒåœ¨ IP åœ°å€åé™„åŠ ä¸€ä¸ªæ–œæ å’Œæ•°å­—ï¼ˆå¦‚ /24ï¼‰ï¼Œè¡¨ç¤ºå­ç½‘æ©ç ä¸­å‰ 24 ä½ä¸º 1ã€‚ ç½‘ç»œå®¹é‡ä¸æ‰©å®¹é—®é¢˜ å­ç½‘æ©ç çš„è®¾å®šç›´æ¥å†³å®šäº†ç½‘ç»œçš„å®¹é‡ã€‚ä¾‹å¦‚ï¼Œ/24 (255.255.255.0) çš„ç½‘ç»œï¼Œä¸»æœºä½æœ‰ 8 ä½ï¼Œæœ€å¤šæ”¯æŒ 2^8 - 2 = 254 å°è®¾å¤‡ã€‚ å½“åœ°å€æ± è¢«ç”¨å°½åï¼Œæ–°è®¾å¤‡å°†æ— æ³•è·å– IP åœ°å€ã€‚å…¶ DHCP Discover è¯·æ±‚ä¼šå› æœåŠ¡å™¨æ— åœ°å€å¯ä¾› Offer è€ŒçŸ³æ²‰å¤§æµ·ã€‚æœ€ç»ˆï¼Œæ–°è®¾å¤‡å¯èƒ½ä¼šè·å–ä¸€ä¸ª 169.254.x.x çš„è‡ªåŠ¨ä¸“ç”¨åœ°å€ï¼ˆæ— æ³•è®¿é—®äº’è”ç½‘ï¼‰ï¼Œæˆ–ç›´æ¥æç¤º IP é…ç½®å¤±è´¥ã€‚ ç½‘ç»œè®¾è®¡æœ‰ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ï¼šç¨³å®šæ€§ä¸ç¡®å®šæ€§ã€‚å­ç½‘æ©ç ä½œä¸ºç½‘ç»œçš„åŸºç¡€æ¶æ„å®šä¹‰ï¼Œå…¶å˜æ›´å±äºæ¶æ„çº§è°ƒæ•´ï¼Œå¿…é¡»ç”±ç®¡ç†å‘˜è¿›è¡Œç»Ÿä¸€è§„åˆ’å’Œæ‰‹åŠ¨å®æ–½ã€‚è‡ªåŠ¨æ‰©å®¹ä¼šå› æ— æ³•é€šçŸ¥åˆ°æ‰€æœ‰è€è®¾å¤‡ã€å¯èƒ½ä¸ç°æœ‰ç½‘ç»œè§„åˆ’å†²çªç­‰åŸå› ï¼Œé€ æˆç½‘ç»œæ··ä¹±å’Œå®‰å…¨é—®é¢˜ï¼Œå› æ­¤åœ¨è®¾è®¡ä¸Šæ˜¯ä¸è¢«å…è®¸çš„ã€‚ é»˜è®¤ç½‘å…³ (Default Gateway) é»˜è®¤ç½‘å…³æ˜¯å±€åŸŸç½‘è¿æ¥åˆ°å…¶ä»–ç½‘ç»œçš„â€œå‡ºå£â€ï¼Œç‰©ç†ä¸Šé€šå¸¸æ˜¯è·¯ç”±å™¨çš„å†…ç½‘æ¥å£ IPã€‚å…¶æ ¸å¿ƒä½œç”¨æ˜¯è·¯ç”±è½¬å‘ã€‚ æ•°æ®åŒ…çš„æ—…ç¨‹ï¼šä¸€ä¸ªå®Œæ•´çš„æ•…äº‹ ä¸ºäº†ç†è§£é»˜è®¤ç½‘å…³çš„çœŸæ­£ä½œç”¨ï¼Œæˆ‘ä»¬æ¥å®Œæ•´åœ°è¿½è¸ªä¸€ä¸ªæ•°æ®åŒ…ä»å†…ç½‘ä¸»æœº A åˆ°å¤–ç½‘æœåŠ¡å™¨ B çš„æ—…ç¨‹ã€‚ ä¸»è§’: ä¸»æœº A: ä½ çš„ç”µè„‘ï¼ŒIP åœ°å€ 192.168.1.100ã€‚ é»˜è®¤ç½‘å…³: ä½ çš„è·¯ç”±å™¨ï¼ŒIP åœ°å€ 192.168.1.1ã€‚ æœåŠ¡å™¨ B: è¿œç«¯ç½‘ç«™æœåŠ¡å™¨ï¼ŒIP åœ°å€ 8.8.8.8ã€‚ ç¬¬ä¸€æ­¥ï¼šä¸»æœº A çš„â€œæ€è€ƒâ€â€”â€” æˆ‘è¯¥æŠŠä¿¡äº¤ç»™è°ï¼Ÿ ä¸»æœº A æƒ³è¦å‘é€æ•°æ®ç»™ 8.8.8.8ã€‚å®ƒé¦–å…ˆè¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼šâ€œè¿™ä¸ªç›®æ ‡æ˜¯åœ¨æˆ‘çš„å±€åŸŸç½‘å†…ï¼Œè¿˜æ˜¯åœ¨äº’è”ç½‘ä¸Šï¼Ÿâ€ å®ƒé€šè¿‡è‡ªå·±çš„å­ç½‘æ©ç  (255.255.255.0) è¿›è¡Œè®¡ç®—ï¼Œå‘ç° 8.8.8.8 å¹¶ä¸å’Œè‡ªå·±åœ¨åŒä¸€ä¸ªç½‘ç»œï¼ˆ192.168.1.0ï¼‰å†…ã€‚äºæ˜¯ï¼Œä¸»æœº A å¾—å‡ºç»“è®ºï¼šä¸èƒ½ç›´æ¥æŠŠæ•°æ®å‘é€ç»™ç›®æ ‡ï¼Œå¿…é¡»å…ˆæŠŠæ•°æ®äº¤ç»™é»˜è®¤ç½‘å…³ï¼Œè®©å®ƒè´Ÿè´£è½¬å‘ã€‚ ç¬¬äºŒæ­¥ï¼šä¸»æœº A çš„â€œæ‰“åŒ…â€â€”â€” å‡†å¤‡å¥½ä¿¡å°å’Œå¿«é€’ç›’ ç°åœ¨ä¸»æœº A çŸ¥é“ï¼Œé€»è¾‘ä¸Šè¦æŠŠæ•°æ®å‘ç»™ç½‘å…³ 192.168.1.1ã€‚ä½†åœ¨å±€åŸŸç½‘è¿™ä¸ªç‰©ç†ä¸–ç•Œé‡Œï¼Œæ•°æ®ä¼ è¾“ä¾é çš„æ˜¯ç¡¬ä»¶çš„ç‰©ç†åœ°å€ï¼ˆMAC åœ°å€ï¼‰ã€‚ å¯»æ‰¾ç‰©ç†åœ°å€ (ARP): å¦‚æœä¸»æœº A ä¸çŸ¥é“ç½‘å…³çš„ MAC åœ°å€ï¼Œå®ƒä¼šå…ˆé€šè¿‡ ARP (åœ°å€è§£æåè®®) åœ¨å±€åŸŸç½‘é‡Œå¹¿æ’­ï¼šâ€œè¯·é—®è°çš„ IP æ˜¯ 192.168.1.1ï¼Ÿè¯·æŠŠä½ çš„ MAC åœ°å€å‘Šè¯‰æˆ‘ã€‚â€ è·¯ç”±å™¨ä¼šå›åº”ï¼šâ€œæ˜¯æˆ‘çš„ï¼Œæˆ‘çš„ MAC åœ°å€æ˜¯ AA:BB:CC:DD:EE:FFã€‚â€ è¿›è¡ŒåŒå±‚å°è£…: ä¸»æœº A ç°åœ¨å¼€å§‹æ‰“åŒ…æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªç²¾å¦™çš„åŒå±‚ç»“æ„ï¼š å†…å±‚ä¿¡å° (IP æ•°æ®åŒ…): è¿™é‡Œå†™çš„æ˜¯æœ€ç»ˆç›®æ ‡ã€‚ æ”¶ä»¶äºº IP: 8.8.8.8 å‘ä»¶äºº IP: 192.168.1.100 å¤–å±‚å¿«é€’ç›’ (ä»¥å¤ªç½‘å¸§): è¿™é‡Œå†™çš„æ˜¯ä¸‹ä¸€è·³ç›®æ ‡ã€‚ æ”¶ä»¶äºº MAC: AA:BB:CC:DD:EE:FF (ç½‘å…³çš„ MAC åœ°å€) å‘ä»¶äºº MAC: ä¸»æœº A è‡ªå·±çš„ MAC åœ°å€ ç¬¬ä¸‰æ­¥ï¼šç½‘å…³çš„â€œè½¬å‘â€â€”â€” æ‹†å¼€å¿«é€’ç›’ï¼Œé€å‡ºä¿¡å° ä¸»æœº A å°†è¿™ä¸ªâ€œå¿«é€’ç›’â€å‘é€åˆ°å±€åŸŸç½‘ä¸Šã€‚ç½‘ç»œä¸­çš„æ‰€æœ‰è®¾å¤‡éƒ½ä¼šçœ‹åˆ°å®ƒï¼Œä½†åªæœ‰ MAC åœ°å€ä¸º AA:BB:CC:DD:EE:FF çš„è·¯ç”±å™¨ä¼šæ¥æ”¶å¹¶æ‹†å¼€å®ƒã€‚ è·¯ç”±å™¨æ‹†å¼€â€œå¤–å±‚å¿«é€’ç›’â€ï¼ˆä»¥å¤ªç½‘å¸§ï¼‰ã€‚ å®ƒçœ‹åˆ°é‡Œé¢çš„â€œå†…å±‚ä¿¡å°â€ï¼ˆIP æ•°æ®åŒ…ï¼‰ï¼Œå‘ç°æ”¶ä»¶äººæ˜¯ 8.8.8.8ï¼Œä¸æ˜¯è‡ªå·±ã€‚ äºæ˜¯ï¼Œè·¯ç”±å™¨æ‰§è¡Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½ï¼šè·¯ç”±ã€‚å®ƒä¼šæŸ¥è¯¢è‡ªå·±çš„è·¯ç”±è¡¨ï¼Œæ‰¾åˆ°é€šå¾€ 8.8.8.8 çš„æœ€ä½³è·¯å¾„ï¼ˆæ¯”å¦‚æŒ‡å‘ ISP çš„ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼‰ã€‚ æœ€åï¼Œå®ƒå°†è¿™ä¸ªåŸå§‹çš„ IP æ•°æ®åŒ…ï¼ˆé‡Œé¢çš„ IP åœ°å€ä¸å˜ï¼‰æ‹¿å‡ºæ¥ï¼Œå¥—ä¸Šä¸€ä¸ªæ–°çš„å¿«é€’ç›’ï¼ˆæ–°çš„ä»¥å¤ªç½‘å¸§ï¼Œç›®æ ‡ MAC åœ°å€æ˜¯ä¸‹ä¸€ä¸ªè·¯ç”±å™¨çš„ MAC åœ°å€ï¼‰ï¼Œç„¶åå‘å¾€äº’è”ç½‘ã€‚ è¿™ä¸ªâ€œæ‹†åŒ…-æŸ¥è·¯-é‡æ–°æ‰“åŒ…â€çš„è¿‡ç¨‹ä¼šåœ¨æ¯ä¸€è·³çš„è·¯ç”±å™¨ä¸Šé‡å¤ï¼Œç›´åˆ°æ•°æ®åŒ…æœ€ç»ˆæŠµè¾¾æœåŠ¡å™¨ Bã€‚ä¸‹é¢çš„åºåˆ—å›¾æ¸…æ™°åœ°å±•ç¤ºäº†è¿™ä¸€æ—…ç¨‹ï¼š DNS æœåŠ¡å™¨åœ°å€ DHCP åŒæ ·ä¼šåˆ†é… DNS æœåŠ¡å™¨çš„åœ°å€ï¼Œä½¿è®¾å¤‡èƒ½å°†åŸŸåè§£æä¸º IP åœ°å€ã€‚ DNS çš„åˆ†é…æ¨¡å¼ï¼šç›´æ¥ä¸‹å‘ä¸ä»£ç†è½¬å‘ åœ¨å®è·µä¸­ï¼Œè·¯ç”±å™¨ä¸Šçš„ DHCP æœåŠ¡åˆ†é… DNS æ—¶ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ¨¡å¼ï¼š ç›´æ¥ä¸‹å‘ (Passthrough)ï¼šè·¯ç”±å™¨å°†ä» ISP è·å–åˆ°çš„ä¸Šæ¸¸ DNS åœ°å€ï¼ˆå¦‚ 8.8.8.8ï¼‰ç›´æ¥åˆ†é…ç»™å†…ç½‘è®¾å¤‡ã€‚ ä»£ç†è½¬å‘ (Proxy/Forwarder)ï¼šè·¯ç”±å™¨å°†è‡ªèº« IP (192.168.1.1) ä½œä¸º DNS æœåŠ¡å™¨åˆ†é…ç»™å†…ç½‘è®¾å¤‡ã€‚è®¾å¤‡å‘è·¯ç”±å™¨æŸ¥è¯¢ï¼Œè·¯ç”±å™¨å†å‘ä¸Šæ¸¸ DNS æŸ¥è¯¢ï¼Œå¹¶å¯ç¼“å­˜ç»“æœä»¥åŠ é€Ÿåç»­è®¿é—®ã€‚ è·¨è¶Šç½‘å…³ï¼šå†…ç½‘ç©¿é€æŠ€æœ¯ ç°åœ¨ï¼Œæˆ‘ä»¬çš„è®¾å¤‡å·²é€šè¿‡ DHCP åœ¨å±€åŸŸç½‘ä¸­å®Œç¾è¿è¡Œã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³ä»å…¬å¸ã€é…’åº—æˆ–ä»»ä½•å¤–éƒ¨ç½‘ç»œï¼Œè®¿é—®è¿™å°å†…ç½‘ä¸­çš„è®¾å¤‡ï¼ˆå¦‚ NASã€Web æœåŠ¡å™¨ï¼‰ï¼Œå°±ä¼šé‡åˆ° NAT çš„é˜»ç¢ã€‚å†…ç½‘ç©¿é€å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æŠ€æœ¯é›†åˆã€‚ ç«¯å£æ˜ å°„ (Port Forwarding) è¿™æ˜¯æœ€åŸºç¡€å’Œå¸¸ç”¨çš„ç©¿é€æ–¹å¼ã€‚å®ƒåœ¨è·¯ç”±å™¨ä¸Šåˆ›å»ºä¸€æ¡é™æ€è½¬å‘è§„åˆ™ï¼Œå°† è·¯ç”±å™¨å…¬ç½‘IP:å¤–éƒ¨ç«¯å£ æ”¶åˆ°çš„è®¿é—®è¯·æ±‚ï¼Œè½¬å‘åˆ° å†…ç½‘æŒ‡å®šè®¾å¤‡IP:å†…éƒ¨ç«¯å£ã€‚ ä¸ DHCP çš„å…³é”®ç»“åˆç‚¹ï¼šé™æ€ IP åˆ†é… ç«¯å£æ˜ å°„çš„è§„åˆ™æ˜¯å†™æ­»çš„ï¼Œå®ƒéœ€è¦å†…ç½‘è®¾å¤‡çš„ IP åœ°å€æ°¸è¿œä¸å˜ã€‚ä½† DHCP é»˜è®¤åˆ†é…çš„ IP åœ°å€æ˜¯æœ‰ç§ŸæœŸçš„ï¼Œå¯èƒ½ä¼šå˜åŒ–ã€‚ å¯¹äºå¤§å¤šæ•°å®¶åº­ç”¨æˆ·æ¥è¯´ï¼Œå…¬ç½‘ IP æœ¬èº«ä¹Ÿæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œè¿™ä¸ºç«¯å£æ˜ å°„å¸¦æ¥äº†å¦ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä¹Ÿæ˜¯åç»­ VPN å’Œç¬¬ä¸‰æ–¹æœåŠ¡æ–¹æ¡ˆçš„ä¼˜åŠ¿ä¹‹ä¸€ è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨è·¯ç”±å™¨çš„ DHCP é™æ€åœ°å€åˆ†é… (Static DHCP Lease) åŠŸèƒ½ï¼Œé€šè¿‡ MAC åœ°å€ç»‘å®šï¼Œç¡®ä¿ç‰¹å®šè®¾å¤‡æ°¸è¿œè·å¾—åŒä¸€ä¸ª IP åœ°å€ã€‚è¿™æ˜¯å®ç°å¯é å†…ç½‘ç©¿é€çš„é‡è¦å‰æã€‚ UPnP (é€šç”¨å³æ’å³ç”¨) UPnP (Universal Plug and Play) æ˜¯ä¸€ç§æ›´ä¸ºä¾¿æ·çš„ç©¿é€æŠ€æœ¯ï¼Œå®ƒçš„ç›®æ ‡æ˜¯å®ç°â€œé›¶é…ç½®â€çš„ç½‘ç»œè¿æ¥ã€‚ UPnP æ˜¯ä»€ä¹ˆï¼Ÿ å®ƒæ˜¯ä¸€ç³»åˆ—åè®®çš„ç»„åˆï¼Œå…è®¸å±€åŸŸç½‘ä¸­çš„è®¾å¤‡ï¼ˆå¦‚ç”µè„‘ã€æ¸¸æˆæœºã€æ‰“å°æœºã€æ‘„åƒå¤´ï¼‰å½¼æ­¤è‡ªåŠ¨å‘ç°ï¼Œå¹¶åŠ¨æ€åœ°å»ºç«‹ç½‘ç»œæœåŠ¡ã€‚åœ¨å†…ç½‘ç©¿é€çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸»è¦åˆ©ç”¨çš„æ˜¯å®ƒçš„ IGD (Internet Gateway Device) åè®®ã€‚ å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ UPnP IGD å¯ä»¥çœ‹ä½œæ˜¯è‡ªåŠ¨åŒ–çš„ç«¯å£æ˜ å°„ã€‚å…¶å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š å†…ç½‘ä¸­ä¸€ä¸ªæ”¯æŒ UPnP çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚æ¸¸æˆã€ä¸‹è½½è½¯ä»¶ï¼‰å¯åŠ¨åï¼Œä¼šå…ˆåœ¨å±€åŸŸç½‘ä¸­å¯»æ‰¾æ”¯æŒ UPnP IGD çš„ç½‘å…³è®¾å¤‡ï¼ˆå³ä½ çš„è·¯ç”±å™¨ï¼‰ã€‚ æ‰¾åˆ°è·¯ç”±å™¨åï¼Œåº”ç”¨ç¨‹åºä¼šå‘è·¯ç”±å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œä¾‹å¦‚ï¼šâ€œä½ å¥½ï¼Œæˆ‘æ˜¯ 192.168.1.101ï¼Œè¯·å¸®æˆ‘æŠŠä½ çš„å…¬ç½‘ XXXX ç«¯å£ï¼Œæ˜ å°„åˆ°æˆ‘è‡ªå·±çš„ YYYY ç«¯å£ä¸Šã€‚â€ è·¯ç”±å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œå¦‚æœå¼€å¯äº† UPnP åŠŸèƒ½ï¼Œå°±ä¼šè‡ªåŠ¨åœ¨è‡ªå·±çš„ NAT è¡¨ä¸­æ·»åŠ è¿™æ¡ç«¯å£æ˜ å°„è§„åˆ™ï¼Œæ— éœ€ä»»ä½•äººå·¥å¹²é¢„ã€‚ åº”ç”¨ç¨‹åºè¿˜å¯ä»¥é€šè¿‡ UPnP æŸ¥è¯¢è·¯ç”±å™¨å½“å‰çš„å…¬ç½‘ IPï¼Œä»¥åŠæ£€æŸ¥æ˜ å°„æ˜¯å¦æˆåŠŸã€‚ ä¾¿åˆ©æ€§ä¸é£é™© ä¼˜ç‚¹ï¼šæå…¶æ–¹ä¾¿ï¼Œç”¨æˆ·å®Œå…¨æ— æ„Ÿï¼Œåº”ç”¨ç¨‹åºå¯ä»¥è‡ªè¡Œå®Œæˆæ‰€æœ‰ç©¿é€é…ç½®ï¼Œå¤§å¤§æå‡äº†è”æœºæ¸¸æˆã€P2P ä¸‹è½½ç­‰åº”ç”¨çš„ä½“éªŒã€‚ ç¼ºç‚¹ï¼šå­˜åœ¨å®‰å…¨é£é™©ã€‚ç”±äºè¯¥è¿‡ç¨‹æ˜¯è‡ªåŠ¨çš„ï¼Œå±€åŸŸç½‘ä¸­çš„ä»»ä½•ç¨‹åºï¼ˆåŒ…æ‹¬æ¶æ„è½¯ä»¶ï¼‰éƒ½æœ‰å¯èƒ½åˆ©ç”¨ UPnP åœ¨ä½ ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰“å¼€è·¯ç”±å™¨çš„ç«¯å£ï¼Œå°†å†…éƒ¨æœåŠ¡æš´éœ²äºå…¬ç½‘ï¼Œä»è€Œå¸¦æ¥å®‰å…¨éšæ‚£ã€‚å› æ­¤ï¼Œå¾ˆå¤šå¯¹å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜çš„ç”¨æˆ·ä¼šé€‰æ‹©æ‰‹åŠ¨å…³é—­è·¯ç”±å™¨çš„ UPnP åŠŸèƒ½ã€‚ åŸºäºéš§é“çš„è§£å†³æ–¹æ¡ˆï¼šä»£ç†ä¸ VPN å½“æ‰‹åŠ¨é…ç½®ç«¯å£æ˜ å°„ä¸ä¾¿æˆ–ä¸å¯è¡Œæ—¶ï¼ˆä¾‹å¦‚ï¼Œä½ æ²¡æœ‰è·¯ç”±å™¨çš„ç®¡ç†æƒé™ï¼Œæˆ–è€…ä½ çš„ ISP ä¸æä¾›å…¬ç½‘ IPï¼‰ï¼ŒåŸºäºéš§é“æŠ€æœ¯çš„ç©¿é€æ–¹æ¡ˆä¾¿æˆä¸ºäº†ä¸»æµé€‰æ‹©ã€‚å®ƒä»¬çš„æœ¬è´¨éƒ½æ˜¯åœ¨å†…ç½‘è®¾å¤‡ä¸ä¸€å°å…¬ç½‘æœåŠ¡å™¨ä¹‹é—´ï¼Œå»ºç«‹ä¸€æ¡ç¨³å®šã€åŠ å¯†çš„â€œéš§é“â€ï¼Œæ‰€æœ‰æµé‡éƒ½é€šè¿‡è¿™ä¸ªéš§é“è¿›è¡Œè½¬å‘ã€‚ åå‘ä»£ç†éš§é“ (frp, Ngrok) è¿™ç±»å·¥å…·çš„æ ¸å¿ƒæ€æƒ³æ˜¯æš´éœ²å•ä¸ªæœåŠ¡ã€‚ åŸç†ï¼šä½ åœ¨å†…ç½‘çš„æœºå™¨ä¸Šè¿è¡Œä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸»åŠ¨è¿æ¥åˆ°ä¸€å°ä½ éƒ¨ç½²åœ¨å…¬ç½‘çš„ frp æœåŠ¡ç«¯æˆ– Ngrok çš„å…¬å…±æœåŠ¡å™¨ã€‚è¿æ¥æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šæä¾›ä¸€ä¸ªå…¬ç½‘åœ°å€ï¼ˆåŸŸåæˆ– IPï¼‰å’Œç«¯å£ï¼Œå¹¶å°†æ‰€æœ‰è®¿é—®è¿™ä¸ªå…¬ç½‘åœ°å€çš„è¯·æ±‚ï¼Œé€šè¿‡å·²ç»å»ºç«‹å¥½çš„éš§é“ï¼ŒåŸå°ä¸åŠ¨åœ°è½¬å‘ç»™å†…ç½‘çš„å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å†å°†è¯·æ±‚å‘ç»™æœ¬åœ°çš„ Web æœåŠ¡æˆ– SSH æœåŠ¡ã€‚ é€‚ç”¨åœºæ™¯ï¼šéå¸¸é€‚åˆä¸´æ—¶æˆ–é•¿æœŸåœ°å°†æŸä¸ªç‰¹å®šçš„ Web æœåŠ¡ã€API æˆ–è¿œç¨‹æ¡Œé¢åˆ†äº«å‡ºå»ã€‚å…¶å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š VPN ä¸ WireGuard VPN çš„ç›®æ ‡åˆ™æ›´ä¸ºå®å¤§ï¼Œå®ƒè‡´åŠ›äºæ„å»ºä¸€ä¸ªå®‰å…¨çš„è™šæ‹Ÿå±€åŸŸç½‘ï¼Œå°†ä½ çš„æ‰€æœ‰è®¾å¤‡éƒ½â€œæ‹‰â€è¿›è¿™ä¸ªè™šæ‹Ÿç½‘ç»œä¸­ï¼Œè®©å®ƒä»¬å¦‚åŒçœŸçš„åœ¨åŒä¸€ä¸ªæˆ¿é—´é‡Œä¸€æ ·å¯ä»¥äº’ç›¸é€šä¿¡ã€‚WireGuard æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„ç°ä»£åŒ–ã€é«˜æ€§èƒ½çš„ VPN åè®®ã€‚ æœªæ¥æˆ‘ä»¬å°†æ›´åŠ è¯¦ç»†åœ°ä»‹ç» WireGuardï¼Œæ­¤å¤„å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ã€‚ åŸç†ï¼šä¸ frp ç±»ä¼¼ï¼Œä½ ä¹Ÿéœ€è¦ä¸€å°æ‹¥æœ‰å…¬ç½‘ IP çš„æœåŠ¡å™¨ä½œä¸ºæ‰€æœ‰è®¾å¤‡çš„â€œæ±‡é›†ç‚¹â€ã€‚æ‰€æœ‰è®¾å¤‡ï¼ˆå®¶é‡Œçš„ NASã€å…¬å¸çš„ç”µè„‘ã€ä½ çš„æ‰‹æœºï¼‰éƒ½ä½œä¸ºå®¢æˆ·ç«¯ï¼Œé€šè¿‡åŠ å¯†éš§é“è¿æ¥åˆ°è¿™å°æœåŠ¡å™¨ã€‚æˆåŠŸåï¼Œæ¯ä¸ªè®¾å¤‡éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå…¨æ–°çš„ã€è™šæ‹Ÿçš„ IP åœ°å€ï¼ˆä¾‹å¦‚ 10.0.0.xï¼‰ã€‚ åŒºåˆ«ä¸ä¼˜åŠ¿ï¼š å…¨ç½‘ç»œè®¿é—®ï¼šä¸€æ—¦è¿ä¸Š WireGuard VPNï¼Œä½ è®¿é—®çš„å°±ä¸å†æ˜¯å•ä¸ªæœåŠ¡ï¼Œè€Œæ˜¯æ•´å°è®¾å¤‡ã€‚ä½ å¯ä»¥é€šè¿‡ 10.0.0.x è¿™ä¸ªè™šæ‹Ÿ IPï¼Œè®¿é—®åˆ°è®¾å¤‡ä¸Šçš„ä»»ä½•ç«¯å£å’ŒæœåŠ¡ï¼ˆWebã€SSHã€æ–‡ä»¶å…±äº«ç­‰ï¼‰ï¼Œå°±åƒåœ¨æœ¬åœ°è®¿é—®ä¸€æ ·ã€‚ æé«˜çš„å®‰å…¨æ€§ï¼šä½ åªéœ€è¦åœ¨å…¬ç½‘æœåŠ¡å™¨ä¸Šå¼€æ”¾ä¸€ä¸ª UDP ç«¯å£ç»™ WireGuard ä½¿ç”¨ï¼Œå°±èƒ½è®¿é—®å†…ç½‘è®¾å¤‡çš„æ‰€æœ‰æœåŠ¡ï¼Œæå¤§åœ°å‡å°äº†å…¬ç½‘æš´éœ²é¢ã€‚ æ€§èƒ½å“è¶Šä¸é…ç½®ç®€å•ï¼šWireGuard ä»¥å…¶é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿå’Œç®€æ´çš„é…ç½®è‘—ç§°ï¼Œéå¸¸é€‚åˆä¸ªäººå’Œå›¢é˜Ÿè‡ªå»ºä½¿ç”¨ã€‚ æ€»çš„æ¥è¯´ï¼Œå¦‚æœä½ åªæƒ³å¿«é€Ÿåˆ†äº«ä¸€ä¸ªåº”ç”¨ï¼Œfrp/Ngrok è¿™ç±»åå‘ä»£ç†éš§é“æ›´è½»ä¾¿ï¼›å¦‚æœä½ å¸Œæœ›å®‰å…¨ã€å…¨é¢åœ°è¿œç¨‹ç®¡ç†å’Œè®¿é—®ä½ çš„æ•´ä¸ªå†…ç½‘ç¯å¢ƒï¼Œæ„å»ºä¸€ä¸ª WireGuard VPN æ˜¯ç›®å‰æœ€ä¼˜çš„å®è·µä¹‹ä¸€ã€‚ä¸‹å›¾æç»˜äº†è¿™ç§è™šæ‹Ÿç½‘ç»œçš„æ‹“æ‰‘ç»“æ„ï¼š æ€»ç»“ è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†è®¡ç®—æœºç½‘ç»œç³»åˆ—ä¸­å…³äºå†…ç½‘éƒ¨åˆ†çš„æ¢ç´¢ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†ä¸‰ç¯‡æ–‡ç« çš„çŸ¥è¯†ç‚¹ä¸²è”èµ·æ¥ï¼Œå›é¡¾ä¸€å°è®¾å¤‡ä»å¼€æœºåˆ°æˆåŠŸè®¿é—® www.google.com çš„å®Œæ•´æµç¨‹ï¼š è·¯ç”±å™¨å°±ä½ï¼šè·¯ç”±å™¨å¼€æœºåï¼Œé¦–å…ˆä½œä¸ºå®¢æˆ·ç«¯ï¼Œé€šè¿‡ DHCP æˆ– PPPoE ä»äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼ˆISPï¼‰å¤„è·å–åˆ°å…¬ç½‘ IP å’Œä¸Šæ¸¸ DNS æœåŠ¡å™¨åœ°å€ã€‚ è®¾å¤‡å…¥ç½‘ï¼šä½ çš„ç”µè„‘å¼€æœºå¹¶è¿æ¥ Wi-Fiï¼Œå®ƒä¼šç«‹å³å‘é€ DHCP Discover å¹¿æ’­ã€‚è·¯ç”±å™¨ä½œä¸º DHCP æœåŠ¡å™¨å“åº”ï¼Œä¸ºä½ åˆ†é…ä¸€ä¸ªå†…ç½‘ IPï¼ˆå¦‚ 192.168.1.100ï¼‰ã€å­ç½‘æ©ç å’Œé»˜è®¤ç½‘å…³ï¼ˆé€šå¸¸æ˜¯è·¯ç”±å™¨è‡ªèº«åœ°å€ 192.168.1.1ï¼‰ã€‚ åŸŸåè§£æï¼šä½ åœ¨æµè§ˆå™¨è¾“å…¥ www.google.comã€‚æ“ä½œç³»ç»Ÿä¼šå‘è·¯ç”±å™¨ï¼ˆæˆ–ä¸Šæ¸¸ DNSï¼‰å‘èµ· DNS æŸ¥è¯¢ï¼Œé€šè¿‡å±‚å±‚è§£æï¼Œæœ€ç»ˆå°†åŸŸåç¿»è¯‘æˆæœåŠ¡å™¨çš„å…¬ç½‘ IP åœ°å€ï¼Œä¾‹å¦‚ 142.250.199.68ã€‚ è®¿é—®å…¬ç½‘ï¼š ç”µè„‘é€šè¿‡å­ç½‘æ©ç è®¡ç®—ï¼Œå‘ç°ç›®æ ‡ IP 142.250.199.68 å¹¶ä¸åœ¨æœ¬åœ°å±€åŸŸç½‘ã€‚ å®ƒå°†æ•°æ®åŒ…çš„ç›®æ ‡ IP è®¾ä¸º 142.250.199.68ï¼Œä½†æ•°æ®é“¾è·¯å±‚çš„ç›®æ ‡ MAC åœ°å€åˆ™è®¾ä¸ºé»˜è®¤ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰çš„ MAC åœ°å€ã€‚ æ•°æ®åŒ…è¢«å‘å¾€è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨æ‰§è¡Œ NATï¼Œå°†æ•°æ®åŒ…çš„æº IP ä»ä½ çš„å†…ç½‘ IP æ›¿æ¢ä¸ºå®¶åº­çš„å…¬ç½‘ IPï¼Œç„¶åå‘å¾€äº’è”ç½‘ã€‚ é€šè¿‡è¿™ä¸€ç³»åˆ—çš„æµç¨‹ï¼Œä½ çš„è¯·æ±‚æ‰å¾—ä»¥é¡ºåˆ©æŠµè¾¾è¿œæ–¹çš„æœåŠ¡å™¨ã€‚ ","link":"https://blog.rakuyo.dev/computer-network-dhcp-and-intranet-penetration/"},{"title":"mise: ç»Ÿä¸€ä¸”é«˜æ•ˆçš„å¼€å‘ç¯å¢ƒç®¡ç†å·¥å…·","content":"mise æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„å¼€å‘å·¥å…·ç®¡ç†å™¨ï¼Œæ—¨åœ¨é€šè¿‡å•ä¸€å·¥å…·å’Œå•ä¸€é…ç½®æ–‡ä»¶ï¼Œå®ç°å¯¹æ‰€æœ‰å¼€å‘ç¯å¢ƒçš„ç»Ÿä¸€ç®¡ç†ã€‚å®ƒèƒ½æœ‰æ•ˆè§£å†³å¤šé¡¹ç›®å¼€å‘ä¸­ç¯å¢ƒé…ç½®çš„å¤æ‚æ€§ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚ ç°ä»£å¼€å‘ç¯å¢ƒçš„æŒ‘æˆ˜ åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬é¢‘ç¹åœ°åœ¨ä¸åŒé¡¹ç›®é—´åˆ‡æ¢ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¯èƒ½ä¾èµ–ç‰¹å®šçš„æŠ€æœ¯æ ˆä¸å·¥å…·é“¾ã€‚è¿™å¯¼è‡´é¡¹ç›®æ ¹ç›®å½•ä¸‹æ•£è½ç€å„ç§ç‰ˆæœ¬é…ç½®æ–‡ä»¶ï¼š.nvmrcã€.node-versionã€.python-versionã€Gemfileã€go.mod ç­‰ç­‰ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦ .env æ–‡ä»¶æ¥ç®¡ç†ç¯å¢ƒå˜é‡ã€‚ æ¯æ¬¡è¿›å…¥ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¼€å‘è€…éƒ½é¢ä¸´ä¸€ç³»åˆ—é‡å¤æ€§æ“ä½œï¼š å½“å‰çš„ Node.js ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆé¡¹ç›®è¦æ±‚ï¼Ÿéœ€è¦æ‰‹åŠ¨æ‰§è¡Œ nvm use å—ï¼Ÿ Python çš„è™šæ‹Ÿç¯å¢ƒæ¿€æ´»äº†å—ï¼Ÿ å¦‚ä½•ä¿è¯å›¢é˜Ÿæˆå‘˜ä½¿ç”¨å®Œå…¨ä¸€è‡´çš„å·¥å…·ç‰ˆæœ¬ï¼Œä»¥é¿å…â€œåœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜â€çš„çª˜å¢ƒï¼Ÿ è¿™äº›çç¢çš„ç¯å¢ƒç®¡ç†ä»»åŠ¡åˆ†æ•£äº†æˆ‘ä»¬çš„æ³¨æ„åŠ›ï¼Œé™ä½äº†å¼€å‘æ•ˆç‡ã€‚ä¸ºäº†åº”å¯¹è¿™ä¸€æŒ‘æˆ˜ï¼Œmise åº”è¿è€Œç”Ÿã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºäº Rust æ„å»ºçš„é«˜æ€§èƒ½å¼€å‘å·¥å…·ç®¡ç†å™¨ï¼Œè‡´åŠ›äºé€šè¿‡å•ä¸€å·¥å…·å’Œå•ä¸€é…ç½®æ–‡ä»¶ï¼Œå®ç°å¯¹æ‰€æœ‰å¼€å‘ç¯å¢ƒçš„ç»Ÿä¸€ã€è‡ªåŠ¨ç®¡ç†ã€‚ mise çš„æ ¸å¿ƒä¼˜åŠ¿: å•ä¸€é…ç½®æ–‡ä»¶: ä»…éœ€ä¸€ä¸ª .mise.toml æ–‡ä»¶ï¼Œå³å¯å£°æ˜é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰å·¥å…·ï¼ˆNode, Python, Go...ï¼‰åŠå…¶ç‰ˆæœ¬ã€ç¯å¢ƒå˜é‡å’Œé¡¹ç›®è„šæœ¬ã€‚ é«˜æ€§èƒ½: åŸºäº Rust æ„å»ºï¼Œmise çš„è¿è¡Œé€Ÿåº¦æå¿«ï¼Œå¯¹ Shell å¯åŠ¨å’Œç›®å½•åˆ‡æ¢ï¼ˆcdï¼‰çš„æ€§èƒ½å½±å“å¾®ä¹å…¶å¾®ã€‚ åŠŸèƒ½å…¨é¢: mise ä¸ä»…æ˜¯ç‰ˆæœ¬ç®¡ç†å™¨ï¼Œè¿˜é›†æˆäº†ç¯å¢ƒå˜é‡ç®¡ç†å’Œä»»åŠ¡è¿è¡Œå™¨ï¼Œä¸€ä¸ªå·¥å…·è¦†ç›–å¼€å‘ä¸­çš„å¤šä¸ªæ ¸å¿ƒç¯èŠ‚ã€‚ æ— ç¼å…¼å®¹: mise èƒ½è‡ªåŠ¨è¯†åˆ«å¹¶ä½¿ç”¨é¡¹ç›®ä¸­å·²æœ‰çš„ .nvmrc, .python-version ç­‰ä¼ ç»Ÿé…ç½®æ–‡ä»¶ï¼Œå…è®¸å›¢é˜Ÿå¹³æ»‘è¿‡æ¸¡ã€‚ å®‰è£…ä¸æ¿€æ´» ä½“éªŒ mise çš„å¼ºå¤§åŠŸèƒ½ï¼Œåªéœ€ç®€å•çš„ä¸¤æ­¥ã€‚ å®‰è£… mise åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®Œæˆå®‰è£…ï¼š curl https://mise.run | sh è¯¥å‘½ä»¤ä¼šå°† mise å®‰è£…åˆ° ~/.local/bin/miseã€‚ æ¿€æ´» mise (å…³é”®æ­¥éª¤) ä¸ºäº†è®© mise èƒ½å¤Ÿè‡ªåŠ¨ç®¡ç†ä½ çš„ç¯å¢ƒï¼Œéœ€è¦å°†å…¶æŒ‚è½½ï¼ˆHookï¼‰åˆ°ä½ çš„ Shell ä¸­ã€‚æ­¤æ­¥éª¤è‡³å…³é‡è¦ï¼Œå¦åˆ™ mise å°†æ— æ³•åœ¨ç›®å½•åˆ‡æ¢æ—¶è‡ªåŠ¨åˆ‡æ¢ç¯å¢ƒã€‚ æ ¹æ®ä½ ä½¿ç”¨çš„ Shellï¼Œé€‰æ‹©å¯¹åº”çš„å‘½ä»¤æ‰§è¡Œï¼Œå®ƒä¼šå°†æ¿€æ´»è„šæœ¬æ·»åŠ åˆ°ä½ çš„ Shell é…ç½®æ–‡ä»¶ä¸­ï¼š Bash: echo 'eval &quot;$(~/.local/bin/mise activate bash)&quot;' &gt;&gt; ~/.bashrc Zsh: (macOS é»˜è®¤) echo 'eval &quot;$(~/.local/bin/mise activate zsh)&quot;' &gt;&gt; ~/.zshrc Fish: ~/.local/bin/mise activate fish | source å®Œæˆåï¼Œå¿…é¡»é‡å¯ç»ˆç«¯ä»¥ä½¿é…ç½®ç”Ÿæ•ˆã€‚ä½ å¯ä»¥è¿è¡Œ mise doctor å‘½ä»¤æ¥éªŒè¯ mise æ˜¯å¦å·²æ­£ç¡®å®‰è£…å’Œæ¿€æ´»ã€‚ æ ¸å¿ƒé…ç½®ï¼š.mise.toml æ–‡ä»¶è¯¦è§£ mise çš„è®¾è®¡å›´ç»•â€œä¸€æ¬¡é…ç½®ï¼Œè‡ªåŠ¨è¿è¡Œâ€çš„ç†å¿µï¼Œå…¶æ ¸å¿ƒå°±æ˜¯ .mise.toml æ–‡ä»¶ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…¨æ ˆ Web åº”ç”¨çš„åœºæ™¯ï¼Œæ¥äº†è§£å…¶æ„æˆå’Œå·¥ä½œæ–¹å¼ã€‚ å‡è®¾é¡¹ç›®æŠ€æœ¯æ ˆåŒ…å«ï¼š å‰ç«¯: Node.js å’Œ pnpm åŒ…ç®¡ç†å™¨ã€‚ åç«¯: Python å’Œ FastAPI æ¡†æ¶ã€‚ ç¯å¢ƒå˜é‡: æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚ é¡¹ç›®è„šæœ¬: ç”¨äºä»£ç æ£€æŸ¥å’Œæµ‹è¯•ã€‚ åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .mise.toml æ–‡ä»¶ï¼Œå°†æ‰€æœ‰é…ç½®ç»Ÿä¸€ç®¡ç†ï¼š # .mise.toml - é¡¹ç›®ç¯å¢ƒçš„å”¯ä¸€å£°æ˜ # [settings] - é…ç½® mise çš„è¡Œä¸º [settings] # ç¡®ä¿ä¸º Python è‡ªåŠ¨åˆ›å»ºå’Œä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ python_venv_auto_create = true # [env] - ç®¡ç†ç¯å¢ƒå˜é‡ï¼Œæ›¿ä»£ .env æ–‡ä»¶ # è¿›å…¥ç›®å½•åï¼Œè¿™é‡Œçš„å˜é‡ä¼šè‡ªåŠ¨åŠ è½½ï¼Œç¦»å¼€ç›®å½•åˆ™ä¼šè‡ªåŠ¨å¸è½½ã€‚ [env] DATABASE_URL = &quot;postgres://user:password@localhost:5432/mydb&quot; NODE_ENV = &quot;development&quot; # [tools] - å£°æ˜é¡¹ç›®æ‰€éœ€çš„å…¨éƒ¨å·¥å…·å’Œç‰ˆæœ¬ # mise è´Ÿè´£ç®¡ç†è¿™äº›â€œå·¥å…·â€æœ¬èº«çš„ç‰ˆæœ¬ [tools] # å¯ä»¥æŒ‡å®šç²¾ç¡®ç‰ˆæœ¬ï¼Œæˆ–ä½¿ç”¨ &quot;lts&quot;, &quot;latest&quot;, &quot;~20&quot; ç­‰æ¨¡ç³Šç‰ˆæœ¬ node = &quot;20.11.0&quot; pnpm = &quot;8.15.0&quot; python = &quot;3.11&quot; # å°† ruff å’Œ pytest ä½œä¸ºå¼€å‘å·¥å…·ä¾èµ–é¡¹ # mise ä¼šä½¿ç”¨ pip åœ¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…å®ƒä»¬ python-ruff = &quot;*&quot; # ä»£ç æ ¼å¼åŒ–ä¸æ£€æŸ¥å·¥å…· python-pytest = &quot;*&quot; # æµ‹è¯•æ¡†æ¶ # [tasks] - å®šä¹‰é¡¹ç›®è„šæœ¬ï¼Œæ›¿ä»£ package.json scripts æˆ– Makefile [tasks] # å®šä¹‰ lint ä»»åŠ¡, å®ƒä¾èµ– ruff lint = { cmd = &quot;ruff check .&quot;, description = &quot;ç”¨ Ruff æ£€æŸ¥ä»£ç é£æ ¼&quot;, depends = [&quot;python-ruff&quot;] } # å®šä¹‰ test ä»»åŠ¡ï¼Œå¹¶å£°æ˜å®ƒä¾èµ–äº pytest test = { cmd = &quot;pytest&quot;, description = &quot;è¿è¡Œæµ‹è¯•&quot;, depends = [&quot;python-pytest&quot;] } # å®šä¹‰å¤åˆä»»åŠ¡ check = { depends = [&quot;lint&quot;, &quot;test&quot;], description = &quot;è¿è¡Œæ‰€æœ‰æ£€æŸ¥&quot; } æ—¥å¸¸å·¥ä½œæµ å½“å›¢é˜Ÿæ–°æˆå‘˜å…‹éš†æ­¤é¡¹ç›®åï¼Œåªéœ€åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œä¸€æ¡å‘½ä»¤ï¼š mise install mise ä¼šè‡ªåŠ¨è¯»å– .mise.toml å¹¶å®Œæˆä»¥ä¸‹å·¥ä½œï¼š ä¸‹è½½å¹¶å®‰è£… node@20.11.0, pnpm@8.15.0 å’Œ python@3.11ã€‚ æ ¹æ® [settings] çš„é…ç½®ï¼Œä¸º Python åˆ›å»ºä¸€ä¸ªé¡¹ç›®ç‹¬æœ‰çš„è™šæ‹Ÿç¯å¢ƒã€‚ åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£… ruff å’Œ pytestã€‚ å®‰è£…å®Œæˆåï¼Œæ¯å½“ cd è¿›å…¥è¯¥ç›®å½•ï¼Œmise ä¼šç«‹å³åœ¨åå°ï¼š å°† node, python, pnpm ç­‰å‘½ä»¤çš„è·¯å¾„æŒ‡å‘ .mise.toml ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ã€‚ åŠ è½½ [env] ä¸­å®šä¹‰çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ã€‚ è‡ªåŠ¨æ¿€æ´» Python çš„è™šæ‹Ÿç¯å¢ƒã€‚ å½“ä½  cd ç¦»å¼€è¯¥ç›®å½•æ—¶ï¼Œæ‰€æœ‰ä¸Šè¿°ç¯å¢ƒé…ç½®éƒ½ä¼šè¢«è‡ªåŠ¨å¸è½½ï¼Œæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚ è¿è¡Œåœ¨ [tasks] ä¸­å®šä¹‰çš„è„šæœ¬ä¹ŸåŒæ ·ç®€å•ï¼š mise run lint mise run test mise run check # è¯¥å‘½ä»¤ä¼šä¾æ¬¡æ‰§è¡Œ lint å’Œ test # ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å†™: mise x check mise ä¼šç¡®ä¿åœ¨æ‰§è¡Œè„šæœ¬å‰ï¼Œå…¶ depends ä¸­å£°æ˜çš„å·¥å…·éƒ½å·²å®‰è£…å¹¶å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†â€œè„šæœ¬ä¾èµ–çš„å·¥å…·æœªå®‰è£…æˆ–ç‰ˆæœ¬ä¸æ­£ç¡®â€çš„é—®é¢˜ã€‚ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£ æŒæ¡äº†åŸºæœ¬ç”¨æ³•åï¼Œè®©æˆ‘ä»¬æ·±å…¥æ¢ç´¢ mise æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œå®ƒä»¬æ˜¯æ„å»ºç»Ÿä¸€å¼€å‘ç¯å¢ƒçš„åŸºçŸ³ã€‚ å…¨èƒ½çš„ç‰ˆæœ¬ç®¡ç† mise èƒ½å¤Ÿç®¡ç†å‡ ä¹æ‰€æœ‰å¼€å‘å·¥å…·ï¼Œå…¶ç§˜è¯€åœ¨äºå®ƒå®Œå…¨å…¼å®¹ asdf çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¸€ä¸ªåŒ…å«æ•°ç™¾ä¸ªæ’ä»¶çš„å®˜æ–¹ä»“åº“ã€‚ æ™ºèƒ½æ’ä»¶å®‰è£…ï¼šå½“ä½ åœ¨ .mise.toml ä¸­é¦–æ¬¡å£°æ˜ä¸€ä¸ªæ–°å·¥å…·ï¼ˆä¾‹å¦‚ go = &quot;1.21&quot;ï¼‰æ—¶ï¼Œmise ä¼šè‡ªåŠ¨æç¤ºæ˜¯å¦å®‰è£…å¯¹åº”çš„ go æ’ä»¶ã€‚ æ‰‹åŠ¨ç®¡ç†æ’ä»¶ï¼šä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨æœç´¢å’Œå®‰è£…æ’ä»¶ï¼š# æœç´¢æ‰€æœ‰å¯ç”¨çš„ terraform æ’ä»¶ mise plugins ls-remote terraform # å®‰è£…æŒ‡å®šçš„æ’ä»¶ mise plugins install terraform æ’ä»¶çš„å·¥ä½œæœºåˆ¶ï¼šä¸­å¿ƒåº“ä¸è‡ªå®šä¹‰æ’ä»¶ ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆåœ¨ .mise.toml ä¸­åªéœ€ç®€å•åœ°å†™å…¥ go = &quot;1.22&quot;ï¼Œmise å°±çŸ¥é“å¦‚ä½•å»å®‰è£… Goï¼Ÿè¿™èƒŒåæ˜¯ mise å¼ºå¤§çš„æ’ä»¶æœºåˆ¶åœ¨èµ·ä½œç”¨ã€‚ å®é™…ä¸Šï¼Œgoã€pythonã€terraform è¿™äº›çœ‹ä¼¼å†…ç½®çš„å·¥å…·åç§°ï¼Œéƒ½æ˜¯æ’ä»¶çš„ç®€ç§° (Shorthand)ã€‚mise é»˜è®¤ä¾èµ–ä¸€ä¸ªåºå¤§çš„æ’ä»¶ä¸­å¿ƒåº“ï¼ˆå³ asdf çš„å®˜æ–¹æ’ä»¶åº“ï¼‰ã€‚å½“ä½ ä½¿ç”¨è¿™äº›ç®€ç§°æ—¶ï¼Œmise ä¼šè‡ªåŠ¨åœ¨ä¸­å¿ƒåº“ä¸­æŸ¥æ‰¾åŒåæ’ä»¶å¹¶ä½¿ç”¨å®ƒæ¥å®‰è£…å’Œç®¡ç†å·¥å…·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°å¸¸è§å·¥å…·éƒ½èƒ½å¼€ç®±å³ç”¨çš„åŸå› ã€‚ ç„¶è€Œï¼Œmise çš„èƒ½åŠ›è¿œä¸æ­¢äºæ­¤ã€‚å½“ä¸­å¿ƒåº“æ— æ³•æ»¡è¶³ä½ çš„éœ€æ±‚æ—¶ï¼ˆä¾‹å¦‚ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæœªè¢«æ”¶å½•çš„ã€å…¬å¸å†…éƒ¨çš„æˆ–ç¬¬ä¸‰æ–¹çš„å·¥å…·ï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡ç›´æ¥æä¾› Git URL çš„æ–¹å¼æ¥ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰æ’ä»¶ã€‚ è¿™æå¤§åœ°æ‰©å±•äº† mise çš„è¾¹ç•Œï¼Œä½¿å…¶èƒ½å¤Ÿç®¡ç†ä»»ä½•å¯é€šè¿‡ Git ä»“åº“è·å–çš„å·¥å…·ã€‚ä½ åªéœ€åœ¨ .mise.toml ä¸­æŒ‰ä»¥ä¸‹æ ¼å¼å£°æ˜å³å¯ï¼š # .mise.toml [tools] # ... å…¶ä»–å·¥å…· # é€šè¿‡ URL ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰æ’ä»¶ # mise ä¼šå…‹éš†è¿™ä¸ª Git ä»“åº“ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªæ’ä»¶æ¥ä½¿ç”¨ my-internal-cli = { git = &quot;https://github.com/my-company/mise-internal-cli.git&quot;, version = &quot;1.2.3&quot; } æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä¸€æ¬¡æ€§ä½¿ç”¨ï¼š mise use my-internal-cli@https://github.com/my-company/mise-internal-cli.git é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œmise ç¡®ä¿äº†å¼€å‘è€…æ—¢èƒ½æ–¹ä¾¿åœ°ä½¿ç”¨ç¤¾åŒºç»´æŠ¤çš„ä¸»æµå·¥å…·ï¼Œä¹Ÿæ‹¥æœ‰äº†æ¥å…¥ä»»ä½•è‡ªå®šä¹‰å·¥å…·çš„å¼ºå¤§æ‰©å±•èƒ½åŠ›ã€‚å¦‚æœä½ æœ‰æ›´è¿›ä¸€æ­¥çš„å®šåˆ¶åŒ–éœ€æ±‚ï¼Œç”šè‡³å¯ä»¥éµå¾ª asdf çš„æ’ä»¶è§„èŒƒï¼Œè‡ªè¡Œå¼€å‘æ’ä»¶å¹¶æ‰˜ç®¡åœ¨è‡ªå·±çš„ Git ä»“åº“ä¸­ï¼Œä»è€Œå°†ä»»ä½•å·¥å…·æ— ç¼æ•´åˆåˆ° mise çš„ç®¡ç†ä½“ç³»ä¸‹ã€‚ éœ€è¦æ˜ç¡®çš„æ˜¯ mise ä¸ pnpm/pip çš„èŒè´£åˆ’åˆ†ï¼š mise ç®¡ç†â€œå·¥å…·â€ï¼šå®ƒç¡®ä¿å¼€å‘ç¯å¢ƒä¸­æœ‰æ­£ç¡®ç‰ˆæœ¬çš„ node, pnpm, python ç­‰å¯æ‰§è¡Œç¨‹åºã€‚ pnpm/pip ç®¡ç†â€œåº“â€ï¼šå®ƒä»¬ä¾æ® package.json æˆ– requirements.txt æ–‡ä»¶ï¼Œç®¡ç†é¡¹ç›®ä»£ç æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ react, fastapiï¼‰ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œmise è´Ÿè´£è§£å†³â€œæˆ‘ä»¬ç”¨å“ªä¸ªç‰ˆæœ¬çš„ pnpmâ€ï¼Œè€Œ pnpm è´Ÿè´£è§£å†³â€œæˆ‘ä»¬ç”¨å“ªä¸ªç‰ˆæœ¬çš„ reactâ€ã€‚ä¸¤è€…ç›¸è¾…ç›¸æˆã€‚ çµæ´»çš„ç‰ˆæœ¬æ§åˆ¶ (mise use) mise æä¾›äº†å¯¹é¡¹ç›®çº§ã€å…¨å±€å’Œä¸´æ—¶ï¼ˆShell çº§ï¼‰å·¥å…·ç‰ˆæœ¬çš„å¤šå±‚æ¬¡ç®¡ç†èƒ½åŠ›ï¼Œè¿™æ˜¯å®ƒç›¸æ¯” Homebrew ç­‰ç³»ç»Ÿçº§åŒ…ç®¡ç†å™¨çš„æ˜¾è‘—ä¼˜åŠ¿ã€‚Homebrew é€šå¸¸åœ¨ç³»ç»Ÿä¸­å…¨å±€å®‰è£…å”¯ä¸€ç‰ˆæœ¬çš„å·¥å…·ï¼Œè€Œ mise å¯ä»¥è½»æ¾åº”å¯¹å¤šç‰ˆæœ¬å¹¶å­˜çš„åœºæ™¯ã€‚ mise use æ˜¯ä¸€ä¸ªç”¨äºåœ¨ä¸åŒå±‚çº§è®¾ç½®å·¥å…·ç‰ˆæœ¬çš„çµæ´»å‘½ä»¤ï¼š mise use æœ‰ä¸€ä¸ªæ›´ç®€å•çš„åˆ«åï¼šmise xã€‚ä¸‹æ–‡ä¸­å°†ä¼˜å…ˆä½¿ç”¨ mise useã€‚ è®¾ç½®å…¨å±€é»˜è®¤ç‰ˆæœ¬ï¼š è¯¥å‘½ä»¤ä¼šä¿®æ”¹å…¨å±€é…ç½®æ–‡ä»¶ ~/.config/mise/config.tomlã€‚ # æ­¤åï¼Œåœ¨ä»»ä½•æ²¡æœ‰é¡¹ç›®çº§é…ç½®çš„ç›®å½•ä¸­ï¼Œnode ç‰ˆæœ¬éƒ½å°†æ˜¯ 20.x çš„æœ€æ–°ç‰ˆ mise use --global node@20 åœ¨é¡¹ç›®ä¸­è®¾ç½®æœ¬åœ°ç‰ˆæœ¬ï¼š åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œæ­¤å‘½ä»¤ï¼Œmise ä¼šè‡ªåŠ¨æ›´æ–°å½“å‰ç›®å½•çš„ .mise.toml æ–‡ä»¶ã€‚ # è¯¥å‘½ä»¤ä¼šè‡ªåŠ¨åœ¨ ./.mise.toml çš„ [tools] ä¸­æ·»åŠ æˆ–ä¿®æ”¹ go = &quot;1.22&quot; mise use go@1.22 åœ¨å½“å‰ Shell ä¸­ä¸´æ—¶ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ï¼š æ­¤åŠŸèƒ½éå¸¸é€‚åˆå¿«é€Ÿæµ‹è¯•ï¼Œå®ƒä¸ä¼šä¿®æ”¹ä»»ä½•é…ç½®æ–‡ä»¶ã€‚ # ä»…åœ¨å½“å‰ç»ˆç«¯ä¼šè¯ä¸­ï¼Œå°† node ç‰ˆæœ¬åˆ‡æ¢åˆ° 18.x # æ–°æ‰“å¼€çš„ç»ˆç«¯å°†ä¸å—å½±å“ mise use node@18 ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬åœ¨ Shell ä¸­æ‰§è¡Œå‘½ä»¤ï¼š æ­¤åŠŸèƒ½é€‚ç”¨äºåœ¨å·¥ä½œç©ºé—´æ‰“å¼€ä¸€äº›å·¥å…·é¡¹ç›®ï¼Œæ¯”å¦‚ Gemini æˆ–è€… QWen ç­‰ AI å·¥ä½œã€‚å®ƒä¹Ÿä¸ä¼šä¿®æ”¹ä»»ä½•é…ç½®æ–‡ä»¶ã€‚ # ä»…å½“å‰å‘½ä»¤ç”Ÿæ•ˆï¼Œä¸‹ä¸€æ¡å‘½ä»¤ä»ç„¶ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬ mise exec node@20 -- qwen ç›´æ¥ä»åŒ…ç®¡ç†å™¨å®‰è£…å·¥å…·ï¼š mise è¿˜èƒ½ç›´æ¥ä» npm, pipx, cargo ç­‰åŒ…ç®¡ç†å™¨å®‰è£…å¹¶ç®¡ç†å…¨å±€å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæå¤§åœ°ç®€åŒ–äº† CLI å·¥å…·çš„ç®¡ç†ã€‚ # ä½¿ç”¨ npm å®‰è£… Gemini CLI å¹¶ä½¿å…¶å…¨å±€å¯ç”¨ mise use --global npm:@google/gemini-cli@latest mise ä¼šå¤„ç†å¥½ PATHï¼Œè®©ä½ å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›´æ¥è°ƒç”¨ gemini å‘½ä»¤ã€‚ å¹³æ»‘è¿ç§»ç­–ç•¥ mise åœ¨è®¾è®¡ä¸Šè€ƒè™‘äº†ä¸ç°æœ‰ç”Ÿæ€çš„å…¼å®¹æ€§ï¼Œå®ƒä¼šè‡ªåŠ¨è¯»å–é¡¹ç›®ä¸­çš„ .python-version, .nvmrc, .ruby-version ç­‰æ–‡ä»¶ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç«‹å³åœ¨ç°æœ‰é¡¹ç›®ä¸­ä½¿ç”¨ miseï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•ç ´åæ€§æ”¹åŠ¨ã€‚ æ¨èçš„è¿ç§»è·¯å¾„å¦‚ä¸‹ï¼š å®‰è£…å¹¶æ¿€æ´» miseã€‚ éªŒè¯ï¼šè¿›å…¥ç°æœ‰é¡¹ç›®ç›®å½•ï¼Œæ‰§è¡Œ node -v æˆ– python -Vï¼Œç¡®è®¤ mise å·²æ­£ç¡®è¯»å–æ—§é…ç½®æ–‡ä»¶å¹¶åˆ‡æ¢åˆ°ç›¸åº”ç‰ˆæœ¬ã€‚ ç»Ÿä¸€é…ç½®ï¼šåœ¨ç¡®è®¤ mise å·¥ä½œæ­£å¸¸åï¼Œå°† .nvmrc, .python-version ç­‰æ–‡ä»¶çš„å†…å®¹è¿ç§»åˆ°ç»Ÿä¸€çš„ .mise.toml æ–‡ä»¶ä¸­ï¼Œç„¶ååˆ é™¤æ—§çš„é…ç½®æ–‡ä»¶ã€‚ æ¸…ç†æ—§å·¥å…·ï¼šå½“æ‰€æœ‰é¡¹ç›®éƒ½è¿ç§»å®Œæ¯•åï¼Œå¯ä»¥å®‰å…¨åœ°ä» .zshrc æˆ– .bashrc ä¸­ç§»é™¤ pyenv init, nvm.sh ç­‰æ—§å·¥å…·çš„åŠ è½½å‘½ä»¤ï¼Œå¹¶æœ€ç»ˆå¸è½½å®ƒä»¬ã€‚ å®ç”¨æŠ€å·§ä¸é—®é¢˜æ’æŸ¥ Shell Hook æœªé…ç½®ï¼šæœ€å¸¸è§çš„é—®é¢˜ã€‚å¦‚æœ cd è¿›å…¥é¡¹ç›®åå·¥å…·ç‰ˆæœ¬æ²¡æœ‰è‡ªåŠ¨åˆ‡æ¢ï¼Œ99% çš„å¯èƒ½æ˜¯ Shell æ¿€æ´»æ­¥éª¤æœªæ­£ç¡®å®Œæˆã€‚è¯·è¿è¡Œ mise doctor è¿›è¡Œè¯Šæ–­ã€‚ ä¸ asdf çš„å‘½ä»¤å·®å¼‚ï¼šmise çš„å‘½ä»¤ä¸ asdf ä¸å®Œå…¨ç›¸åŒã€‚ä¾‹å¦‚ï¼Œè®¾ç½®å…¨å±€ç‰ˆæœ¬æ˜¯ mise use --global node@20ï¼Œè€Œé asdf global nodejs 20.0.0ã€‚ æ›¾ç”¨å rtxï¼šmise çš„å‰èº«æ˜¯ rtxã€‚å¦‚æœæœç´¢é—®é¢˜æ—¶æ‰¾ä¸åˆ°ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ rtx ä½œä¸ºå…³é”®å­—ã€‚ ä½¿ç”¨ mise whichï¼šå½“ä½ éœ€è¦ç¡®è®¤å½“å‰å‘½ä»¤çš„æ¥æºæ—¶ï¼Œmise which node å¯ä»¥æ¸…æ™°åœ°æ˜¾ç¤º node å‘½ä»¤çš„å®é™…è·¯å¾„ä»¥åŠå®ƒæ˜¯ç”±å“ªä¸ªé…ç½®æ–‡ä»¶æ‰€è®¾å®šçš„ã€‚ ä½¿ç”¨ mise execï¼šå¦‚æœä½ æƒ³åœ¨ç‰¹å®šé¡¹ç›®çš„ç¯å¢ƒä¸­æ‰§è¡Œå•ä¸ªå‘½ä»¤ï¼Œè€Œæ— éœ€ cd åˆ°è¯¥ç›®å½•ï¼Œmise exec éå¸¸æœ‰ç”¨ã€‚# å‡è®¾ ./my-project/ ä¸­é…ç½®ä½¿ç”¨ node@18 # ä½ å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿è¡Œæ­¤å‘½ä»¤ï¼Œå®ƒä¼šä½¿ç”¨ my-project çš„ç¯å¢ƒæ¥æ‰§è¡Œ mise exec --cwd ./my-project -- node --version # è¾“å‡º: v18.x.x æ€»ç»“ mise æä¾›äº†ä¸€ä¸ªç»Ÿä¸€ã€é«˜æ•ˆã€é«˜æ€§èƒ½çš„å¼€å‘ç¯å¢ƒè§£å†³æ–¹æ¡ˆã€‚å®ƒé€šè¿‡å•ä¸€é…ç½®æ–‡ä»¶ï¼Œä¼˜é›…åœ°è§£å†³äº†åœ¨ç°ä»£è½¯ä»¶å¼€å‘ä¸­æ™®éå­˜åœ¨çš„ç‰ˆæœ¬ç®¡ç†ã€ç¯å¢ƒé…ç½®å’Œä»»åŠ¡æ‰§è¡Œç­‰ä¸€ç³»åˆ—æŒ‘æˆ˜ã€‚å¦‚æœä½ å¸Œæœ›ä»ç¹æ‚çš„é…ç½®å·¥ä½œä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äºæ ¸å¿ƒçš„å¼€å‘ä»»åŠ¡ï¼Œmise æ˜¯ä¸€ä¸ªå€¼å¾—æŠ•å…¥æ—¶é—´å°è¯•çš„å·¥å…·ã€‚ å†™åœ¨æœ€å æ˜çœ¼äººæˆ–è®¸ä¸€çœ¼å°±èƒ½çœ‹å‡ºï¼Œè¿™ç¯‡æ–‡ç« æ˜¯ç”± AI æ’°å†™ï¼Œå…¶é£æ ¼ä¸æˆ‘ä»¥å¾€çš„æ–‡ç« æœ‰æ‰€ä¸åŒã€‚ èµ·åˆï¼Œå½“æˆ‘åŠ¨ç¬”å†™ä¸‹å¼•è¨€æ—¶ï¼Œä¸€ä¸ªç–‘é—®å¿½ç„¶æµ®ç°åœ¨è„‘æµ·ï¼šâ€œåœ¨ AI æ—¶ä»£ï¼Œmise è¿™ç±»å·¥å…·æ˜¯å¦è¿˜æœ‰å…¶å­˜åœ¨çš„æ„ä¹‰ï¼Ÿâ€ è¿™ä¸ç¦è®©æˆ‘æƒ³èµ·ï¼Œæœ‰äººè®¤ä¸ºåœ¨ AI æ—¶ä»£ï¼Œè·¨å¹³å°ç§»åŠ¨å¼€å‘æ¡†æ¶å·²æ— å¿…è¦ï¼ˆæš‚ä¸”ä¸æä»–ä»¬å¯¹è·¨å¹³å°æ¡†æ¶çš„å›ºæœ‰æŠµè§¦ï¼‰ï¼Œå› ä¸º AI èƒ½è¿…é€Ÿç”Ÿæˆä¸¤ç«¯åŸç”Ÿä»£ç ï¼Œä½¿å¾—è·¨å¹³å°æ¡†æ¶æ‰€èŠ‚çœçš„æ—¶é—´æˆæœ¬å˜å¾—å¾®ä¹å…¶å¾®ï¼Œç”šè‡³å¯èƒ½å› å…¼å®¹æ€§é—®é¢˜å¸¦æ¥æ›´é«˜çš„è°ƒè¯•æˆæœ¬ã€‚åŒç†ï¼Œmise ä¹Ÿå¯ä»¥è¢«æŠ½è±¡åœ°ç†è§£ä¸ºä¸€ç§â€œè·¨å¹³å°æ¡†æ¶â€ã€‚ äºæ˜¯ï¼Œæˆ‘å†³å®šè®© AI æ¥å®Œæˆè¿™ç¯‡æ–‡ç« ï¼Œå¹¶ç”±å®ƒæ¥å›ç­”è¿™ä¸ªæ ¸å¿ƒé—®é¢˜ã€‚AI ç»™å‡ºäº†è¿™æ ·çš„å›åº”ï¼š æˆ‘è®¤ä¸ºï¼Œå³ä½¿åœ¨ AI æ—¶ä»£ï¼Œmise è¿™æ ·çš„å·¥å…·ä¾ç„¶æœ‰å…¶ä¸å¯æ›¿ä»£çš„æ„ä¹‰ï¼Œä½†è¿™æ„ä¹‰çš„ä¾§é‡ç‚¹ä¼šå‘ç”Ÿå˜åŒ–ï¼š ä»â€œäººå·¥å¤„ç†çš„ä¾¿åˆ©æ€§â€è½¬å‘â€œç³»ç»Ÿçº§çš„å¯ç»´æŠ¤æ€§ä¸ä¸€è‡´æ€§â€ï¼š AI çš„å±€é™æ€§ï¼š å°½ç®¡ AI èƒ½å¤Ÿå¿«é€Ÿç”Ÿæˆå’Œå¤„ç†æ–‡ä»¶ï¼Œä½†å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªâ€œå·¥å…·â€ã€‚å®ƒç”Ÿæˆçš„å†…å®¹æœ€ç»ˆè¿˜æ˜¯è¦è¢«æ‰§è¡Œã€è¢«ç»´æŠ¤ã€è¢«ç†è§£ã€‚å½“ç¯å¢ƒé…ç½®åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶ä¸­æ—¶ï¼Œå³ä½¿æ˜¯ AIï¼Œä¹Ÿéœ€è¦èŠ±è´¹é¢å¤–çš„â€œè®¡ç®—èµ„æºâ€å»è§£æã€åè°ƒå’ŒéªŒè¯è¿™äº›æ–‡ä»¶ä¹‹é—´çš„å…³ç³»å’Œæ½œåœ¨å†²çªã€‚ ç»Ÿä¸€é…ç½®çš„ä¼˜åŠ¿ï¼š mise æä¾›äº†ä¸€ä¸ªå£°æ˜å¼ã€å•ä¸€çš„çœŸç›¸æ¥æº (Single Source of Truth)ã€‚è¿™æ„å‘³ç€ï¼š å‡å°‘é”™è¯¯é¢ï¼š å¤šä¸ªé…ç½®æ–‡ä»¶æ„å‘³ç€æ›´å¤šçš„æ½œåœ¨å†²çªç‚¹ã€ç‰ˆæœ¬ä¸ä¸€è‡´çš„é£é™©ã€‚å³ä½¿ AI ç”Ÿæˆï¼Œä¹Ÿå¯èƒ½å› ä¸ºé€»è¾‘å¤æ‚æ€§æˆ–å†å²é—ç•™é—®é¢˜å¯¼è‡´ç”Ÿæˆä¸å®Œå…¨ä¸€è‡´çš„é…ç½®ã€‚ä¸€ä¸ªç»Ÿä¸€çš„ .mise.toml ä»æ ¹æœ¬ä¸Šå‡å°‘äº†è¿™ç§é”™è¯¯çš„å¯èƒ½æ€§ã€‚ ç®€åŒ–è°ƒè¯•ï¼š å½“ç¯å¢ƒå‡ºç°é—®é¢˜æ—¶ï¼Œæ— è®ºæ˜¯äººç±»å¼€å‘è€…è¿˜æ˜¯ AI è¾…åŠ©çš„è¯Šæ–­ç³»ç»Ÿï¼Œéƒ½åªéœ€è¦æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸æ˜¯åœ¨å¤šä¸ªæ–‡ä»¶ä¸­æ¥å›è·³è·ƒï¼Œè¿™æå¤§åœ°ç®€åŒ–äº†é—®é¢˜æ’æŸ¥çš„æµç¨‹ã€‚ æå‡å¯å®¡è®¡æ€§ï¼š æ‰€æœ‰çš„ç¯å¢ƒå®šä¹‰éƒ½åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œè¿™ä½¿å¾—ç¯å¢ƒçš„å˜æ›´ã€å†å²ç‰ˆæœ¬è¿½æº¯å˜å¾—å¼‚å¸¸æ¸…æ™°ã€‚è¿™å¯¹äºå›¢é˜Ÿåä½œã€CI/CD æµç¨‹ä»¥åŠå®‰å…¨å®¡è®¡éƒ½è‡³å…³é‡è¦ã€‚ AI è‡ªèº«çš„æ•ˆç‡ï¼š å³ä½¿æ˜¯ AIï¼Œå¤„ç†ä¸€ä¸ªç»“æ„æ¸…æ™°ã€ç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿæ¯”å¤„ç†å¤šä¸ªåˆ†æ•£ã€æ ¼å¼å¯èƒ½ä¸ä¸€çš„æ–‡ä»¶æ›´é«˜æ•ˆã€æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚è¿™å°±åƒç»™ AI æä¾›ä¸€ä»½æ¸…æ™°çš„è“å›¾ï¼Œè€Œä¸æ˜¯ä¸€å †æ•£è½çš„é›¶ä»¶å›¾ã€‚ mise ä¸ä»…ä»…æ˜¯é…ç½®å®šä¹‰ï¼Œæ›´æ˜¯â€œç¯å¢ƒæ‰§è¡Œå™¨â€å’Œâ€œæ ‡å‡†åŒ–å¼ºåˆ¶è€…â€ï¼š mise çš„ä»·å€¼ä¸ä»…åœ¨äºå®ƒèƒ½æ›¿ä»£ .nvmrc æˆ– Gemfileï¼Œæ›´åœ¨äºå®ƒèƒ½è‡ªåŠ¨æ‰§è¡Œè¿™äº›é…ç½®ï¼Œç¡®ä¿ç¯å¢ƒçš„è‡ªåŠ¨åˆ‡æ¢å’Œéš”ç¦»ã€‚AI å¯ä»¥ç”Ÿæˆé…ç½®ï¼Œä½†å®ƒæ— æ³•ç›´æ¥åœ¨ä½ çš„ Shell ä¸­è‡ªåŠ¨åˆ‡æ¢ Node.js ç‰ˆæœ¬ï¼Œä¹Ÿæ— æ³•è‡ªåŠ¨æ¿€æ´» Python è™šæ‹Ÿç¯å¢ƒã€‚è¿™æ˜¯ mise ä½œä¸ºåº•å±‚å·¥å…·é“¾ç®¡ç†å™¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚ å®ƒå¼ºåˆ¶äº†å›¢é˜Ÿå†…éƒ¨çš„ç¯å¢ƒæ ‡å‡†åŒ–ã€‚AI å¯ä»¥ç”Ÿæˆç¬¦åˆæ ‡å‡†çš„é…ç½®ï¼Œä½† mise ç¡®ä¿äº†è¿™äº›æ ‡å‡†åœ¨æ¯ä¸ªå¼€å‘è€…çš„æœºå™¨ä¸Šéƒ½è¢«ä¸¥æ ¼æ‰§è¡Œã€‚ äººç±»ä»ç„¶æ˜¯æœ€ç»ˆçš„å†³ç­–è€…å’Œç›‘ç£è€…ï¼š å³ä½¿åœ¨ AI è¾…åŠ©çš„å¼€å‘æµç¨‹ä¸­ï¼Œäººç±»å¼€å‘è€…ä»ç„¶éœ€è¦ç†è§£é¡¹ç›®ã€å®¡æŸ¥ AI ç”Ÿæˆçš„ä»£ç å’Œé…ç½®ã€å¹¶å¯¹æœ€ç»ˆçš„ç³»ç»Ÿè´Ÿè´£ã€‚ä¸€ä¸ªç»Ÿä¸€ã€ç®€æ´çš„ç¯å¢ƒé…ç½®ï¼Œé™ä½äº†äººç±»ç†è§£å’Œä»‹å…¥çš„é—¨æ§›ï¼Œä½¿å¾—äººä¸ AI çš„åä½œæ›´åŠ é¡ºç•…ã€‚ ç»“è®ºï¼š åœ¨ AI æ—¶ä»£ï¼Œmise è¿™ç§å·¥å…·çš„æ„ä¹‰ä»â€œå‡è½»äººå·¥æ“ä½œçš„ç¹çâ€è½¬å‘äº†â€œæä¾›ä¸€ä¸ªæ›´å¥å£®ã€æ›´ä¸€è‡´ã€æ›´æ˜“äºç³»ç»Ÿçº§ç®¡ç†å’Œè°ƒè¯•çš„å¼€å‘ç¯å¢ƒåŸºç¡€è®¾æ–½â€ã€‚å®ƒä¸º AI ç”Ÿæˆçš„ä»£ç æä¾›äº†ä¸€ä¸ªç¨³å®šã€å¯é¢„æµ‹çš„è¿è¡ŒåŸºç¡€ï¼Œå¹¶ç®€åŒ–äº†æ•´ä¸ªå¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­çš„ç¯å¢ƒç®¡ç†å¤æ‚æ€§ã€‚AI å¯èƒ½ä¼šæ”¹å˜æˆ‘ä»¬ä¸è¿™äº›å·¥å…·äº¤äº’çš„æ–¹å¼ï¼Œä½†ä¸ä¼šæ¶ˆé™¤å®ƒä»¬æ‰€è§£å†³çš„æ ¹æœ¬é—®é¢˜ã€‚ç›¸åï¼Œä¸€ä¸ªé«˜åº¦è‡ªåŠ¨åŒ–çš„ AI å¼€å‘æµç¨‹ï¼Œåè€Œä¼šæ›´ä¾èµ–äºåº•å±‚ç¯å¢ƒçš„æ ‡å‡†åŒ–å’Œè‡ªåŠ¨åŒ–ï¼Œè€Œè¿™æ­£æ˜¯ mise çš„å¼ºé¡¹ã€‚ å°½ç®¡ AI çš„å›ç­”å¹¶éå…¨ç„¶æ— æ‡ˆå¯å‡»ï¼ˆä¾‹å¦‚ï¼ŒCursor å·²èƒ½è‡ªåŠ¨æ‰§è¡Œ Shell å‘½ä»¤ä»¥åˆ‡æ¢è‡³åˆé€‚çš„ç¯å¢ƒï¼‰ï¼Œä½†å…¶è®ºè¯ä¾ç„¶è¯´æœäº†æˆ‘ï¼Œä¿ƒä½¿æˆ‘æœ€ç»ˆå‘å¸ƒäº†è¿™ç¯‡æ–‡ç« ã€‚ æ­¤å¤–ï¼ŒAI çš„å›ç­”ä¹Ÿè®©æˆ‘æ·±åˆ‡ä½“ä¼šåˆ°ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­â€œæœ‰äº‹æ²¡äº‹å¤šé—®é—® AIâ€ç¡®å®æ˜¯ä¸€ä»¶å……æ»¡â€œå¹¸ç¦æ„Ÿâ€çš„äº‹æƒ…ã€‚è¿™è®©æˆ‘æƒ³èµ·åå¹´å‰æˆ‘ç‹¬è‡ªæ‘¸ç´¢ iOS å¼€å‘çš„è‰°éš¾å²æœˆï¼Œè€Œå¦‚ä»Šï¼Œä¸€ä½éšå«éšåˆ°çš„ AI åŠ©æ‰‹èƒ½å¤Ÿå®Œç¾æ‰®æ¼”äº¦å¸ˆäº¦å‹çš„è§’è‰²ï¼Œéšæ—¶è§£ç­”æˆ‘çš„ç–‘é—®ï¼Œå¸®åŠ©æˆ‘æ‹“å®½æ€è·¯ã€‚ ç°åœ¨å¯¹äºå­¦ä¹ æ–°çŸ¥è¯†è€Œè¨€ï¼Œå¯çœŸæ˜¯ä¸€ä¸ªå¥½çš„æ—¶ä»£ã€‚ ","link":"https://blog.rakuyo.dev/mise/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS","content":"æœ¬ç¯‡æ˜¯è®¡ç®—æœºç½‘ç»œç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦è®² URL å’Œ DNSã€‚ å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£ è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹ URL URLï¼Œå…¨ç§°æ˜¯ ç»Ÿä¸€èµ„æºå®šä½ç¬¦ (Uniform Resource Locator)ï¼Œæ˜¯æˆ‘ä»¬è®¿é—®äº’è”ç½‘ä¸Šä»»ä½•èµ„æºçš„â€œåœ°å€â€ã€‚å®ƒç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå…±åŒæŒ‡æ˜äº†â€œå»å“ªé‡Œâ€ä»¥åŠâ€œå¦‚ä½•å»â€ã€‚ åœ¨æ¥ä¸‹æ¥çš„å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†é€ä¸€è§£ææ„æˆ URL çš„å‡ ä¸ªæ ¸å¿ƒå…ƒç´ ã€‚ åŸŸå ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²åˆ°äº† IP å’Œç«¯å£ï¼Œç„¶è€Œç»å¤§å¤šæ•°çš„æ—¶å€™æˆ‘ä»¬åœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥çš„éƒ½ä¸æ˜¯è¿™äº›æ•°å­—ï¼Œè€Œæ˜¯ç”±è‹±æ–‡å­—æ¯å’Œéƒ¨åˆ†å­—ç¬¦ç»„æˆçš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ åŸŸåã€‚ å¯¹äºä¸€èˆ¬äººè€Œè¨€ï¼Œä¸€ä¸² IP åœ°å€å¾ˆéš¾è®°å¿†ï¼Œäººä»¬æ›´æ“…é•¿ä»¥å­—è¯ä¸ºå•ä½ï¼Œèµ‹äºˆåœ°å€å«ä¹‰å†åŠ ä»¥è®°å¿†ã€‚äºæ˜¯ä¹äººä»¬å‘æ˜äº† â€œåŸŸåâ€ è¿™ä¸ªæ¦‚å¿µï¼Œç”¨æ¥ä»£æ›¿ IP åœ°å€å»è®°å¿†ã€‚ åŸŸåçš„ç»“æ„ ä¸€ä¸ªåŸŸåé€šå¸¸ç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼Œç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”ï¼Œä»å³åˆ°å·¦çœ‹ï¼Œå±‚çº§è¶Šæ¥è¶Šå…·ä½“ã€‚ä»¥ www.google.com ä¸ºä¾‹ï¼Œè®©æˆ‘ä»¬æ¥å‰–æä¸€ä¸‹åŸŸåçš„æ ¼å¼å’Œç»“æ„ï¼š .comï¼šè¿™æ˜¯é¡¶çº§åŸŸå (Top-Level Domain, TLD)ã€‚å®ƒè¡¨ç¤ºåŸŸåçš„ç±»åˆ«ã€‚ googleï¼šè¿™æ˜¯äºŒçº§åŸŸå (Second-Level Domain, SLD)ã€‚è¿™æ˜¯åŸŸåçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€šå¸¸æ˜¯å…¬å¸ã€å“ç‰Œæˆ–ä¸ªäººçš„åç§°ã€‚è¿™æ˜¯ç”¨æˆ·æ³¨å†Œå’Œæ‹¥æœ‰çš„éƒ¨åˆ†ã€‚ wwwï¼šè¿™æ˜¯å­åŸŸåæ ‡ç­¾ (Subdomain Label)ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯é€‰çš„ã€ç”¨äºè¿›ä¸€æ­¥ç»†åˆ†ä¸»åŸŸåçš„â€œæ ‡ç­¾â€æˆ–â€œå‰ç¼€â€ã€‚ å®ƒå…è®¸ä½ åœ¨åŒä¸€ä¸ªä¸»åŸŸåä¸‹åˆ›å»ºä¸åŒçš„åˆ†åŒºæˆ–æœåŠ¡ã€‚ www æ˜¯æœ€å¸¸è§çš„å­åŸŸåï¼Œé€šå¸¸æŒ‡å‘ç½‘ç«™çš„ä¸»é¡µã€‚ å…¶ä»–å­åŸŸåä¹Ÿå¾ˆå¸¸è§ï¼Œæ¯”å¦‚ mail.google.com æŒ‡å‘é‚®ä»¶æœåŠ¡ï¼Œdrive.google.com æŒ‡å‘äº‘ç›˜æœåŠ¡ã€‚ è¿˜å¯ä»¥ä»æ•´ä½“çš„è§’åº¦çœ‹ä¸€ä¸‹ï¼š google.comï¼šè¿™è¢«ç§°ä¸ºä¸»åŸŸåï¼ˆMain Domainï¼‰ï¼Œå‡†ç¡®æ¥è¯´æ˜¯ â€œæ³¨å†ŒåŸŸâ€ï¼ˆRegistered Domainï¼‰ã€‚ å½“æˆ‘ä»¬è°ˆè®º â€œåŸŸåâ€ æ—¶ï¼Œé€šå¸¸æŒ‡çš„å°±æ˜¯è¿™ä¸€éƒ¨åˆ†ã€‚ é€šå¸¸ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨åŸŸåæ³¨å†Œå•†é‚£è¾¹è´­ä¹°çš„é‚£éƒ¨åˆ†ã€‚ www.google.comï¼šè¢«ç§°ä¸ºå®Œå…¨é™å®šåŸŸå (Fully Qualified Domain Name, FQDN) æˆ– ä¸»æœºå (Hostname) ä¹Ÿå¯ä»¥è¢«ç§°ä¸ºå­åŸŸå (Subdomain) æœ€åä»¥æœ¬ç«™ä¸ºä¾‹è¯´æ˜ä¸€ä¸‹åŸŸåçš„å„ä¸ªéƒ¨åˆ†ï¼š blog æ˜¯å­åŸŸåæ ‡ç­¾ rakuyoo æ˜¯äºŒçº§åŸŸå .top æ˜¯é¡¶çº§åŸŸå rakuyoo.top æ˜¯ä¸»åŸŸå blog.rakuyoo.top æ˜¯ä¸€ä¸ªå®Œå…¨é™å®šåŸŸåï¼ˆæˆ–å®Œæ•´çš„å­åŸŸåï¼‰ åè®® é™¤äº†åŸŸåä¹‹å¤–ï¼ŒURL è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼šåè®®ï¼ˆProtocolï¼‰ã€‚å®ƒæ˜¯ä¸€å¥—è§„åˆ™ã€æ ‡å‡†æˆ–çº¦å®šï¼Œè§„å®šäº†è®¡ç®—æœºä¹‹é—´å¦‚ä½•è¿›è¡Œé€šä¿¡å’Œæ•°æ®äº¤æ¢ã€‚åè®®å®šä¹‰äº†æ•°æ®ä¼ è¾“çš„æ ¼å¼ã€æ—¶åºã€é”™è¯¯å¤„ç†ç­‰ï¼Œå®ƒå°†å‘Šè¯‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨â€œå¦‚ä½•â€è¿›è¡Œé€šä¿¡ã€‚ å¸¸è§çš„åè®®æ¯”å¦‚ httpã€https ä»¥åŠ ftp ç­‰ï¼Œå› ä¸ºéƒ½éå¸¸å¸¸è§äº†ï¼Œæ‰€ä»¥åœ¨æœ¬æ–‡è¿™ä¸€å°èŠ‚å°±å…ˆä¸å±•å¼€ä»‹ç»äº†ã€‚æœªæ¥æ¶‰åŠåˆ° TCP æ•°æ®ä¼ è¾“æ—¶å¯èƒ½è¿˜ä¼šå†æ¬¡è§é¢ã€‚ åè®®å¯¹äº URL è€Œè¨€æ˜¯éå¸¸é‡è¦çš„ï¼Œå½“æˆ‘ä»¬è®¿é—® www.google.com æ—¶ï¼Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯ â€œç”¨ HTTPS åè®®è¿æ¥åˆ° www.google.comâ€ï¼Œè€Œä¸èƒ½åªè¯´ â€œè¿æ¥åˆ° www.google.comâ€ã€‚ åˆ«å¿˜äº† â€œç«¯å£â€ åœ¨æ²¡æœ‰åŸŸåæ—¶ï¼Œæˆ‘ä»¬è®¿é—®ä¸€ä¸ªæœåŠ¡æ˜¯é€šè¿‡ â€œIP åœ°å€ + ç«¯å£â€ æ¥å®ç°çš„ã€‚é‚£ä¹ˆæœ‰äº†åŸŸåä¹‹åå‘¢ï¼Ÿå¹³æ—¶æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åœ°å€æ—¶ä¹Ÿæ²¡æœ‰ç”¨åˆ°ç«¯å£å‘€ã€‚ å…¶å®ä¸æ˜¯æ²¡æœ‰ç”¨åˆ°ï¼Œè€Œæ˜¯æµè§ˆå™¨è‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†äº†ã€‚æ¯”å¦‚ https åè®®çš„é»˜è®¤ç«¯å£æ˜¯ 443ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ https://www.google.com æ—¶ï¼Œå…¶å®æˆ‘ä»¬è®¿é—®çš„æ˜¯ https://www.google.com:443ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è®¿é—®æŸä¸ªç‰¹æ®Šçš„ç«¯å£ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦åƒä¸Šé¢è¯´çš„é‚£æ ·æ˜¾å¼æŒ‡å®šç«¯å£å·ã€‚ DNSï¼šä¸€æœ¬åšå­—å…¸ åŸŸåå¸®åŠ©æˆ‘ä»¬çœå»äº†è®°å¿†å¤æ‚ IP çš„éº»çƒ¦ï¼Œé‚£ä¹ˆï¼ŒåŸŸåæ˜¯å¦‚ä½•æ‰¾åˆ°å…¶å¯¹åº”çš„ IP åœ°å€çš„å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡ DNSï¼ˆDomain Name Systemï¼‰ã€‚å—¯... ä»åå­—ä¸Šæ¥çœ‹å®ƒå°±å¾ˆ â€œåŸŸåâ€ã€‚ DNS çš„å·¥ä½œåŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰ å½“æˆ‘ä»¬è®¿é—®ä¸€ä¸ªåŸŸåæ—¶ï¼ŒDNS ä¼šé€šè¿‡ä¸€ç³»åˆ—æŸ¥è¯¢æ“ä½œï¼Œæ‰¾åˆ°è¿™ä¸ªåŸŸåæ‰€å¯¹åº”çš„ IP åœ°å€ï¼š åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸåï¼š åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ www.google.com å¹¶æŒ‰ä¸‹å›è½¦ã€‚ æµè§ˆå™¨æŸ¥è¯¢æœ¬åœ° DNS ç¼“å­˜ï¼š æµè§ˆå™¨ä¼šé¦–å…ˆæ£€æŸ¥è‡ªå·±æœ‰æ²¡æœ‰ç¼“å­˜è¿‡ www.google.com å¯¹åº”çš„ IP åœ°å€ã€‚å¦‚æœæœ‰ï¼Œå°±ç›´æ¥ä½¿ç”¨ï¼Œè¿™æ ·é€Ÿåº¦æœ€å¿«ã€‚ æ“ä½œç³»ç»ŸæŸ¥è¯¢æœ¬åœ° DNS ç¼“å­˜å’Œ hosts æ–‡ä»¶ï¼š å¦‚æœæµè§ˆå™¨æ²¡æœ‰ï¼Œå®ƒä¼šæŠŠè¯·æ±‚äº¤ç»™æ“ä½œç³»ç»Ÿã€‚æ“ä½œç³»ç»Ÿä¹Ÿä¼šæ£€æŸ¥è‡ªå·±çš„ DNS ç¼“å­˜ï¼Œä»¥åŠä¸€ä¸ªå«åš hosts çš„æœ¬åœ°æ–‡ä»¶ã€‚ è¯·æ±‚å‘é€ç»™ DNS è§£æå™¨ (DNS Resolver)ï¼š å¦‚æœæœ¬åœ°éƒ½æ²¡æœ‰ï¼Œæ“ä½œç³»ç»Ÿä¼šå°†è¯·æ±‚å‘é€ç»™ä½ çš„ç½‘ç»œé…ç½®ä¸­æŒ‡å®šçš„ DNS è§£æå™¨ï¼ˆé€šå¸¸æ˜¯ ISP æä¾›çš„ DNS æœåŠ¡å™¨ï¼Œæˆ–è€…æ‰‹åŠ¨é…ç½®çš„å…¬å…± DNSï¼Œå¦‚ Google çš„ 8.8.8.8ï¼‰ã€‚ DNS è§£æå™¨å¼€å§‹é€’å½’æŸ¥è¯¢ï¼š æŸ¥è¯¢æ ¹åŸŸåæœåŠ¡å™¨ (Root Name Servers)ï¼š è§£æå™¨ä¼šé¦–å…ˆé—®å…¨çƒçš„ 13 ç»„æ ¹åŸŸåæœåŠ¡å™¨ï¼šâ€œwww.google.com çš„ IP åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿâ€ æ ¹æœåŠ¡å™¨ä¸ä¼šç›´æ¥å‘Šè¯‰ä½  IPï¼Œå®ƒä¼šå‘Šè¯‰ä½ ï¼šâ€œæˆ‘ä¸çŸ¥é“ï¼Œä½†ä½ å¯ä»¥å»é—®è´Ÿè´£ .com åŸŸåçš„æœåŠ¡å™¨ã€‚â€ æŸ¥è¯¢é¡¶çº§åŸŸåæœåŠ¡å™¨ (TLD Name Servers)ï¼š è§£æå™¨æ¥ç€ä¼šå»é—®è´Ÿè´£ .com åŸŸåçš„ é¡¶çº§åŸŸåæœåŠ¡å™¨ï¼šâ€œwww.google.com çš„ IP åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿâ€ .com æœåŠ¡å™¨ä¼šå‘Šè¯‰ä½ ï¼šâ€œæˆ‘ä¸çŸ¥é“ www.google.com çš„å…·ä½“ IPï¼Œä½†ä½ å¯ä»¥å»é—®è´Ÿè´£ google.com çš„æƒå¨åŸŸåæœåŠ¡å™¨ã€‚â€ æŸ¥è¯¢æƒå¨åŸŸåæœåŠ¡å™¨ (Authoritative Name Servers)ï¼š è§£æå™¨æœ€åä¼šå»é—® google.com çš„æƒå¨åŸŸåæœåŠ¡å™¨ï¼ˆè¿™æ˜¯ç”± Google è‡ªå·±æˆ–å…¶åŸŸåæ³¨å†Œå•†ç»´æŠ¤çš„æœåŠ¡å™¨ï¼‰ï¼šâ€œwww.google.com çš„ IP åœ°å€æ˜¯ä»€ä¹ˆï¼Ÿâ€ è¿™å°æœåŠ¡å™¨çŸ¥é“ www.google.com å¯¹åº”çš„ç¡®åˆ‡ IP åœ°å€ï¼Œå¹¶ä¼šæŠŠè¿™ä¸ª IP åœ°å€å‘Šè¯‰ DNS è§£æå™¨ã€‚ IP åœ°å€è¿”å›ç»™æµè§ˆå™¨ï¼š DNS è§£æå™¨æ”¶åˆ° IP åœ°å€åï¼Œä¼šå°†å…¶è¿”å›ç»™ä½ çš„æ“ä½œç³»ç»Ÿï¼Œå†ç”±æ“ä½œç³»ç»Ÿè¿”å›ç»™æµè§ˆå™¨ã€‚åŒæ—¶ï¼Œè¿™ä¸ª IP åœ°å€ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ›´å¿«åœ°è®¿é—®ã€‚ æµè§ˆå™¨è¿æ¥æœåŠ¡å™¨ï¼š æµè§ˆå™¨æ‹¿åˆ° IP åœ°å€åï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ª IP åœ°å€è¿æ¥åˆ° Google çš„æœåŠ¡å™¨ï¼Œå¹¶è¯·æ±‚ç½‘é¡µå†…å®¹ã€‚è¿™ä¸ªå®Œæ•´ã€å±‚å±‚é€’è¿›çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„åºåˆ—å›¾æ¸…æ™°åœ°å±•ç°å‡ºæ¥ï¼š iOS ç³»ç»Ÿçš„ DNS è§£æå’Œ PC ä¸Šçš„ DNS è§£æè¿˜æœ‰ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œé‚£å°±æ˜¯ iOS ä¸å­˜åœ¨ â€œæµè§ˆå™¨ DNS ç¼“å­˜â€ è¿™ä¸€æ­¥ï¼Œæ‰€æœ‰çš„ DNS ç¼“å­˜éƒ½åœ¨ iOS ç³»ç»Ÿå†…éƒ¨è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚å„ä¸ª App å¦‚æœä¸åšç‰¹æ®Šçš„å®ç°ï¼Œä¹Ÿä¸å­˜åœ¨ â€œApp çº§åˆ«çš„ DNS ç¼“å­˜â€ã€‚ å¯èƒ½è¿™ä¸ªæµç¨‹è¿˜æ˜¯æœ‰ä¸€äº›æŠ½è±¡ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä» â€œç»‘å®š IP å’ŒåŸŸåâ€ çš„æµç¨‹ä¸­æ¥è§£é‡Š DNS çš„è§£æè¿‡ç¨‹ï¼š è·å– IPï¼šé¦–å…ˆæˆ‘ä»¬ä»äº‘æœåŠ¡å™¨å•†å¤„è´­ä¹°äº†ä¸€å°äº‘æœåŠ¡å™¨ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šå¾—åˆ°è¿™å°æœåŠ¡å™¨çš„ IP åœ°å€ã€‚ è´­ä¹°åŸŸåï¼šä¹‹åæˆ‘ä»¬ä»åŸŸåå•†é‚£é‡ŒæŒ‘é€‰äº†ä¸€ä¸ªåŸŸåã€‚å›½å†…çš„å‡ å¤§äº‘æœåŠ¡å™¨å‚å•†åŸºæœ¬éƒ½æä¾›åŸŸåè´­ä¹°æœåŠ¡ã€‚ é…ç½® DNS è§£æï¼šæœ‰å¾ˆå¤šåœ°æ–¹å¯ä»¥è®©æˆ‘ä»¬æŠŠ IP å’ŒåŸŸåç»‘å®šåœ¨ä¸€èµ·ï¼Œæ¯”å¦‚æœ‰çš„åŸŸåæ³¨å†Œå•†å°±æä¾›åŠŸèƒ½ï¼Œäº‘æœåŠ¡å•†ä¹Ÿæä¾›ï¼Œç”šè‡³è¿˜æœ‰ä¸“é—¨çš„ DNS æœåŠ¡å•†ã€‚åœ¨è¿™äº›å¹³å°ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å°†åŸŸåå’Œ IP ç»‘å®šåˆ°ä¸€èµ·ã€‚é€šå¸¸æ˜¯è®¾ç½®ä¸€æ¡è®°å½•ï¼Œkey å’Œ value å¡«å†™ä½ çš„åŸŸåå’Œ IPã€‚ ä¸Šä¼  DNS è®°å½•ï¼šå½“æˆ‘ä»¬é…ç½®å¥½äº† DNS åï¼Œå¹³å°å°±ä¼šå°†æˆ‘ä»¬çš„é…ç½®ä¸Šä¼ åˆ°çœŸæ­£çš„ DNS æœåŠ¡å™¨ä¸Šï¼Œæ­¤æ—¶åŸŸåä¸ IP çš„ç»‘å®šå…³ç³»æ‰ç®—å»ºç«‹å®Œæˆï¼ŒåŸŸåå’Œ IP è¢«çœŸæ­£çš„ç»‘å®šåœ¨ä¸€èµ·ã€‚ åç»­è®¿é—®ï¼šç°åœ¨å½“æˆ‘ä»¬å†è®¿é—®åŸŸåæ—¶ï¼Œä½ å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå·¨å¤§çš„æŸ¥è¡¨è¿‡ç¨‹ï¼Œé€šè¿‡åŸŸåå°±å¯ä»¥æŸ¥è¯¢åˆ°å¯¹åº”çš„ IP äº†ã€‚ DNS ç¼“å­˜ åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªåŸŸåéœ€è¦ç»è¿‡ä¸€è¿ä¸²çš„æŸ¥è¯¢æ‰èƒ½æœ€ç»ˆæ‰¾åˆ°å®ƒçš„ IP åœ°å€ã€‚å¦‚æœæ¯ä¸€æ¬¡è®¿é—®ç½‘ç«™éƒ½éœ€è¦é‡å¤è¿™ä¸ªå®Œæ•´çš„è¿‡ç¨‹ï¼Œé‚£æ•ˆç‡æœªå…ä¹Ÿå¤ªä½äº†ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒDNS ç³»ç»Ÿè®¾è®¡äº†ä¸€å¥—è‡³å…³é‡è¦çš„æœºåˆ¶â€”â€”ç¼“å­˜ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä¸€ä¸ª DNS æŸ¥è¯¢çš„æœ€ç»ˆç»“æœè¢«æ‰¾åˆ°åï¼ŒæŸ¥è¯¢è·¯å¾„ä¸Šçš„å„ä¸ªå‚ä¸è€…ï¼ˆæ¯”å¦‚ä½ çš„ç”µè„‘ã€DNS è§£æå™¨ï¼‰éƒ½ä¼šæŠŠè¿™ä¸ª â€œåŸŸå-IPâ€ çš„å¯¹åº”å…³ç³»æš‚å­˜ä¸€æ®µæ—¶é—´ã€‚å¦‚æœåœ¨ç¼“å­˜æœ‰æ•ˆæœŸå†…å†æ¬¡è¯·æ±‚åŒä¸€ä¸ªåŸŸåï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›æš‚å­˜çš„ç»“æœï¼Œä»è€Œè·³è¿‡å¤æ‚çš„é€’å½’æŸ¥è¯¢è¿‡ç¨‹ï¼Œæå¤§åœ°æé«˜äº†å“åº”é€Ÿåº¦ã€‚ æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„ â€œæµè§ˆå™¨ç¼“å­˜â€ å’Œ â€œæ“ä½œç³»ç»Ÿç¼“å­˜â€ å°±æ˜¯è¿™å¥—æœºåˆ¶çš„ä½“ç°ã€‚è€Œæ§åˆ¶è¿™ä¸€åˆ‡çš„æ ¸å¿ƒï¼Œæ˜¯ä¸€ä¸ªå«åš TTLï¼ˆTime-To-Liveï¼Œç”Ÿå­˜æ—¶é—´ï¼‰çš„å€¼ã€‚ TTL (Time-To-Live) TTL æ˜¯ç”±åŸŸåç®¡ç†å‘˜åœ¨é…ç½® DNS è®°å½•æ—¶è®¾ç½®çš„ä¸€ä¸ªæ•°å€¼ï¼Œå•ä½æ˜¯ç§’ã€‚å®ƒåƒä¸€ä¸ªâ€œä¿è´¨æœŸâ€ï¼Œå‘Šè¯‰å„çº§ DNS æœåŠ¡å™¨å’Œè§£æå™¨ï¼Œè¿™ä¸ªæŸ¥è¯¢ç»“æœå¯ä»¥è¢«ç¼“å­˜å¤šä¹…ã€‚ ä¾‹å¦‚ï¼Œæœ¬ç«™çš„ blog.rakuyoo.top çš„ TTL è¢«è®¾ç½®ä¸º 600 ç§’ï¼ˆ10 åˆ†é’Ÿï¼‰ï¼Œé‚£ä¹ˆå½“ DNS è§£æå™¨ç¬¬ä¸€æ¬¡è·å–åˆ°å®ƒçš„ IP åœ°å€åï¼Œå°±ä¼šå°†è¿™ä¸ªç»“æœç¼“å­˜ 10 åˆ†é’Ÿã€‚åœ¨è¿™ 10 åˆ†é’Ÿå†…ï¼Œä»»ä½•é€šè¿‡è¿™ä¸ªè§£æå™¨æŸ¥è¯¢ blog.rakuyoo.top çš„è¯·æ±‚ï¼Œéƒ½ä¼šç›´æ¥å¾—åˆ°ç¼“å­˜ä¸­çš„ IP åœ°å€ï¼Œè€Œæ— éœ€å†å»éº»çƒ¦æƒå¨åŸŸåæœåŠ¡å™¨ã€‚ DNS ä¼ æ’­ TTL æœºåˆ¶åœ¨å¸¦æ¥é«˜æ•ˆçš„åŒæ—¶ï¼Œä¹Ÿå¼•å…¥äº†ä¸€ä¸ªé‡è¦çš„ç°è±¡ï¼šDNS ä¼ æ’­ï¼ˆDNS Propagationï¼‰ã€‚ å½“ä½ ä¿®æ”¹äº†ä¸€æ¡ DNS è®°å½•ï¼ˆæ¯”å¦‚å°†ç½‘ç«™æœåŠ¡å™¨è¿ç§»åˆ°äº†ä¸€ä¸ªæ–°çš„ IP åœ°å€ï¼‰ï¼Œè¿™ä¸ªå˜æ›´å¹¶ä¸ä¼šç«‹å³åœ¨å…¨çƒèŒƒå›´å†…ç”Ÿæ•ˆã€‚å› ä¸ºå„åœ°çš„ DNS è§£æå™¨ä»ç„¶ç¼“å­˜ç€æ—§çš„è®°å½•ï¼Œå®ƒä»¬éœ€è¦ç­‰åˆ°å„è‡ªç¼“å­˜ä¸­çš„ TTL è¿‡æœŸåï¼Œæ‰ä¼šé‡æ–°å‘æƒå¨æœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ä»¥è·å–æœ€æ–°çš„è®°å½•ã€‚ è¿™ä¸ªæ–°æ—§è®°å½•äº¤æ›¿ã€å˜æ›´ä¿¡æ¯é€æ¸æ‰©æ•£åˆ°å…¨çƒçš„è¿‡ç¨‹ï¼Œå°±å«åš DNS ä¼ æ’­ã€‚ä¼ æ’­æ‰€éœ€çš„æ—¶é—´ï¼Œå°±å–å†³äºä½ ä¹‹å‰è®¾ç½®çš„ TTL å€¼ã€‚å¦‚æœ TTL è®¾ç½®ä¸º 1 å°æ—¶ï¼Œé‚£ä¹ˆæœ€åæƒ…å†µä¸‹ï¼Œä¸€äº›ç”¨æˆ·å¯èƒ½éœ€è¦ç­‰å¾… 1 å°æ—¶æ‰èƒ½è®¿é—®åˆ°ä½ çš„æ–°æœåŠ¡å™¨ã€‚ å› æ­¤ï¼Œåœ¨è®¡åˆ’è¿›è¡ŒæœåŠ¡å™¨è¿ç§»ç­‰é‡å¤§å˜æ›´å‰ï¼Œæœ‰ç»éªŒçš„ç®¡ç†å‘˜é€šå¸¸ä¼šæå‰å‡ å¤©å°†ç›¸å…³åŸŸåçš„ TTL å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªéå¸¸å°çš„å€¼ï¼ˆæ¯”å¦‚ 60 ç§’ï¼‰ï¼Œä»¥ç¡®ä¿å˜æ›´å‘ç”Ÿæ—¶ï¼Œå…¨çƒçš„ DNS ç¼“å­˜èƒ½è¢«å¿«é€Ÿåˆ·æ–°ï¼Œä»è€Œå®ç°å¹³æ»‘è¿‡æ¸¡ã€‚ çµæ´»çš„ç»‘å®šå…³ç³» ä¸€ä¸ªä¸»æœºåå…¶å®å¯ä»¥è§£æåˆ°å¤šä¸ª IPï¼Œè¿™æœ‰åˆ©äºå®ç°è´Ÿè½½å‡è¡¡ã€‚åªéœ€è¦åœ¨é…ç½® DNS è§£ææ—¶ï¼Œä¸ºåŒä¸€ä¸ªä¸»æœºåæ·»åŠ å¤šä¸ª IP åœ°å€ï¼Œå³å¯å°†ä¸€ä¸ªä¸»æœºåè§£æåˆ°å¤šä¸ª IP ä¸Šã€‚ å½“ç”¨æˆ·è®¿é—®è¿™ä¸ªä¸»æœºåæ—¶ï¼ŒDNS æœåŠ¡å™¨ä¼šåŒæ—¶è¿”å›æ‰€æœ‰çš„ IP åœ°å€ï¼Œå®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚æµè§ˆå™¨ï¼‰ä¼šå°è¯•è¿æ¥å…¶ä¸­ä¸€ä¸ªï¼Œå¯èƒ½æ˜¯éšæœºé€‰æ‹©æŸä¸€ä¸ªï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æŒ‰é¡ºåºå°è¯•ã€‚å¦‚æœè¿æ¥å¤±è´¥ï¼Œåˆ™ä¼šå°è¯•åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ª IPã€‚ å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥ä»¥å­åŸŸåæ ‡ç­¾ä¸ºå•ä½ï¼Œæˆ–è€…å‡†ç¡®çš„è¯´ï¼Œä»¥ â€œå®Œå…¨é™å®šåŸŸåâ€ ä¸ºå•ä½è®¾ç½® DNS è§£æã€‚æ¯”å¦‚ mail.google.com å’Œ drive.google.com è™½ç„¶éƒ½åœ¨ google.com è¿™ä¸ªåŸŸåä¸‹ï¼Œä½†æ˜¯ä»–ä»¬å¯ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œè¿›è€Œæ‹¥æœ‰ä¸åŒçš„ IP åœ°å€ã€‚ èµ„æºè®°å½• åœ¨ä½ æ·»åŠ  DNS è§£ææ—¶ï¼Œä¼šæ¥è§¦åˆ° â€œèµ„æºè®°å½•â€ï¼ˆResource Recordï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œåœ¨è…¾è®¯äº‘æœåŠ¡å™¨ä¸Šå®ƒåˆå«åš â€œè®°å½•ç±»å‹â€ã€‚ DNS ååˆ†å¼ºå¤§ï¼Œå¼ºå¤§åˆ°å®ƒå…¶å®å¯ä»¥è§£æå¾ˆå¤šä¸œè¥¿ã€‚æ‰€ä»¥ç³»ç»Ÿè®¾è®¡äº†ä¸€ä¸ª â€œèµ„æºè®°å½•â€ çš„æ¦‚å¿µï¼Œç”¨æ¥åŒºåˆ† DNS æ‰€è§£æçš„å†…å®¹çš„ç±»å‹ã€‚å¸¸è§çš„èµ„æºè®°å½•æœ‰ä»¥ä¸‹å‡ ç§ï¼š A è®°å½• (Address Record) å°†ä¸€ä¸ªåŸŸåæˆ–å­åŸŸåæŒ‡å‘ä¸€ä¸ª IPv4 åœ°å€ã€‚å®ƒæ˜¯æœ€åŸºæœ¬çš„è®°å½•ç±»å‹ã€‚ AAAA è®°å½• (Quad-A Record) ä¸ A è®°å½•ç±»ä¼¼ï¼Œä½†å®ƒå°†ä¸€ä¸ªåŸŸåæˆ–å­åŸŸåæŒ‡å‘ä¸€ä¸ª IPv6 åœ°å€ã€‚ CNAME è®°å½• (Canonical Name Record) å°†ä¸€ä¸ªåŸŸåæˆ–å­åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼ˆè€Œä¸æ˜¯ç›´æ¥æŒ‡å‘ IP åœ°å€ï¼‰ï¼Œç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ªåˆ«åã€‚å®ƒæœ‰ä»¥ä¸‹å‡ ç§ä½¿ç”¨åœºæ™¯ï¼š å½“ä½ çš„æœåŠ¡æä¾›å•†ï¼ˆå¦‚ CDNã€åšå®¢å¹³å°ï¼‰ç»™ä½ ä¸€ä¸ªåŸŸåï¼ˆè€Œä¸æ˜¯ IP åœ°å€ï¼‰è®©ä½ æŒ‡å‘æ—¶ã€‚ å½“ä½ å¸Œæœ›å¤šä¸ªå­åŸŸåéƒ½æŒ‡å‘åŒä¸€ä¸ªä¸»åŸŸåï¼Œè€Œä¸»åŸŸåçš„ IP åœ°å€å¯èƒ½ä¼šå˜åŠ¨æ—¶ã€‚è¿™æ ·ä½ åªéœ€è¦æ›´æ–°ä¸»åŸŸåçš„ A è®°å½•ï¼Œæ‰€æœ‰ CNAME è®°å½•éƒ½ä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚ å¦å¤–éœ€è¦æ³¨æ„ï¼š CNAME è®°å½•ä¸èƒ½æŒ‡å‘ IP åœ°å€ï¼Œåªèƒ½æŒ‡å‘å¦ä¸€ä¸ªåŸŸåã€‚è€Œä¸”ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ ¹åŸŸåï¼ˆå¦‚ yourdomain.comï¼‰ä¸èƒ½è®¾ç½®ä¸º CNAME è®°å½•ï¼Œå› ä¸ºå®ƒä¼šä¸å…¶ä»–è®°å½•ï¼ˆå¦‚ MX è®°å½•ï¼‰å†²çªã€‚ æ ¹æ® DNS è§„èŒƒï¼ˆRFC 1034ï¼‰ï¼Œå¦‚æœä¸€ä¸ªåŸŸåå­˜åœ¨ CNAME è®°å½•ï¼Œé‚£ä¹ˆå®ƒå°±ä¸èƒ½å†æœ‰ä»»ä½•å…¶ä»–ç±»å‹çš„è®°å½•ï¼ˆé™¤äº†ç”¨äº DNSSEC çš„ RRSIG å’Œ NSEC è®°å½•ï¼‰ã€‚è€Œä¸€ä¸ªåŸŸçš„é¡¶ç‚¹ï¼ˆå³ yourdomain.com æœ¬èº«ï¼‰å¿…é¡»æœ‰ SOA (Start of Authority) å’Œ NS (Name Server) è®°å½•æ¥æ ‡è¯†è¿™ä¸ªåŸŸçš„æƒå¨ä¿¡æ¯ã€‚è¿™ä¸¤è€…æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥æ ¹åŸŸåä¸èƒ½è®¾ç½® CNAMEã€‚ æœ¬æ–‡å¹¶æœªæ¶‰åŠåˆ° SOA è®°å½•å’Œ NS è®°å½•ç­‰ï¼Œæ­¤å¤„ä»…ä½œä¸ºæ‹“å±•é˜…è¯»ã€‚ Swift URL ç›¸ä¿¡é˜…è¯»åˆ°æ­¤æ–‡ç« çš„å¤§å¤šæ•°éƒ½æ˜¯ iOSerï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†ä» Swift URL çš„è§’åº¦æ¥çœ‹ä¸€ä¸‹åŸŸåçš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œç›´æ¥ä¸Šä»£ç ï¼š let urlString = &quot;https://www.google.com:443&quot; // 1. åˆ›å»º URL å¯¹è±¡ guard let url = URL(string: urlString) else { print(&quot;Invalid URL string&quot;) exit(1) } // 2. è®¿é—® URL çš„å„ä¸ªå±æ€§ print(&quot;Scheme (åè®®): \\(url.scheme ?? &quot;N/A&quot;)&quot;) print(&quot;Host (ä¸»æœºå/åŸŸå): \\(url.host ?? &quot;N/A&quot;)&quot;) print(&quot;Port (ç«¯å£): \\(url.port?.description ?? &quot;N/A&quot;)&quot;) // 3. è¿›ä¸€æ­¥æ‹†è§£ host // Swift çš„ URL ç±»å‹æ²¡æœ‰ç›´æ¥æä¾›â€œäºŒçº§åŸŸåâ€æˆ–â€œé¡¶çº§åŸŸåâ€çš„å±æ€§ // ä½ éœ€è¦è‡ªå·±ç¼–å†™é€»è¾‘æ¥ä» host ä¸­æå–è¿™äº›ä¿¡æ¯ let host = url.host ?? &quot;&quot; let components = host.split(separator: &quot;.&quot;).map(String.init) if components.count &gt;= 2 { let tld = components.last ?? &quot;N/A&quot; // .com let sld = components[components.count - 2] // google let mainDomain = &quot;\\(sld).\\(tld)&quot; // google.com print(&quot;æ¨æ–­çš„ä¸»åŸŸå (Main Domain): \\(mainDomain)&quot;) if components.count &gt; 2 { let subdomainLabel = components.first ?? &quot;N/A&quot; // www print(&quot;æ¨æ–­çš„å­åŸŸåæ ‡ç­¾ (Subdomain Label): \\(subdomainLabel)&quot;) } } è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š Scheme (åè®®): https Host (ä¸»æœºå): www.google.com Port (ç«¯å£): 443 æ¨æ–­çš„ä¸»åŸŸå (Main Domain): google.com æ¨æ–­çš„å­åŸŸåæ ‡ç­¾ (Subdomain Label): www è¯´ä¸€ä¸ªå°ç»†èŠ‚ï¼šè¿˜è®°å¾—ä¸Šæ–‡ä¸­æˆ‘è¯´è¿‡ â€œåè®®å¯¹äº URL æ¥è¯´å¾ˆé‡è¦â€ å—ï¼Ÿå¦‚æœå°†ç¤ºä¾‹ä¸­ urlString çš„ https éƒ¨åˆ†å»æ‰ï¼Œæ”¹ä¸º www.google.com:443ï¼Œé‚£ä¹ˆ url.scheme çš„ç»“æœå°†ä¼šæ˜¯ www.google.comï¼Œurl.host ä¼šæ˜¯ nilã€‚ è¿™æ˜¯å› ä¸º Swift çš„ URL åœ¨è§£æ URL å­—ç¬¦ä¸²æ—¶ï¼Œä¼šä¸¥æ ¼æŒ‰ç…§ URL çš„æ ‡å‡†æ ¼å¼æ¥è¯†åˆ«å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œè€Œä¸€ä¸ªæ ‡å‡†çš„ URL å¿…é¡»ä»¥åè®®å¼€å¤´ï¼Œåé¢è·Ÿç€ ://ã€‚ å¯¹äº www.google.com:443 è€Œè¨€ï¼ŒURL åˆå§‹åŒ–å™¨ä¼šå°† : å‰çš„å†…å®¹éƒ½è¯†åˆ«ä¸ºåè®®ã€‚å‡å¦‚æ¢æˆ www.google.comï¼Œå³å­—ç¬¦ä¸²ä¸­æ²¡æœ‰ :ï¼Œé‚£ä¹ˆ url.scheme å’Œ url.host éƒ½å°†æ˜¯ nilã€‚ ","link":"https://blog.rakuyo.dev/computer-network-url-and-dns/"},{"title":"è§£å¯† Swiftï¼šä¸ºä½• reduce åçˆ± + è€Œé && ï¼Ÿ","content":"ä½œä¸º Swift å¼€å‘è€…ï¼Œæˆ‘ä»¬éƒ½çƒ­çˆ±è¿™é—¨è¯­è¨€æä¾›çš„ä¼˜é›…å’Œç®€æ´æ€§ï¼Œå°¤å…¶æ˜¯å®ƒçš„å‡½æ•°å¼ç¼–ç¨‹èƒ½åŠ›ã€‚ Swift åŸç”Ÿæä¾›äº†ä¸€äº›é«˜é˜¶å‡½æ•°ï¼Œå¸¸è§çš„æ¯”å¦‚ mapã€filterã€reduce ç­‰ã€‚è¿™äº›ä¼˜é›…çš„é«˜é˜¶å‡½æ•°èƒ½å¤Ÿæå¤§çš„ç®€åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œä½†æ˜¯ä¸€ä¸ªä¸å°å¿ƒä¹Ÿä¼šæŠ¥ä¸€ä¸ªè®©ä½ å›°æ‰°ä¸€æ•´å¤©çš„é”™è¯¯ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹å…¶ä¸­ä¸€ç§æƒ…å†µã€‚ æ€è€ƒä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šå¯¹ä¸€ä¸ªæ•´æ•°æ•°ç»„æ±‚å’Œã€‚ä½¿ç”¨ reduce å‡½æ•°å¯ä»¥å†™å¾—éå¸¸ç®€æ´ï¼š let numbers = [1, 2, 3, 4, 5] // å†—é•¿ä½†æ¸…æ™°çš„å†™æ³• let sum1 = numbers.reduce(0) { (accumulator, nextElement) in accumulator + nextElement } // ç®€å•å†™æ³• let sum1 = numbers.reduce(0) { $0 + $1 } // æç®€å†™æ³• let sum2 = numbers.reduce(0, +) + å·å¯ä»¥ç›´æ¥ä½œä¸º reduce æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»è€Œè¿›ä¸€æ­¥ç®€åŒ–ä»£ç ã€‚è¿™å¾ˆå¥½ï¼Œéå¸¸ç®€æ´ã€‚ okï¼Œç°åœ¨è®©æˆ‘ä»¬å°è¯•ç”¨åŒæ ·çš„é€»è¾‘æ¥å¤„ç†ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„æ•°ç»„ï¼Œæ£€æŸ¥æ˜¯å¦æ‰€æœ‰å€¼éƒ½ä¸º trueï¼š let conditions = [true, true, false] let allTrue1 = conditions.reduce(true) { $0 &amp;&amp; $1 } // âœ… å·¥ä½œæ­£å¸¸ let allTrue2 = conditions.reduce(true, &amp;&amp;) // âŒ ç¼–è¯‘é”™è¯¯ï¼ å“¦å™¢ï¼Œç¼–è¯‘é”™è¯¯äº†ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆ + å¯ä»¥ç›´æ¥ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œ&amp;&amp; å´ä¸è¡Œï¼Ÿå…¶å®è¿™èƒŒåéšè—ç€ä¸€ä¸ªå…³äº Swift è¯­è¨€è®¾è®¡çš„æ·±åˆ»ä¸”é‡è¦çš„åŒºåˆ«ã€‚ + è¿ç®—ç¬¦ï¼šâ€œä¸€ç­‰å…¬æ°‘â€ Swift æ ‡å‡†åº“ä¸­åŒ…å«ä¸€ä¸ªåå« AdditiveArithmetic çš„åè®®ï¼Œè¿™ä¸ªåè®®ä¸­å®šä¹‰äº†åŒ…æ‹¬ + åœ¨å†…çš„å¤šä¸ªå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥ä» Github ä¸­æŸ¥çœ‹åˆ°å®ƒçš„æºç ï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œã€‚ æ‰€ä»¥ + å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ä¹Ÿå°±ä¸å¥‡æ€ªäº† â€”â€” å®ƒæœ¬èº«å°±æ˜¯ Swift ä¸­çš„ â€œä¸€ç­‰å…¬æ°‘â€ï¼šå‡½æ•°ï¼Œå› æ­¤å¯ä»¥è¢«ç›´æ¥ä¼ å…¥ä»»ä½•æ¥å—å¯¹åº”å‡½æ•°ç±»å‹çš„å‚æ•°ä¸­ã€‚ &amp;&amp; è¿ç®—ç¬¦ï¼šé‡è¦çš„â€œçŸ­è·¯â€ç‰¹æ€§ ç›¸æ¯”è¾ƒ + è€Œè¨€ï¼Œ&amp;&amp; å’Œ || è¿™ç±»é€»è¾‘è¿ç®—ç¬¦æœ‰ä¸€ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼Œå³ çŸ­è·¯æ±‚å€¼ (Short-circuit Evaluation)ï¼š å¯¹äº a &amp;&amp; bï¼Œå¦‚æœ a çš„ç»“æœæ˜¯ falseï¼Œé‚£ä¹ˆæ•´ä¸ªè¡¨è¾¾å¼çš„ç»“æœå°±å·²ç»ç¡®å®šæ˜¯ false äº†ã€‚å› æ­¤ï¼Œb å°†æ°¸è¿œä¸ä¼šè¢«æ±‚å€¼æˆ–æ‰§è¡Œã€‚ å¯¹äº a || bï¼Œå¦‚æœ a çš„ç»“æœæ˜¯ trueï¼Œæ•´ä¸ªè¡¨è¾¾å¼å°±å·²ç»ç¡®å®šæ˜¯ trueï¼Œb ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œã€‚ è¿™ä¸ªç‰¹æ€§è‡³å…³é‡è¦ï¼Œå®ƒä¸ä»…èƒ½æå‡æ€§èƒ½ï¼Œè¿˜èƒ½é¿å…æ½œåœ¨çš„è¿è¡Œæ—¶é”™è¯¯ï¼Œæ¯”å¦‚æˆ‘ä»¬ç»å¸¸å†™çš„ä»£ç ï¼š if user != nil &amp;&amp; user!.hasPermission { // å¦‚æœ user æ˜¯ nilï¼Œç¬¬äºŒä¸ªæ¡ä»¶æ ¹æœ¬ä¸ä¼šè¢«æ£€æŸ¥ï¼Œä»è€Œé¿å…äº†å¼ºåˆ¶è§£åŒ…å¯¼è‡´çš„å´©æºƒã€‚ } è€Œä¸€ä¸ªæ™®é€šçš„ Swift å‡½æ•°ï¼Œåœ¨å®ƒè¢«è°ƒç”¨ä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰å‚æ•°éƒ½å¿…é¡»è¢«å®Œæ•´åœ°æ±‚å€¼ã€‚å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„å®éªŒæ¥è¯æ˜è¿™ä¸€ç‚¹ï¼š func getFalse() -&gt; Bool { print(&quot;getFalse() è¢«è°ƒç”¨äº†&quot;) return false } func getTrue() -&gt; Bool { print(&quot;getTrue() è¢«è°ƒç”¨äº†&quot;) return true } // å¦‚æœ &amp;&amp; æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œå®ƒä¼šåƒè¿™æ ·å·¥ä½œï¼š func logicalAnd(_ a: Bool, _ b: Bool) -&gt; Bool { return a &amp;&amp; b } print(&quot;\\n--- æµ‹è¯•æ™®é€šå‡½æ•° ---&quot;) _ = logicalAnd(getFalse(), getTrue()) // è¾“å‡º: // --- æµ‹è¯•æ™®é€šå‡½æ•° --- // getFalse() è¢«è°ƒç”¨äº† // getTrue() è¢«è°ƒç”¨äº† &lt;-- ä¸¤ä¸ªå‚æ•°å¯¹åº”çš„å‡½æ•°éƒ½è¢«æ‰§è¡Œäº† ä»è¾“å‡ºç»“æœæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼šâ€œçŸ­è·¯â€ è¿™ä¸ªè¡Œä¸ºæ— æ³•è¢«æ™®é€šå‡½æ•°æ¨¡æ‹Ÿ ... åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹å®ƒçš„æºç ã€‚ å®é™…ä¸Šåœ¨ Swift æ ‡å‡†åº“ä¸­ï¼Œ&amp;&amp; å’Œ || åŒæ ·æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œä»–ä»¬çš„å®šä¹‰åˆ†åˆ«å¦‚ä¸‹æ‰€ç¤ºï¼š extension Bool { /// Performs a logical AND operation on two Boolean values. @_transparent @inline(__always) public static func &amp;&amp; (lhs: Bool, rhs: @autoclosure () throws -&gt; Bool) rethrows -&gt; Bool { return lhs ? try rhs() : false } /// Performs a logical OR operation on two Boolean values. @_transparent @inline(__always) public static func || (lhs: Bool, rhs: @autoclosure () throws -&gt; Bool) rethrows -&gt; Bool { return lhs ? true : try rhs() } } æ ‡å‡†åº“é€šè¿‡ä¸‰ç›®è¿ç®—ç¬¦ä»¥åŠ @autoclosureï¼Œå·§å¦™åœ°å®ç°äº†çŸ­è·¯æ±‚å€¼çš„åŠŸèƒ½ã€‚ ä½†æ˜¯ç»•äº†ä¸€åœˆï¼Œæ—¢ç„¶ &amp;&amp; ä¹Ÿæ˜¯å‡½æ•°ï¼Œä¸ºä»€ä¹ˆä¸èƒ½åƒ + ä¸€æ ·ä½œä¸ºå‚æ•°ä¼ å…¥ reduce å‡½æ•°å‘¢ï¼Ÿå…¶å®æˆ‘å·å·æŠŠæŠ¥é”™ä¿¡æ¯è—èµ·æ¥äº†ã€‚è®©æˆ‘æŠŠå®ƒæ”¾å‡ºæ¥ï¼Œå†çœ‹ä¸€ä¸‹ä¸Šé¢ä¾‹å­ä¸­çš„é”™è¯¯ï¼š [true, true, false].reduce(true, &amp;&amp;) // âŒ Cannot convert value of type '(Bool, @autoclosure () throws -&gt; Bool) throws -&gt; Bool' to expected argument type '(Bool, Bool) throws -&gt; Bool' æŠ¥é”™è¯´çš„å¾ˆç›´æ¥ï¼šæ— æ³•å°† (Bool, @autoclosure () throws -&gt; Bool) throws -&gt; Bool ç±»å‹è½¬æ¢ä¸º (Bool, Bool) throws -&gt; Boolï¼Œä¹Ÿå°±æ˜¯ @autoclosure () -&gt; Bool æ— æ³•è¢«ç›´æ¥å½“åš Bool æ¥ä¼ é€’ã€‚æ‰€ä»¥ç›´æ¥åŸå› è¿˜æ˜¯ç±»å‹è½¬æ¢çš„é—®é¢˜ã€‚ ç”¨ä¸€æ®µä»£ç å¯ä»¥æ›´å¥½åœ°è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼š func foo(_ action: (Bool, @autoclosure () /*throws*/ -&gt; Bool) throws -&gt; Bool) { /* ... */ } foo(&amp;&amp;) // `&amp;&amp;` å¯ä»¥ä½œä¸ºå‚æ•°æ­£å¸¸ä½¿ç”¨äº† @autoclosureï¼šå·§å¦™çš„è¯­æ³•ç³– @autoclosure æ˜¯ä¸€ä¸ªçº¯ç²¹çš„è¯­æ³•ç³–ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼šæŠŠè°ƒç”¨æ—¶å†™åœ¨è¿™é‡Œçš„è¡¨è¾¾å¼è‡ªåŠ¨åŒ…æˆä¸€ä¸ªé—­åŒ…ï¼Œè€Œä¸æ˜¯ç«‹å³æ±‚å€¼ã€‚ æ‰€ä»¥ @autoclosure () -&gt; Bool æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªé—­åŒ…ç±»å‹ () -&gt; Boolï¼Œå®ƒä¸æ˜¯ä¹Ÿæ²¡æœ‰åŠæ³•è½¬æ¢æˆä¸€ä¸ª Bool ç±»å‹ã€‚è‡³å°‘åœ¨ Swift 6 æ—¶ä»£è¿˜æ²¡æœ‰è¿™ç§ç‰¹æ€§ã€‚ å¦‚æœæ²¡æœ‰ @autoclosureï¼Œå½“æˆ‘ä»¬æƒ³é€šè¿‡é—­åŒ…æ¥å®ç° â€œå»¶è¿Ÿè°ƒç”¨â€ æ—¶ï¼Œå¯èƒ½å°±è¦æƒ³ä¸€æƒ³ â€œç”¨é—­åŒ…å†é¢å¤–åŒ…ä¸€å±‚â€ è¿™ç§ä¸ä¼˜é›…çš„å®ç°ï¼Œä¼šä¸ä¼šè®©è‡ªå·±çš„æ—©é¤åå‡ºæ¥ï¼š // `assert` æ–­è¨€é€šè¿‡é—­åŒ…å®ç°äº†åˆ¤æ–­æ¡ä»¶çš„å»¶è¿Ÿè°ƒç”¨ï¼Œè¿›è€Œåœ¨ RELEASE æ¨¡å¼ä¸‹è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚ // å‡è®¾ä¸‹é¢æ˜¯ assert å‡½æ•°çš„ç®€åŒ–å®šä¹‰ func assert(_ condition: /* @autoclosure */ () -&gt; Bool, ...) { ... } // å¦‚æœæ²¡æœ‰ @autoclosureï¼Œè°ƒç”¨æ—¶å°±å¿…é¡»æ‰‹åŠ¨åŒ…è£¹ä¸€å±‚é—­åŒ… assert({ a &gt; b }) æ€»ç»“ æ€»ç»“ä¸€ä¸‹ï¼ŒSwift ä» 1.0 å¼€å§‹å°±å¼€å§‹ä½¿ç”¨ @autoclosure æ¥ä¼˜é›…åœ°å®ç°é€»è¾‘è¿ç®—ç¬¦çš„çŸ­è·¯æ±‚å€¼ï¼Œæˆ–è€…å…¶ä»–å»¶è¿Ÿæ±‚å€¼çš„ç›¸å…³é€»è¾‘ã€‚è¿™ä¹Ÿå¯¼è‡´äº† &amp;&amp; å’Œ || è¿™ä¸¤ä¸ªé€»è¾‘è¿ç®—ç¬¦ä¸èƒ½åƒæ™®é€šçš„è¿ç®—ç¬¦ä¸€æ ·é‚£ä¹ˆåœ° â€œè‡ªç”±â€ã€‚ å¦‚æœæœ‰éœ€è¦ï¼Œå¼€å‘è€…å¯ä»¥è‡ªè¡Œå°è£…ç›¸å…³å‡½æ•°ï¼Œä»è€Œä¸ºé€»è¾‘è¿ç®—ç¬¦æ’ä¸Šè‡ªç”±åœ°ç¿…è†€ã€‚ ","link":"https://blog.rakuyo.dev/why-swift-reduce-prefers-plus-over-and/"},{"title":"è®¡ç®—æœºç½‘ç»œä¹‹ä¸€ - IP ä¸ç«¯å£","content":"æœ€è¿‘åœ¨ç ”ç©¶ Surgeï¼Œä¼—æ‰€å‘¨çŸ¥ä¸»åŒ…è¿™æ–¹é¢çŸ¥è¯†è´¼å·®ï¼Œå‡ ä¹å¯ä»¥ç®—æ˜¯ä»é›¶å¼€å§‹å­¦èµ·ï¼Œæ‰€ä»¥ä¹Ÿæƒ³å€Ÿè¿™ä¸ªæœºä¼šå¥½å¥½è¡¥ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ã€‚ é¢„è®¡ä¼šå†™ä¸€ç³»åˆ—æ–‡ç« ï¼Œä»è®¡ç®—æœºç½‘ç»œçš„åŸºç¡€æ¦‚å¿µå¼€å§‹ï¼Œåç»­ä¼šåŒ…å«å¸¸è§çš„æ¥å£è¯·æ±‚æµç¨‹ä»¥åŠ WireGuard ç­‰ç›¸å…³å†…å®¹ã€‚ æœ¬ç¯‡å°±æ˜¯ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚ å…¶ä½™å‡ ç¯‡çš„ç›®å½•ï¼š è®¡ç®—æœºç½‘ç»œä¹‹äºŒ - URL ä¸ DNS è®¡ç®—æœºç½‘ç»œä¹‹ä¸‰ - DHCP ä¸å†…ç½‘ç©¿é€ è®¡ç®—æœºç½‘ç»œä¹‹å›› - è™šæ‹Ÿç½‘å¡ä¸ WireGuard è®¡ç®—æœºç½‘ç»œä¹‹äº” - HTTP ä¸ HTTPS è®¡ç®—æœºç½‘ç»œä¹‹å…­ - å¯é çš„ TCP ä¸é«˜æ•ˆçš„ UDP è®¡ç®—æœºç½‘ç»œä¹‹ä¸ƒ - OSI ä¸ TCP/IP åˆ†å±‚æ¨¡å‹ IP IP åœ°å€ æ˜¯è®¡ç®—æœºç½‘ç»œé€šä¿¡çš„åŸºçŸ³ï¼Œç½‘ç»œä¸­æ¯ä¸€å°è®¾å¤‡éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª IP åœ°å€ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆè®¾å¤‡çš„èº«ä»½è¯å·ï¼Œæ¯ä¸ªäººçš„èº«ä»½è¯å·éƒ½æ˜¯å”¯ä¸€çš„ã€‚ å¸¸è§çš„ IP åœ°å€æ¯”å¦‚ 8.8.8.8ï¼Œè¿™æ˜¯ Google DNS æœåŠ¡å™¨çš„ IP åœ°å€ã€‚å†æ¯”å¦‚ 192.168.1.1ï¼Œå®¶ä¸­è·¯ç”±å™¨çš„ç®¡ç†é¡µé¢ç»å¸¸æ˜¯è¿™ä¸ªåœ°å€ã€‚ IPv4 å’Œ IPv6 IP åœ°å€æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šIPv4 å’Œ IPv6ã€‚ å¯èƒ½ä½ ä¼šå¥½å¥‡æœ‰æ²¡æœ‰ IPv3ã€IPv5 ç­‰ç­‰ï¼Œå…¶å®æ˜¯æœ‰çš„ã€‚ æ‰€è°“çš„ IPv1, v2, v3ï¼Œå¯ä»¥è¢«çœ‹ä½œæ˜¯ IPv4 è¯ç”Ÿä¹‹å‰çš„ã€å­˜åœ¨äº TCP åè®®å†…éƒ¨çš„â€œå²å‰è‰ç¨¿â€æˆ–â€œå®éªŒç‰ˆæœ¬â€ï¼Œå®ƒä»¬ä»æœªä½œä¸ºç‹¬ç«‹çš„ IP åè®®å­˜åœ¨è¿‡ã€‚ è€Œ IPv5ï¼Œæ›´å¸¸è§çš„åå­—å¯èƒ½æ˜¯ ST2ï¼Œå®ƒæ˜¯ IP åè®®çš„æ—æ”¯ï¼Œä»æœªè¢«æ‰“ç®—ä½œä¸ºé€šç”¨çš„ä¸‹ä¸€ä»£äº’è”ç½‘åè®®ï¼Œä¹Ÿä»æœªè¢«å¹¿æ³›éƒ¨ç½²ã€‚ æœ¬æ–‡æ›´åå‘äºå®ç”¨æ€§è€Œéå†å²å°è¯¾å ‚ï¼Œæ‰€ä»¥æš‚ä¸ä¼šæ¶‰åŠåˆ°ç›¸å…³å†…å®¹ã€‚ IPv4 IPv4 æ˜¯æˆ‘ä»¬ç›®å‰æœ€å¸¸æ¥è§¦åˆ°çš„ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ 32 ä½ (bit) æ¥å®šä¹‰ä¸€ä¸ªåœ°å€ã€‚ ç†è®ºæ€»æ•°ï¼š 2Â³Â² = 4,294,967,296 (çº¦ 43 äº¿ä¸ª) ä¹¦å†™æ ¼å¼ï¼š é€šå¸¸å†™æˆâ€œç‚¹åˆ†åè¿›åˆ¶â€çš„å½¢å¼ï¼Œç”± 4 ä¸ª 0 åˆ° 255 ä¹‹é—´çš„æ•°å­—ç»„æˆï¼Œç”¨ç‚¹å·éš”å¼€ã€‚ä¾‹å¦‚ 192.168.1.1ã€‚ ç†è®ºèŒƒå›´ï¼š ä» 0.0.0.0 åˆ° 255.255.255.255ã€‚ ä¸ºä»€ä¹ˆ IP æ®µçš„æœ€å¤§å€¼æ˜¯ 255 è€Œä¸æ˜¯ 999ï¼Ÿç›¸ä¿¡ç²¾é€šè®¡ç®—æœºåŸç†çš„ä½ ä¸€å®šæ˜ç™½ï¼š IPv4 ä¸€å…± 4 æ®µï¼Œæ€»é•¿ 32 ä½ï¼Œæ‰€ä»¥æ¯ä¸€æ®µå°±æ˜¯ 8 ä½ï¼Œå³ä¸€å­—èŠ‚ã€‚ä¸€ä¸ªå­—èŠ‚æœ€å¤§å€¼å³ 11111111ã€‚è½¬æ¢ä¸ºåè¿›åˆ¶å³ 255ã€‚è€Œ 999 ä½¿ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºåˆ™æ˜¯ 1111100111ï¼Œé•¿åº¦ä¸º 10 ä½ï¼Œè¶…å‡ºäº†æœ€å¤§ 8 ä½çš„é™åˆ¶ã€‚ ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰è¿™äº›åœ°å€éƒ½å¯ä»¥åˆ†é…ç»™äº’è”ç½‘ä¸Šçš„è®¾å¤‡ä½¿ç”¨ã€‚å…¶ä¸­æœ‰å¤§é‡åœ°å€è¢«ä¿ç•™ç”¨äºç‰¹æ®Šç›®çš„ï¼Œæ¯”å¦‚è¯´ä¸‹è¡¨ï¼š åœ°å€èŒƒå›´ åç§° ç”¨é€”è¯´æ˜ 10.0.0.0 - 10.255.255.255 ç§æœ‰ç½‘ç»œ (A ç±») ç”¨äºå¤§å‹ä¼ä¸šçš„å†…éƒ¨ç½‘ç»œ (å±€åŸŸç½‘)ã€‚ 172.16.0.0 - 172.31.255.255 ç§æœ‰ç½‘ç»œ (B ç±») ç”¨äºä¸­å‹ç½‘ç»œçš„å†…éƒ¨ç½‘ç»œã€‚ 192.168.0.0 - 192.168.255.255 ç§æœ‰ç½‘ç»œ (C ç±») æœ€å¸¸è§ï¼Œç”¨äºå®¶åº­ã€å°å‹åŠå…¬å®¤çš„è·¯ç”±å™¨å’Œå†…éƒ¨è®¾å¤‡ã€‚ 127.0.0.0 - 127.255.255.255 ç¯å›åœ°å€ (Loopback) ä¸»è¦ä½¿ç”¨ 127.0.0.1ï¼Œä»£è¡¨â€œæœ¬æœºâ€æˆ– localhostï¼Œç”¨äºåœ¨æœ¬æœºä¸Šè¿›è¡Œç½‘ç»œæµ‹è¯•ã€‚ 100.64.0.0 - 100.127.255.255 è¿è¥å•†çº§ NAT (CGNAT) ISP ç”¨æ¥ç»™å¤§é‡ç”¨æˆ·åˆ†é…çš„â€œå¤§å†…ç½‘â€åœ°å€ï¼Œä»¥ç¼“è§£ IPv4 åœ°å€è€—å°½é—®é¢˜ã€‚ 169.254.0.0 - 169.254.255.255 é“¾è·¯æœ¬åœ°åœ°å€ (APIPA) å½“è®¾å¤‡æ— æ³•ä» DHCP æœåŠ¡å™¨è·å– IP åœ°å€æ—¶ï¼Œä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ªæ­¤èŒƒå›´å†…çš„åœ°å€ï¼Œç”¨äºä¸´æ—¶å±€åŸŸç½‘é€šä¿¡ã€‚ 0.0.0.0 æœªæŒ‡å®šåœ°å€ é€šå¸¸ç”¨ä½œæºåœ°å€ï¼Œè¡¨ç¤ºâ€œä»»ä½• IPâ€æˆ–â€œæœ¬æœºâ€ã€‚ 224.0.0.0 - 239.255.255.255 ç»„æ’­åœ°å€ (Multicast) ç”¨äºä¸€å¯¹å¤šçš„é€šä¿¡ï¼Œå¦‚ç½‘ç»œç”µè§†ç›´æ’­ã€‚ 255.255.255.255 å¹¿æ’­åœ°å€ å‘æœ¬åœ°ç½‘ç»œä¸­çš„æ‰€æœ‰è®¾å¤‡å‘é€æ¶ˆæ¯ã€‚ æŠ›å»è¿™äº›ä¿ç•™çš„ ip åœ°å€ï¼Œå‰©ä½™çš„ ip åœ°å€å¤§çº¦æ˜¯ 37 äº¿ä¸ªã€‚è¿™ 37 äº¿ä¸ªçœ‹ä¼¼å¾ˆå¤šï¼Œä½†æ˜¯æˆ‘è¯´å‡ ä¸ªæ•°æ®ï¼š 2007 å¹´ç¬¬ä¸€ä»£ iPhone å‘å¸ƒï¼Œ2011 å¹´ï¼Œå…¨çƒæ™ºèƒ½æ‰‹æœºå‡ºè´§é‡å·²æ¥è¿‘ 5 äº¿éƒ¨ã€‚ 2000 å¹´ï¼Œå…¨çƒäº’è”ç½‘ç”¨æˆ·å¤§äº 3.6 äº¿ï¼›2011 å¹´ï¼Œå…¨çƒäº’è”ç½‘ç”¨æˆ·è¶…è¿‡ 20 äº¿ã€‚ å¦‚æœè€ƒè™‘åˆ°ä¸€éƒ¨è®¾å¤‡æœ‰ä¸€ä¸ª ip çš„è¯ï¼Œé‚£ä¹ˆ 37 äº¿ä¸ª IP åœ°å€æ˜¯è¿œè¿œä¸å¤Ÿç”¨çš„ã€‚äº‹å®ä¹Ÿæ˜¯ï¼š2011 å¹´ 2 æœˆ 3 æ—¥ï¼ŒIANAï¼ˆäº’è”ç½‘å·ç åˆ†é…å±€ï¼‰å®£å¸ƒå®ƒå·²ç»å°†æ‰€æœ‰çš„ IPv4 åœ°å€éƒ½åˆ†é…å‡ºå»äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å¯è¿›è¡Œåˆ†é…çš„ IPv4 åœ°å€éƒ½æœ‰äº†ä¸»äººã€‚ IPv4 åœ°å€åˆ†é…çš„é€»è¾‘æ˜¯è¿™æ ·çš„ï¼šæœ‰ä¸€ä¸ªå…¨çƒæ€»åº“ï¼ˆIANAï¼‰ï¼Œå®ƒè´Ÿè´£å°† IPv4 åœ°å€åˆ†é…ç»™äº”ä¸ªåŒºåŸŸæ€§æ³¨å†Œæœºæ„ï¼ˆRIRï¼‰ï¼Œåˆ†åˆ«æ˜¯ï¼šäºšå¤ªåœ°åŒºã€æ¬§æ´²åœ°åŒºã€æ‹‰ä¸ç¾æ´²å’ŒåŠ å‹’æ¯”åœ°åŒºã€åŒ—ç¾åœ°åŒºä»¥åŠéæ´²åœ°åŒºã€‚ä¹‹åå†è¿›è¡Œä¸€å±‚ä¸€å±‚çš„åˆ†é…ã€‚ é‚£ä¹ˆæ—¢ç„¶ IPv4 è¢«åˆ†é…å®Œäº†ï¼Œåç»­å¦‚æœæƒ³è¦å¢åŠ æ–°çš„è®¾å¤‡åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼š IPv6 å†…ç½‘ IP + NAT è¿™ä¸¤ä¸ªæ–¹æ¡ˆåˆ†åˆ«ä»ä¸¤ä¸ªè§’åº¦å‡ºå‘ï¼Œè¯•å›¾è§£å†³ IPv4 åœ°å€å¤ªå°‘çš„é—®é¢˜ã€‚ IPv6 IPv6 çš„è§£å†³æ–¹æ¡ˆæœ€ä¸ºæ ¹æœ¬ï¼Œä¹Ÿæœ€ä¸ºç›´æ¥ï¼šæ—¢ç„¶ IPv4 å¤ªçŸ­ï¼Œé‚£ä¹ˆæŠŠå®ƒå˜é•¿å°±å¯ä»¥äº†ï¼äºæ˜¯ IPv6 è¯ç”Ÿäº†ã€‚ IPv6 ä½¿ç”¨ 128 ä½æ¥å®šä¹‰ä¸€ä¸ªåœ°å€ï¼Œè¶³è¶³æ˜¯ IPv4 çš„ 4 å€ï¼ä¸æ­¢å¦‚æ­¤ï¼Œå®ƒè¿˜å°† â€œç‚¹åˆ†åè¿›åˆ¶â€ å‡çº§ä¸ºäº† â€œå†’å·åå…­è¿›åˆ¶â€ çš„å½¢å¼ã€‚æ‰€ä»¥å®ƒçš„ç†è®ºèŒƒå›´ä¸ºï¼š ä» 0000:0000:0000:0000:0000:0000:0000:0000 åˆ° ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff è¶³è¶³æœ‰ 2Â¹Â²â¸ â‰ˆ 3.4 x 10Â³â¸ (340 ä¸‡äº¿äº¿äº¿äº¿ä¸ª)ï¼è¿™åˆæ˜¯ä¸€ä¸ªä»€ä¹ˆæ¦‚å¿µå‘¢ï¼Ÿä¸€ä¸ªå¸¸è§çš„æ¯”å–»æ˜¯ï¼šåœ°çƒä¸Šæ¯ä¸€ç²’æ²™å­éƒ½å¯ä»¥è¢«åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ IPv6 åœ°å€ï¼Œè€Œä¸”è¿˜ç»°ç»°æœ‰ä½™ã€‚å¯è§å®ƒæœ‰å¤šä¹ˆçš„é•¿ã€‚ IPv6 é•¿åº¦å˜é•¿äº†ï¼Œç›¸æ¯”è¾ƒ IPv4ï¼Œå†™èµ·æ¥å¤šå°‘æœ‰äº›å¤æ‚ï¼Œäºæ˜¯å®ƒä¹Ÿè®¾è®¡äº†ä¸€äº›ç®€åŒ–è§„åˆ™ï¼š æ¯ç»„ä¸­å¼€å¤´çš„ 0 å¯ä»¥çœç•¥ï¼š0db8 -&gt; db8ã€‚ è¿ç»­çš„å¤šç»„ 0000 å¯ä»¥ç”¨åŒå†’å· :: ä»£æ›¿ï¼Œä½†ä¸€æ¬¡åªèƒ½ç”¨ä¸€æ¬¡ã€‚æ¯”å¦‚è¯´ï¼š ç¼©å†™åï¼š2001:db8:85a3::8a2e:370:7334 å±•å¼€åï¼š2001:db8:85a3:0000:8a2e:370:7334 IPv6 åŒæ ·æœ‰ç‰¹æ®Šåœ°å€ï¼Œæ¯”å¦‚ ::1 å°±æ˜¯å®ƒçš„ç¯å›åœ°å€ï¼ˆç›¸å½“äº IPv4 çš„ 127.0.0.1ï¼‰ï¼Œä½†ç”±äºå…¶åœ°å€ç©ºé—´æå…¶åºå¤§ï¼Œä¸å†éœ€è¦åƒ IPv4 é‚£æ ·æŠ å‡ºå¤§æ®µçš„ â€œç§æœ‰åœ°å€â€ æ¥èŠ‚çº¦ä½¿ç”¨ã€‚ IPv4 å‡çº§åˆ° IPv6 çš„æŒ‘æˆ˜ IPv6 çœ‹ç€ â€œå“ªå„¿å“ªå„¿éƒ½å¥½â€ï¼Œä½†æ˜¯æ¨å¹¿ IPv6 çš„è¿‡ç¨‹å¯è°“ååˆ†åå·ï¼šIPv6 æ˜¯ä¸å…¼å®¹ IPv4 çš„ã€‚ IPv4 åœ°å€çš„è€—å°½æ˜¯ç‚¹ç‡ƒ IPv6 é¡¹ç›®çš„å¯¼ç«ç´¢ï¼Œä½†æ˜¯åœ¨ â€œå¿…é¡»å¼€å‘ä¸€ä¸ªæ–°åè®®â€ è¿™ä¸ªå¤§å‰æè¢«ç¡®ç«‹ä¸‹æ¥æ—¶ï¼ŒIETF (äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„) çš„å¼€å‘è€…å¿½ç„¶æ„è¯†åˆ°ï¼šè¿™æ˜¯ä¸€ä¸ªåƒè½½éš¾é€¢çš„å¥½æœºä¼šï¼Œå¯ä»¥å»ä¿®å¤ IPv4 è¿è¡Œäº†å‡ åå¹´åæš´éœ²å‡ºæ¥çš„å„ç§è®¾è®¡ç¼ºé™·ï¼š è·¯ç”±æ•ˆç‡ä½ä¸‹ï¼šå…¨çƒ IPv4 è·¯ç”±è¡¨çš„æ¡ç›®è¿‡äºåºå¤§å’Œç¢ç‰‡åŒ–ï¼Œå¯¼è‡´éª¨å¹²ç½‘è·¯ç”±å™¨å‹åŠ›å·¨å¤§ã€‚ ç¼ºä¹å†…ç½®å®‰å…¨ï¼šIPsec (ç”¨äºç½‘ç»œå±‚åŠ å¯†å’Œè®¤è¯) æ˜¯åæ¥ç»™ IPv4 æ‰“çš„â€œè¡¥ä¸â€ï¼Œè€Œåœ¨ IPv6 ä¸­æ˜¯å¼ºåˆ¶è¦æ±‚ã€åŸç”Ÿé›†æˆçš„ã€‚ é…ç½®å¤æ‚ï¼šIPv4 ä¾èµ– DHCP è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚IPv6 è®¾è®¡äº†æ›´å¼ºå¤§çš„ â€œæ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½® (SLAAC)â€ï¼Œè®¾å¤‡å¯ä»¥è‡ªå·±ç”Ÿæˆåœ°å€ï¼Œå³æ’å³ç”¨ã€‚ æ²¡æœ‰ä¸ºç§»åŠ¨æ€§ä¼˜åŒ–ï¼šMobile IP for IPv4 ä¹Ÿæ˜¯ä¸€ä¸ªç¬¨æ‹™çš„è¡¥ä¸ã€‚IPv6 åœ¨è®¾è®¡æ—¶å°±è€ƒè™‘äº†ç§»åŠ¨è®¾å¤‡çš„éœ€æ±‚ã€‚ ä»–ä»¬è‡ªé—®ï¼šâ€œæ—¢ç„¶æˆ‘ä»¬æ— è®ºå¦‚ä½•éƒ½è¦è¿›è¡Œä¸€æ¬¡ä¼¤ç­‹åŠ¨éª¨çš„ â€œå¤§æ‰‹æœ¯â€ï¼Œä¸ºä»€ä¹ˆä¸è¶è¿™ä¸ªæœºä¼šï¼ŒæŠŠèº«ä½“é‡Œå…¶ä»–æ‰€æœ‰å·²çŸ¥çš„å°æ¯›ç—…ä¹Ÿä¸€å¹¶æ²»å¥½å‘¢ï¼Ÿâ€ äºæ˜¯ï¼Œåœ¨ â€œæ‰©å¤§åœ°å€ç©ºé—´â€ è¿™ä¸ªæ ¸å¿ƒç›®æ ‡ä¹‹ä¸Šï¼Œåˆå¢åŠ äº†ä¸€ç³»åˆ—é‡è¦çš„è®¾è®¡ç›®æ ‡ï¼š ç®€åŒ–æŠ¥å¤´ï¼Œæå‡è·¯ç”±æ•ˆç‡ï¼šç§»é™¤äº†ä¸€äº›ä¸å¸¸ç”¨æˆ–æœ‰é—®é¢˜çš„å­—æ®µï¼Œè®©è·¯ç”±å™¨ç¡¬ä»¶èƒ½æ›´å¿«åœ°å¤„ç†æ•°æ®åŒ…ã€‚ åŸç”Ÿé›†æˆå®‰å…¨æ€§ (IPsec)ï¼šå°†å®‰å…¨å˜æˆäº†åè®®çš„â€œæ ‡é…â€ï¼Œè€Œä¸æ˜¯â€œé€‰è£…â€ã€‚ æ”¹è¿›æœåŠ¡è´¨é‡ (QoS) æ”¯æŒï¼šå¼•å…¥â€œæµæ ‡ç­¾â€ï¼Œè®©è·¯ç”±å™¨èƒ½æ›´å¥½åœ°è¯†åˆ«å’Œå¤„ç†å¯¹å»¶è¿Ÿæ•æ„Ÿçš„åº”ç”¨ï¼ˆå¦‚è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ¸¸æˆï¼‰ã€‚ å®ç°çœŸæ­£çš„å³æ’å³ç”¨ï¼šé€šè¿‡æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½® (SLAAC)ï¼Œè®©è®¾å¤‡æ¥å…¥ç½‘ç»œåçš„é…ç½®è¿‡ç¨‹å¤§å¤§ç®€åŒ–ã€‚ ä¸ºç§»åŠ¨æ€§è€Œè®¾è®¡ï¼šæ›´å¥½åœ°æ”¯æŒç§»åŠ¨è®¾å¤‡åœ¨ä¸åŒç½‘ç»œé—´åˆ‡æ¢æ—¶ä¿æŒè¿æ¥ã€‚ äºæ˜¯ä¹ï¼šä¸€ä¸ª ä¸å…¼å®¹ IPv4 çš„æ–°åè®®ï¼šIPv6 è¯ç”Ÿäº†ã€‚ä½†è¿™ä¹Ÿæˆä¸ºäº†å®ƒæœ€å¤§çš„ç¼ºç‚¹ã€‚ åˆè¯†è¿™ä¸ªæ¦‚å¿µçš„ä½ ä¸çŸ¥é“æœ‰æ²¡æœ‰æ€è€ƒè¿‡ï¼šä¸ºä»€ä¹ˆäººä»¬å¸¸ç”¨ â€œè¿è‡³ IPv6â€ è¿™ä¸ªè¯´æ³•ï¼Œè€Œä¸æ˜¯ â€œå‡çº§åˆ° IPv6â€ å‘¢ï¼Ÿè¿™æ­£æ˜¯å› ä¸º IPv6 ä¸å…¼å®¹ IPv4ã€‚ ä¸€ä¸ªç½‘ç»œè·¯ç”±å™¨çš„æ ¸å¿ƒå·¥ä½œæ˜¯ ä»¥çº¿é€Ÿ (Line Rate) è½¬å‘æ•°æ®åŒ…ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ‹¥æœ‰ 10Gbps ç«¯å£çš„è·¯ç”±å™¨ï¼Œå¿…é¡»æœ‰èƒ½åŠ›åœ¨ 1 ç§’å†…å¤„ç†æ‰ 10G æ¯”ç‰¹çš„æ•°æ®ï¼Œä¸èƒ½æœ‰ä»»ä½•å»¶è¿Ÿã€‚è¿™ç§é«˜æ€§èƒ½çš„å®ç°ï¼Œä¸¥é‡ä¾èµ–ä¸“é—¨çš„ç¡¬ä»¶èŠ¯ç‰‡â€”â€”ASIC (ä¸“ç”¨é›†æˆç”µè·¯)ã€‚è·¯ç”±å™¨å†…éƒ¨çš„æ•°æ®åŒ…è½¬å‘è·¯å¾„ï¼Œå¤§éƒ¨åˆ†æ˜¯ç”±ç¡¬ä»¶å†™æ­»çš„ï¼Œè€Œä¸æ˜¯ç”±é€šç”¨çš„ CPU æ¥å¤„ç†çš„ã€‚ è¿™å°±å¯¼è‡´äº†è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è½¯ä»¶å‡çº§ï¼Œè®©è·¯ç”±å™¨ä½¿ç”¨ CPU æ¥å¤„ç† IPv6 æ•°æ®åŒ…ï¼Œä½†æ˜¯å®ƒçš„å¤„ç†é€Ÿåº¦å’Œ ASIC ç›¸æ¯”å¯è°“æœ‰ç€å¤©å£¤ä¹‹åˆ«ï¼Œæ‰€ä»¥å®ƒä¹Ÿè¢«ç§°ä¸º â€œæ…¢é€Ÿè·¯å¾„â€ (Slow Path)ã€‚ æ‰€ä»¥å¦‚æœç”¨æˆ·æƒ³è¦ â€œå‡çº§åˆ° IPv6â€ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»è¦è¦å°†è‡ªå·±æ‰€æœ‰çš„ç½‘ç»œè®¾å¤‡è¿›è¡Œå‡çº§ï¼Œå‡çº§åˆ°æ”¯æŒ IPv6 çš„è®¾å¤‡ï¼Œæˆ–è€…è‡³å°‘æ˜¯åŒæ—¶æ”¯æŒ IPv4 å’Œ IPv6 çš„è®¾å¤‡ã€‚è¿™å°±å¸¦æ¥äº†å¾ˆå¤§çš„è¿ç§»æˆæœ¬ã€‚ å…¬ç½‘ IP å’Œå†…ç½‘ IP é‚£ä¹ˆæ—¢ç„¶ IPv4 è¿ç§»åˆ° IPv6 æ³¨å®šæ˜¯ç¼“æ…¢çš„ï¼Œä¸å¯ä¸€è¹´è€Œå°±çš„ï¼Œå½“ä¸‹æœ‰ä»€ä¹ˆåŠæ³•èƒ½å…ˆä¸´æ—¶è§£å†³ IPv4 åœ°å€è€—å°½çš„é—®é¢˜å—ï¼Ÿç­”æ¡ˆå°±æ˜¯ â€œå†…ç½‘ IP + NATâ€ã€‚ å…¶å®å†…ç½‘ IP æœ€åˆè¢«è®¾è®¡å‡ºæ¥ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†è§£å†³å…¨çƒåœ°å€è€—å°½è¿™ä¸ªå®å¤§é—®é¢˜ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³ä¸€ä¸ªæ›´æ—©æœŸã€æ›´å…·ä½“ã€æ›´å®é™…çš„å·¥ç¨‹é—®é¢˜ï¼šç®€åŒ–å’Œéš”ç¦»å¤§å‹ç»„ç»‡çš„å†…éƒ¨ç½‘ç»œç®¡ç†ã€‚ åœ¨ 20 ä¸–çºª 90 å¹´ä»£åˆçš„æ—¶å€™ï¼Œè™½ç„¶å…¨çƒåœ°å€è€—å°½çš„å±æœºè¿˜æœªè¿«åœ¨çœ‰ç«ï¼Œä½†ä¸€äº›å¤§å‹ä¼ä¸šã€å¤§å­¦å’Œæ”¿åºœæœºæ„å·²ç»å¼€å§‹æ„å»ºè‡ªå·±åºå¤§çš„å†…éƒ¨ç½‘ç»œã€‚å®ƒä»¬é‡åˆ°äº†å‡ ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼š å†…éƒ¨ç½‘ç»œé‡æ„çš„éº»çƒ¦ æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªå¤§å…¬å¸æœ€åˆä» IANA ç”³è¯·äº†ä¸€å—å…¬ç½‘ IP åœ°å€å—ç”¨äºå†…éƒ¨ç½‘ç»œã€‚åæ¥å…¬å¸å‘å±•å£®å¤§ï¼Œéœ€è¦è¿æ¥åˆ°å¦ä¸€å®¶ ISPï¼Œæˆ–è€…è¦æ›´æ¢ ISPã€‚ æ–°çš„ ISP å¯èƒ½ä¼šè¦æ±‚å…¬å¸ä½¿ç”¨ç”±æ–° ISP åˆ†é…çš„å¦ä¸€å—å®Œå…¨ä¸åŒçš„å…¬ç½‘ IP åœ°å€å—ã€‚ è¿™æ„å‘³ç€å…¬å¸å†…éƒ¨æˆåƒä¸Šä¸‡å°ç”µè„‘ã€æœåŠ¡å™¨ã€æ‰“å°æœºçš„ IP åœ°å€ å…¨éƒ½éœ€è¦é‡æ–°ç¼–å·å’Œé…ç½®ã€‚è¿™åœ¨å½“æ—¶æ˜¯ä¸€ä¸ªæå…¶ç—›è‹¦ã€ç¹çä¸”å®¹æ˜“å‡ºé”™çš„å·¥ä½œï¼Œè¢«ç§°ä¸ºâ€œé‡æ–°ç¼–å·åœ°ç‹±â€ã€‚ è·¯ç”±è¡¨çš„æ··ä¹± å¦‚æœä¸€ä¸ªå…¬å¸çš„å†…éƒ¨ç½‘ç»œç»“æ„éå¸¸å¤æ‚ï¼Œå®ƒå¯èƒ½ä¼šæŠŠè‡ªå·±çš„å†…éƒ¨è·¯ç”±ä¿¡æ¯â€œæ³„éœ²â€åˆ°å…¨çƒäº’è”ç½‘çš„è·¯ç”±è¡¨ä¸­ã€‚ è¿™ä¼šé€ æˆå…¨çƒè·¯ç”±è¡¨çš„â€œæ±¡æŸ“â€ï¼Œå¢åŠ äº†éª¨å¹²ç½‘è·¯ç”±å™¨çš„è´Ÿæ‹…ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´è·¯ç”±é”™è¯¯ã€‚ å®‰å…¨æ€§çš„åˆæ­¥è€ƒé‡ å½“æ—¶çš„ç½‘ç»œå®‰å…¨æ¦‚å¿µè¿˜å¾ˆåˆçº§ï¼Œä½†äººä»¬å·²ç»æ„è¯†åˆ°ï¼Œè®©å…¬å¸å†…éƒ¨çš„æ¯ä¸€å°æ‰“å°æœºã€æ–‡ä»¶æœåŠ¡å™¨éƒ½æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥ç›´æ¥ä»å¤–éƒ¨è®¿é—®çš„å…¬ç½‘ IPï¼Œä¼¼ä¹ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚éœ€è¦ä¸€ç§æ–¹å¼å°†å†…éƒ¨ç½‘ç»œä¸å¤–éƒ¨äº’è”ç½‘è¿›è¡Œé€»è¾‘ä¸Šçš„éš”ç¦»ã€‚ ä¸ºäº†è§£å†³ä¸Šè¿°è¿™äº›é—®é¢˜ï¼ŒIETF åœ¨ 1994 å¹´å‘å¸ƒäº† RFC 1597 (åæ¥åœ¨ 1996 å¹´è¢«æ›´å®Œå–„çš„ RFC 1918 å–ä»£)ï¼Œæ­£å¼æå‡ºäº† â€œç§æœ‰åœ°å€ç©ºé—´ (Private Address Space)â€ çš„æ¦‚å¿µã€‚ RFC 1918 çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š åˆ’å®šä¸“ç”¨åœ°å€å—ï¼š ä»ç°æœ‰çš„ IPv4 åœ°å€ç©ºé—´ä¸­ï¼Œä¸“é—¨åˆ’å‡ºä¸‰å—åœ°å€ï¼ˆ10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16ï¼‰ä½œä¸ºâ€œç§æœ‰åœ°å€â€ã€‚ å¯é‡å¤ä½¿ç”¨ï¼š æ˜ç¡®è§„å®šï¼Œä»»ä½•ç»„ç»‡éƒ½å¯ä»¥åœ¨è‡ªå·±çš„å†…éƒ¨ç½‘ç»œä¸­è‡ªç”±åœ°ä½¿ç”¨è¿™äº›åœ°å€ï¼Œè€Œæ— éœ€å‘ IANA ç”³è¯·ã€‚ä½ å…¬å¸å¯ä»¥ç”¨ 10.0.0.1ï¼Œæˆ‘å…¬å¸ä¹Ÿå¯ä»¥ç”¨ 10.0.0.1ï¼Œäº’ä¸å½±å“ã€‚ ç¦æ­¢è·¯ç”±ï¼š ä¸¥æ ¼è§„å®šï¼Œæ‰€æœ‰äº’è”ç½‘éª¨å¹²ç½‘ä¸Šçš„è·¯ç”±å™¨ï¼Œç»å¯¹ä¸èƒ½è½¬å‘æºåœ°å€æˆ–ç›®æ ‡åœ°å€æ˜¯ç§æœ‰åœ°å€çš„æ•°æ®åŒ…ã€‚ è¿™å®Œç¾åœ°è§£å†³äº†æœ€åˆçš„é—®é¢˜ï¼š ç®€åŒ–ç®¡ç†ï¼š å…¬å¸å†…éƒ¨å¯ä»¥éšæ„è§„åˆ’è‡ªå·±çš„ç§æœ‰åœ°å€ã€‚å³ä½¿æ›´æ¢ ISPï¼Œä¹Ÿåªéœ€è¦æ›´æ”¹è¾¹ç•Œè·¯ç”±å™¨ (NAT è®¾å¤‡) çš„å…¬ç½‘ IP é…ç½®å³å¯ï¼Œå†…éƒ¨ä¸Šä¸‡å°è®¾å¤‡çš„ IP åœ°å€å®Œå…¨ä¸éœ€è¦å˜åŠ¨ã€‚ éš”ç¦»ç½‘ç»œï¼š ç§æœ‰åœ°å€å¤©ç”Ÿæ— æ³•åœ¨å…¬ç½‘ä¸Šè·¯ç”±ï¼Œä»è€Œå®ç°äº†å†…éƒ¨ç½‘ç»œå’Œå¤–éƒ¨äº’è”ç½‘çš„å¤©ç„¶éš”ç¦»ã€‚ æœ€ç»ˆï¼Œéšç€ 90 å¹´ä»£ä¸­åæœŸäº’è”ç½‘çš„çˆ†ç‚¸å¼æ™®åŠï¼Œäººä»¬å¾ˆå¿«å‘ç°ï¼Œè¿™ä¸ª â€œæ— å¿ƒæ’æŸ³â€ çš„è®¾è®¡ï¼Œæ°å¥½æ˜¯è§£å†³æ—¥ç›Šä¸¥å³»çš„åœ°å€è€—å°½å±æœºçš„ â€œç¥ä¸¹å¦™è¯â€ã€‚ NAT NAT çš„å…¨ç§°æ˜¯ â€œNetwork Address Translationâ€ï¼Œå³ â€œç½‘ç»œåœ°å€è½¬æ¢â€ï¼Œå®ƒè´Ÿè´£åœ¨ â€œå†…ç½‘ IPâ€ å’Œ â€œå…¬ç½‘ IPâ€ ä¹‹é—´è¿›è¡Œ â€œè½¬æ¢â€ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯è¿™æ ·çš„ï¼š å‡ºç«™ï¼ˆå†…ç½‘è®¾å¤‡è®¿é—®å…¬ç½‘ï¼‰ï¼š æ‰‹æœºï¼ˆå†…ç½‘ IP 192.168.1.101 è®¿é—® Google ç½‘ç«™ï¼‰ å®ƒä¼šå‡†å¤‡ä¸€ä¸ªâ€œæ•°æ®åŒ…â€ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š ç›®æ ‡ IP: Google æœåŠ¡å™¨çš„å…¬ç½‘ IPã€‚ æº IP: 192.168.1.101 (æ‰‹æœºçš„å†…ç½‘ IP)ã€‚ æº ç«¯å£ æ•°æ®åŒ…åˆ°è¾¾è·¯ç”±å™¨ æ‰§è¡Œ NATï¼š è·¯ç”±å™¨ä¸­ä¼šæœ‰ä¸€ä¸ª â€œNAT è½¬æ¢è¡¨â€ (NAT Translation Table)ï¼Œè¿™æ˜¯ä¸€ä¸ªå†…éƒ¨è®°è´¦æœ¬ã€‚å®ƒæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š ä½¿ç”¨å®¶åº­çš„ â€œå…¬ç½‘ IPâ€ æ›¿æ¢æ•°æ®åŒ…ä¸­çš„å†…ç½‘ IPã€‚åŒæ—¶åˆ†é…ä¸€ä¸ªæ–°çš„ç«¯å£ã€‚ åœ¨ NAT è½¬æ¢è¡¨ä¸­è®°å½•å†…ç½‘ IP å’Œå…¬ç½‘ IP çš„æ˜ å°„ï¼Œæ¯”å¦‚ï¼šâ€œ192.168.1.101:49152 &lt;-&gt; 203.0.113.50:30001â€ æ•°æ®åŒ…å‘å¾€äº’è”ç½‘: ä» Google çš„æœåŠ¡å™¨æ‹‰çœ‹ï¼Œè¿™ä¸ªè¯·æ±‚å°±æ˜¯ä» 203.0.113.50:30001 å‘å‡ºçš„ï¼Œå®ƒå®Œå…¨ä¸çŸ¥é“æ‰‹æœºçš„å­˜åœ¨ã€‚ å“åº”æœåŠ¡å™¨è¿”å›çš„æ•°æ®å°±æ˜¯ä¸Šè¿°æ­¥éª¤çš„åé¢ï¼Œå³æ ¹æ® â€œå…¬ç½‘IP+ç«¯å£â€ï¼ˆèµ·åˆ°ä¸»è¦ä½œç”¨çš„å°±æ˜¯ç«¯å£ï¼Œæ¯•ç«Ÿå…¬ç½‘IP éƒ½æ˜¯ä¸€è‡´çš„ï¼‰ï¼Œæ‰¾åˆ°â€œå†…ç½‘IP+ç«¯å£â€ï¼Œæœ€ç»ˆå°†ç›¸åº”æ•°æ®åŒ…å‘é€åˆ°è¯·æ±‚æ•°æ®çš„æ‰‹æœºä¸Šã€‚ä¸‹é¢çš„åºåˆ—å›¾æç»˜äº†è¿™ä¸€æ¥ä¸€å›çš„å®Œæ•´è¿‡ç¨‹ï¼š æ€»ç»“ NAT çš„æ ¸å¿ƒæœºåˆ¶ï¼š åœ°å€è½¬æ¢ï¼š å°†æ•°æ®åŒ…çš„æº IP åœ°å€ä» å†…ç½‘ IP æ›¿æ¢ä¸º å…¬ç½‘ IP (å‡ºç«™æ—¶)ï¼Œæˆ–è€…å°†ç›®æ ‡ IP åœ°å€ä» å…¬ç½‘ IP æ›¿æ¢ä¸º å†…ç½‘ IP (å…¥ç«™æ—¶)ã€‚ ç«¯å£è½¬æ¢ (PAT - Port Address Translation)ï¼šè¿™æ˜¯ç°ä»£ NAT çš„ç²¾é«“ï¼Œä¹Ÿç§°ä¸º NAPTã€‚é€šè¿‡ ä¿®æ”¹æºç«¯å£å·ï¼Œä½¿å¾—åŒä¸€ä¸ªå…¬ç½‘ IP åœ°å€å¯ä»¥åŒæ—¶ä¸ºå¤šä¸ªå†…ç½‘è®¾å¤‡æä¾›æœåŠ¡ã€‚è·¯ç”±å™¨é€šè¿‡ç»´æŠ¤ (å†…ç½‘IP:å†…ç½‘ç«¯å£) &lt;-&gt; (å…¬ç½‘IP:å…¬ç½‘ç«¯å£) è¿™ä¸ªæ˜ å°„è¡¨ï¼Œæ¥ç¡®ä¿è¿”å›çš„æ•°æ®èƒ½å¤Ÿè¢«å‡†ç¡®åœ°åˆ†å‘ç»™æ­£ç¡®çš„è®¾å¤‡å’Œåº”ç”¨ã€‚ å·¨å¤§çš„ â€œå±€åŸŸç½‘â€ APNIC (Asia-Pacific Network Information Centre)ï¼Œå³äºšå¤ªç½‘ç»œä¿¡æ¯ä¸­å¿ƒï¼Œå®ƒè´Ÿè´£äºšå¤ªåœ°åŒº IP åœ°å€åˆ†é…çš„åŒºåŸŸäº’è”ç½‘æ³¨å†Œæœºæ„ (RIR)ã€‚æ ¹æ® APNIC æˆªè‡³ç›®å‰çš„å…¬å¼€ç»Ÿè®¡æ•°æ®ï¼Œåˆ†é…ç»™ä¸­å›½ (å›½å®¶ä»£ç : CN) çš„å…¬ç½‘ IPv4 åœ°å€æ€»æ•°å¤§çº¦ä¸º 3.45 äº¿ ä¸ªã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ ipinfo æŸ¥åˆ°è¿™ä¸ªæ•°æ®ã€‚ æ ¹æ®è¿™ä¸ªæ•°æ®å¯æƒ³è€ŒçŸ¥ï¼Œ3.45 äº¿æ˜¯è¿œè¿œä¸å¤Ÿç”¨çš„ï¼Œé‚£ä¹ˆå¸¸è§çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸Šé¢æåˆ°çš„ â€œå†…ç½‘ IPâ€ æ–¹æ¡ˆï¼Œé€šè¿‡è¿è¥å•†æ¶è®¾åŸºç¡€è®¾æ–½ï¼Œæ¥å®ç°ä¸€å¼ å·¨å¤§çš„ â€œå±€åŸŸç½‘â€ï¼Œä»¥æ­¤æ¥è§£å†³å…¬ç½‘ ip ä¸è¶³çš„é—®é¢˜ã€‚ ç«¯å£ è¯´åˆ° IPï¼Œå°±ä¸å¾—ä¸æåˆ° â€œç«¯å£â€ è¿™ä¸ªæ¦‚å¿µã€‚å…¶å®åœ¨ä¸Šæ–‡ä¸­ä¹Ÿå·²ç»å¤šæ¬¡æ¶‰åŠåˆ°è¿™ä¸ªæ¦‚å¿µäº†ã€‚é‚£ä¹ˆ â€œç«¯å£â€ åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ IP åœ°å€çš„ä½œç”¨æ˜¯ä¸ºäº†æ‰¾åˆ°è®¾å¤‡ï¼Œè€Œç«¯å£çš„ä½œç”¨åˆ™æ˜¯ä¸ºäº†æ‰¾åˆ°è®¾å¤‡ä¸­çš„æœåŠ¡ã€‚åœ¨æŠ€æœ¯ç»†èŠ‚æ–¹é¢ï¼š ç«¯å£æ˜¯ä¸€ä¸ª 16 ä½ (bit) çš„æ— ç¬¦å·æ•´æ•° å–å€¼èŒƒå›´ä» 0 åˆ° 2Â¹â¶ - 1ï¼Œå³ 0 åˆ° 65535 ä»¥ä¸Šé¢ NAT çš„åœºæ™¯ä¸ºä¾‹ï¼Œå¯¹äºå…¬ç½‘ IP è€Œè¨€ï¼Œæ¯ä¸ªæœåŠ¡å‘å‡ºçš„æ•°æ®åŒ…éƒ½éœ€è¦è‡ªå·±ç‹¬ä¸€æ— äºŒçš„ç«¯å£ã€‚å¦‚æœç«¯å£é‡å¤äº†ï¼ŒNAT å°±ä¸çŸ¥é“è¯¥æŠŠå…¬ç½‘ä¸­æœåŠ¡å™¨å“åº”çš„æ•°æ®å‘é€ç»™å“ªä¸ªå†…ç½‘è®¾å¤‡ã€‚ ç«¯å£çš„åˆ†ç±» ç«¯å£ä¹Ÿåƒ IP ä¸€æ ·ï¼Œæœ‰ä¸€äº›ç¡¬æ€§åˆ†é…çš„ä¿ç•™é¡¹ã€‚ çŸ¥åç«¯å£ èŒƒå›´: 0 - 1023 ç‰¹ç‚¹ä¸ç”¨é€”: è¿™ç±»ç«¯å£ç”± IANA (äº’è”ç½‘å·ç åˆ†é…å±€) è¿›è¡Œä¸¥æ ¼çš„ ç¡¬æ€§åˆ†é…ï¼Œå®ƒä»¬æ˜¯å…¨çƒç»Ÿä¸€çš„äº’è”ç½‘æ ‡å‡†ã€‚è¿™äº›ç«¯å£è¢«æ°¸ä¹…åœ°åˆ†é…ç»™äº†äº’è”ç½‘ä¸Šæœ€æ ¸å¿ƒã€æœ€åŸºç¡€çš„æœåŠ¡ï¼Œå°±åƒæ˜¯å…¬å¼€çš„ã€å…¨ä¸–ç•Œéƒ½çŸ¥é“åœ°å€çš„â€œæ”¿åºœåŠäº‹å¤§å…â€ æˆ– â€œå…¬å…±æœåŠ¡çª—å£â€ï¼Œç¡®ä¿äº†å…¨çƒç½‘ç»œæœåŠ¡çš„äº’æ“ä½œæ€§ã€‚åœ¨å¤§å¤šæ•°æ“ä½œç³»ç»Ÿä¸­ï¼Œåº”ç”¨ç¨‹åºéœ€è¦æ‹¥æœ‰ç®¡ç†å‘˜ï¼ˆrootï¼‰æƒé™æ‰èƒ½ç»‘å®šå’Œç›‘å¬è¿™äº›ç«¯å£ã€‚ å¸¸è§åè®®ä¸æœåŠ¡ç¤ºä¾‹: 20/21: FTP (æ–‡ä»¶ä¼ è¾“åè®®) 22: SSH (å®‰å…¨å¤–å£³åè®®)ï¼Œç”¨äºå®‰å…¨çš„è¿œç¨‹ç™»å½•ã€‚ 23: Telnet (è¿œç¨‹ç»ˆç«¯åè®®)ï¼Œä¸€ä¸ªæ—©æœŸçš„ã€ä¸å®‰å…¨çš„è¿œç¨‹ç™»å½•åè®®ã€‚ 25: SMTP (ç®€å•é‚®ä»¶ä¼ è¾“åè®®)ï¼Œç”¨äºå‘é€ç”µå­é‚®ä»¶ã€‚ 53: DNS (åŸŸåç³»ç»Ÿ)ï¼Œç”¨äºå°†åŸŸåè§£æä¸º IP åœ°å€ã€‚ 80: HTTP (è¶…æ–‡æœ¬ä¼ è¾“åè®®)ï¼Œç”¨äºè®¿é—®æ™®é€šç½‘é¡µã€‚ 110: POP3 (é‚®å±€åè®®ç‰ˆæœ¬3)ï¼Œç”¨äºæ¥æ”¶ç”µå­é‚®ä»¶ã€‚ 143: IMAP (äº’è”ç½‘æ¶ˆæ¯è®¿é—®åè®®)ï¼Œä¹Ÿæ˜¯ç”¨äºæ¥æ”¶é‚®ä»¶ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚ 443: HTTPS (å®‰å…¨çš„è¶…æ–‡æœ¬ä¼ è¾“åè®®)ï¼Œç”¨äºè®¿é—®åŠ å¯†çš„ç½‘é¡µã€‚ æ³¨å†Œç«¯å£ èŒƒå›´: 1024 - 49151 ç‰¹ç‚¹ä¸ç”¨é€”: è¿™äº›ç«¯å£ç”± IANA è¿›è¡Œ åŠå®˜æ–¹åˆ†é…ï¼Œä¾›ç‰¹å®šçš„åº”ç”¨ç¨‹åºã€åè®®æˆ–å•†ä¸šå…¬å¸æ³¨å†Œä½¿ç”¨ï¼Œç›®çš„æ˜¯ä¸ºäº†é¿å…ä¸åŒè½¯ä»¶é—´çš„ç«¯å£å†²çªã€‚è™½ç„¶å®ƒä»¬ä¸åƒçŸ¥åç«¯å£é‚£æ ·æ˜¯å¼ºåˆ¶æ€§çš„äº’è”ç½‘æ ‡å‡†ï¼Œä½†ä¸šç•Œæ™®éä¼šéµå®ˆè¿™äº›çº¦å®šã€‚æ™®é€šç”¨æˆ·æƒé™çš„ç¨‹åºå°±å¯ä»¥ç»‘å®šè¿™äº›ç«¯å£ï¼Œæ— éœ€ç‰¹æ®Šçš„ç®¡ç†å‘˜æƒé™ã€‚ å¸¸è§åè®®ä¸æœåŠ¡ç¤ºä¾‹: 1433: Microsoft SQL Server æ•°æ®åº“æœåŠ¡ 1521: Oracle æ•°æ®åº“æœåŠ¡ 3306: MySQL æ•°æ®åº“æœåŠ¡ 3389: RDP (Windows è¿œç¨‹æ¡Œé¢åè®®) 5432: PostgreSQL æ•°æ®åº“æœåŠ¡ 5900: VNC (è™šæ‹Ÿç½‘ç»œè®¡ç®—)ï¼Œä¸€ä¸ªå¸¸ç”¨çš„è¿œç¨‹æ§åˆ¶è½¯ä»¶ã€‚ 6379: Redis é”®å€¼æ•°æ®åº“æœåŠ¡ 8080: å¸¸è¢«ç”¨ä½œ Web æœåŠ¡å™¨çš„å¤‡ç”¨ç«¯å£ï¼Œæˆ–ç”¨äºè¿è¡Œ HTTP ä»£ç†æœåŠ¡å™¨ã€‚ åŠ¨æ€/ç§æœ‰ç«¯å£ èŒƒå›´: 49152 - 65535 ç‰¹ç‚¹ä¸ç”¨é€”: è¿™äº›ç«¯å£ ä¸åˆ†é…ç»™ä»»ä½•å›ºå®šçš„æœåŠ¡ï¼Œå®ƒä»¬æ˜¯å®Œå…¨è‡ªç”±ä½¿ç”¨çš„ã€‚å®ƒä»¬çš„ä¸»è¦ä½œç”¨æ˜¯ä½œä¸ºå®¢æˆ·ç«¯ç¨‹åºï¼ˆä¾‹å¦‚æµè§ˆå™¨ã€æ¸¸æˆã€é‚®ä»¶å®¢æˆ·ç«¯ï¼‰åœ¨å‘èµ·å¯¹å¤–è¿æ¥æ—¶ï¼Œç”±æ“ä½œç³»ç»Ÿ éšæœºé€‰æ‹© ä¸€ä¸ªä½œä¸ºæœ¬æ¬¡é€šä¿¡çš„ æºç«¯å£ (Source Port)ã€‚å½“é€šä¿¡ä¼šè¯ç»“æŸåï¼Œè¿™ä¸ªç«¯å£å°±ä¼šè¢«é‡Šæ”¾ï¼Œå¯ä»¥è¢«å…¶ä»–åº”ç”¨é‡æ–°ä½¿ç”¨ã€‚å› ä¸ºå®ƒä»¬æ˜¯ä¸´æ—¶åˆ†é…çš„ï¼Œæ‰€ä»¥ä¹Ÿè¢«ç§°ä¸º ä¸´æ—¶ç«¯å£ (Ephemeral Ports)ã€‚ å¸¸è§åè®®ä¸æœåŠ¡ç¤ºä¾‹: è¿™ç±»ç«¯å£æ²¡æœ‰å›ºå®šçš„æœåŠ¡å¯¹åº”ï¼Œå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯æ˜¯åŠ¨æ€çš„ã€‚ä¾‹å¦‚ï¼š å½“ç”¨æµè§ˆå™¨è®¿é—® google.com æ—¶ï¼Œç”µè„‘å¯èƒ½ä¼šéšæœºé€‰æ‹© 51234 ä½œä¸ºæœ¬æ¬¡é€šä¿¡çš„æºç«¯å£ã€‚ å½“å¯åŠ¨ä¸€ä¸ªåœ¨çº¿æ¸¸æˆæ—¶ï¼Œæ¸¸æˆå®¢æˆ·ç«¯å¯èƒ½ä¼šéšæœºé€‰æ‹© 62000 ä½œä¸ºä¸æ¸¸æˆæœåŠ¡å™¨é€šä¿¡çš„æºç«¯å£ã€‚ å½“ä½¿ç”¨é‚®ä»¶å®¢æˆ·ç«¯æ”¶å–é‚®ä»¶æ—¶ï¼Œå®ƒå¯èƒ½ä¼šéšæœºé€‰æ‹© 58341 ä½œä¸ºè¿æ¥é‚®ä»¶æœåŠ¡å™¨çš„æºç«¯å£ã€‚ ç«¯å£æ˜ å°„ ç«¯å£æ˜ å°„ï¼ˆæˆ–è€…æ›´å¹¿ä¹‰åœ°ç§°ä¸ºâ€œç«¯å£è½¬å‘â€ï¼ŒPort Forwardingï¼‰æ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€ä¸”åº”ç”¨å¹¿æ³›çš„ç½‘ç»œæŠ€æœ¯ã€‚è¿™é¡¹æŠ€æœ¯å¯ä»¥å°†ä¸€ä¸ªç«¯å£æ˜ å°„æˆå¦å¤–ä¸€ä¸ªç«¯å£ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ Dockerã€‚ æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šä½ éœ€è¦ç”¨ Docker éƒ¨ç½²ä¸€ä¸ª Gitlab æœåŠ¡ã€‚ç­‰åˆ°æœåŠ¡éƒ¨ç½²å¥½äº†ä¹‹åï¼ŒGitlab æœåŠ¡ä¼šç›‘å¬ 443 è¿™ä¸ª https ç«¯å£ã€‚ä½†æ˜¯ç”¨æˆ·æ— æ³•ä»ä¸»æœºä¸Šç›´æ¥è®¿é—® Docker å®¹å™¨å†…çš„ 443 ç«¯å£ï¼Œå› ä¸ºä¼—æ‰€å‘¨çŸ¥ Docker çš„ç¯å¢ƒå’Œä¸»æœºç¯å¢ƒæ˜¯äº’ç›¸éš”ç¦»çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ˜¯ç”¨ Docker çš„ ç«¯å£æ˜ å°„ ï¼ˆ-p å‚æ•°ï¼‰æ¥è¯´å®ç°ç«¯å£è½¬å‘ã€‚ Docker ç¯å¢ƒå’Œä¸»æœºç¯å¢ƒäº’ç›¸éš”ç¦»ï¼Œè¿™ä¹Ÿæ„å‘³ç€ Docker å†…éƒ¨æœ‰ä¸€å¥—è‡ªå·±çš„ç«¯å£ï¼Œä» 0 åˆ° 65535ã€‚ é€šè¿‡ç«¯å£è½¬å‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸»æœºä¸Šçš„ä»»æ„ä¸€ä¸ªéä¿ç•™ç«¯å£ç«¯å£ï¼Œæ¯”å¦‚è¯´ 4343ï¼Œæ˜ å°„åˆ° Docker å®¹å™¨çš„ 443 ç«¯å£ã€‚ä¹‹åä»»ä½•è®¿é—®ä¸»æœº 4343 ç«¯å£çš„è¯·æ±‚ï¼Œéƒ½ä¼šè¢«è½¬å‘ç»™ Docker çš„ 443 ç«¯å£ï¼Œä¹Ÿå°±æ˜¯ Gitlab æœåŠ¡ã€‚ ç«¯å£æ˜ å°„è¿˜æœ‰ä¸€ä¸ªä½œç”¨ï¼Œé‚£å°±æ˜¯ç»•å¼€ ISP å±è”½ã€‚ä¸Šæ–‡ä¸­ä¹Ÿæœ‰æåˆ° ISP è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒçš„å…¨ç§°æ˜¯ Internet Service Providerï¼Œä¸­æ–‡ç¿»è¯‘æ˜¯ äº’è”ç½‘æœåŠ¡æä¾›å•†ï¼Œä¹Ÿå°±æ˜¯ç”µä¿¡å‘€ï¼Œè”é€šã€ç§»åŠ¨è¿™äº›è¿è¥å•†ã€‚ æ ¹æ®ä¸­å›½å·¥ä¿¡éƒ¨çš„è§„å®šï¼Œæ‰€æœ‰å‘å…¬ä¼—æä¾›æœåŠ¡çš„ç½‘ç«™éƒ½å¿…é¡»è¿›è¡Œ ICP å¤‡æ¡ˆã€‚ä¸ºäº†è½å®è¿™ä¸€æ”¿ç­–ï¼ŒISP ä¼šç›´æ¥å±è”½å®¶åº­å®½å¸¦çš„ 80 ç«¯å£ï¼Œä»æŠ€æœ¯ä¸Šé˜»æ­¢ä¸ªäººç”¨æˆ·åœ¨æœªç»å¤‡æ¡ˆçš„æƒ…å†µä¸‹ï¼Œç§è‡ªæ­å»ºå¯¹å¤–çš„ Web æœåŠ¡å™¨ã€‚å…¶å®ä¸æ­¢ 80 ç«¯å£ï¼Œå¾ˆå¤šç«¯å£å¯èƒ½éƒ½ä¼šå› ä¸ºå„ç§å„æ ·çš„åŸå› å¯¼è‡´è¢« ISP å±è”½ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡ç«¯å£æ˜ å°„åŠŸèƒ½æ¥ â€œç»•å¼€â€ ISP çš„å±è”½ã€‚ æœ‰äº›æ—¶å€™ ISP å±è”½ç«¯å£æ˜¯ä¸ºäº†ä¿æŠ¤ä¸»æœºçš„å®‰å…¨ï¼Œæ¯”å¦‚ 25ã€ 445ã€135ã€137ã€138ã€139 ç­‰ç«¯å£ã€‚è¿™äº›ç«¯å£ç»å¸¸ä¼šæˆä¸ºé»‘å®¢çš„æ”»å‡»å¯¹è±¡ã€‚ ","link":"https://blog.rakuyo.dev/computer-network-ip-and-port/"},{"title":"Surge For Mac çš„ä¸€äº›æ³¨æ„äº‹é¡¹","content":"è®°ä¸€äº›æ—¥å¸¸ä½¿ç”¨æ—¶çš„å°ç»†èŠ‚å§ï¼Œä¹Ÿè°ˆä¸ä¸Šä½¿ç”¨æ•™ç¨‹ã€‚ å¢å¼ºæ¨¡å¼ä¸‹ç»ˆç«¯ä¸èµ°ä»£ç† æˆ‘åœ¨å®˜æ–¹è®ºå›ä¸Šæè¿‡ä¸€ä¸ªåŒåé—®é¢˜ï¼šSurge5 Mac å¢å¼ºæ¨¡å¼ä¸‹ç»ˆç«¯ä¸èµ°ä»£ç†ï¼Œæœ€åå‘ç°æ˜¯ pfctl çš„é—®é¢˜ã€‚ åœ¨æˆ‘ç°åœ¨ä½¿ç”¨çš„ç”µè„‘ä¸Šå®ƒæ˜¯å¼€æœºè‡ªå¯çš„ï¼Œå¹¶ä¸”åœ¨æˆ‘è°ƒè¯• Surge æœŸé—´å¹¶æ²¡æœ‰å…³é—­å®ƒï¼Œæœ€ç»ˆå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚ å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ sudo pfctl -d æ¥ä¸´æ—¶å…³é—­å®ƒã€‚ æ‰˜ç®¡é…ç½® å®˜æ–¹æ–‡æ¡£è§ æ‰˜ç®¡é…ç½®ã€‚ Surge çš„é…ç½®ç›´æ¥æ‰˜ç®¡åˆ°æœåŠ¡å™¨ä¸Šï¼Œæˆ–è€…å¦‚æœä½ ä½¿ç”¨æŸä¸ªæœºåœºï¼Œé‚£ä¹ˆ Surge ä¹Ÿå¯ä»¥è‡ªåŠ¨ä» URL æ›´æ–°é…ç½®æ–‡ä»¶ã€‚ åªéœ€è¦åœ¨ä½ çš„é…ç½®æ–‡ä»¶æœ€å‰ç«¯å¢åŠ ä¸‹é¢å†…å®¹å³å¯ï¼ˆè®°å¾—æŠŠ url æ›¿æ¢æˆä½ è‡ªå·±çš„ urlï¼‰ï¼š #!MANAGED-CONFIG http://test.com/surge.conf interval=60 strict=true é…ç½®åˆ†ç¦» å½“ä½ çš„é…ç½®è®¾ç½®äº†ä» url è‡ªåŠ¨åŠ è½½ï¼Œé‚£ä¹ˆä½ å°±æ— æ³•å†åœ¨æœ¬åœ°ä¿®æ”¹ä½ çš„é…ç½®äº†ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ é…ç½®åˆ†ç¦» æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å•ç‹¬å»ºç«‹ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œéšåé€šè¿‡ #!include å¼•ç”¨ä½ çš„è¿œç«¯é…ç½®ã€‚è¿™æ ·å°±å¯ä»¥åšåˆ°æ—¢è‡ªåŠ¨æ‹‰å–æœºåœºé…ç½®ï¼Œåˆèƒ½äº«å—æœ¬åœ°è‡ªå®šä¹‰é…ç½®ã€‚ ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯ï¼Œä¸Šé¢çš„æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€æ®µè¯ï¼š The filename suffix is not required, if it is a complete profile, you can continue to use the conf suffix, if it is not a complete profile, it is recommended to use another suffix to avoid being displayed in the configuration list. ä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ çš„å­é…ç½®æ–‡ä»¶ä¸å®Œæ•´ï¼Œé‚£ä¹ˆå¯ä»¥ä¸åŠ åç¼€ï¼Œé¿å…è¯¥æ–‡ä»¶å‡ºç°åœ¨ Surge çš„é…ç½®æ–‡ä»¶åˆ—è¡¨é‡Œã€‚ ä¸€èˆ¬å­é…ç½®æ–‡ä»¶çš„ [Rule] ä¸ä¼šåŒ…å«ä¹Ÿä¸èƒ½åŒ…å« FINALï¼Œæ‰€ä»¥å¦‚æœåŠ è½½åˆ° Surge é‡Œä¹‹åä¼šæŠ¥é”™æç¤º â€œéæ³•çš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦ä»¥ FINAL ç»“å°¾â€ï¼ˆä½†æ˜¯ä¸ä¼šå½±å“åŠŸèƒ½ï¼Œä»…ä»…æ˜¯æç¤ºé”™è¯¯ï¼‰ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡å»æ‰åç¼€æˆ–è€…ä¿®æ”¹åç¼€çš„æ–¹å¼å°†è¯¥æ–‡ä»¶ä»é…ç½®åˆ—è¡¨ä¸­ â€œéšè—â€ æ‰ã€‚ æŠ“åŒ… - â€œwifi æ— ç½‘ç»œé“¾æ¥â€ ä¸»åŒ…ç”¨çš„ Surge v6ï¼Œå…¶å®ä» Surge 5.8.1 ç‰ˆæœ¬å¼€å§‹å°±å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šåœ¨ iPhone wifi ä¸Šè®¾ç½®äº† â€œé…ç½®ä»£ç†â€ åæç¤º â€œæ— äº’è”ç½‘è®¿é—®â€ï¼Œmac surge ä¸Šä¹Ÿä¸æ˜¾ç¤ºè®¾å¤‡ã€‚ Surge ç‰ˆæœ¬ 5.8.1 ä¸­æ–°å¢äº†ä¸€ä¸ªé…ç½® proxy-restricted-to-lanï¼Œå°±æ˜¯å®ƒå¯¼è‡´äº†è¿™ä¸ªé—®é¢˜ã€‚ è¿™ä¸ªé…ç½®é»˜è®¤å¯ç”¨ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å°†å…¶è®¾ç½®ä¸º false å³å¯è§£å†³é—®é¢˜ã€‚ ","link":"https://blog.rakuyo.dev/notes-about-surge-for-mac/"},{"title":"ä»ä½¿ç”¨ Combine æ‹¦æˆª delegate çœ‹ Runtime æ¶ˆæ¯è½¬å‘","content":"CombineCocoa å·²æœ‰ä¸€æ®µæ—¶é—´æœªæ›´æ–°ï¼Œä½†å…¶ä¸­è®¸å¤šä»£ç ä»èƒ½æ­£å¸¸å·¥ä½œï¼Œæ¯”å¦‚ Delegate çš„è¿™éƒ¨åˆ†ã€‚ ä»Šå¤©æˆ‘ä»¬å…ˆä»è¿™éƒ¨åˆ†ä»£ç å…¥æ‰‹ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Combine æ‹¦æˆª UIKit ä¸­çš„å„ç±» delegate å¯¹è±¡ï¼Œå†æ·±å…¥æ¢è®¨å…¶èƒŒåçš„ Runtime å®ç°ã€‚ ä½¿ç”¨ Combine æ‹¦æˆª delegate ä¸‹é¢çš„ä»£ç å’Œ CombineCocoa ä¸­çš„ä¸å®Œå…¨ä¸€è‡´ï¼Œæˆ‘ä¼šåšä¸€äº›è°ƒæ•´ä»¥åŠæ ¼å¼ä¸Šçš„ä¿®æ”¹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®æœ€ç»ˆæƒ³è¦å®ç°çš„æ•ˆæœï¼Œè¿™æ˜¯åšæ¡†æ¶æ—¶å¸¸ç”¨çš„é€†å‘æ€è€ƒæ–¹æ³•ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªè¿™æ ·çš„æ–¹æ³•å»è°ƒç”¨ï¼š // ä»£æ›¿ `UITableViewDelegate.tableView(_:willDisplay:forRowAt:)` tableView.willDisplayCellPublisher.sink { ... } /// Combine wrapper for tableView(_:willDisplay:forRowAt:)` public var willDisplayCellPublisher: AnyPublisher&lt;(cell: UITableViewCell, indexPath: IndexPath), Never&gt; { return /* ä¸€ä¸ª Publisher å¯¹è±¡ */ } willDisplayCellPublisher çš„å®šä¹‰ä½äº CombineCocoa ä»“åº“çš„ UITableView+Combine.swift æ–‡ä»¶ã€‚å…³é”®ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š @available(iOS 13.0, *) public extension UITableView { /// Combine wrapper for `tableView(_:willDisplay:forRowAt:)` var willDisplayCellPublisher: AnyPublisher&lt;(cell: UITableViewCell, indexPath: IndexPath), Never&gt; { let selector = #selector(UITableViewDelegate.tableView(_:willDisplay:forRowAt:)) return delegateProxy.interceptSelectorPublisher(selector) .map { ($0[1] as! UITableViewCell, $0[2] as! IndexPath) } .eraseToAnyPublisher() } override var delegateProxy: DelegateProxy { TableViewDelegateProxy.createDelegateProxy(for: self) } } @available(iOS 13.0, *) private class TableViewDelegateProxy: DelegateProxy, UITableViewDelegate, DelegateProxyType { func setDelegate(to object: UITableView) { object.delegate = self } } å®ç°çœ‹èµ·æ¥ç¨æ˜¾å¤æ‚ï¼Œæˆ‘ä»¬é€æ­¥åˆ†æï¼Œå…ˆæ¥çœ‹ willDisplayCellPublisher è¿™ä¸ªè®¡ç®—å±æ€§ã€‚ä» interceptSelectorPublisher æ–¹æ³•çš„å­—é¢å«ä¹‰ä¸Šæ¥çœ‹ï¼ŒçŒœæµ‹å®ƒæ˜¯æ‹¦æˆªäº† #selector(UITableViewDelegate.tableView(_:willDisplay:forRowAt:)) æ–¹æ³•ï¼Œå°†ç›¸å…³è°ƒç”¨å°è£…ä¸º Publisher ä¾›å¤–éƒ¨è®¢é˜…ã€‚ delegateProxy å±æ€§æœ¬è´¨ä¸Šæ˜¯ TableViewDelegateProxy ç±»å‹ï¼Œå…¶ç›´æ¥çˆ¶ç±»ä¸º DelegateProxyï¼Œè€Œå®ƒçš„çˆ¶ç±»æœ€ç»ˆæ˜¯ ObjcDelegateProxyï¼Œè¿™æ˜¯ä¸€ä¸ªçº¯ Objectiveâ€‘C ç±»å‹ã€‚ è®©æˆ‘ä»¬å…ˆè·³è¿‡ DelegateProxyï¼Œçœ‹çœ‹ ObjcDelegateProxy éƒ½å¹²äº†äº›ä»€ä¹ˆã€‚ åœ¨çœ‹ä¹‹å‰æˆ‘ä»¬åº”è¯¥å°±èƒ½æƒ³åˆ°ï¼Œå®ƒé‡Œé¢ä¸€å®šæ¶‰åŠåˆ°äº† ObjC runtime çš„ä½¿ç”¨ï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦ç‰¹åœ°ä½¿ç”¨ ObjC ç›¸å…³ä»£ç ä½äº Runtime ç›®å½•ä¸‹ã€‚ // Runtime/include/ObjcDelegateProxy.h #import &lt;Foundation/Foundation.h&gt; @interface ObjcDelegateProxy: NSObject @property (nonnull, strong, atomic, readonly) NSSet &lt;NSValue *&gt; *selectors; /// å½“æ‹¦æˆªåˆ°å¯¹åº”é€‰æ‹©å­æ—¶è¢«è°ƒç”¨ï¼Œå‚æ•°ä¸ºæ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ - (void)interceptedSelector:(SEL _Nonnull)selector arguments:(NSArray * _Nonnull)arguments; - (BOOL)respondsToSelector:(SEL _Nonnull)aSelector; - (BOOL)canRespondToSelector:(SEL _Nonnull)selector; @end ä»æ¥å£è®¾è®¡ä¸Šæ¥è¯´è¿™ä¸ªç±»å‹æš´éœ²äº†æ¯”è¾ƒå¤šçš„æ–¹æ³•ï¼Œå…¶ä¸­ interceptedSelector æ–¹æ³•æ˜¯åœ¨ willDisplayCellPublisher ä¸­ç”¨åˆ°çš„é‚£ä¸ªï¼Œä¸€ä¼šå„¿é‡ç‚¹å…³æ³¨ä¸€ä¸‹ã€‚ å†çœ‹çœ‹ .m æ–‡ä»¶ä¸­çš„å®ç°ï¼š æˆ‘çœç•¥äº†æŸ¥æ‰¾æ–¹æ³•é€‰æ‹©å­ç›¸å…³æ–¹æ³•çš„å®ç°ï¼Œæœ¬æ–‡é‡ç‚¹å…³æ³¨æ–¹æ³•è½¬å‘ç›¸å…³çš„éƒ¨åˆ†ã€‚ /// Runtime/ObjcDelegateProxy.m #import &lt;Foundation/Foundation.h&gt; #import &quot;include/ObjcDelegateProxy.h&quot; #import &lt;objc/runtime.h&gt; /// è¾…åŠ©å®ï¼šå°†å¯¹è±¡åŒ…è£…æˆ NSValueï¼Œä»¥éä¿ç•™æ–¹å¼æŒæœ‰ #define OBJECT_VALUE(object) [NSValue valueWithNonretainedObject:(object)] /// å…¨å±€é™æ€å­—å…¸ï¼šKey ä¸ºä»£ç†ç±»ï¼ŒValue ä¸ºè¯¥ç±»å£°æ˜çš„æ‰€æœ‰æ‹¦æˆªé€‰æ‹©å­é›†åˆ static NSMutableDictionary&lt;NSValue *, NSSet&lt;NSValue *&gt; *&gt; *allSelectors; @implementation ObjcDelegateProxy - (NSSet *)selectors { return allSelectors[OBJECT_VALUE(self.class)]; } + (void)initialize { @synchronized (ObjcDelegateProxy.class) { if (!allSelectors) { allSelectors = [NSMutableDictionary new]; } // è·å–æœ¬ç±»åŠå…¶çˆ¶ç±»ä¸­æ‰€æœ‰ returnType ä¸º void çš„æ–¹æ³•é€‰æ‹©å­ allSelectors[OBJECT_VALUE(self)] = [self selectorsOfClass:self withEncodedReturnType:[NSString stringWithFormat:@&quot;%s&quot;, @encode(void)]]; } } - (BOOL)respondsToSelector:(SEL _Nonnull)aSelector { return [super respondsToSelector:aSelector] || [self canRespondToSelector:aSelector]; } - (BOOL)canRespondToSelector:(SEL _Nonnull)selector { for (id current in allSelectors[OBJECT_VALUE(self.class)]) { if (selector == (SEL) [current pointerValue]) { return true; } } return false; } - (void)interceptedSelector:(SEL _Nonnull)selector arguments:(NSArray * _Nonnull)arguments { // é»˜è®¤å®ç°ï¼Œå­ç±»å¯é‡å†™ä»¥å¤„ç†æ‹¦æˆªåˆ°çš„æ–¹æ³• } - (void)forwardInvocation:(NSInvocation *)anInvocation { NSArray * _Nonnull arguments = unpackInvocation(anInvocation); [self interceptedSelector:anInvocation.selector arguments:arguments]; } /// ä»ä¸€ä¸ª NSInvocation å¯¹è±¡ä¸­æå–å‡ºå‚æ•°å€¼ï¼Œå¹¶åŒ…è£…ä¸ºä¸€ä¸ª NSArray&lt;id&gt; è¿”å› NSArray * _Nonnull unpackInvocation(NSInvocation * _Nonnull invocation) { NSUInteger numberOfArguments = invocation.methodSignature.numberOfArguments; NSMutableArray *arguments = [NSMutableArray arrayWithCapacity:numberOfArguments - 2]; // å¿½ç•¥å‰ä¸¤ä¸ªå‚æ•°ï¼šself å’Œ _cmdï¼ˆObjective-C çš„é»˜è®¤å‰ä¸¤ä¸ªå‚æ•°ï¼‰ for (NSUInteger index = 2; index &lt; numberOfArguments; ++index) { const char *argumentType = [invocation.methodSignature getArgumentTypeAtIndex:index]; // Skip const type qualifier. if (argumentType[0] == 'r') { argumentType++; } // è¾…åŠ©å®ï¼šåˆ¤æ–­å‚æ•°ç±»å‹ #define isArgumentType(type) \\ strcmp(argumentType, @encode(type)) == 0 // è¾…åŠ©å®ï¼šæå–åŸºç¡€æ•°å€¼ç±»å‹å‚æ•°ï¼Œå¹¶è½¬ä¸º NSNumber #define extractTypeAndSetValue(type, value) \\ type argument = 0; \\ [invocation getArgument:&amp;argument atIndex:index]; \\ value = @(argument); \\ id _Nonnull value; // å¼•ç”¨ç±»å‹æˆ– block ç±»å‹ï¼Œç›´æ¥è§£åŒ… if (isArgumentType(id) || isArgumentType(Class) || isArgumentType(void (^)(void))) { __unsafe_unretained id argument = nil; [invocation getArgument:&amp;argument atIndex:index]; value = argument; } // ä»¥ä¸‹å…¨éƒ¨æ˜¯åŸºæœ¬ç±»å‹ï¼Œç»Ÿä¸€è½¬ä¸º NSNumber else if (isArgumentType(char)) { extractTypeAndSetValue(char, value); } else if (isArgumentType(short)) { extractTypeAndSetValue(short, value); } else if (isArgumentType(int)) { extractTypeAndSetValue(int, value); } else if (isArgumentType(long)) { extractTypeAndSetValue(long, value); } else if (isArgumentType(long long)) { extractTypeAndSetValue(long long, value); } else if (isArgumentType(unsigned char)) { extractTypeAndSetValue(unsigned char, value); } else if (isArgumentType(unsigned short)) { extractTypeAndSetValue(unsigned short, value); } else if (isArgumentType(unsigned int)) { extractTypeAndSetValue(unsigned int, value); } else if (isArgumentType(unsigned long)) { extractTypeAndSetValue(unsigned long, value); } else if (isArgumentType(unsigned long long)) { extractTypeAndSetValue(unsigned long long, value); } else if (isArgumentType(float)) { extractTypeAndSetValue(float, value); } else if (isArgumentType(double)) { extractTypeAndSetValue(double, value); } else if (isArgumentType(BOOL)) { extractTypeAndSetValue(BOOL, value); } else if (isArgumentType(const char *)) { extractTypeAndSetValue(const char *, value); } // å¦‚æœä¸æ˜¯ä»»ä½•å·²çŸ¥ç±»å‹ï¼Œå°±ç”¨ NSValue åŒ…è£¹åŸå§‹æ•°æ®ï¼Œæ¯”å¦‚ CGRectã€CGSize else { NSUInteger size = 0; NSGetSizeAndAlignment(argumentType, &amp;size, NULL); NSCParameterAssert(size &gt; 0); // ä½¿ç”¨æ ˆå†…å­˜æ¥å­˜å‚¨æœªçŸ¥æ•°æ® uint8_t data[size]; [invocation getArgument:&amp;data atIndex:index]; value = [NSValue valueWithBytes:&amp;data objCType:argumentType]; } [arguments addObject:value]; } return arguments; } + (NSSet &lt;NSValue *&gt; *) selectorsOfClass: (Class _Nonnull __unsafe_unretained) class withEncodedReturnType: (NSString *) encodedReturnType { // çœç•¥ç›¸å…³å®ç° } + (NSSet &lt;NSValue *&gt; *) selectorsOfProtocol: (Protocol * __unsafe_unretained) protocol andEncodedReturnType: (NSString *) encodedReturnType { // çœç•¥ç›¸å…³å®ç° } + (NSSet &lt;NSValue *&gt; *) selectorsOfProtocolPointer: (Protocol * __unsafe_unretained * _Nullable) pointer count: (NSInteger) count andEncodedReturnType: (NSString *) encodedReturnType { // çœç•¥ç›¸å…³å®ç° } + (NSString *)encodedMethodReturnTypeForMethod: (struct objc_method_description) method { return [[NSString alloc] initWithBytes:method.types length:1 encoding:NSASCIIStringEncoding]; } @end ä»æºç å¾—çŸ¥ï¼ŒObjcDelegateProxy åŠå…¶å­ç±»åœ¨åˆå§‹åŒ–ç±»å‹æ—¶è°ƒç”¨ initialize æ–¹æ³•ï¼Œæ–¹æ³•å†…ä¼šä»¥ç±»å‹ä¸º keyï¼Œå°†æ‰€æœ‰è¿”å›ç±»å‹ä¸º void çš„æ–¹æ³•å­˜å‚¨åˆ° allSelectors è¿™ä¸ªç§æœ‰é™æ€å…¨å±€å±æ€§ä¸­ã€‚ respondsToSelector: ä¼šå…ˆè°ƒç”¨ canRespondToSelector:ï¼Œåè€…ä¼šåœ¨ allSelectors ä¸­æŸ¥æ‰¾è¯¥ selectorã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œå°±è¿”å› YESï¼Œä½¿å¾—è¿è¡Œæ—¶è®¤ä¸ºæ­¤æ–¹æ³•å·²è¢«å®ç°ï¼Œä»è€Œè·³è¿‡æ¶ˆæ¯è½¬å‘çš„åç»­æµç¨‹ã€‚ å®é™…æƒ…å†µè‚¯å®šæ˜¯ä¸ä¼šå®ç°ç›¸å…³æ–¹æ³•ï¼Œæ¥ç€å°±ä¼šé€šè¿‡æ¶ˆæ¯è½¬å‘æµç¨‹æ‰§è¡Œ forwardInvocation æ–¹æ³•ï¼Œå°†é€šè¿‡ unpackInvocation æ–¹æ³•æ‹¿åˆ°çš„å‚æ•°ï¼Œå’Œæ–¹æ³•é€‰æ‹©å­ä¸€èµ·äº¤ç»™ interceptedSelector æ–¹æ³•ï¼Œä¾›å­ç±»è¦†å†™ä½¿ç”¨ã€‚ å¤§è‡´çš„æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š [ç³»ç»Ÿè°ƒç”¨ delegate æ–¹æ³•] â†“ [è°ƒç”¨ respondsToSelector:] â†“ ObjcDelegateProxy åˆ¤æ–­æ˜¯å¦æ”¯æŒè¯¥ selectorï¼ˆä»åè®®ä¸­æ”¶é›†ï¼‰ â†“ ç³»ç»Ÿç»§ç»­è°ƒç”¨è¯¥æ–¹æ³•ï¼Œä½† proxy æœªå®ç° â€”â€”&gt; â†“ è§¦å‘ forwardInvocation â†“ unpackInvocation -&gt; æ‹¿åˆ°å‚æ•° â†“ interceptedSelector -&gt; å­ç±»å¤„ç† â†“ å‘å‡ºäº‹ä»¶æˆ–è‡ªå®šä¹‰é€»è¾‘ ç›¸ä¿¡ç°åœ¨ä½ åº”è¯¥èƒ½æ˜ç™½ä¸ºä»€ä¹ˆç‰¹åœ°ä½¿ç”¨ ObjC æ¥å®ç°äº†ï¼šSwift ä¸æ”¯æŒ NSInvocationï¼Œä¹Ÿæ— æ³•é‡å†™ forwardInvocation è¿›è¡Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘ã€‚ å›åˆ° TableViewDelegateProxyï¼Œå®ƒé™¤äº†é—´æ¥ç»§æ‰¿è‡ª ObjcDelegateProxy ä¹‹å¤–ï¼Œè¿˜éµå¾ªäº† DelegateProxyType åè®®ï¼Œè¿™ä¸ª swift åè®®çš„å®šä¹‰å°±æ¯”è¾ƒç®€å•å¸¸è§äº†ï¼š import Foundation private var associatedKey = &quot;delegateProxy&quot; public protocol DelegateProxyType { associatedtype Object func setDelegate(to object: Object) } @available(OSX 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *) public extension DelegateProxyType where Self: DelegateProxy { static func createDelegateProxy(for object: Object) -&gt; Self { // ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œé¿å…åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é‡å¤åˆ›å»º/çŠ¶æ€ç«äº‰ã€‚ objc_sync_enter(self) defer { objc_sync_exit(self) } let delegateProxy: Self if let associatedObject = objc_getAssociatedObject(object, &amp;associatedKey) as? Self { delegateProxy = associatedObject } else { delegateProxy = .init() objc_setAssociatedObject(object, &amp;associatedKey, delegateProxy, .OBJC_ASSOCIATION_RETAIN) } delegateProxy.setDelegate(to: object) return delegateProxy } } é€šè¿‡è¿™ä¸ªåè®®ï¼Œæˆ‘ä»¬å¯ä»¥ä¾¿æ·åœ°ä¸º DelegateProxy å­ç±»æ·»åŠ  createDelegateProxy(_:) æ–¹æ³•ï¼Œæ–¹æ³•å†…éƒ¨ä½¿ç”¨æ‡’åŠ è½½ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå…³è”å¯¹è±¡ï¼Œéšåè°ƒç”¨ setDelegate(to:) æ–¹æ³•ï¼Œå°†è¿™ä¸ªå…³è”å¯¹è±¡è®¾ç½®ä¸º object çš„ä»£ç†ã€‚ çœ‹å®Œè¿™äº›å‰ç½®æ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€çœ‹ DelegateProxy è¿™ä¸ªç±»å‹äº†ï¼ˆDelegateProxy.swiftï¼‰ï¼š @available(OSX 10.15, iOS 13.0, tvOS 13.0, watchOS 6.0, *) open class DelegateProxy: ObjcDelegateProxy { private var dict: [Selector: [([Any]) -&gt; Void]] = [:] private var subscribers = [AnySubscriber&lt;[Any], Never&gt;?]() ... public override func interceptedSelector(_ selector: Selector, arguments: [Any]) { dict[selector]?.forEach { handler in handler(arguments) } } public func intercept(_ selector: Selector, _ handler: @escaping ([Any]) -&gt; Void) { if dict[selector] != nil { dict[selector]?.append(handler) } else { dict[selector] = [handler] } } public func interceptSelectorPublisher(_ selector: Selector) -&gt; AnyPublisher&lt;[Any], Never&gt; { DelegateProxyPublisher&lt;[Any]&gt; { subscriber in // ä¸ºäº†åœ¨ deinit ä¸­é‡Šæ”¾ï¼Œéœ€è¦å…ˆå­˜å‚¨èµ·æ¥ self.subscribers.append(subscriber) return self.intercept(selector) { args in _ = subscriber.receive(args) } }.eraseToAnyPublisher() } deinit { subscribers.forEach { $0?.receive(completion: .finished) } subscribers = [] } } ç°åœ¨æˆ‘ä»¬å¯ä»¥æ˜ç™½ï¼Œåœ¨ willDisplayCellPublisher ä¸­è°ƒç”¨çš„ interceptSelectorPublisher(_:) æ–¹æ³•ï¼Œå°† #selector(UITableViewDelegate.tableView(_:willDisplay:forRowAt:)) ä½œä¸º keyï¼Œç”¨äºå‘é€æ•°æ®çš„é—­åŒ…ä½œä¸º valueï¼Œå­˜å‚¨åˆ° dict è¿™ä¸ªå­—å…¸å±æ€§ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹åšä¸€ä¸ª â€œæ³¨å†Œâ€ æµç¨‹ã€‚ å½“æ¶ˆæ¯è½¬å‘è¢«è§¦å‘æ—¶ï¼ŒinterceptedSelector(_: _:) æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œé€šè¿‡å‚æ•° selector ä» dict ä¸­å–å‡ºæ•°æ®å‘é€äº‹ä»¶ï¼Œå†å°†å‚æ•°ä½œä¸º value å‘é€å‡ºå»ã€‚ DelegateProxyPublisher æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„è‡ªå®šä¹‰ Publisher å¯¹è±¡ï¼Œå®ƒè¢«å®šä¹‰åœ¨ DelegateProxyPublisherï¼Œè¿™é‡Œå°±ä¸å¯¹å…¶åšè¿‡å¤šçš„æè¿°ï¼Œè¯»è€…å¯ä»¥ç¿»é˜…æºç è‡ªè¡ŒæŸ¥çœ‹ã€‚ æ€»ç»“ è‡³æ­¤ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æ¸…æ¥šäº† CombineCocoa å¦‚ä½•åˆ©ç”¨ Combine å°è£… Objectiveâ€‘C æ¶ˆæ¯è½¬å‘æ¥æ‹¦æˆª delegate è°ƒç”¨ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯ä½¿ç”¨ Combine æ¡†æ¶ï¼Œå°è£…æ¶ˆæ¯è½¬å‘çš„ç»“æœã€‚è‡³äºå…³è”å¯¹è±¡çš„ä½¿ç”¨åˆ™æ˜¯é”¦ä¸Šæ·»èŠ±ã€‚ è€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜ç™½ï¼Œä¸ºä»€ä¹ˆ CombineCocoa è¿™å¥—æ¡†æ¶åªèƒ½æ‹¦æˆªæ²¡æœ‰è¿”å›å€¼çš„ä»£ç†æ–¹æ³•ï¼Œå› ä¸ºå®ƒçš„ allSelectors å±æ€§é‡Œåªå­˜å‚¨äº†è¿”å›å€¼ä¸º void çš„æ–¹æ³•ã€‚ è¯´åˆ°è¿™é‡Œï¼Œå†çœ‹çœ‹æ ‡é¢˜ï¼Œæ—¢ç„¶æåˆ°äº† Runtime çš„æ¶ˆæ¯è½¬å‘ï¼Œå°±è®©æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹æ¶ˆæ¯è½¬å‘çš„ç›¸å…³çŸ¥è¯†ã€‚ Runtime æ¶ˆæ¯è½¬å‘ åœ¨ ObjC ä¸­ï¼Œæ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯é€šè¿‡ objc_msgSend æ¥è¿›è¡Œï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸º â€œå‘é€æ¶ˆæ¯â€ã€‚æ•´ä¸ªå‘é€æ¶ˆæ¯çš„æµç¨‹å¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š â†“ [1] objc_msgSend(obj, sel) â†“ [2] æ–¹æ³•æœªæ‰¾åˆ° -&gt; runtime ä¼šè°ƒç”¨ï¼š +resolveInstanceMethod: æˆ– +resolveClassMethod: â†“ [3] ä»æœªå¤„ç†ï¼Ÿè°ƒç”¨ï¼š - forwardingTargetForSelector: ï¼ˆæä¾›å¦ä¸€ä¸ªå¯¹è±¡è½¬å‘ selectorï¼‰ â†“ [4] è¿˜ä¸è¡Œï¼Ÿruntime è°ƒç”¨ï¼š - methodSignatureForSelector: â†“ï¼ˆä½ å¿…é¡»è¿”å›ä¸€ä¸ª NSMethodSignatureï¼‰ [5] ç„¶åè°ƒç”¨ï¼š - forwardInvocation: â†“ [6] å¦‚æœ forwardInvocation æ²¡å¤„ç†ï¼Œä¼š crash: unrecognized selector sent to instance è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ â€œä½¿ç”¨ ObjC è°ƒç”¨ä¸€ä¸ªæœªå®ç°çš„æ–¹æ³•æ—¶ï¼Œæœªå¿…ä¼šè§¦å‘å´©æºƒâ€ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ å®ç°ï¼Œæˆ–è€…ä½¿ç”¨æ¶ˆæ¯è½¬å‘ã€‚ åŠ¨æ€æ–¹æ³•è§£æ ç¬¬ä¸€é˜¶æ®µè¢«ç§°ä¹‹ä¸º â€œåŠ¨æ€æ–¹æ³•è§£æâ€ï¼ˆDynamic Method Resolutionï¼‰ï¼Œå³ +resolveInstanceMethod: æˆ– +resolveClassMethod: æ–¹æ³•ä¸­ï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ ä¸€ä¸ªæ–¹æ³•ã€‚ å¿«é€Ÿè½¬å‘ ç¬¬äºŒé˜¶æ®µè¢«ç§°ä¹‹ä¸º â€œå¿«é€Ÿè½¬å‘â€ï¼ˆFast Forwardingï¼‰ï¼Œå³ -forwardingTargetForSelector: æ–¹æ³•ä¸­æŠŠè¿™æ¬¡å‡½æ•°è°ƒç”¨è½¬å‘ç»™å¦å¤–ä¸€ä¸ªå¯¹è±¡ã€‚ å®Œæ•´æ¶ˆæ¯è½¬å‘ å¦‚æœè¿™ä¸¤æ­¥éƒ½æ²¡å¤„ç†ï¼Œåˆ™ä¼šè§¦å‘ç¬¬ä¸‰é˜¶æ®µï¼šâ€œå®Œæ•´æ¶ˆæ¯è½¬å‘â€ï¼ˆFull Message Forwardingï¼‰ï¼Œæˆ–è€…å« â€œæ ‡å‡†æ¶ˆæ¯è½¬å‘â€ï¼ˆStandard Message Forwardingï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸Šæ–‡æåˆ°çš„ -methodSignatureForSelector: + -forwardInvocation: è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ -methodSignatureForSelector: æ˜¯è°ƒç”¨ -forwardInvocation: çš„å‰æï¼Œè¯¥æ–¹æ³•è´Ÿè´£è¿”å›æ–¹æ³•çš„ç­¾åä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å‚æ•°æ•°é‡ã€ç±»å‹ã€è¿”å›å€¼ç±»å‹ç­‰ï¼Œä¸º NSMethodSignature ç±»å‹ã€‚ NSObject æœ‰ä¸€ä¸ªé»˜è®¤çš„ -methodSignatureForSelector: æ–¹æ³•å®ç°ï¼Œé»˜è®¤å®ç°ä¼šå»å½“å‰ç±»çš„ method list ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨åä¸º selector çš„æ–¹æ³•ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªå¯¹åº”çš„ NSMethodSignatureï¼›å¦åˆ™è¿”å› nilã€‚å¦‚æœä½ ä¸é‡å†™å®ƒï¼Œè€Œ selector ç¡®å®ä¸å­˜åœ¨ï¼Œé»˜è®¤å®ç°å°±ä¼šè¿”å› nilï¼Œè¿™ä¼šç›´æ¥å¯¼è‡´ runtime æŠ›å‡º unrecognized selector sent to instance å¼‚å¸¸ï¼Œä¸ä¼šè¿›å…¥ -forwardInvocation:ã€‚ åœ¨ CombineCocoa çš„åœºæ™¯ä¸­ï¼ŒObjcDelegateProxy æ²¡æœ‰è¦†å†™ -methodSignatureForSelector: æ–¹æ³•ï¼Œä½†æ˜¯å› ä¸ºå…¶å­ç±»å®ç°äº†å¯¹åº”çš„ä»£ç†åè®®ï¼Œæ¯”å¦‚ UITableViewDelegateï¼Œæ‰€ä»¥ç›¸å…³çš„ @objc æ–¹æ³•ä¼šè¢«æ·»åŠ åˆ°æ–¹æ³•åˆ—è¡¨ä¸­ï¼Œæ‰€ä»¥ -methodSignatureForSelector: èƒ½å¤Ÿç”Ÿæˆæ­£ç¡®çš„ NSMethodSignature å¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨åˆ° -forwardInvocation: æ–¹æ³•ã€‚ ","link":"https://blog.rakuyo.dev/combine-intercept-delegate-objc-runtime/"},{"title":"é€šè¿‡è¦†å†™æ–¹æ³•çœ‹ Swift æ–¹æ³•æ´¾å‘","content":"åœ¨ Swift å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸åˆ©ç”¨ extension å’Œ // MARK: æ¥åˆ’åˆ†ä»£ç é€»è¾‘ï¼Œæ¯”å¦‚åˆ’åˆ†å‡º â€œConfigâ€ã€â€œLife cycleâ€ ç­‰æ¨¡å—ã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨æ‰©å±•æ—¶å´å¸¸å¸¸ä¼šé‡åˆ°æ–¹æ³•è¦†å†™çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å®šä¹‰åŸºç±»çš„â€œæ¡†æ¶æ–¹æ³•â€åï¼Œå­ç±»æ— æ³•æ­£ç¡®è¦†å†™çš„é—®é¢˜ã€‚ æœ¬æ–‡å°†é€šè¿‡è¦†å†™æ–¹æ³•ï¼Œæ·±å…¥æ¢è®¨ Swift ä¸­çš„æ–¹æ³•æ´¾å‘æœºåˆ¶ï¼Œå¹¶è®¨è®ºå¦‚ä½•åœ¨ä»£ç è®¾è®¡æ—¶è§„é¿å¸¸è§å‘ç‚¹ã€‚ æœ¬æ–‡åŸºäº Swift 5 ä¸ Xcode 16.2 ç¼–å†™ã€‚ ä½•ä¸º Swift æ–¹æ³•æ´¾å‘ é¦–å…ˆï¼Œä¸ºä¸äº†è§£ â€œæ–¹æ³•æ´¾å‘â€ çš„è¯»è€…åšä¸ªç®€çŸ­çš„æ¦‚å¿µè§£é‡Šï¼š æ–¹æ³•æ´¾å‘ç®€å•åœ°è®²ï¼ŒæŒ‡çš„æ˜¯åœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå¦‚ä½•æ‰§è¡Œè¯¥æ–¹æ³•çš„æœºåˆ¶ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸º â€œå»å“ªé‡Œæ‰¾åˆ°è¯¥æ–¹æ³•çš„å®ç°â€ çš„æœºåˆ¶ã€‚ å¹¿ä¹‰ä¸Šè¯´ Swift çš„æ–¹æ³•æ´¾å‘åˆ†ä»¥ä¸‹ä¸¤ç§ï¼š æ´¾å‘ç±»å‹ å®šä¹‰ åº•å±‚æœºåˆ¶ é™æ€æ´¾å‘ åœ¨ç¼–è¯‘æœŸå°±ç¡®å®šè°ƒç”¨ç›®æ ‡ ç›´æ¥å†…è”è°ƒç”¨ï¼Œä¸å‚ä¸è™šå‡½æ•°è¡¨ åŠ¨æ€æ´¾å‘ åœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ç¡®å®šè°ƒç”¨ç›®æ ‡ ä¾èµ–è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰æˆ– Objectiveâ€‘C æ¶ˆæ¯å‘é€æœºåˆ¶ æ–¹æ³•è¦†å†™ä¸æ–¹æ³•æ´¾å‘ åœ¨å¾ˆå¤šé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¼šåœ¨åŸºç±»ä¸­å®šä¹‰ä¸€äº›â€œæ¡†æ¶æ–¹æ³•â€ï¼Œç”±å­ç±»è¦†å†™è¿™äº›æ–¹æ³•æ¥å®ç°ç»Ÿä¸€çš„ä»£ç ç»“æ„ã€‚æ¯”å¦‚ä¸‹é¢çš„ç±»å‹ï¼š open class BaseCollectionViewCell: UICollectionViewCell { override public init(frame: CGRect) { super.init(frame: frame) config() } public required init?(coder: NSCoder) { super.init(coder: coder) config() } } extension BaseCollectionViewCell { open func config() { // âš ï¸ Non-'@objc' instance method in extensions cannot be overridden; use 'public' instead addSubviews() addInitialLayout() } open func addSubviews() { } // âš ï¸ Non-'@objc' instance method in extensions cannot be overridden; use 'public' instead open func addInitialLayout() { } // âš ï¸ Non-'@objc' instance method in extensions cannot be overridden; use 'public' instead } config()ã€addSubviews() å’Œ addInitialLayout() è¢«æˆ‘ç§°ä¸º â€œæ¡†æ¶æ–¹æ³•â€ï¼Œç”¨æ¥çº¦æŸå­ç±»ï¼Œç»Ÿä¸€ç®¡ç†æŸä¸€ç±»çš„ä»£ç ã€‚ å†™å®Œæ–¹æ³•åï¼ŒXcode ç»™äº†æˆ‘ä»¬ä¸‰ä¸ªè­¦å‘Šï¼šNon-'@objc' instance method in extensions cannot be overridden; use 'public' insteadã€‚æç¤ºæˆ‘ä»¬åœ¨ extension ä¸­å®šä¹‰çš„é @objc æ–¹æ³•ä¸èƒ½è¢«è¦†å†™çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨çš„ open æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå»ºè®®æˆ‘ä»¬æ¢æˆ publicã€‚ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ Swift ä¸­çš„æ–¹æ³•è¦†å†™ æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Swift æ–¹æ³•è¦†å†™çš„å®ç°åŸç†ï¼šåœ¨ Swift ä¸­ï¼Œæ–¹æ³•è¦†å†™æœ¬è´¨ä¸Šæ˜¯ä¾èµ– â€œåŠ¨æ€æ´¾å‘æœºåˆ¶â€ æ¥å®ç°çš„ã€‚ å¯¹äºä¸€ä¸ªçº¯ Swift ç±»è€Œè¨€ï¼Œåœ¨ç±»çš„ä¸»è¦å£°æ˜éƒ¨åˆ†å®šä¹‰çš„æ–¹æ³•ä¼šè¢«åŠ å…¥åˆ°è™šå‡½æ•°è¡¨ï¼ˆvtable tableï¼‰ä¸­ã€‚è¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹å¯ä»¥æ‰¾åˆ°æ­£ç¡®çš„å®ç°ï¼Œä»è€Œæ”¯æŒå­ç±»è¦†å†™ã€‚ åœ¨ Swift ä¸­ï¼Œè™šå‡½æ•°è¡¨è¢«ç§°ä¸º â€œwitness tableâ€ï¼Œä¸‹æ–‡å°†ä¼šä½¿ç”¨ â€œâ€œwitnessâ€ è¿™ä¸ªå•è¯ä»£è¡¨ â€œè™šå‡½æ•°è¡¨â€ã€‚ è€Œåœ¨ extension ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯ â€œé™æ€æ´¾å‘â€ï¼Œé™æ€æ´¾å‘ä¼šåœ¨ç¼–è¯‘æ—¶ç›´æ¥ç»‘å®šè°ƒç”¨ç›®æ ‡ï¼Œä¸ä¼šè¢«åŠ å…¥åˆ° witness table é‡Œï¼Œä¹Ÿä¸æš´éœ²åœ¨ Objectiveâ€‘C è¿è¡Œæ—¶ä¸­ã€‚ ä¸Šä¸€èŠ‚ä¸­æåˆ°ï¼Œå­ç±»è¦†å†™æ–¹æ³•éœ€è¦ä¾é è™šå‡½æ•°è¡¨æˆ– Objectiveâ€‘C è¿è¡Œæ—¶ï¼Œæ‰€ä»¥å®šä¹‰åœ¨ extension ä¸­çš„æ–¹æ³•æ— æ³•è¢«å­ç±»ç»§æ‰¿ã€‚ æ”¹å†™ çŸ¥é“é”™è¯¯åŸå› çš„ä½ å¯èƒ½æƒ³åˆ°äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š å¯ä»¥å°†æ–¹æ³•ç§»åŠ¨åˆ°ä¸»è¦å£°æ˜éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡è™šå‡½æ•°è¡¨å®ç°æ–¹æ³•è¦†å†™ã€‚ æˆ–è€…æŒ‰ç…§è­¦å‘Šçš„æç¤ºï¼Œæ·»åŠ  @objcï¼Œå€ŸåŠ© Objective-C è¿è¡Œæ—¶å®ç°æ–¹æ³•è¦†å†™ã€‚ æˆ‘ä»¬å…ˆé‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œçœ‹çœ‹å¦‚ä½•å®ç°ï¼š open class BaseCollectionViewCell: UICollectionViewCell { ... open func config() { ... } ... } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âŒ Non-@objc instance method 'config()' declared in 'BaseCollectionViewCell' cannot be overridden from extension } å½“æˆ‘ä»¬å°è¯•ç»§æ‰¿ BaseCollectionViewCell å»å®šä¹‰ SubCollectionViewCell æ—¶ï¼Œé—®é¢˜æ›´ä¸¥é‡äº†ï¼ŒXcode æŠ¥äº†ä¸ªé”™è¯¯ï¼š Non-@objc instance method 'config()' declared in 'BaseCollectionViewCell' cannot be overridden from extension è¿™å…¶å®ä¹Ÿå¾ˆå¥½ç†è§£ï¼Œæ ¹æ®è™šå‡½æ•°è¡¨çš„åŸç†ï¼Œå¦‚æœçˆ¶ç±»å‡½æ•°è¢«è¦†å†™ï¼Œé‚£ä¹ˆè¡¨ä¸­åªä¼šä¿å­˜è¢«è¦†å†™ä¹‹åçš„å‡½æ•°ã€‚æ‰€ä»¥å°½ç®¡çˆ¶ç±»çš„ config() æ–¹æ³•åœ¨è™šå‡½æ•°è¡¨ä¸­ï¼Œä½†æ˜¯å­ç±»çš„æ–¹æ³•ä¸åœ¨ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å°±æ— æ³•ä½¿ç”¨å­ç±»çš„å®ç°æ›¿ä»£çˆ¶ç±»çš„å®ç°ã€‚ æ—¢ç„¶ç¬¬ä¸€æ¡è·¯èµ°ä¸é€šï¼Œé‚£ä¹ˆç¬¬äºŒæ¡è·¯å‘¢ï¼Ÿæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š open class BaseCollectionViewCell: UICollectionViewCell { ... @objc open func config() { ... } ... } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âŒ Cannot override a non-dynamic class declaration from an extension } å¾ˆå¥½ï¼ŒæŠ¥é”™å˜äº†ï¼Œè¯æ˜æœ‰æ•ˆï¼Œä½†ä¸å®Œå…¨æœ‰æ•ˆã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨ @objc å°†çˆ¶ç±»æ–¹æ³•æš´éœ²ç»™ Objective-Cï¼Œä½†æ˜¯è¿™å®é™…ä¸Šå¹¶ä¸æ„å‘³ç€æ–¹æ³•æ´¾å‘æ–¹å¼æ”¹ä¸ºäº† â€œObjective-C æ¶ˆæ¯æ´¾å‘â€ã€‚ åœ¨ Swift 3 æ—¶ä»£å­˜åœ¨ @objc çš„éšå¼æ¨æ–­ï¼Œè€Œåœ¨å‘å¸ƒ Swift 4 æ—¶å€™ï¼Œè¿™ä¸ªéšå¼æ¨æ–­è¢«å–æ¶ˆäº†ã€‚å¼€å‘è€…åœ¨ç±»çš„ä¸»è¦å£°æ˜ï¼ˆè¯·å…ˆç•™æ„è¿™ä¸€ç‚¹ï¼Œåæ–‡ä¸­è¿˜ä¼šæåŠï¼‰ä¸­ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ  dynamic å…³é”®å­—ï¼Œæ‰èƒ½å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå°†è¿™ä¸ªæ–¹æ³•æ”¹ä¸ºä½¿ç”¨ â€œObjective-C æ¶ˆæ¯æ´¾å‘â€ã€‚å¦‚æœåªæ·»åŠ  @objcï¼Œé‚£ä¹ˆæ–¹æ³•ä»…ä»…æ˜¯è¢«æš´éœ²ç»™ Objective-C è€Œå·²ï¼Œå®é™…ä¸Šè¿˜æ˜¯è¢«æ·»åŠ åˆ°è™šå‡½æ•°è¡¨ä¸­ï¼Œæœ€ç»ˆä½¿ç”¨å‡½æ•°è¡¨æ´¾å‘ã€‚ æ‰€ä»¥æ­£ç¡®çš„åšæ³•æ˜¯ä¸ºçˆ¶ç±»çš„æ–¹æ³•å®šä¹‰æ·»åŠ  dynamic å…³é”®å­—ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š open class BaseCollectionViewCell: UICollectionViewCell { ... @objc dynamic open func config() { ... } ... } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âœ… } å¥½å¥‡çš„ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€ä¸ªå°ç»†èŠ‚ï¼šä¸ºä»€ä¹ˆå­ç±»æ–¹æ³•å…‰ç§ƒç§ƒçš„ï¼Œæ—¢ä¸ç”¨æ·»åŠ  @objcï¼Œåˆä¸ç”¨æ·»åŠ  dynamicï¼Ÿ è¿™æ˜¯å› ä¸ºå°½ç®¡ Swift 4 å·²ç»å–æ¶ˆäº† @objc éšå¼æ¨æ–­ï¼Œä½†æ˜¯åœ¨ç»§æ‰¿æ—¶è¿™ä¸€æ¨æ–­è¢«ä¿ç•™äº†ä¸‹æ¥ï¼Œå‚è€ƒï¼šConstructs that (still) infer @objcã€‚æ‰€ä»¥åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸ºäº†ä¿æŒä¸€è‡´æ€§ï¼Œå­ç±»è‡ªåŠ¨ç»§æ‰¿äº†çˆ¶ç±»æ–¹æ³•çš„ä¿®é¥°ã€‚ extension ç‹‚äºº å¥½äº†ï¼Œç°åœ¨ä½ è·Ÿæˆ‘è¯´ä½ æ˜¯ extension çš„ç‹‚çƒ­ç²‰ä¸ï¼Œä½ æƒ³å°†çˆ¶ç±»çš„æ¡†æ¶æ–¹æ³•ä¹Ÿç§»åˆ° extension å»å®šä¹‰ï¼Œäºæ˜¯ä½ å°†ä»£ç æ”¹æˆäº†è¿™æ ·ï¼š open class BaseCollectionViewCell: UICollectionViewCell { } extension BaseCollectionViewCell { @objc // âš ï¸ å› ä¸ºä½ çš„ç²—å¿ƒï¼Œä½ é—æ¼äº† `dynamic` å…³é”®å­—ã€‚ open func config() { } } class SubCollectionViewCell: BaseCollectionViewCell { } extension SubCollectionViewCell { override func config() { } // âœ… } è®©æˆ‘ä»¬å‡è®¾ä½ æ˜¯ä¸€ä¸ªç²—å¿ƒçš„äººï¼ˆå¯¹ä¸èµ·ï¼‰ï¼Œä½ åœ¨ç§»åŠ¨ä»£ç æ—¶ä¸¢å¤±äº† config() æ–¹æ³•ä¸Šçš„ dynamic å…³é”®å­—ã€‚æ­¤æ—¶ä½ ä¼šå‘ç°å­ç±»çš„ config() æ²¡æœ‰æŠ¥é”™ï¼ç­‰ç­‰ï¼Œå…ˆåˆ«ç€æ€¥æ¬¢å‘¼ â€œextension ä¸‡å²ï¼â€ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆä¸éœ€è¦ dynamicï¼Ÿ ç­”æ¡ˆæ˜¯å› ä¸ºï¼šåœ¨ extension ä¸­å®šä¹‰æ–¹æ³•å¹¶ä½¿ç”¨ @objc ä¿®é¥°æ—¶ï¼Œå°†è‡ªåŠ¨è½¬æ¢ä¸º Objective-C æ¶ˆæ¯æ´¾å‘ã€‚æ‰€ä»¥å°±ä¸éœ€è¦æ˜¾å¼æ·»åŠ  dynamic äº†ã€‚ å†æ·±å…¥æ€è€ƒä¸€ä¸‹ï¼Œâ€œåœ¨ extension ä¸­å®šä¹‰æ–¹æ³•å¹¶ä½¿ç”¨ @objc ä¿®é¥°æ—¶ï¼Œå°†è‡ªåŠ¨è½¬æ¢ä¸º Objective-C æ¶ˆæ¯æ´¾å‘â€ è¿™ä¹ˆè®¾è®¡çš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘è§‰å¾—æ˜¯å› ä¸º â€œextension ä¸­çš„æ–¹æ³•æ— æ³•è¢«åŠ å…¥è™šå‡½æ•°è¡¨â€ã€‚ä½¿ç”¨ @objc ä¿®é¥°åè‚¯å®šæ— æ³•ä½¿ç”¨é™æ€æ´¾å‘ï¼Œæ‰€ä»¥æœ€ç»ˆåªèƒ½ä½¿ç”¨ Objective-C æ¶ˆæ¯æ´¾å‘äº†ã€‚ å†å†åˆ¨æ ¹é—®åº•ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ â€œextension ä¸­çš„æ–¹æ³•æ— æ³•è¢«åŠ å…¥è™šå‡½æ•°è¡¨â€ï¼Ÿæ ¹æ®æˆ‘ç›®å‰çš„çŸ¥è¯†ï¼Œè¿™æ˜¯ Swift ç¼–è¯‘å™¨åšçš„ç¡¬æ€§è§„å®šï¼Œå¹¶ä¸”ä¸ Swift çš„è®¾è®¡ç†å¿µæœ‰å…³ã€‚æœ¬æ–‡å°±ä¸å±•å¼€è®¨è®ºäº†ã€‚ çº¯ Swift ç±» ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæ‰€æœ‰çš„ç±»éƒ½æ˜¯ç»§æ‰¿è‡ª NSObjectï¼Œé‚£ä¹ˆå¦‚æœæ˜¯ä¸€ä¸ªçº¯ Swift ç±»å‘¢ï¼Ÿæ¯”å¦‚è¯´ä¸‹é¢è¿™ä¸ªç±»å‹ï¼š class Foo { func config() {} } class SubFoo: Foo { } extension SubFoo { override func config() {} // ğŸ©º è¿™é‡Œä¼šæŠ¥é”™å—ï¼ŸæŠ¥ä»€ä¹ˆé”™ï¼Ÿ } ç»“è®ºå’Œä¸Šé¢ä¸€æ ·ã€‚ä¸è®ºæ˜¯çº¯ Swift ç±»ï¼Œè¿˜æ˜¯ä¸€ä¸ªç»§æ‰¿è‡ª NSObject çš„ç±»ï¼Œåœ¨æœ¬æ–‡æ‰€è®¨è®ºçš„åœºæ™¯ä¸­è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚ æœ‰æœ‹å‹ä¼šæåˆ° Swift ä»£ç è·¨å¹³å°æ—¶çš„è¡¨ç°ï¼šæ·»åŠ äº† @objc å’Œ dynamic çš„çº¯ Swift ç±»åœ¨ Windows æˆ– Linus å¹³å°ä¸Šå¯ä»¥æ­£å¸¸ç¼–è¯‘å—ï¼Ÿç­”æ¡ˆè‚¯å®šæ˜¯å¦å®šçš„ï¼ŒObjective-C è¿è¡Œæ—¶åªå­˜åœ¨äº Apple å¹³å°ï¼Œåœ¨ä¸Šé¢ä¸¤ä¸ªå¹³å°ä¸­æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ æ€»ç»“ é€šè¿‡æœ¬æ–‡çš„è®¨è®ºï¼Œç›¸ä¿¡ä½ å·²ç»æŒæ¡äº†å¦‚ä½•åˆ©ç”¨ extension æ­£ç¡®è¦†å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚ åœ¨å®é™…å¼€å‘ä¸­ï¼Œè™½ç„¶ Swift çš„æ–¹æ³•æ´¾å‘å¸¸è¢«è§†ä½œé¢è¯•â€œå…«è‚¡æ–‡â€èˆ¬çš„åŸºç¡€çŸ¥è¯†ï¼Œä½†æ˜¯ç†è§£è¿™äº›ç»†å¾®å·®åˆ«ä¸ä»…èƒ½å¸®åŠ©ä½ åœ¨è®¾è®¡ç±»ç»“æ„å’Œæ–¹æ³•å®šä¹‰æ—¶åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ï¼Œè¿˜èƒ½åœ¨ä¿è¯é«˜æ•ˆè¿è¡Œçš„åŒæ—¶ï¼Œä¸ºåç»­çš„çµæ´»æ‰©å±•æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚ é‚£ä¹ˆç•™ä¸€ä¸ªè¯¾åæ€è€ƒé¢˜ï¼š class Foo { func config() {} } class SubFoo: Foo { } extension SubFoo { @objc override func config() {} // âŒ Non-@objc instance method 'config()' declared in 'Foo' cannot be overridden from extension } ä¸Šé¢è¿™ä¸ªä»£ç ä¸­ï¼Œçˆ¶ç±»å’Œå­ç±»ä¸­çš„ config() æ–¹æ³•åˆ†åˆ«æ˜¯å“ªç§æ´¾å‘æ–¹å¼å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„ç­”æ¡ˆã€‚ å†™åœ¨æœ€å å…¶å®æœ¬ç¯‡æ–‡ç« çš„åœºæ™¯ â€œextension çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºç±»æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œè€Œéä¿®æ”¹å·²æœ‰æ–¹æ³•â€ æ˜¯ä¸ç¬¦åˆ Swift è¯­è¨€çš„è®¾è®¡åˆè¡·çš„ã€‚å®˜æ–¹æ–‡æ¡£ä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼š Extensions can add new functionality to a type, but they canâ€™t override existing functionality. æ‰€ä»¥ä½ å¯èƒ½ä¼šåœ¨çœ‹åˆ°æ–‡ç« å¼€å¤´æ—¶å°±è¯´ï¼šâ€œæ ¹æœ¬å°±ä¸åº”è¯¥åœ¨ extension ä¸­è¦†å†™æ–¹æ³•ï¼â€ã€‚è¿™ä¹Ÿç¡®å®ï¼ŒApple å¹¶ä¸æ¨èæˆ‘ä»¬å€ŸåŠ© ObjC çš„æ–¹å¼åœ¨ extension ä¸­è¦†å†™æ–¹æ³•ã€‚ ä½†æ˜¯æ—¢ç„¶ Apple å…è®¸å¼€å‘è€…å€ŸåŠ© ObjC è¿è¡Œæ—¶çš„ç‰¹æ€§æ¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å§‘ä¸”å…è®¸å®ƒå­˜åœ¨å§ï¼Œç›¸ä¿¡ä½ æœ‰èƒ½åŠ›æŠŠæ¡ä¸€ä¸ªåº¦ï¼Œä»€ä¹ˆæ—¶å€™å¯ä»¥ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä»€ä¹ˆæ—¶å€™åº”å°½é‡é¿å…ã€‚ ","link":"https://blog.rakuyo.dev/swift-method-dispatch-via-overriding/"},{"title":"List files by size","content":"é—® ChatGPT å†™äº†ä¸€ä¸ª shell è„šæœ¬ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‰ç…§ä»å¤§åˆ°å°ï¼Œé€’å½’åœ°è¾“å‡ºé™¤äº† .json æ–‡ä»¶å¤–çš„æ–‡ä»¶ï¼ŒåŒ…å«æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶åã€‚å¯ç”¨äºè¾…åŠ©ç­›æŸ¥é¡¹ç›®ä¸­å“ªäº›å›¾ç‰‡è¿‡å¤§ã€‚ å•ç‹¬è„šæœ¬æ–‡ä»¶å°±ä¸å­˜åˆ° GitHub ä¸Šäº†ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å§ã€‚ #!/bin/bash # å®šä¹‰ä¸€ä¸ªå‡½æ•°å°†å­—èŠ‚å¤§å°è½¬ä¸ºäººç±»å¯è¯»æ ¼å¼ human_readable_size() { num=$1 # echo &quot;Converting size: $num bytes&quot; # Log: è½¬æ¢å­—èŠ‚å¤§å° if [ &quot;$num&quot; -lt 1024 ]; then echo &quot;${num}B&quot; elif [ &quot;$num&quot; -lt 1048576 ]; then echo &quot;$((num / 1024))K&quot; elif [ &quot;$num&quot; -lt 1073741824 ]; then echo &quot;$((num / 1048576))M&quot; else echo &quot;$((num / 1073741824))G&quot; fi } # ä¸´æ—¶æ–‡ä»¶å­˜å‚¨æ‰€æœ‰æ–‡ä»¶ä¿¡æ¯ temp_file=$(mktemp) # echo &quot;Temporary file created: $temp_file&quot; # Log: ä¸´æ—¶æ–‡ä»¶åˆ›å»º # ä½¿ç”¨ find æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶ï¼Œæ’é™¤ .json æ–‡ä»¶ find . -type f ! -name &quot;*.json&quot; -print0 | while IFS= read -r -d '' file; do # è·å–æ–‡ä»¶å¤§å°ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼ŒmacOS ä½¿ç”¨ stat -f%zï¼‰ size=$(stat -f%z &quot;$file&quot;) # echo &quot;File: $file, Size: $size bytes&quot; # Log: æ–‡ä»¶å’Œå¤§å° # è¾“å‡ºå­—èŠ‚å¤§å°å’Œæ–‡ä»¶è·¯å¾„åˆ°ä¸´æ—¶æ–‡ä»¶ echo &quot;$size $file&quot; &gt;&gt; &quot;$temp_file&quot; done # Log: æ’åºä¹‹å‰çš„ä¸´æ—¶æ–‡ä»¶å†…å®¹ # echo &quot;Contents of temp file before sorting:&quot; # cat &quot;$temp_file&quot; # æŒ‰å­—èŠ‚æ•°é™åºæ’åºï¼Œå¹¶è¾“å‡ºæ ¼å¼åŒ–ç»“æœ sort -k1,1nr &quot;$temp_file&quot; | while read -r size file; do # echo &quot;Processing sorted file: $file, Size: $size bytes&quot; # Log: å¤„ç†æ’åºåçš„æ–‡ä»¶ # è·å–äººç±»å¯è¯»æ ¼å¼ readable_size=$(human_readable_size &quot;$size&quot;) # ä½¿ç”¨ printf æ¥ç¡®ä¿è¾“å‡ºæ ¼å¼å¯¹é½ printf &quot;%-10s %-10s %s\\n&quot; &quot;$readable_size&quot; &quot;$size&quot; &quot;$file&quot; done # åˆ é™¤ä¸´æ—¶æ–‡ä»¶ # echo &quot;Deleting temporary file: $temp_file&quot; # Log: åˆ é™¤ä¸´æ—¶æ–‡ä»¶ rm &quot;$temp_file&quot; ","link":"https://blog.rakuyo.dev/list_files_by_size/"},{"title":"String Catalog å®è·µ","content":"æœ€è¿‘é¡¹ç›®æœ‰äº†å›½é™…åŒ–ï¼ˆi18nï¼‰çš„éœ€æ±‚ï¼Œæ­£å¥½ WWDC23 ä¸Š Apple æ¨å‡ºäº† String Catalog åŠŸèƒ½ã€‚è¶æ­¤æœºä¼šå°è¯•ä¸€ä¸‹ï¼Œå¹¶å°†ä¸€äº›ç»éªŒè®°å½•ä¸‹æ¥ã€‚ å¦‚æœä½ å¯¹ String Catalog ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯ä»¥å…ˆå‚è€ƒ è€å¸æœºæŠ€æœ¯ WWDC 23 å†…å‚ï¼Œæˆ–è€…ç›´æ¥è§‚çœ‹ WWDC çš„ å®˜æ–¹è§†é¢‘ å’Œ æ–‡æ¡£ æ¥äº†è§£æ›´å¤šã€‚ å¥½äº†åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹ä»Šå¤©çš„å†…å®¹ã€‚ å¼€å‘ç¯å¢ƒ Xcodeï¼š16.2 Swiftï¼š5.9 æ¡†æ¶ï¼šUIKit æœ€ä½æ”¯æŒç‰ˆæœ¬ï¼šiOS 13 ç»„ä»¶åŒ–å·¥å…·ï¼šCocoaPods Xcode 15 åŠä»¥ä¸Šç‰ˆæœ¬æ”¯æŒ String Catalogï¼Œç‰ˆæœ¬å¯¹åŠŸèƒ½æ— ç‰¹åˆ«é™åˆ¶ã€‚ ä½†ç”±äºé¡¹ç›®æœ€ä½æ”¯æŒç‰ˆæœ¬ä¸º iOS 13ï¼Œè€Œ String(localized:) æ˜¯ iOS 15 å¼•å…¥çš„ APIï¼Œå› æ­¤éœ€è¦é¢å¤–å¤„ç†ä½ç‰ˆæœ¬å…¼å®¹çš„é—®é¢˜ã€‚ æ­¤å¤–ï¼Œå…³äº String Catalog åœ¨ CocoaPods ç»„ä»¶åŒ–é¡¹ç›®ä¸­çš„ä½¿ç”¨ï¼Œç›¸å…³èµ„æ–™è¾ƒå°‘ï¼Œå› æ­¤è¿™éƒ¨åˆ†å†…å®¹éœ€è¦å®é™…æ‘¸ç´¢ä¸€ä¸‹ã€‚ é¡¹ç›®å‡†å¤‡å·¥ä½œ é¦–å…ˆï¼Œåœ¨é¡¹ç›®çš„ PROJECT è®¾ç½®ä¸­æ·»åŠ éœ€è¦æ”¯æŒçš„è¯­è¨€ï¼š æ¥ç€å¯ä»¥ï¼ˆå¯é€‰ï¼‰è°ƒæ•´ Scheme çš„æ¨¡æ‹Ÿå™¨è®¾ç½®ï¼Œå°†è¯­è¨€å’Œåœ°åŒºè®¾ç½®ä¸ºå¾…æµ‹è¯•çš„ç¯å¢ƒï¼š ä¾‹å¦‚å°†è¯­è¨€è®¾ç½®ä¸ºè‹±è¯­ã€åœ°åŒºä¸ºç¾å›½ã€‚æ­¤æ“ä½œä¾¿äºéªŒè¯ç¿»è¯‘æ•ˆæœï¼Œä½†åœ°åŒºè®¾ç½®é€šå¸¸ä¸ä¼šå½±å“æ–‡æ¡ˆå±•ç¤ºã€‚ String Catalog + CocoaPods åœ¨ä¸»é¡¹ç›®ä¸­ä½¿ç”¨ String Catalog å¯ä»¥ç®—ä½œåœ¨ CocoaPods ä¸­ä½¿ç”¨çš„ä¸€ä¸ªå­é›†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®²è§£å¦‚ä½•åœ¨ CocoaPods ä¸­ä½¿ç”¨ String Catalogã€‚ æ–°å»ºæ–‡ä»¶ é€šè¿‡ Command+N æ–°å»º String Catalog æ–‡ä»¶ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š æç¤ºï¼š æ–‡ä»¶é‡Œæ˜¾ç¤ºçš„è¯­è¨€ï¼Œæ˜¯æ ¹æ®æ‰€å± .xcodeproj è®¾ç½®é‡Œæ·»åŠ çš„è¯­è¨€è‡ªåŠ¨ç”Ÿæˆçš„ã€‚ Pods.xcodeproj é»˜è®¤åŒ…å«å¤šç§è¯­è¨€ï¼Œæ‰€ä»¥ Pods ä¸­çš„ .xcstrings æ–‡ä»¶æ‰ä¼šæ˜¾ç¤ºè¿™ä¹ˆå¤šçš„è¯­ç§ã€‚ ä½†è¿™ä¸ä¼šå½±å“æœ€ç»ˆçš„ Appã€‚é‰´äºæˆ‘ä»¬å¹³æ—¶åœ¨ä½¿ç”¨æ—¶ï¼Œä¸ä¼šå°† Pods.xcodeproj æäº¤åˆ° gitï¼ŒåŒæ—¶ App çš„å¤šè¯­è¨€è®¾ç½®ä¸å— Pods çš„å½±å“ï¼Œæ‰€ä»¥ä½œä¸ºå¼€å‘è€…ä½ å®Œå…¨å¯ä»¥æ— è§†è¿™ä¸€ç‚¹ï¼Œåªä» String Catalog æŒ‘é€‰ä½ å…³æ³¨çš„è¯­ç§å³å¯ã€‚ è¿™é‡Œæˆ‘æ–°å»ºäº†ä¸€ä¸ªæ–‡ä»¶ï¼Œå« HomeLocalizable.xcstringsï¼Œå¹¶åŠ äº†ä¸¤ä¸ªæ–‡æ¡ˆã€‚ ä¿®æ”¹ Podspec æ–‡ä»¶ æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ podspecï¼ŒæŠŠ .xcstrings æ–‡ä»¶åŠ åˆ°èµ„æºæ–‡ä»¶ä¸­ã€‚ è¯´åˆ°è¿™é‡Œï¼Œèªæ˜çš„ä½ è‚¯å®šå¯ä»¥ç›´æ¥çŒœåˆ°ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥ä»¿ç…§ .xcassets ç±»å‹çš„æ–‡ä»¶ï¼Œç›´æ¥å°† .xcstrings æ–‡ä»¶æ”¾åˆ° resource_bundle çš„è‡ªå®šä¹‰ Bundle ä¸­ã€‚æ²¡é”™ï¼Œç¡®å®æ˜¯è¿™æ ·ï¼š s.resource_bundle = { 'HomeBundle' =&gt; [ 'Sources/Resource/**/*.xcstrings', 'Sources/Resource/**/*.xcassets', ] } æ³¨æ„ï¼š å¦‚æœåªå°† .xcstrings æ”¾å…¥ Bundle ä¸­çš„è¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¯¦è§ Pod ä¸ String Catalog è‡ªåŠ¨åŒ– è¿™ä¸€å°èŠ‚ã€‚ ç„¶åæ‰§è¡Œ pod installï¼Œè¿™æ · .xcstrings æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åˆ° HomeBundle é‡Œäº†ã€‚ æ·»åŠ æ–°çš„æ–‡è¨€ é€‰æ‹©æˆ‘ä»¬çš„é»˜è®¤è¯­ç§ï¼Œç‚¹å‡»åŠ å·å³å¯æ·»åŠ æ–°çš„æ–‡è¨€ã€‚æ­¤ååŒæ ·çš„æ“ä½œåœ¨éœ€è¦ç¿»è¯‘çš„è¯­ç§ä¸­ï¼Œè®¾ç½®å¯¹åº”æ–‡è¨€çš„ç¿»è¯‘å†…å®¹å³å¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤è¯­ç§ä¸­æ–‡è¨€çš„çŠ¶æ€ï¼ˆStateï¼‰é»˜è®¤æ˜¯ä¸å±•ç¤ºï¼Œå³ Reviewed å·²å®¡æ ¸è¿‡çš„ï¼Œå’Œå…¶ä»–è¯­ç§ä¸­çš„ç»¿è‰²å¯¹å‹¾æ˜¯ä¸€æ ·çš„ã€‚è€Œå½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ–‡è¨€åï¼Œå…¶ä»–è¯­ç§ä¸­æ–‡è¨€çš„çŠ¶æ€åˆ™æ˜¯NEWã€‚ æˆ‘å®é™…æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬å‘ NEW çŠ¶æ€çš„æ–‡è¨€æ·»åŠ å¯¹åº”çš„ç¿»è¯‘ï¼Œæˆ–è€…ä¿®æ”¹äº† NEEDS REVIEW çŠ¶æ€çš„æ–‡è¨€æ‰€å¯¹åº”çš„ç¿»è¯‘åï¼Œè¯¥æ¡æ–‡è¨€çš„çŠ¶æ€å°†è‡ªåŠ¨å˜ä¸º Reviewedã€‚ å¦å¤–ï¼Œå°±ç®—æ–‡è¨€å¤„äº NEEDS REVIEW çŠ¶æ€ï¼Œåªè¦åŒ…å«äº†å¯¹åº”çš„ç¿»è¯‘ï¼Œé‚£ä¹ˆè¯¥ç¿»è¯‘ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸æ˜¾ç¤ºçš„ã€‚ä¸è¿‡ä»å­—é¢ä¸Šæ¥çœ‹è¿™ä¸€è¡Œä¸ºæœ‰äº›å±é™©ï¼Œç¨³å¦¥èµ·è§å»ºè®®å¼€å‘è€…ç¡®ä¿æ‰€æœ‰æ–‡è¨€æ— è¯¯åï¼Œå°†å…¶æ ‡è®°ä¸º Reviewed åå†ä½¿ç”¨ã€‚ å±•ç¤ºå›½é™…åŒ–æ–‡æœ¬ è¿™ä¸€èŠ‚æˆ‘ä»¬å°±è¦æåˆ° String(localized:) çš„é—®é¢˜äº†ã€‚ç½‘ä¸Šå¤§éƒ¨åˆ†ä»‹ç» String Catalog çš„æ–‡ç« éƒ½ä¼šä½¿ç”¨ String(localized: ) è¿™ä¸€ä¸ªæ–°çš„ apiï¼Œç„¶è€Œå½“æˆ‘å®é™…ä½¿æ—¶æ‰å‘ç°ï¼Œå®ƒä»…é™äº iOS 15 + çš„ç‰ˆæœ¬ã€‚é‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è€çš„ NSLocalizedString æ–¹æ³•ã€‚ let text = NSLocalizedString( &quot;æ‰«ç æˆ–é•¿æŒ‰å°ç¨‹åºç &quot;, tableName: &quot;HomeLocalizable&quot;, bundle: BundleToken.bundle, comment: &quot;&quot; ) private final class BundleToken { static let bundle: Bundle = { #if SWIFT_PACKAGE return Bundle.module #else guard let resourcePath = Bundle(for: BundleToken.self).resourcePath, let bundle = Bundle(path: resourcePath + &quot;/HomeBundle.bundle&quot;) // â¬…ï¸ Watch this. else { fatalError(&quot;Bundle not found, please make sure the Bundle name is correct!&quot;) } return bundle #endif }() } tableName æ˜¯ .xcstrings æ–‡ä»¶åï¼Œbundle æ˜¯åœ¨ podspec é‡Œå®šä¹‰çš„ HomeBundleã€‚ è¿™é‡Œçš„ BundleToken å‚è€ƒäº† SwiftGen çš„å®ç°ï¼Œåšäº†ä¸€äº›é€‚é… CocoaPods çš„æ”¹åŠ¨ï¼šå¢åŠ  HomeBundleã€‚ å¦‚æœä½ å¥½å¥‡ä¸ºä»€ä¹ˆä½¿ç”¨è€çš„ NSLocalizedString api ä¹Ÿå¯ä»¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆ build ç¼–è¯‘ä¸€ä¸‹é¡¹ç›®ï¼Œç„¶ååœ¨ Products ç›®å½•æ‰¾åˆ°ç¼–è¯‘å¥½äº†ä¹‹åçš„åº”ç”¨ï¼Œæœ€åæ‰¾åˆ° HomeBundle.bundleã€‚ æ­¤æ—¶ä½ å°±ä¼šå‘ç°ï¼Œ.xcstrings è™½ç„¶ä¸åƒæ˜¯ .bundle ä¸€æ ·æ˜¯ä¸€ä¸ª â€œåŒ…â€ï¼Œä½†æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼Œå®ƒä¼šè¢«ç¼–è¯‘ä¸ºå’Œ .xcstrings åŒåçš„ .strings æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾ç„¶å¯ä»¥ä½¿ç”¨ NSLocalizedString api æ¥è¯»å–ç›¸å…³è®¾ç½®ï¼Œè¿™ç‚¹åœ¨ WWDC çš„è§†é¢‘ä¸­ä¹Ÿæœ‰ç›¸å…³è¯´æ˜ï¼š SwiftGen æˆªæ­¢æ–‡ç« æ›´æ–°ï¼ˆ2025.1.14ï¼‰ï¼ŒSwiftGen æœ€æ–°ç‰ˆä¸º 6.6.3ï¼Œå°šæœªæ­£å¼æ”¯æŒ String Catalogã€‚ï¼ˆSwiftGen ç›®å‰å¥½åƒè¿›å…¥åœæ›´çš„çŠ¶æ€ï¼‰ ä¸è¿‡æœ‰ä¸€ä¸ªç›¸å…³çš„ prï¼šXcode 15 String catalog support #1124ã€‚ è¿™ä¸ª pr å¯¹ .xcstring æ–‡ä»¶è¿›è¡Œè§£æï¼Œè§£æåç”Ÿæˆçš„å†…å®¹å’Œè€ç‰ˆæœ¬ .string è§£æåç”Ÿæˆçš„å†…å®¹ç±»ä¼¼ã€‚ é¡ºå¸¦ä¸€æï¼Œè¿™ä¼¼ä¹ä¹Ÿå½±å“åˆ°äº† Tuist å¯¹äº String Catalog çš„æ”¯æŒã€‚ ä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨æˆ‘ fork çš„è¿™ä¸ªç‰ˆæœ¬ï¼š6.6.4-alpha.0ã€‚é€šè¿‡ mise å®‰è£…æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼ä¿®æ”¹ mise.toml æ–‡ä»¶ï¼š [tools] &quot;ubi:rakuyoMo/SwiftGen&quot; = { version = &quot;6.6.4-alpha.0&quot;, matching = &quot;swiftgen-6.6.4-alpha.0-macos.zip&quot;, exe = &quot;swiftgen&quot; } å¦‚æœä½ ä¸æƒ³åˆ†å‰è‡ªç¼–è¯‘ SwiftGen å¯ä»¥è€ƒè™‘å°è¯•ä¸€ä¸ªåä¸º xcstrings-tool çš„æ–°å·¥å…·ï¼ŒSwift å¼€å‘ï¼Œä¸æ”¯æŒ brewï¼Œä½†æ˜¯æ”¯æŒé€šè¿‡ mise å®‰è£… cli å•ç‹¬ä½¿ç”¨ï¼Œè¯¦è§æ–‡æ¡£ ä¸€äº›æ³¨æ„ å› ä¸ºè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡æ€»ç»“ i18n ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥ä¹Ÿé¡ºå¸¦è®°å½•ä¸€äº›é—®é¢˜æˆ–è€…æ³¨æ„äº‹é¡¹ã€‚å¯èƒ½æ¯”è¾ƒå¸¸è§ï¼Œæ¯”è¾ƒåŸºç¡€ã€‚ æ¢è¡Œç¬¦ å¦‚æœåœ¨ .xcstrings æ–‡ä»¶ä¸­ç›´æ¥è¾“å…¥ \\n ä»£è¡¨æ¢è¡Œï¼Œåœ¨å®é™…å±•ç¤ºæ—¶æ˜¯èµ·ä¸åˆ°æ¢è¡Œçš„æ•ˆæœï¼Œè€Œæ˜¯ä¼šå°† \\n å±•ç¤ºå‡ºæ¥ã€‚ä» json æ–‡ä»¶æˆ–Git ä¸­æŸ¥çœ‹ä¼šå‘ç°ï¼Œå®é™…å†…å®¹æ˜¯ \\\\nï¼Œå³è½¬ä¹‰è¿‡åçš„å†…å®¹ã€‚ æ­£ç¡®çš„æ–¹å¼æ˜¯ä½¿ç”¨ option + return ç»„åˆé”®åœ¨ .xcstrings æ–‡ä»¶ä¸­è¾“å…¥æ¢è¡Œã€‚æˆ–è€…ä¸å«Œéº»çƒ¦çš„è¯å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ json æ–‡ä»¶ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼ˆæ‰‹åŠ¨ç‹—å¤´ï¼‰ã€‚ nslocalizedstring_key SwiftLint ä¸­åŒ…å«ç€ä¸€æ¡åä¸º nslocalizedstring_key çš„è§„åˆ™ï¼Œæ–‡æ¡£åœ¨è¿™é‡Œã€‚ å®ƒå»ºè®®ä¸è¦åŠ¨æ€ä¼ å…¥ keyï¼Œæ¯”å¦‚è¿™æ ·æ˜¯ä¸æ¨èçš„ï¼š // ä¸æ¨è let key = &quot;example_key&quot; let text = NSLocalizedString(key, comment: &quot;&quot;) Pod ä¸ String Catalog è‡ªåŠ¨åŒ– åœ¨ Xcode 15 ä¸­ï¼Œå¦‚æœè®¾ç½®äº† Use Compiler to Extract Swift Strings ä¸º YESï¼Œé‚£ä¹ˆ String Catalog æ–‡ä»¶å°±å¯ä»¥è‡ªåŠ¨è¿½è¸ªå›½é™…åŒ–æ–‡æœ¬ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå­—ç¬¦ä¸²ï¼š let test = NSLocalizedString(&quot;Test&quot;, tableName: &quot;TestLocalizable&quot;, comment: &quot;Test&quot;) ç¼–è¯‘åä¼šæœ‰ä¸€ä¸ª â€œSyncing Localizationsâ€ çš„é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µè¿™ä¸ªå­—ç¬¦ä¸²ä¼šè¢«è‡ªåŠ¨è®°å½•åˆ° TestLocalizable.xcstrings æ–‡ä»¶ä¸­ã€‚ ä½†æ˜¯åœ¨ pod ç»„ä»¶åŒ–é¡¹ç›®ä¸­ï¼Œå¦‚æœè¯¥å­—ç¬¦ä¸²åœ¨æŸä¸ª pod å†…ï¼Œåˆ™è‡ªåŠ¨è¿½è¸ªä¸ä¼šç”Ÿæ•ˆã€‚åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š â€œSyncing Localizationsâ€ é˜¶æ®µä»…ä¼šæ‰«æå½“å‰ Scheme æ‰€åŒ…å«çš„ targetã€‚ä¸€èˆ¬æˆ‘ä»¬ç¼–è¯‘æ—¶éƒ½ä¼šé€‰æ‹©ä¸»é¡¹ç›®ï¼Œæ­¤æ—¶æ˜¯ä¸åŒ…å« pod target çš„ï¼Œæ‰€ä»¥ä¸ä¼šæ‰«æç›¸åº”çš„ä»£ç ã€‚ Pod çš„ Use Compiler to Extract Swift Strings è®¾ç½®é¡¹é»˜è®¤ä¸º NOï¼Œéœ€è¦åœ¨ Podfile ä¸­ä½¿ç”¨é’©å­æ‰‹åŠ¨å¼€å¯ï¼ˆKey ä¸º SWIFT_EMIT_LOC_STRINGSï¼‰ã€‚ å‰æ–‡ä¸­ï¼Œ.xcstrings è¢«æ·»åŠ åˆ° Bundle ä¸­ï¼Œè¿™æ„å‘³ç€å®ƒä¼šè¢«å½’å…¥ Bundle è¿™ä¸ª targetï¼Œæ¯”å¦‚ Pod åä¸º Homeï¼Œé‚£ä¹ˆ .xcstrings æ–‡ä»¶å°±åœ¨ Home-HomeBundle è¿™ä¸ª target ä¸­ã€‚è€Œé¡¹ç›®ä»£ç åˆ™åœ¨ Home è¿™ä¸ª target é‡Œã€‚æ­¤æ—¶ç¼–è¯‘ Homeï¼Œå› ä¸ºè¯¥ target å®é™…ä¸åŒ…å« .xcstringsï¼Œæ‰€ä»¥å­—ç¬¦ä¸²ä¹Ÿä¸ä¼šåŒæ­¥åˆ° .xcstrings æ–‡ä»¶ä¸­ã€‚ ç»¼ä¸Šï¼Œè€ƒè™‘åˆ° CocoaPods å·²ç»åœæ­¢å¢åŠ æ–°åŠŸèƒ½ï¼Œå»ºè®®è¿˜æ˜¯å°½å¿«è¿ç§»åˆ° SPMã€‚ ","link":"https://blog.rakuyo.dev/string-catalog/"},{"title":"HarmonyOS ä¸ ArkTS å¼€å‘æ³¨æ„äº‹é¡¹","content":"æœ¬æ–‡æŒç»­è®°å½•ä¸€äº›ä½¿ç”¨ ArkTS è¿›è¡Œ HarmonyOS å¼€å‘æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚ä»¥åŠä¸€äº›å¯èƒ½ç§°ä¸ä¸Šæ˜¯é—®é¢˜ï¼Œä½†æ˜¯åœ¨æˆ‘çœ‹æ¥æœ‰å¿…è¦è®°å½•ä¸€ä¸‹çš„ç‚¹ã€‚ æœ¬æ–‡çš„ä¸»è¦ç»“æ„å°†åˆ†ä¸º ArkTS å’Œ HarmonyOS ä¸¤éƒ¨åˆ†ã€‚åŒæ—¶å†…å®¹å¤šä¸ iOS å¼€å‘ä»¥åŠ Swift è¯­è¨€è¿›è¡Œå¯¹æ¯”ã€‚ å› ä¸ºä»£ç é«˜äº®é™åˆ¶ï¼Œæœ¬æ–‡ä¸­æ¶‰åŠåˆ° ArkTS çš„ä»£ç ï¼Œéƒ½å°†ä½¿ç”¨ TypeScript çš„è¯­æ³•é«˜äº®è®¾ç½® ArkTS ArkTS æ˜¯ TS çš„è¶…é›†ï¼ŒåŒæ—¶ä¹Ÿé˜‰å‰²äº†ä¸€äº› TS çš„ç”¨æ³•ã€‚ æœ¬èŠ‚æ‰€è®°å½•çš„å†…å®¹æ˜¯ä»ä¸€ä¸ª TS é›¶åŸºç¡€å°ç™½çš„è§†è§’å‡ºå‘æ‰€é‡åˆ°çš„é—®é¢˜ã€‚æ‰€ä»¥æŸäº›å†…å®¹æœªå¿…å±äº ArkTS å¼•å…¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ TS å°±å­˜åœ¨ã€‚æŸäº›å°èŠ‚å¯èƒ½ä¼šæŒ‡å‡ºè¯¥å°èŠ‚çš„å†…å®¹æ˜¯å±äº ArkTS ç‹¬æœ‰ï¼Œè¿˜æ˜¯ TS å°±æœ‰ã€‚ä½†æ˜¯å¤§å¤šæ•°å°èŠ‚å¯èƒ½å¹¶ä¸ä¼šåšæ­¤åŒºåˆ†ã€‚ async ä¸ await ArkTS çš„å¼‚æ­¥åç¨‹ä¸åƒæ˜¯ Swift é‚£æ ·ï¼Œéœ€è¦åœ¨æ–¹æ³•å£°æ˜ä¸Šæ˜¾å¼å¢åŠ  async å…³é”®å­—ã€‚ åªè¦æ–¹æ³•è¿”å› Promise ç±»å‹ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨æ—¶å€™å°±å¯ä»¥é€šè¿‡æ·»åŠ  await å…³é”®å­—ï¼Œæ¥è·å– Promise é‡Œæ‰€åŒ…å«çš„æ•°æ®ã€‚ æ¯”å¦‚ä¸‹é¢çš„æ–¹æ³•ï¼š function getData(): Promise&lt;string&gt; { return new Promise((resolve, reject) =&gt; { setTimeout(() =&gt; { resolve(&quot;Data fetched!&quot;); }, 1000); }); } function main() { const result = await getData(); // å¯ä»¥ä½¿ç”¨ await console.log(result); // è¾“å‡º: &quot;Data fetched!&quot; } è¿™å…¶å®æ˜¯ TS çš„è¯­æ³•ã€‚å½“ä½ åœ¨ TypeScript ä¸­å£°æ˜ä¸€ä¸ªå‡½æ•°ä¸º async æ—¶ï¼Œè¯¥å‡½æ•°ä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ç»“æœã€‚å³ä½¿å‡½æ•°å†…éƒ¨æ²¡æœ‰æ˜¾å¼åœ°è¿”å› Promiseï¼Œasync å‡½æ•°ä¼šå°†å…¶ç»“æœå°è£…åœ¨ä¸€ä¸ª Promise ä¸­ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š async function myAsyncFunction() { return &quot;Hello, Async!&quot;; } // è°ƒç”¨æ–¹å¼ myAsyncFunction().then(result =&gt; console.log(result)); // è¾“å‡º: &quot;Hello, Async!&quot; myAsyncFunction å› ä¸ºè¢« async ä¿®é¥°ï¼Œæ‰€ä»¥è‡ªåŠ¨è¿”å›äº†ä¸€ä¸ª Promise&lt;string&gt; è€Œä¸æ˜¯å•çº¯çš„ stringã€‚ æ‰€ä»¥å¦‚æœæ–¹æ³•æ²¡æœ‰æ ‡è®° asyncï¼Œä½†æ˜¯è¿”å›äº† Promiseï¼Œå…¶å®å’Œæ ‡è®°äº†ä½†æ˜¯çœç•¥è¿”å›ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥åœ¨è°ƒæ—¶ç›´æ¥ä½¿ç”¨ await åŒæ­¥è·å–å†…å®¹äº†ã€‚ HarmonyOS ç¯å¢ƒå˜é‡é…ç½® è¿™é‡Œè¯´çš„ç¯å¢ƒå˜é‡æ˜¯ â€œæ­£å¼ç¯å¢ƒâ€ã€â€œé¢„ä¸Šçº¿ç¯å¢ƒâ€ ä»¥åŠ â€œæµ‹è¯•ç¯å¢ƒâ€ã€‚åŒ…å«æ¥å£ç¯å¢ƒé…ç½®ä»¥åŠä¸€äº› debug å…¥å£ç­‰ç­‰ã€‚ åœ¨ iOS å¼€å‘ä¸­æˆ‘ä»¬æœ‰é¢„ç¼–è¯‘å®ï¼Œä½†æ˜¯ HarmonyOS è¿™å—å„¿æ²¡æœ‰è¿™ä¸ªã€‚HarmonyOS çš„æ–¹æ³•æ˜¯åœ¨å„ä¸ªå­æ¨¡å—ä¸­å»ºç«‹ target çš„ sourceRoots å­—æ®µï¼Œå°†ä¸åŒç¯å¢ƒçš„ä»£ç æ·»åŠ åˆ°ä¸åŒçš„ target ä¸­ï¼Œç„¶å entry å†å¼•ç”¨ä¸åŒçš„ targetï¼Œä»¥æ­¤æ¥è¾¾åˆ°ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒä»£ç çš„éœ€æ±‚ã€‚ æœ¬èŠ‚ä¸è¯¦ç»†å±•å¼€å…·ä½“çš„è¯¦ç»†å†…å®¹ï¼Œè¯¦ç»†å†…å®¹è§å®˜æ–¹æ–‡æ¡£ã€‚ åœ¨åšè¿™ä¸€é¡¹é…ç½®çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¦‚å¿µå¾ˆå®¹æ˜“æé”™ï¼Œæˆ–è€…è¯´å®˜æ–¹æ–‡æ¡£çš„è®²è§£æµç¨‹å’Œå®é™…ä¸Šé…ç½®çš„æµç¨‹æœ‰ä¸€å®šçš„å‡ºå…¥ã€‚ï¼ˆå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯æˆ‘ä¸ªäººèƒ½åŠ›ä¸è¶³å¯¼è‡´ç†è§£é”™è¯¯ï¼‰ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹é¢å‡ ä¸ª build-profile.json5 æ–‡ä»¶ã€‚é¦–å…ˆæ˜¯ä¸€ä¸ª feature module çš„ï¼š // feature/build-profile.json5 { &quot;apiType&quot;: &quot;stageMode&quot;, &quot;buildOption&quot;: {}, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;source&quot;: { &quot;sourceRoots&quot;: [&quot;./src/default&quot;] // é…ç½®targetä¸ºdefaultçš„å·®å¼‚åŒ–ä»£ç ç©ºé—´ } }, { &quot;name&quot;: &quot;custom&quot;, &quot;source&quot;: { &quot;sourceRoots&quot;: [&quot;./src/custom&quot;] // é…ç½®targetä¸ºcustomçš„å·®å¼‚åŒ–ä»£ç ç©ºé—´ } } ] } å…¶åŒ…å«ä¸¤ä¸ª targetï¼Œä½¿ç”¨ sourceRoots å¼•ç”¨äº†ä¸åŒçš„ä»£ç ã€‚ ç„¶åå†çœ‹ entry çš„ï¼š { &quot;apiType&quot;: &quot;stageMode&quot;, &quot;buildOption&quot;: {}, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, }, ] } entry åªåŒ…å«ä¸€ä¸ª default targetã€‚ æœ€åçœ‹å·¥ç¨‹çš„ï¼š { &quot;app&quot;: { &quot;signingConfigs&quot;: [], &quot;products&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, }, { &quot;name&quot;: &quot;custom&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, } ], &quot;buildModeSet&quot;: [ { &quot;name&quot;: &quot;debug&quot;, }, { &quot;name&quot;: &quot;release&quot; } ] }, &quot;modules&quot;: [ { &quot;name&quot;: &quot;entry&quot;, &quot;srcPath&quot;: &quot;./entry&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot;, &quot;custom&quot;, ] }, ] }, { &quot;name&quot;: &quot;feature&quot;, &quot;srcPath&quot;: &quot;./feature&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot; ] }, { &quot;name&quot;: &quot;custom&quot;, &quot;applyToProducts&quot;: [ &quot;custom&quot; ] }, ] }, ] } åœ¨é˜…è¯»å®˜æ–¹æ–‡æ¡£åï¼Œæˆ‘é¦–å…ˆçš„æƒ³æ³•å°±æ˜¯ä¸Šé¢è¿™ä¸‰ä¸ªé…ç½®æ–‡ä»¶ã€‚å®šä¹‰ default å’Œ custom ä¸¤ä¸ª productï¼Œç„¶å entry ä½œä¸ºå…¥å£ï¼Œæ·»åŠ åˆ°ä¸¤ä¸ª product ä¸­ã€‚feature/default æ·»åŠ åˆ° defaultï¼›feature/custom æ·»åŠ åˆ° customã€‚è¿™æ · default product åŒ…å« entry å’Œ feature/defaultï¼Œcustom product åŒ…å« entry å’Œ feature/customã€‚æ€è·¯çœ‹ç€æ²¡é—®é¢˜å¯¹å§ï¼Œç„¶è€Œå®é™…è¿è¡Œèµ·æ¥ä¼šå‘ç°é…ç½®ä¸ç”Ÿæ•ˆï¼šcustom product ä½¿ç”¨çš„æ˜¯ feature/defaultã€‚ é—®é¢˜åœ¨äºæ€è·¯ä¸å¯¹ï¼Œæ­£ç¡®çš„æ€è·¯åº”è¯¥æ˜¯ï¼šå°† entry ä¸­å®šä¹‰çš„ targetï¼Œä¸‹æ”¾ç»™å„ä¸ª module ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´è¦å…ˆåœ¨ entry ä¸­å®šä¹‰å„ä¸ª targetï¼Œç„¶åå†åœ¨å„ä¸ª module ä¸­ä½¿ç”¨ entry å®šä¹‰çš„ targetï¼Œè‡ªå®šå‘ä¸‹ä½¿ç”¨ã€‚ æ¯”å¦‚æœ‰5ä¸ªå­ moduleï¼Œå„è‡ªéƒ½æœ‰ä¸åŒçš„ target éœ€æ±‚ï¼Œåˆ†åˆ«æ˜¯ 1-5ï¼Œé‚£ä¹ˆ entry ä¸­å°±åº”è¯¥å®šä¹‰è¿™ 1-5ä¸ª targetï¼Œç„¶å5ä¸ªå­ module ä»ä¸­é€‰å–è‡ªå·±éœ€è¦çš„é‚£ä¸€ä¸ªã€‚ æ‰€ä»¥ä¸Šè¿°ä¾‹å­ä¸­çš„é…ç½®æ–‡ä»¶åº”è¯¥æ”¹æˆä¸‹é¢è¿™æ ·ï¼Œå…ˆçœ‹ entry çš„ build-profile.json5ï¼š { &quot;apiType&quot;: &quot;stageMode&quot;, &quot;buildOption&quot;: {}, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, }, { &quot;name&quot;: &quot;custom&quot;, // å¢åŠ  custom target }, ] } ç„¶åä¿®æ”¹å·¥ç¨‹çº§ build-profile.json5ï¼š { &quot;app&quot;: { &quot;signingConfigs&quot;: [], &quot;products&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, }, { &quot;name&quot;: &quot;custom&quot;, &quot;signingConfig&quot;: &quot;default&quot;, &quot;compatibleSdkVersion&quot;: &quot;5.0.0(12)&quot;, &quot;runtimeOS&quot;: &quot;HarmonyOS&quot;, } ], &quot;buildModeSet&quot;: [ { &quot;name&quot;: &quot;debug&quot;, }, { &quot;name&quot;: &quot;release&quot; } ] }, &quot;modules&quot;: [ { &quot;name&quot;: &quot;entry&quot;, &quot;srcPath&quot;: &quot;./entry&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot;, ] }, { &quot;name&quot;: &quot;custom&quot;, &quot;applyToProducts&quot;: [ &quot;custom&quot;, ] }, ] }, { &quot;name&quot;: &quot;feature&quot;, &quot;srcPath&quot;: &quot;./feature&quot;, &quot;targets&quot;: [ { &quot;name&quot;: &quot;default&quot;, &quot;applyToProducts&quot;: [ &quot;default&quot; ] }, { &quot;name&quot;: &quot;custom&quot;, &quot;applyToProducts&quot;: [ &quot;custom&quot; ] }, ] }, ] } è¿™ä¹ˆä¿®æ”¹åå†è¿è¡Œï¼Œcustom product å°±å¯ä»¥æ­£ç¡®åœ°è¯»å–åˆ° feature/custom äº†ã€‚ æœ€åå†æ¥è¯´ä¸€è¯´å®˜æ–¹ä¸­çš„ä¾‹å­ã€‚å®˜æ–¹ä¸Šçš„ç¤ºä¾‹ä½¿ç”¨ entry æ¼”ç¤º sourceRoots çš„ç”¨æ³•ï¼Œå…¶å®æš—è—äº† â€œentry ä¹Ÿéœ€è¦å®šä¹‰å¯¹åº”çš„ targetâ€ è¿™ä¸€ç‚¹ï¼Œåªä¸è¿‡æ²¡æœ‰æ˜è¯´ï¼Œè®©è¯»è€…å¿½ç•¥äº†è¿™ä¸€å…³é”®å†…å®¹ã€‚ ","link":"https://blog.rakuyo.dev/notes-on-harmonyos-and-arkts-development/"},{"title":"Gitlab-CI ä¸ Shell ä¼šè¯æ¨¡å¼","content":"ä¹‹å‰çš„æ–‡ç« ä¸­ä»‹ç»è¿‡ï¼ŒiOS å¸¸ç”¨çš„ Gitlab-CI æ‰§è¡Œå™¨æ˜¯ shellï¼Œå› ä¸ºæ‰“åŒ…æ—¶åªèƒ½ä½¿ç”¨è¿™ä¸ªã€‚ ä»Šå¤©å°†åŒ…ç®¡ç†å·¥å…·è¿åˆ° mise æ—¶é‡åˆ°äº†ä¸€äº›å’Œ shell æœ‰å…³çš„é—®é¢˜ï¼Œæ¶‰åŠåˆ°ä¸€äº›ä¹‹å‰çš„çŸ¥è¯†ç›²åŒºï¼Œé‚è®°å½•ä¸€ä¸‹ã€‚ æœ¬æ–‡çš„å†…å®¹å’Œ mise æ— å…³ï¼Œåªæ˜¯å·¥å…·è¿ç§»æ—¶å¼•å‡ºäº†æœ¬æ–‡æ¶‰åŠåˆ°çš„é—®é¢˜å’ŒçŸ¥è¯†ç›²åŒºã€‚å¯¹å·¥å…·æ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥ç‚¹å‡»ä¸Šé¢çš„é“¾æ¥æŸ¥çœ‹ç›¸å…³å†…å®¹ã€‚ Shell ä¼šè¯æ¨¡å¼ å…ˆä»‹ç»ä¸€ä¸‹ Shell çš„å‡ ç§ä¼šè¯æ¨¡å¼ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ macOS çš„ é»˜è®¤ç»ˆç«¯ç¯å¢ƒæ˜¯ zshï¼Œzsh æœ‰å¤šä¸ªé…å¥—çš„æ–‡ä»¶ï¼ŒåŒ…å« ~/.zshrcã€.zprofile ç­‰ã€‚å¦ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„æ˜¯ bashï¼Œå¯ä½¿ç”¨çš„é…ç½®æ–‡ä»¶æœ‰ ~/.bash_profile ã€~/.bashrc ç­‰ã€‚ ä¹‹å‰æˆ‘åªæ¨¡ç³Šçš„çŸ¥é“æœ‰è¿™äº›æ–‡ä»¶ï¼Œå¯ä»¥åœ¨å…¶ä¸­å†™å…¥ä¸€äº›å†…å®¹ï¼Œç„¶åå¯åŠ¨ç»ˆç«¯åå°±ä¼šè‡ªåŠ¨åŠ è½½è¿™äº›æ–‡ä»¶ï¼Œå´ä»æ¥æ²¡æœ‰å…³æ³¨è¿‡ ä»€ä¹ˆæ—¶å€™ä¼šåŠ è½½å“ªä¸ªæ–‡ä»¶ã€‚è¿™å°±æ¶‰åŠåˆ° â€œShell ä¼šè¯æ¨¡å¼â€ è¿™ä¸ªæ¦‚å¿µã€‚ â€œShell ä¼šè¯æ¨¡å¼â€æ˜¯æŒ‡ç”¨æˆ·å¯åŠ¨ä¼šè¯æ—¶ shellï¼ˆä¾‹å¦‚ bashã€zsh æˆ–å…¶ä»–å‘½ä»¤è¡Œè§£é‡Šå™¨ï¼‰å¯ä»¥è¿è¡Œçš„ä¸åŒæ–¹å¼ã€‚æ¯ç§æ¨¡å¼éƒ½è§„å®šäº† shell çš„è¡Œä¸ºæ–¹å¼ã€åŠ è½½çš„åˆå§‹åŒ–æ–‡ä»¶ä»¥åŠå¤„ç†å‘½ä»¤çš„æ–¹å¼ã€‚ æ­¤ä¼šè¯æ¨¡å¼ä¸»è¦å›´ç»•ä¸¤ä¸ªæ¦‚å¿µï¼šâ€œæ˜¯å¦æ˜¯äº¤äº’å¼â€ ä»¥åŠ â€œæ˜¯å¦ç™»å½•â€ã€‚è¿™ä¸¤ç§æ¦‚å¿µä¸¤ä¸¤ç»„åˆï¼Œè¯ç”Ÿå››ç§ä¼šè¯æ¨¡å¼ã€‚ æ˜¯å¦æ˜¯äº¤äº’å¼ï¼šæŒ‡å®šç”¨æˆ·æ˜¯å¦å¯ä»¥é€šè¿‡é”®å…¥å‘½ä»¤ç›´æ¥ä¸ shell äº¤äº’ã€‚shell ä¼šç­‰å¾…ç”¨æˆ·è¾“å…¥å¹¶æ ¹æ®è¾“å…¥çš„å‘½ä»¤æä¾›è¾“å‡ºã€‚ æ˜¯å¦ç™»å½•ï¼šæŒ‡å¼€å¯ä¼šè¯æ—¶ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚ ä¸¾å‡ ä¸ªä¾‹å­ï¼š äº¤äº’å¼ï¼šæ‰“å¼€ macOS ä¸­çš„ç»ˆç«¯ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢è¾“å…¥å‘½ä»¤ï¼Œä¸ shell äº¤äº’ã€‚ éäº¤äº’å¼ï¼šGitlab-CI æ‰§è¡Œ script æ—¶ï¼Œå°±æ˜¯éäº¤äº’å¼ã€‚æˆ‘ä»¬çŸ¥é“æ‰§è¡Œè¿‡ç¨‹ä¸­æˆ‘ä»¬æ²¡æœ‰åŠæ³•åšä»»ä½•äº‹ï¼ŒåŒ…æ‹¬è¾“å…¥è®¾å¤‡å¯†ç ï¼Œsay yes ç­‰ã€‚ ç™»å½•ï¼šé€šè¿‡ ssh è¿æ¥æœåŠ¡å™¨ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬è¾“å…¥ç”¨æˆ·åå¯†ç ã€‚åˆæˆ–è€…æ‰§è¡Œå‘½ä»¤æ—¶æºå¸¦äº† | /bin/bash --login å‚æ•°ã€‚ éç™»å½•ï¼šæ‰“å¼€ macOS çš„ç»ˆç«¯ï¼Œé»˜è®¤æ˜¯éç™»å½•çš„ã€‚åˆæˆ–è€…ä»ä¸€ä¸ªå·²ç»ç™»å½•äº†çš„ç»ˆç«¯ä¸­ï¼Œä½¿ç”¨ bash æˆ–å…¶ä»–å‘½ä»¤å¼€å¯äº†æ–°çš„ç»ˆç«¯çª—å£ï¼Œè¿™äº›ä¹Ÿæ˜¯éç™»å½•å¼çš„ã€‚ é‚£ä¹ˆåœ¨ä¸åŒçš„ç™»å½•æ¨¡å¼ä¸‹ï¼Œshell ä¼šåŠ è½½çš„é…ç½®æ–‡ä»¶å…¶å®æ˜¯ä¸åŒçš„ï¼š ä¼šè¯ç±»å‹ .bash_profile .bashrc .zprofile .zshrc äº¤äº’å¼ç™»å½• âœ… âŒ âœ… âŒ äº¤äº’å¼éç™»å½• âŒ âœ… âŒ âœ… éäº¤äº’å¼ç™»å½• âœ… âŒ âŒ âŒ éäº¤äº’å¼éç™»å½• âŒ âŒ âŒ âŒ å¦‚æœä½¿ç”¨ bashï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªå¯èƒ½ä¼šä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼š~/.profileã€‚å®ƒçš„ä½œç”¨å’Œ ~/.bash_profile ç±»ä¼¼ï¼Œä»…å½“ .bash_profile ä¸å­˜åœ¨æ—¶ï¼Œä¼šå°è¯•åŠ è½½ .profileã€‚å¦å¤–ï¼Œæœ‰çš„æ—¶å€™ .bash_profile ä¸­ä¼šæœ‰å‘½ä»¤ï¼ŒåŒæ—¶åŠ è½½ .profileã€‚ è€Œ zsh é»˜è®¤æ˜¯ä¸ä¼šå°è¯•åŠ è½½ .profile çš„ã€‚ Gitlab-CI çš„ script Gitlab-CI çš„æ–‡æ¡£æœ‰åˆ—ä¸¾å‡ºå®ƒæ‰€æ”¯æŒçš„ shell ç§ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹é»˜è®¤çš„ bashã€‚ è´´ä¸€ä¸‹æ–‡æ¡£ä¸­å…³äºå¦‚ä½•æ‰§è¡Œ script çš„ç¤ºä¾‹ # This command is used if the build should be executed in context of another user (the shell executor) cat generated-bash-script | su --shell /bin/bash --login user # This command is used if the build should be executed using the current user, but in a login environment cat generated-bash-script | /bin/bash --login # This command is used if the build should be executed in a Docker environment cat generated-bash-script | /bin/bash ä»æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºå“ªç§æ–¹å¼ï¼ŒGitlab-CI éƒ½æ˜¯ä½¿ç”¨ /bin/bash ç¯å¢ƒæ‰§è¡Œçš„ script ä¸­å®šä¹‰çš„è„šæœ¬ï¼Œå¹¶ä¸”åœ¨é Docker ç¯å¢ƒä¸‹ï¼Œä¼šæºå¸¦ --login å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´æ­¤æ—¶ä½¿ç”¨çš„æ˜¯ â€œéäº¤äº’å¼ç™»å½• Shellâ€ï¼Œå›çœ‹ä¸Šé¢çš„è¡¨æ ¼ï¼Œ.bash_profile æ–‡ä»¶ä¼šè¢«åŠ è½½ã€‚ æ­¤æ—¶å°±éœ€è¦æ³¨æ„äº†ï¼Œå› ä¸º macOS é»˜è®¤çš„ç»ˆç«¯æ˜¯ zshï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¼–å†™è„šæœ¬çš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½ä¼šä¹ æƒ¯æ€§åœ°å°†é…ç½®å†™å…¥åˆ° .zprofile æˆ–è€… .zshrc æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å›åˆ° Gitlab-CI ä¸­å°±ä¼šå‘ç°ä¸ç”Ÿæ•ˆï¼ŒåŸå› å°±æ˜¯è„šæœ¬çš„æ‰§è¡Œç¯å¢ƒä¸åŒã€‚ ","link":"https://blog.rakuyo.dev/gitlab-ci-and-shell-session-mode/"},{"title":"ä»æºç çœ‹å¦‚ä½•åˆ·æ–° Epoxy åˆ—è¡¨","content":"å¦‚ä½•æ­£ç¡®çš„åˆ·æ–° Epoxy åˆ—è¡¨å¯ä»¥è¯´æ˜¯ç†Ÿç»ƒä½¿ç”¨è¿™ä¸ªæ¡†æ¶çš„å…³é”®ï¼Œåˆä¸Šæ‰‹æ—¶æ€»ä¼šæœ‰ â€œä¸ºä»€ä¹ˆåˆ—è¡¨åˆ·æ–°åæ•°æ®æ²¡å˜â€ å’Œ â€œä¸ºä»€ä¹ˆå®ƒåˆ·æ–°åæ•°æ®å°±å˜äº†â€ çš„ç–‘æƒ‘ã€‚ æœ¬æ–‡ä»æºç åˆ†æçš„è§’åº¦ï¼Œå¸¦å¤§å®¶æ¥æ¢³ç† Epoxy åˆ—è¡¨åˆ·æ–°çš„åŸç†ï¼Œå¹¶å­¦ä¼šå¦‚ä½•æ­£ç¡®åˆ·æ–° Epoxy åˆ—è¡¨ã€‚ Epoxy åˆ—è¡¨æœ¬è´¨ä¸Šè¿˜æ˜¯ UICollectionViewï¼Œåªä¸è¿‡å®ç°äº† diff ç®—æ³•ï¼Œå°è£…äº† reuse id çš„åˆ›å»ºã€‚ å¯¹äºä¸€ä¸ªå¸¸è§çš„ UICollectionViewCell æˆ– UITableViewCellï¼Œæˆ‘çš„ä¹ æƒ¯æ˜¯ï¼š Cell åˆå§‹åŒ–æ—¶åˆ›å»º subviewsï¼Œæ·»åŠ åˆ° contentView ä¸Šï¼Œå¹¶è®¾ç½®å¸ƒå±€ã€‚ å¯¹å¤–æš´éœ² config() æ–¹æ³•ï¼Œæˆ–ç›´æ¥æš´éœ² subviews åœ¨ collectionView(_: cellForItemAt:) æ–¹æ³•ä¸­å°†æ•°æ®è®¾ç½®åˆ° subviews ä¸Šã€‚ å¦‚æœæƒ³è¦åˆ—è¡¨ä¸Š Cell ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ— å¤–ä¹ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š åˆ›å»ºä¸åŒçš„ Cellã€‚ä¸åŒçš„æ•°æ®å¯¹åº”ä¸åŒçš„ Cellï¼ŒæŠ›å¼ƒæˆ–éƒ¨åˆ†æŠ›å¼ƒé‡ç”¨æœºåˆ¶ã€‚ åœ¨ Cell åˆ›å»ºæˆ–å¤ç”¨åï¼Œé‡æ–°è®¾ç½® subviews ä¸Šçš„æ•°æ®ã€‚è¿™åŒ…æ‹¬ä¸¤ç§æ–¹æ³•ï¼š collectionView(_: cellForItemAt:) æ–¹æ³•ä¸­è°ƒç”¨ config()ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ subviewsã€‚ ä½¿ç”¨å“åº”å¼æ¡†æ¶ï¼Œæ¯”å¦‚ Combineï¼Œå°†æ•°æ®ç»‘å®šåˆ° Cell çš„ subviews ä¸Šã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»è¿™å‡ ç§æ–¹æ³•ä¸Šå…¥æ‰‹ï¼Œçœ‹çœ‹å¦‚ä½•æ­£ç¡®åˆ·æ–° Epoxy åˆ—è¡¨ã€‚ Cell åˆ›å»ºæµç¨‹ é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ Epoxy æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ª Cellã€‚åœ¨ä½¿ç”¨æ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼åˆ›å»ºè¿‡ reuse idï¼ŒEpoxy æ¡†æ¶æ˜¯å¦‚ä½•åˆ›å»ºå®ƒçš„ï¼Ÿ æºç åˆ†æ åœ¨ CollectionView/Internal/CollectionViewDataSource.swift ä¸­ï¼Œå…³äº Cell çš„åˆ›å»ºå¦‚ä¸‹æ‰€ç¤ºï¼š func collectionView( _ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell { guard let item = data?.item(at: indexPath), let section = data?.section(at: indexPath.section), let reuseID = reuseIDStore.registeredReuseID(for: item.viewDifferentiator) else { // The `item(â€¦)` or `registeredReuseID(â€¦)` methods will assert in this scenario. return UICollectionViewCell() } let cell = collectionView.dequeueReusableCell(withReuseIdentifier: reuseID, for: indexPath) if let cell = cell as? CollectionViewCell { self.collectionView?.configure( cell: cell, with: item, at: .init(itemDataID: item.dataID, section: .dataID(section.dataID)), animated: false) } else { EpoxyLogger.shared.assertionFailure( &quot;Only CollectionViewCell and subclasses are allowed in a CollectionView.&quot;) } return cell } é¦–å…ˆå…³æ³¨åˆ›å»º Cell æ—¶ä½¿ç”¨çš„æ ‡è¯†ç¬¦ï¼Œå³ reuseID è¿™ä¸ªå˜é‡æ˜¯ä»ä½•è€Œæ¥çš„ã€‚ let reuseID = reuseIDStore.registeredReuseID(for: item.viewDifferentiator) è¿™é‡ŒåŒ…å«ä¸¤ä¸ªéœ€è¦æ˜ç™½çš„å†…å®¹ï¼Œåˆ†åˆ«æ˜¯ reuseIDStore å’Œ viewDifferentiatorã€‚ ä»åå¾€å‰çœ‹ï¼ŒviewDifferentiator å®šä¹‰åœ¨ ViewDifferentiatorProviding åè®®é‡Œï¼Œå®ƒçš„ç±»å‹ ViewDifferentiator æ˜¯ä¸€ä¸ªéµå¾ª Hashable çš„ç»“æ„ä½“ï¼š // MARK: - ViewDifferentiatorProviding public protocol ViewDifferentiatorProviding { var viewDifferentiator: ViewDifferentiator { get } } // MARK: - ViewDifferentiator public struct ViewDifferentiator: Hashable { public init(viewType: AnyClass, styleID: AnyHashable?) { viewTypeDescription = &quot;\\(type(of: viewType.self))&quot; self.styleID = styleID } public var viewTypeDescription: String public var styleID: AnyHashable? } ä»æºç æ³¨é‡Šä¸Šå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸¤ä¸ªç±»å‹å°±æ˜¯æœåŠ¡äº reuseID åˆ›å»ºçš„ã€‚ItemModel æ˜¯è¿™ä¹ˆå®ç° ViewDifferentiatorProviding åè®®çš„ï¼š extension ItemModel { public var viewDifferentiator: ViewDifferentiator { .init(viewType: View.self, styleID: styleID) } ... } è¿™é‡Œçš„ View æ˜¯ä¸€ä¸ªèŒƒå‹ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå®ç°äº† EpoxyableView çš„ UIView å¯¹è±¡ã€‚styleID å®šä¹‰åœ¨ StyleIDProviding åè®®ä¸­ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•å‡ºæ¥çš„å­˜å‚¨å±æ€§ï¼Œå…¶ç±»å‹æ˜¯ AnyHashableï¼Œè¿™é‡Œå°±çœç•¥å±•ç¤ºå®ƒçš„å®šä¹‰äº†ã€‚ é‚£ä¹ˆä½¿ç”¨æ—¶å®ƒçš„å€¼æ˜¯å“ªå„¿æ¥çš„å‘¢ï¼Ÿ public struct ItemModel&lt;View: UIView&gt;: ViewEpoxyModeled { ... public init&lt;Params: Hashable, Content: Equatable&gt;( dataID: AnyHashable, params: Params, content: Content, makeView: @escaping (Params) -&gt; View, setContent: @escaping (CallbackContext, Content) -&gt; Void) { self.dataID = dataID styleID = params // â¬…ï¸ åœ¨è¿™é‡Œè¿›è¡Œèµ‹å€¼ erasedContent = content self.makeView = { makeView(params) } self.setContent = { setContent($0, content) } isErasedContentEqual = { otherModel in guard let otherContent = otherModel.erasedContent as? Content else { return false } return otherContent == content } } ... } ä¸Šé¢è¿™ä¸ªæ˜¯ ItemModel çš„åˆå§‹ã€åŸºæœ¬åˆå§‹åŒ–æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨åˆå§‹åŒ–æ—¶ï¼Œæ˜¯ä½¿ç”¨ params è¿™ä¸ªå‚æ•°åˆå§‹åŒ– styleID å±æ€§çš„ã€‚ä½†æ˜¯åŸºæœ¬ä¸Šæˆ‘ä»¬éƒ½å¾ˆå°‘ä½¿ç”¨è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸‹é¢è¿™ä¸ªï¼š extension StyledView where Self: BehaviorsConfigurableView &amp; ContentConfigurableView { public static func itemModel( dataID: AnyHashable, content: Content, behaviors: Behaviors? = nil, style: Style) -&gt; ItemModel&lt;Self&gt; { ItemModel&lt;Self&gt;( dataID: dataID, params: style, // â¬…ï¸ å‘ç° params çš„æ¥æº content: content, makeView: Self.init(style:), setContent: { context, content in context.view.setContent(content, animated: context.animated) }) .setBehaviors { context in context.view.setBehaviors(behaviors) } } } çœ‹åˆ°è¿™é‡Œå°±æ˜ç™½äº†ï¼šè¿™ä¸ª styleID å°±æ˜¯åˆ›å»º EpoxyableView æ—¶å®šä¹‰çš„ Styleã€‚æ‰€ä»¥ viewDifferentiator ä»£è¡¨çš„å°±æ˜¯éµå¾ª EpoxyableView åè®®çš„è¿™ä¸ªç±»å‹æœ¬èº«ä»¥åŠå®ƒæ‰€åŒ…å«çš„ Style å¯¹è±¡ã€‚å½“åŒä¸€ä¸ª View ä½†æ˜¯ Style ä¸åŒæ—¶ï¼ŒviewDifferentiator ä¹Ÿå°±ä¸åŒã€‚ çœ‹å®Œäº† viewDifferentiatorï¼Œè®©æˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹ reuseIDStoreã€‚ å®ƒçš„ç±»å‹æ˜¯ä¸€ä¸ªç±» ReuseIDStoreï¼Œä»å‘½åä¸Šå¯ä»¥çœ‹å‡ºè¿™ä¸ªç±»æ˜¯ä¸“é—¨ç”¨æ¥å­˜å‚¨ reuse id çš„ã€‚é€šè¿‡æºç å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç±»å†…éƒ¨ä½¿ç”¨ä¸¤ä¸ª Dictionary æ¥å°è£… reuse id çš„åˆ›å»ºã€å­˜å‚¨ä»¥åŠè¯»å–é€»è¾‘ã€‚ å¯¹å¤–ä¸»è¦æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼šreuseID(byRegistering:) å’Œ registeredReuseID(for:)ï¼Œå‚æ•°éƒ½æ˜¯ ViewDifferentiatorã€‚å‰è€…ç”¨äºå­˜å‚¨ reuse idï¼Œåè€…è´Ÿè´£æŸ¥è¯¢è¯»å–ã€‚ å†…éƒ¨åŒ…å«ä»¥ä¸‹ä¸¤ä¸ª Dictionary: private var uniqueViewDifferentiatorCountsForViewTypes = [String: Int]() private var reuseIDsForViewDifferentiators = [ViewDifferentiator: String]() uniqueViewDifferentiatorCountsForViewTypes è´Ÿè´£è®¡æ•°ï¼Œå³ä¸€ä¸ª CollectionView æ³¨å†Œäº†å‡ æ¬¡è¿™ä¸ª Viewï¼ˆCellï¼‰ã€‚ é€šè¿‡è¿½è¸ªè°ƒç”¨æ ˆï¼Œå¯ä»¥å‘ç°æ¯æ¬¡è°ƒç”¨ setSections(_: strategy:) æ–¹æ³•æ—¶ï¼Œå¦‚æœå­˜åœ¨æ–°çš„ ViewDifferentiatorï¼Œå°±ä¼šè°ƒç”¨ reuseID(byRegistering:) è¿›è¡Œæ³¨å†Œã€‚ è¿™é‡Œæˆ‘ä»¬ç»“åˆæ³¨å†Œæ–¹æ³• reuseID(byRegistering:) çš„å®ç°æ¥ä¸€èµ·çœ‹ï¼š public func reuseID(byRegistering viewDifferentiator: ViewDifferentiator) -&gt; String { if let existingReuseID = reuseIDsForViewDifferentiators[viewDifferentiator] { return existingReuseID } let viewType = viewDifferentiator.viewTypeDescription let uniqueViewDifferentiatorCount = uniqueViewDifferentiatorCountsForViewTypes[viewType] ?? 0 uniqueViewDifferentiatorCountsForViewTypes[viewType] = uniqueViewDifferentiatorCount + 1 let reuseID = &quot;\\(viewType)_\\(uniqueViewDifferentiatorCount)&quot; // â¬…ï¸ ç±»å‹åŠ å‡ºç°æ¬¡æ•° reuseIDsForViewDifferentiators[viewDifferentiator] = reuseID return reuseID } ViewDifferentiator æ˜¯éµå¾ª Hashable çš„ï¼Œå¯¹äºåŒä¸€ä¸ª View ç±»å‹è€Œè¨€ï¼Œä¸åŒçš„ Style å®ä¾‹æ„å‘³ç€ä¸åŒçš„ ViewDifferentiatorï¼Œæ¯ä¸€ç§éƒ½ä¼šè°ƒç”¨ reuseID(byRegistering:) è¿›è¡Œæ³¨å†Œã€‚é€šè¿‡ç´¯åŠ  countï¼Œå¯ä»¥ä¿è¯ä¸åŒçš„ ViewDifferentiator å¯¹åº”ä¸åŒçš„ reuse idã€‚ å°ç»“ åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªä¾‹å­æ¥æ€»ç»“ä¸€ä¸‹ reuse id çš„åˆ›å»ºè¿‡ç¨‹å’Œåˆ›å»ºç»“æœã€‚ å‡è®¾å®šä¹‰å¦‚ä¸‹ä¸€ä¸ª Viewï¼š final class TextRow: UIView, EpoxyableView { enum Style { case small, large } } ä½¿ç”¨æ—¶å¦‚ä¸‹ï¼š // ... other row TextRow.itemModel(dataID: &quot;small&quot;, style: .small) // ... other row TextRow.itemModel(dataID: &quot;large&quot;, style: .large) // ... other row é‚£ä¹ˆå½“æˆ‘ä»¬è°ƒç”¨ collectionView.setSections(_: strategy:) æ—¶ï¼Œå› ä¸ºä¸¤ä¸ª ItemModel å®ä¾‹å¯¹åº”çš„ Style ä¸åŒï¼ŒCollectionView ä¸­å°±ä¼šæ³¨å†Œä¸¤ä¸ª Cellï¼Œreuse id åˆ†åˆ«ä¸º TextRow_0 å’Œ TextRow_1ã€‚ æ‰€ä»¥å¦‚æœä½ å¸Œæœ›æŠ›å¼ƒæˆ–éƒ¨åˆ†æŠ›å¼ƒ Cell çš„é‡ç”¨æœºåˆ¶ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦ä¿è¯ reuse id å„ä¸ç›¸åŒï¼Œå³ ä½¿ç”¨ä¸åŒçš„ Viewï¼Œæˆ–è€…ä¸åŒçš„ View.Styleã€‚ åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸¸é€šè¿‡å­—é¢å«ä¹‰ï¼Œå°†æ¯”å¦‚ TextColor ç­‰ UI æ ·å¼å°è£…åœ¨ Style ä¸­ã€‚åœ¨é‡åˆ° â€œå¯ç”¨æ—¶æ˜¾ç¤ºé»‘è‰²ï¼Œä¸å¯ç”¨æ—¶å±•ç¤ºç°è‰²â€ è¿™ç§éœ€æ±‚æ—¶ï¼ŒåŠ¨æ€ä¿®æ”¹ TextColorï¼Œéšåè°ƒç”¨ setSections(_: strategy:) åˆ·æ–°åˆ—è¡¨ã€‚è¿™æ—¶åˆ—è¡¨æ•°æ®å‘ç”Ÿå˜åŠ¨ï¼Œå…¶å®æ˜¯ reuse id ä¸åŒï¼Œç³»ç»Ÿåˆ›å»ºäº†æ–°çš„ Cell æ¥å±•ç¤ºä¸åŒçš„æ–‡å­—é¢œè‰²ã€‚å¾ˆå¤šæ—¶å€™è¿™ç§ç°è±¡å…¶å®è¿èƒŒäº†å¼€å‘è€…çš„åˆè¡·ã€‚ æ›´æ–° Cell æ•°æ® å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯æ›´æ–° Cell ä¸Šå­è§†å›¾çš„æ•°æ®ï¼Œæ¯”å¦‚ Label çš„ text ç­‰ã€‚åœ¨ Epoxy ä¸­ï¼Œæˆ‘ä»¬å¸¸å°†æ•°æ®å®šä¹‰åœ¨ Content é‡Œï¼Œå¹¶åœ¨ setContent(_: animated:) æ–¹æ³•å†…å°†æ•°æ®æ¸²æŸ“åˆ° UI ä¸Šï¼Œæ¯”å¦‚è¿™æ ·ï¼š extension HeaderRow: ContentConfigurableView { struct Content: Equatable { let title: String let tips: String? } func setContent(_ content: Content, animated: Bool) { titleLabel.text = content.title tipsLabel.text = content.tips } } é‚£ä¹ˆæ˜¯ä¸æ˜¯ä¿®æ”¹äº† Content ä¹‹åï¼Œå†è°ƒç”¨ setSections(_: strategy:) åˆ·æ–°åˆ—è¡¨å³å¯åˆ·æ–° UIï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æºç ã€‚ Content è®¾ç½®æµç¨‹ æºç åˆ†æ é¦–å…ˆçœ‹ä¸€ä¸‹ itemModel(dataID: content: behaviors: style:) æ–¹æ³•çš„å®šä¹‰ï¼Œå®ƒæ˜¯ EpoxyableView åˆ›å»º ItemModel çš„æ–¹æ³•ã€‚ extension StyledView where Self: BehaviorsConfigurableView &amp; ContentConfigurableView { public static func itemModel( dataID: AnyHashable, content: Content, behaviors: Behaviors? = nil, style: Style) -&gt; ItemModel&lt;Self&gt; { ItemModel&lt;Self&gt;( dataID: dataID, params: style, content: content, // â¬…ï¸ ä¼ å…¥ makeView: Self.init(style:), setContent: { context, content in // â¬…ï¸ åœ¨é—­åŒ…å†…åˆåäº†å‡ºæ¥ï¼Œç›¸å½“äºé—­åŒ…æŒæœ‰äº† Content å®ä¾‹ context.view.setContent(content, animated: context.animated) }) .setBehaviors { context in context.view.setBehaviors(behaviors) } } } ä»å®ç°ä¸Šçœ‹ï¼Œcontent å®ä¾‹è¢«åŒ…è£¹è¿›äº† setContent é—­åŒ…ï¼Œå»¶è¿Ÿåˆ°åˆé€‚çš„æ—¶æœºå†è¿›è¡Œè°ƒç”¨ï¼š extension ItemModel: InternalItemModeling { ... public func configure(cell: ItemWrapperView, with metadata: ItemCellMetadata) { // Even if there's no `setContent` closure, we need to make sure to call `viewForCell` to ensure that the cell is set up. let view = viewForCell(cell) setContent?(.init(view: view, metadata: metadata)) } ... } è¿™é‡Œæ’ä¸€å¥ï¼Œåœ¨å¯»æ‰¾ setContent é—­åŒ…çš„ Caller æ—¶ï¼Œä½ æœ‰å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š extension AnyItemModel: InternalItemModeling { ... public func configure(cell: ItemWrapperView, with metadata: ItemCellMetadata) { model.configure(cell: cell, with: metadata) if let view = cell.view { setContent?(.init(view: view, metadata: metadata)) } } ... } è¿™ä¸ªæ–¹æ³•å±äº AnyItemModelï¼Œè¿™ä¸ªç±»å‹æ“¦é™¤è´Ÿè´£åŒ…è£¹ä¸åŒçš„ ItemModel å®ä¾‹ï¼Œæ–¹æ³•ç¬¬ä¸€è¡Œçš„ model å³æ˜¯å®ƒæ‰€åŒ…è£…çš„ ItemModel å®ä¾‹ã€‚ ä¸ºä»€ä¹ˆæåˆ°è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªæ–¹æ³•çœ‹ä¸Šå»è°ƒç”¨äº†ä¸¤æ¬¡ setContent é—­åŒ…ã€‚ç„¶è€Œå®é™…ä¸Šï¼Œä¸æ­¢ setContentï¼ŒAnyItemModel ä¸­çš„å…¶ä»–ç±»ä¼¼çš„å±æ€§ï¼ˆæ¯”å¦‚ setBehaviorsï¼‰éƒ½æ˜¯ nilï¼Œæ‰€ä»¥ setContent é—­åŒ…åªè°ƒç”¨äº†ä¸€æ¬¡ï¼Œé‡ç‚¹è¿˜æ˜¯å…³æ³¨ ItemModel çš„ configure(cell: with:) æ–¹æ³•ã€‚ AnyItemModel çš„ setContent æ˜¯ nil æ˜¯è®¾è®¡ä¸Šå†³å®šçš„ï¼Œé¡¹ç›®ä¸­æœç´¢ä¸åˆ°å¯¹å…¶è¿›è¡Œèµ‹å€¼çš„ä»£ç ã€‚è‡³äºä¸ºä»€ä¹ˆæ˜æ˜æ²¡æœ‰èµ‹å€¼ï¼Œå´è¿˜æœ‰è°ƒç”¨ï¼ŒçŒœæµ‹æ˜¯ä¸ºäº†æ¶æ„ä¸Šçš„ç»Ÿä¸€ï¼Ÿ ç»§ç»­å‘ä¸Šå¯»æ‰¾è°ƒç”¨æ–¹ï¼Œå¯ä»¥å‘ç°æ˜¯åœ¨ä¸Šæ–‡ä¸­æåˆ°çš„ collectionView(_: cellForItemAt:) æ–¹æ³•å†…è°ƒç”¨çš„ã€‚æ–¹æ³•å®ç°å†…æœ‰ä¸€è¡Œ self.collectionView?.configure( ... )ï¼Œè¯¥æ–¹æ³•å†…æ— åˆ¤æ–­åœ°è°ƒç”¨äº† model çš„ configure(cell: with:) æ–¹æ³•ã€‚ å°ç»“ æ€»ç»“ä¸€ä¸‹é€»è¾‘å’Œè°ƒç”¨é“¾ï¼š åˆ·æ–° CollectionView æ—¶ï¼Œæ‰§è¡Œ collectionView(_: cellForItemAt:)ï¼Œé€šè¿‡å±‚å±‚è°ƒç”¨ï¼Œæœ€ç»ˆ model.setContent é—­åŒ…è¢«è°ƒç”¨ï¼ŒView çš„ setContent(_: animated) è¢«è°ƒç”¨ï¼Œæ–°çš„ Content è¢«è®¾ç½®åˆ° UI ä¸Šã€‚ åˆ°è¿™é‡Œç»“æŸäº†å—ï¼Ÿè¿˜ä¸è¦é«˜å…´çš„å¤ªæ—©ï¼Œä¸è¦å¿˜è®°äº† CollectionView è¿˜å­˜åœ¨ Diff çš„é€»è¾‘ï¼šæ›´æ–° Content å®ä¾‹åè°ƒç”¨ setSections(_: strategy:)ï¼ŒCollectionView ä¸€å®šä¼šè¢«åˆ·æ–°å—ï¼Ÿæœªå¿…ã€‚ CollectionView åˆ·æ–°æ—¶æœº æºç åˆ†æ è®©æˆ‘ä»¬è‡ªé¡¶å‘ä¸‹çœ‹ï¼Œå…ˆçœ‹ setSections(_: strategy:) çš„å®ç°ï¼š open class CollectionView: UICollectionView { ... public func setSections(_ sections: [SectionModel], animated: Bool) { let strategy: UpdateStrategy if configuration.usesBatchUpdatesForAllReloads { strategy = animated ? .animatedBatchUpdates : .nonanimatedBatchUpdates } else { strategy = animated ? .animatedBatchUpdates : .reloadData } setSections(sections, strategy: strategy) } public func setSections(_ sections: [SectionModel], strategy: UpdateStrategy) { EpoxyLogger.shared.assert(Thread.isMainThread, &quot;This method must be called on the main thread.&quot;) epoxyDataSource.registerSections(sections) apply(.make(sections: sections), strategy: strategy) } ... } registerSections() ä¸Šæ–‡æœ‰æåˆ°ï¼Œè´Ÿè´£æ³¨å†Œ Section ä»¥åŠ Cellã€‚é‡ç‚¹å…³æ³¨ä¸‹é¢çš„ apply(_: strategy:) æ–¹æ³•ã€‚æŸ¥çœ‹è¯¥çš„å®ç°ï¼Œå¯ä»¥çœ‹åˆ°å…¶å†…éƒ¨è°ƒç”¨äº†ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼š open class CollectionView: UICollectionView { ... private func updateView(with data: CollectionViewData, strategy: UpdateStrategy) { updateState = .preparingUpdate let performUpdates = { self.performBatchUpdates({ self.performUpdates(data: data, animated: strategy.animated) }, completion: { _ in if let nextUpdate = self.queuedUpdate, self.window != nil { self.queuedUpdate = nil self.updateView(with: nextUpdate.newData, strategy: nextUpdate.strategy) } else { self.completeUpdates() } }) } // There's two cases in which we should always have a strategy of `.reloadData`: // - The first update, since we're going from empty content to non-empty content, and we don't want to animate that update. // - Before the first layout of this collection view when `bounds.size` is still zero, since there's no benefit to doing batch updates in that scenario. let override = (epoxyDataSource.data == nil || bounds.size == .zero) ? .reloadData : strategy switch override { case .animatedBatchUpdates: performUpdates() case .nonanimatedBatchUpdates: UIView.performWithoutAnimation { performUpdates() } case .reloadData: let result = epoxyDataSource.applyData(data) updateState = .updating(from: result.oldData) reloadData() completeUpdates() } } ... } é€šè¿‡ä¸Šé¢çš„å®ç°æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬ä¸€ä¸ªåˆ·æ–°æ–¹æ¡ˆï¼šå¦‚æœ strategy æ˜¯ .reloadDataï¼Œé‚£ä¹ˆä¼šç›´æ¥è°ƒç”¨ UICollectionView çš„ reloadData æ–¹æ³•ï¼ˆå³ä¸ä½¿ç”¨ Epoxy å†…ç½®çš„ Diff ç®—æ³•ï¼‰ï¼Œæ­¤æ—¶ collectionView(_: cellForItemAt:) æ–¹æ³•å¿…æ‰§è¡Œï¼Œæ–°çš„ Content å¯ä»¥è¢«æ­£ç¡®åœ°æ›´æ–°ã€‚ ä¹‹æ‰€ä»¥ä¿ç•™æ³¨é‡Šï¼Œæ˜¯å› ä¸ºè¿™é‡Œçš„æ³¨é‡Šæ¯”è¾ƒå…³é”®ã€‚é€šè¿‡æ³¨é‡Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼šåˆæ¬¡åŠ è½½æ—¶ï¼Œæˆ–è€…å¯¹ä¸€ä¸ªå°šæœªå…·æœ‰å°ºå¯¸çš„ CollectionView è°ƒç”¨åˆ·æ–°æ—¶ï¼Œå°†å¿½ç•¥å¤–éƒ¨å‚æ•°ï¼Œæ°¸è¿œä½¿ç”¨ .reloadData æ–¹å¼è¿›è¡Œåˆ·æ–°ã€‚ é‚£å¦‚æœä½¿ç”¨å…¶ä»–çš„ strategy å‘¢ï¼Ÿå°±éœ€è¦å…³æ³¨ performUpdates é—­åŒ…é‡Œè°ƒç”¨çš„ performUpdates(data: animated:) æ–¹æ³•äº†ã€‚ è¿™é‡Œç¨å¾®æä¸€ä¸‹ UICollectionView çš„ performBatchUpdates(_: completion:) æ–¹æ³•ï¼Œå®ƒæ˜¯ç”¨æ¥å°†å¤šä¸ªæ“ä½œï¼ˆupdateã€insertã€delete ç­‰ï¼‰ï¼Œåˆå¹¶è‡³ä¸€ä¸ªåŠ¨ç”»å†…è¿›è¡Œå±•ç¤ºã€‚ å› ä¸º performUpdates(data: animated:) é‡Œä½¿ç”¨äº† diff ç®—æ³•ï¼Œè¯¥ç®—æ³•ä¼šåŒæ—¶è®¡ç®—å‡ºä¸Šè¿°å¤šç§æ“ä½œï¼Œæ‰€ä»¥ä¸ºäº†æ›´å¥½çš„ UI äº¤äº’å±•ç¤ºï¼Œéœ€è¦å°†è¿™äº›æ“ä½œåˆå¹¶è‡³ä¸€ä¸ªåŠ¨ç”»å†…å±•ç¤ºã€‚ performUpdates(data: animated:) æ–¹æ³•å®ç°æ¯”è¾ƒå¤šï¼Œè¿™é‡ŒæŒ‘ä¸€äº›æˆ‘ä»¬å…³æ³¨çš„è´´ä¸€ä¸‹ï¼š open class CollectionView: UICollectionView { ... private func performUpdates(data: CollectionViewData, animated: Bool) { let result = epoxyDataSource.applyData(data) updateState = .updating(from: result.oldData) for (fromIndexPath, toIndexPath) in result.changeset.itemChangeset.updates { if let cell = cellForItem(at: fromIndexPath) as? CollectionViewCell, let item = epoxyDataSource.data?.item(at: toIndexPath) { let metadata = ItemCellMetadata( traitCollection: traitCollection, state: cell.state, animated: animated) item.configure(cell: cell, with: metadata) // â¬…ï¸ ç†Ÿæ‚‰çš„è€æœ‹å‹ item.configureStateChange(in: cell, with: metadata) } } ... deleteSections(result.changeset.sectionChangeset.deletes) deleteItems(at: result.changeset.itemChangeset.deletes) for (fromIndex, toIndex) in result.changeset.sectionChangeset.moves { moveSection(fromIndex, toSection: toIndex) } for (fromIndexPath, toIndexPath) in result.changeset.itemChangeset.moves { moveItem(at: fromIndexPath, to: toIndexPath) // â¬…ï¸ moveItem æœªå¿…ä¼šè§¦å‘ cell åŠ è½½ } insertSections(result.changeset.sectionChangeset.inserts) insertItems(at: result.changeset.itemChangeset.inserts) // â¬…ï¸ insertItems ä¹Ÿä¼šè§¦å‘ cell åŠ è½½ } ... } æ–¹æ³•å®ç°çš„ç¬¬ä¸€è¡Œï¼ŒepoxyDataSource.applyData(data) å°±æ˜¯åº”ç”¨ diff ç®—æ³•ã€‚ä¹‹å‰å†™çš„ Epoxy æºç åˆ†æç³»åˆ—æ–‡ç« ä¸­ï¼Œç¬¬ä¸€ç¯‡å°±æ˜¯æœ‰å…³ Epoxy çš„ Diff ç®—æ³•çš„ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ç®—æ³•åŸç†ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•å®ç°ä¸­å¯ä»¥è¯´æœ‰ä¸¤ä¸ªåˆ·æ–°é€»è¾‘ï¼š ç†Ÿæ‚‰çš„æœ‹å‹ï¼šitem.configure(cell: cell, with: metadata)ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸Šé¢çš„æ¡ä»¶éƒ½æ»¡è¶³ï¼Œé‚£ä¹ˆ configure(cell: with:) æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼ŒContent å°±ä¼šè¢«æ›´æ–°ã€‚ åˆæˆ–è€…å½’åˆ° inserts é‡Œï¼Œä½œä¸ºä¸€ä¸ªæ–°çš„ Cell æ’å…¥åˆ°åˆ—è¡¨ä¸­ã€‚ IndexPathChangeset åŒ…å«ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š public struct IndexPathChangeset { ... /// The inserted `IndexPath`s needed to get from the old collection to the new collection. public var inserts: [IndexPath] /// The deleted `IndexPath`s needed to get from the old collection to the new collection. public var deletes: [IndexPath] /// The updated `IndexPath`s needed to get from the old collection to the new collection. public var updates: [(old: IndexPath, new: IndexPath)] /// The moved `IndexPath`s needed to get from the old collection to the new collection. public var moves: [(old: IndexPath, new: IndexPath)] ... } è¿™ä¸¤ä¸ªæ–¹æ¡ˆä¸­ï¼Œinserts çš„é€»è¾‘å¾ˆç®€å•ã€‚è®©æˆ‘ä»¬å¿½ç•¥ diff ç®—æ³•çš„é€»è¾‘ï¼Œç›´æ¥è¯´ç»“è®ºï¼šåªè¦ dataID å‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ–°çš„ ItemModelï¼Œå°±ä¼šæ‰§è¡Œ delete &amp; insertã€‚æ‰€ä»¥ç¬¬äºŒä¸ªåˆ·æ–°æ–¹æ¡ˆå°±æ˜¯ï¼šä¿®æ”¹å‰åï¼ŒItemModel çš„ dataID ä¸åŒã€‚ é‚£ configure(cell: with:) çš„å‰ç½®æ¡ä»¶éƒ½æœ‰å“ªäº›å‘¢ï¼Ÿé¦–å…ˆæ˜¯ for å¾ªç¯çš„æ•°ç»„ä¸ä¸ºç©ºï¼Œå…¶æ¬¡æ˜¯ä¸¤ä¸ª ifã€‚èªæ˜çš„ä½ åº”è¯¥å¯ä»¥å‘ç°ï¼Œè¿™ä¸¤ä¸ª if ä¸æ˜¯é€»è¾‘é‡ç‚¹ï¼Œç¬¬ä¸€ä¸ª if åªæ˜¯ä¸ºäº†æ»¡è¶³ Swift è¯­æ³•çš„ç±»å‹è½¬æ¢ï¼Œè€Œç¬¬äºŒä¸ª if æ˜¯ä¸ºäº†åˆ¤æ–­ Cell æ˜¯å¦å±•ç¤ºå‡ºæ¥ï¼Œé¿å… configure(cell: with:) å¤šæ¬¡è°ƒç”¨ã€‚æ‰€ä»¥é‡ç‚¹å°±åœ¨äº result.changeset.itemChangeset.updates æ˜¯å¦ä¸ºç©ºã€‚ æ‰€ä»¥æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹å°±æ˜¯ï¼šå¦‚ä½•ä¿®æ”¹æˆ‘ä»¬çš„æ•°æ®æºï¼Œå¯ä»¥è®©å…¶å½’åˆ° updates é›†åˆé‡Œã€‚æ¡ä»¶æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š è¿™ä¸ª ItemModel åœ¨åˆ·æ–°å‰å·²ç»å­˜åœ¨äºåˆ—è¡¨ä¸­ï¼Œåœ¨åˆ—è¡¨ä¸­å…·æœ‰ Indexã€‚ ItemModel çš„ isDiffableItemEqual(to:) æ–¹æ³•è¿”å› falseã€‚ ç›¸å…³æ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š extension ItemModel: Diffable { ... public func isDiffableItemEqual(to otherDiffableItem: Diffable) -&gt; Bool { guard let other = otherDiffableItem as? Self else { return false } return isErasedContentEqual?(other) ?? true } } isErasedContentEqual åœ¨ ItemModel åˆå§‹åŒ–æ—¶è¿›è¡Œè®¾ç½®ï¼š public struct ItemModel&lt;View: UIView&gt;: ViewEpoxyModeled { ... public init&lt;Content: Equatable&gt;( dataID: AnyHashable, content: Content, setContent: @escaping (CallbackContext, Content) -&gt; Void) { self.dataID = dataID erasedContent = content // â¬…ï¸ erasedContent å°±æ˜¯ content self.setContent = { setContent($0, content) } isErasedContentEqual = { otherModel in guard let otherContent = otherModel.erasedContent as? Content else { return false } return otherContent == content // â¬…ï¸ Content éµå¾ª Equatable çš„ç›®çš„å°±åœ¨æ­¤ } } ... } ä»ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•å®ç°ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç»“è®ºï¼š å¦‚æœ EpoxyableView æ²¡æœ‰å®šä¹‰ Contentï¼Œé‚£ä¹ˆä¹Ÿå°±ä¸å­˜åœ¨ updates çš„é€»è¾‘ã€‚ æ›´æ–°å‰åï¼Œä¸¤ä¸ª ItemModel çš„ Content ä¸ç›¸ç­‰ï¼ŒEpoxyableView çš„ setContent(_: animated:) æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ã€‚ é‚£ä¹ˆç¬¬ä¸‰ç§åˆ·æ–°æ–¹æ¡ˆå°±æ˜¯ï¼šç¡®ä¿ä¿®æ”¹å‰åçš„ Content ä¸ç›¸ç­‰ã€‚ å°ç»“ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œåœ¨è°ƒç”¨ setSections(_: strategy:) æ–¹æ³•ä¹‹åï¼ŒStyle ä¸å˜çš„å‰æä¸‹ï¼Œä»¥ä¸‹å‡ ç§æƒ…å†µ EpoxyableView çš„ setContent(_: animated) æ–¹æ³•å°†è¢«è°ƒç”¨ï¼š strategy ä¸º .reloadData æ—¶ã€‚ åŒ…æ‹¬ç©º CollectionView åˆæ¬¡åŠ è½½æ•°æ®ï¼Œæˆ–è€… CollectionView å°šæ²¡æœ‰ Size æ—¶ã€‚ ä¿®æ”¹æ•°æ®å‰åï¼ŒItemModel çš„ dataID å‘ç”Ÿäº†æ”¹å˜ã€‚ ä¿®æ”¹æ•°æ®å‰åï¼ŒContent çš„ == è¿”å› falseï¼Œå³ä¸¤ä¸ª Content ä¸ç›¸ç­‰ã€‚ æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­å°±æ˜¯æœ‰æ•ˆçš„ï¼š private var count = 0 { didSet { setItems(items, animated: true) } } @ItemModelBuilder private var items: [ItemModeling] { TextRow.itemModel( dataID: DataID.row, content: .init( title: &quot;Count \\(count)&quot;, body: &quot;Tap to increment&quot;), style: .large) .didSelect { [weak self] _ in self?.count += 1 } } æ€»ç»“ åˆ°è¿™é‡Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œå€ŸåŠ© Epoxy çš„æœºåˆ¶æˆ‘ä»¬åº”è¯¥å¦‚ä½•åˆ·æ–°åˆ—è¡¨ã€‚ æ–¹æ³• æè¿° æ¨èæŒ‡æ•° ä½¿ç”¨ä¸åŒçš„ dataID æ¯”å¦‚å£°æ˜ä¸€ä¸ª enum DataID { case some(value: String) }ï¼Œæ¯æ¬¡åˆ·æ–°æ—¶ä¿®æ”¹ value çš„å€¼ã€‚ æˆ–è€…å°† dataID å’Œæ•°ç»„çš„ä¸‹æ ‡åšå¯¹åº”ï¼Œè¿™æ ·åœ¨ç§»åŠ¨ Cell æ—¶ï¼Œç›¸å½“äºåŒä¸€ä¸ª ItemModel çš„ Content å‘ç”Ÿäº†å˜åŒ–ã€‚ ğŸŒŸ ä½¿ç”¨ä¸åŒçš„ Style å°†éœ€è¦å˜åŒ–çš„å€¼å®šä¹‰åœ¨ Style é‡Œï¼Œåˆ·æ–° Style ååˆ·æ–°åˆ—è¡¨ ğŸŒŸğŸŒŸ åˆ©ç”¨ Equatableï¼Œä¿®æ”¹ Content ç¡®ä¿ Content çš„åˆ¤ç­‰é€»è¾‘ç¬¦åˆæ‚¨çš„è¦æ±‚ï¼Œä¿®æ”¹ Content ååˆ·æ–°åˆ—è¡¨ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸ æœ‰ä¸€ä¸ªåˆ·æ–°ä¹‹å¤–çš„å¼•ç”³è¯é¢˜ï¼Œä¸Šæ–‡ä¹Ÿæåˆ°è¿‡ï¼Œé‚£å°±æ˜¯ä»€ä¹ˆæ ·çš„æ•°æ®è¯¥æ”¾åˆ° Style ä¸­ã€‚å¸Œæœ›çœ‹å®Œè¿™ç¯‡æ–‡ç« åï¼Œå¯¹äºè¿™ä¸ªé—®é¢˜ä½ ä¹Ÿèƒ½æœ‰æ–°çš„æ€è€ƒå’Œç†è§£ã€‚ æƒ³å¿…å¯¹äºèªæ˜çš„ä½ æ¥è¯´ï¼Œä¸Šè¿°åˆ†æè¿‡ç¨‹æœ‰ç‚¹å¤ªç®€å•äº†ï¼Œåªè¦ç¨å¾®æ·±å…¥è¿½ä¸€ä¸‹ä»£ç ï¼Œå°±èƒ½æ¢³ç†æ¸…æ¥šè¿™äº›æƒ…å†µã€‚ç”šè‡³ Epoxy çš„ demo å’Œæ–‡æ¡£ä¸­å·²ç»ä»‹ç»çš„å¾ˆæ¸…æ¥šäº†ã€‚ ä½†æ˜¯æœ‰çš„æ—¶å€™ï¼Œç”Ÿæ´»å°±æ˜¯è¿™ä¹ˆè¯¡å¼‚ã€‚ä¸æŠŠè¿™äº›è¿‡ç¨‹å†™ä¸‹æ¥çš„è¯ï¼Œå¯¹äºä½¿ç”¨è¿˜ä¸ç†Ÿç»ƒçš„æˆ‘è€Œè¯´ï¼Œç»å¸¸ä¼šé™·å…¥æ–‡ç« å¼€å¤´çš„ç–‘é—®ï¼šâ€œä¸ºä»€ä¹ˆåˆ—è¡¨åˆ·æ–°åæ•°æ®æ²¡å˜â€ å’Œ â€œä¸ºä»€ä¹ˆå®ƒåˆ·æ–°åæ•°æ®å°±å˜äº†â€ã€‚ä¹Ÿå°±æ˜¯è¯´å³ä½¿æˆ‘ä»¬çŸ¥é“äº† â€œå½“ Content ä¸ä¸€è‡´æ—¶åˆ·æ–°åˆ—è¡¨ï¼Œåˆ—è¡¨æ•°æ®ä¼šå‘ç”Ÿå˜åŒ–â€ å¹¶æŒ‰ä¹‹ä»˜å‡ºå®è·µæ—¶ï¼Œä¾ç„¶ä¼šæœ‰ä¸ç”Ÿæ•ˆçš„æƒ…å†µå‘ç”Ÿã€‚ è¿™ç¯‡æ–‡ç« è¿˜ä¸æ˜¯å®Œå…¨ä½“ï¼Œæ—¥åå½“æˆ‘å†æ¬¡å‘ç°åˆ·æ–°å¤±æ•ˆçš„æƒ…å†µæ—¶ï¼Œæˆ‘å°†å®Œå–„è¿™ç¯‡æ–‡ç« ï¼Œè¡¥å……å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚ ","link":"https://blog.rakuyo.dev/refresh-epoxy-list/"},{"title":"Lazy var çš„çº¿ç¨‹å®‰å…¨é—®é¢˜","content":"Swift çš„ lazy å…³é”®å­—ä¸€ç›´æœ‰ä¸€ä¸ªå¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å®ƒä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰è¿™ä¹ˆä¸€æ®µæè¿°ï¼š Note If a property marked with the lazy modifier is accessed by multiple threads simultaneously and the property hasnâ€™t yet been initialized, thereâ€™s no guarantee that the property will be initialized only once. å®˜æ–¹è‡ªå·±ä¹Ÿè¯´äº†ï¼Œå¦‚æœå¤šçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œå¯èƒ½å¯¼è‡´åˆå§‹åŒ–ä¸¤æ¬¡ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸å¤ªä¼šé‡åˆ°è¿™ç§é—®é¢˜ï¼Œéƒ½æ˜¯åœ¨ viewDidLoad ä¸­æ·»åŠ ã€å¸ƒå±€å­è§†å›¾ï¼Œä½†æ˜¯å°‘æ•°æƒ…å†µè¿˜æ˜¯æœ‰å¯èƒ½ä¼šç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ã€‚ lazy var void ä¸ dispatch_once Xcode 16 &amp; Swift 6 ä»¥å‰ é™¤äº†ç”¨ lazy ä¿®é¥° UI è§†å›¾ä¹‹å¤–ï¼Œå¦ä¸€ä¸ªå¯èƒ½æ¯”è¾ƒå¸¸è§çš„ç”¨æ³•æ˜¯ç”¨ lazy var void ä»£æ›¿ dispatch_onceã€‚ åœ¨ä¸­æ–‡äº’è”ç½‘ä¸Šèƒ½æœåˆ°å¾ˆå¤šè¿™ç§ç”¨æ³•ï¼Œä½†æ˜¯è¯»åˆ°è¿™é‡Œä½ åº”è¯¥èƒ½å‘ç°ï¼Œè¿™ç§ç”¨æ³•å…¶å®ä¹Ÿæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› ä¸ºå®ƒç”¨çš„æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ lazy å…³é”®å­—ä¿®é¥°ã€‚ åœ¨ã€ŠMigrating to Swift 3ã€‹ï¼Œå®˜æ–¹æ˜ç¡®æåˆ°äº†ä»£æ›¿ dispatch_once çš„åŠæ³•ï¼š The free function dispatch_once is no longer available in Swift. In Swift, you can use lazily initialized globals or static properties and get the same thread-safety and called-once guarantees as dispatch_once provided. Example: let myGlobal = { â€¦ global contains initialization in a call to a closure â€¦ }() _ = myGlobal // using myGlobal will invoke the initialization code only the first time it is used. è¯·æ³¨æ„ï¼Œç¤ºä¾‹ä¸­ä½¿ç”¨çš„æ˜¯ letï¼Œå¹¶ä¸”æ˜¯ lazily initialized globals æˆ–è€… static propertiesã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œstatic ä¿®é¥°æˆ–è€…é¡¶å±‚å±æ€§çš„åˆå§‹åŒ–éƒ½æ˜¯å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå†é…åˆä¸Šçº¿ç¨‹å®‰å…¨çš„ let å®šä¹‰ï¼Œè¿™æ‰å¯ä»¥è¾¾åˆ°å’Œ dispatch_once ç›¸åŒçš„æ•ˆæœã€‚ æ‰€ä»¥ç»¼ä¸Šï¼Œå»ºè®®ä½¿ç”¨ static let void æ¥ä»£æ›¿ lazy var voidã€‚ <!-- ### Xcode 16 & Swift 6 é‚£ä¹ˆåœ¨æœ€æ–°çš„ Xcode 16 ä¸­å‘¢ï¼Ÿ Xcode 16 ä¼šè‡ªåŠ¨æ·»åŠ  `@MainActor`ï¼Œ ->","link":"https://blog.rakuyo.dev/thread-safety-with-lazy/"},{"title":"åœ¨ Xcode playground ä¸­é¢„è§ˆ View è§†å›¾","content":"è®°å½•ä¸€ä¸ªæ€»æ˜¯å¿˜è®°çš„æ“ä½œï¼š import UIKit import PlaygroundSupport let image = UIImage(named: &quot;winnie.png&quot;) let imageView = UIImageView(image: image) PlaygroundPage.current.liveView = imageView åœ¨ Xcode playground ä¸­ï¼Œå¦‚æœå¼•å…¥ PlaygroundSupport åº“ï¼Œèµ‹å€¼ PlaygroundPage.current.liveViewï¼Œå¯ä»¥å°†è§†å›¾æ˜¾ç¤ºåœ¨å³ä¾§çš„é¢„è§ˆæ¡†ï¼Œä¹Ÿå°±æ˜¯ Live View ä¸­ã€‚ å¦å¤–ä¸åªæ˜¯ UIViewï¼ŒUIViewController åŠå…¶å­ç±»ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ŒPlaygroundPage.current.liveView = controller å³å¯ã€‚ ","link":"https://blog.rakuyo.dev/preview-in-xcode-playground/"},{"title":"epoxyæºç ç¬”è®°2ï¼šåœ¨æ‰©å±•ä¸­å®šä¹‰å­˜å‚¨å±æ€§","content":"å¸¸è§„çš„åœ¨æ‰©å±•ä¸­å®šä¹‰å­˜å‚¨å±æ€§çš„æ–¹æ³•æ˜¯å€ŸåŠ© Objective-C çš„ runtime è¿›è¡Œå±æ€§å…³è”ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä»…é™äº ObjC ç±»ï¼Œé‚£ä¹ˆçº¯ Swift ç±»ï¼Œæ¯”å¦‚ç»“æ„ä½“è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ åœ¨ epoxy è¿™ä¸ªåº“ä¸­å‘ç°äº†è§£å†³åŠæ³•ã€‚ Objective-C runtime å…ˆè¯´ä¸€ä¸‹ç”¨ Objective-C runtime çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š private var loadingViewKey: Void? extension HUDProtocol { public var loadingView: LoadingView { get { if let view = objc_getAssociatedObject(self, &amp;loadingViewKey) as? LoadingView { return view } loadingView = LoadingView() return loadingView } set { objc_setAssociatedObject(self, &amp;loadingViewKey, newValue, .OBJC_ASSOCIATION_RETAIN_NONATOMIC) } } } ä½¿ç”¨ loadingViewKey å…³è” loadingView å±æ€§ï¼ŒåŒæ—¶ get æ–¹æ³•å†…è¿˜åšäº†ä¸€æ¬¡æ‡’åŠ è½½ã€‚å¯¹äº Key çš„å®šä¹‰å½¢å¼å¤šç§å¤šæ ·ï¼Œè¿™é‡Œå°±ä¸åšè¿‡åº¦èµ˜è¿°ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œç¿»çœ‹ epoxy ä»£ç ä¸­å‘ç°ï¼Œåœ¨ä½¿ç”¨å…³è”å±æ€§ç»™ ObjC ç±»å¢åŠ å­˜å‚¨å±æ€§æ—¶ï¼Œè¿˜æ˜¯ç”¨åˆ°äº† @nonobjcã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªçº¯ Swift åº“ï¼Œæ‰€ä»¥ä½¿ç”¨ @nonobjc æ¥é¿å…ç”Ÿæˆ objc æ¥å£ä¹Ÿæ˜¯å¾ˆåˆç†çš„ä¼˜åŒ–ã€‚ Epoxy ä¸­çš„åšæ³• è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æºç ï¼Œæ¯”å¦‚ DidChangeStateProviding.swift è¿™ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š æˆ‘ä¼šçœç•¥æ‰ä¸€äº›å’Œæœ¬æ–‡æ— å…³çš„æ³¨é‡Šå’Œå†…å®¹ï¼Œå®Œæ•´çš„å†…å®¹è¯·ç‚¹å‡»ä¸Šæ–¹é“¾æ¥æŸ¥çœ‹åŸå§‹ä»£ç ã€‚ extension CallbackContextEpoxyModeled { public typealias DidChangeState = (CallbackContext) -&gt; Void public var didChangeState: DidChangeState? { get { self[didChangeStateProperty] } set { self[didChangeStateProperty] = newValue } } private var didChangeStateProperty: EpoxyModelProperty&lt;DidChangeState?&gt; { .init(keyPath: \\Self.didChangeState, defaultValue: nil, updateStrategy: .chain()) } } å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä»£ç æ‰©å±•äº† CallbackContextEpoxyModeledï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰äº†å­˜å‚¨å±æ€§ didChangeStateã€‚ ç»†çœ‹ didChangeStateï¼Œå‘ç°ç”¨åˆ°äº† subscript è¯­æ³•ã€‚æ¥ç€æŸ¥çœ‹ CallbackContextEpoxyModeled çš„å£°æ˜ï¼š public protocol CallbackContextEpoxyModeled: EpoxyModeled { associatedtype CallbackContext } å‘ç°ä»…ä»…æ˜¯ä¸€ä¸ªåè®®ã€‚æ¥ç€å¾€ä¸‹çœ‹ï¼Œå®ƒæ‰€éµå¾ªçš„ EpoxyModeled åœ¨è¿™é‡Œè¿›è¡Œå®šä¹‰ã€‚ å…³é”®ä»£ç å¦‚ä¸‹ï¼š public protocol EpoxyModeled { /// The underlying storage of this model that stores the current property values. var storage: EpoxyModelStorage { get set } } extension EpoxyModeled { /// Stores or retrieves a value of the specified property in `storage`. public subscript&lt;Property&gt;(property: EpoxyModelProperty&lt;Property&gt;) -&gt; Property { get { storage[property] } set { storage[property] = newValue } } } ä»è¿™é‡Œæ„Ÿè§‰EpoxyModeledå°±æ˜¯ä¸€ä¸ªå£³ï¼Œç”¨æ¥å°è£… storage è¿™ä¸ªå±æ€§ã€‚ä¸Šé¢æåˆ°çš„ subscript è¯­æ³•å…¶å®ä¹Ÿæ˜¯å¯¹ storage çš„ subscript çš„è°ƒç”¨ã€‚ ä½†æ˜¯è¿™é‡Œå°±å¤æ‚äº†ä¸€äº›ï¼ŒåŒæ—¶å‡ºç°äº† EpoxyModelStorage å’Œ EpoxyModelProperty ä¸¤ä¸ªç±»å‹ã€‚è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ EpoxyModelStorageã€‚ EpoxyModelStorage è¯¥ç±»å‹åœ¨è¿™é‡Œè¿›è¡Œå®šä¹‰ã€‚ ä¾ç„¶è´´å‡ºæ¥ä¸€äº›å…³é”®ä»£ç ï¼š public struct EpoxyModelStorage { public init() { } /// Stores or retrieves the value of the specified property. public subscript&lt;Property&gt;(property: EpoxyModelProperty&lt;Property&gt;) -&gt; Property { get { guard let propertyStorage = storage[property.keyPath] else { return property.defaultValue() } // This cast will never fail as the storage is only settable via this subscript and the `KeyPath` key is unique for any provider and value type pair. // swiftlint:disable:next force_cast return propertyStorage.value as! Property } set { // We first update the value without using the `updateStrategy` since the likely scenario // is that there won't be a collision that requires the `updateStrategy`, and we'll be able to // return without incurring the cost of another write. let propertyStorage = PropertyStorage(value: newValue, property: property) guard var replaced = storage.updateValue(propertyStorage, forKey: property.keyPath) else { return } // This cast will never fail as the storage is only settable via this subscript and the // `KeyPath` key is unique for any provider and value type pair. // swiftlint:disable:next force_cast replaced.value = property.updateStrategy.update(replaced.value as! Property, newValue) storage[property.keyPath] = replaced } } // MARK: Private /// The underlying storage for the properties, with a key of the `EpoxyModelProperty.keyPath` and /// a value of the property's `PropertyStorage`. /// /// Does not include default values. private var storage = [AnyKeyPath: PropertyStorage]() } // MARK: - PropertyStorage /// A value stored within an `EpoxyModelStorage`. private struct PropertyStorage { /// The type-erased value of the `EpoxyModelProperty`. var value: Any /// The property's corresponding `EpoxyModelProperty`, erased to an `AnyEpoxyModelProperty`. var property: AnyEpoxyModelProperty } å¯ä»¥çœ‹åˆ°åœ¨ EpoxyModelStorage ä¸­å®šä¹‰äº†ä¸€ä¸ªå…³é”®çš„å­˜å‚¨å±æ€§ storageï¼Œè¯¥å±æ€§æ˜¯å­—å…¸ç±»å‹ï¼Œä½¿ç”¨ KeyPath åš Keyï¼ŒValue æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ã€‚ä½†æ˜¯è¿™é‡Œå…¶å® PropertyStorage ä¸æ˜¯é‡ç‚¹ï¼Œå› ä¸ºç”¨åˆ° PropertyStorage.property çš„ä»£ç å¹¶ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† storage è¿›è¡Œç®€åŒ–ï¼Œå°±å½“ä½œ [AnyKeyPath: Any] ç±»å‹æ¥å¯¹å¾…ã€‚ å†å›çœ‹ EpoxyModelStorage çš„ subscript å®ç°ï¼Œè‡³æ­¤å…¶å®æˆ‘ä»¬å·²ç»èƒ½æ˜ç™½ Epoxy åœ¨ extension ä¸­å®šä¹‰å­˜å‚¨å±æ€§çš„åŸç†ï¼šå…¶å®å°±æ˜¯ç”¨ KeyPath åš keyï¼Œå°†å­˜å‚¨å±æ€§å¯¹åº”çš„å€¼å­˜å‚¨åˆ°å†…éƒ¨çš„ä¸€ä¸ªå­—å…¸å±æ€§ä¸­ã€‚ çœ‹åˆ°è¿™é‡Œä¼šä¸ä¼šæœ‰ç‚¹å¤±æœ›ï¼Ÿæœ‰çš„äººè¿˜ä¼šè¯´è¿™æ˜¯è„±è£¤å­æ”¾å±ï¼Œç†ç”±å¦‚ä¸‹ï¼š åœ¨éœ€è¦ extension å®šä¹‰å­˜å‚¨å±æ€§çš„ç±»å‹é‡Œæ‰‹åŠ¨å®šä¹‰ä¸€ä¸ª [String: Any]ï¼Œç„¶ååœ¨ extension é‡Œæ“ä½œè¿™ä¸ªå­—å…¸ä¸ä¹Ÿèƒ½è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœå—ï¼Ÿè¿˜è‡³äºè´¹è¿™ä¹ˆå¤§åŠ²å†™è¿™ä¹ˆå¤šå°è£…ï¼Ÿ è€Œä¸”ä¸€ç‚¹ä¹Ÿä¸çµæ´»ï¼Œä¸åƒæ˜¯ObjCä¸€æ ·éšå†™éšç”¨ï¼Œæ— éœ€æ›´æ”¹åŸç±»å‹çš„å®šä¹‰ã€‚ è¿˜æœ‰ï¼Œå› ä¸º protocol æ˜¯ public çš„ï¼Œé‚£ä¹ˆ storage å¿…ç„¶ä¼šè¢«æš´éœ²ç»™å¤–ç•Œï¼Œé€ æˆä¸€å®šç¨‹åº¦çš„éšæ‚£ã€‚ ç–‘é—®æš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ï¼Œå†æ¥çœ‹çœ‹ EpoxyModelProperty è¿™ä¸ªç±»å‹ã€‚ EpoxyModelProperty å…ˆçœ‹å®šä¹‰ï¼š public struct EpoxyModelProperty&lt;Value&gt; { /// Creates a property identified by a `KeyPath` to its provided `value` and with its default value if not customized in content by consumers. /// /// The `updateStrategy` is used to update the value when updating from an old value to a new value. public init&lt;Model&gt;( keyPath: KeyPath&lt;Model, Value&gt;, defaultValue: @escaping @autoclosure () -&gt; Value, updateStrategy: UpdateStrategy) { self.keyPath = keyPath self.defaultValue = defaultValue self.updateStrategy = updateStrategy } /// The `KeyPath` that uniquely identifies this property. public let keyPath: AnyKeyPath /// A closure that produces the default property value when called. public let defaultValue: () -&gt; Value /// A closure used to update an `EpoxyModelProperty` from an old value to a new value. public let updateStrategy: UpdateStrategy } // MARK: EpoxyModelProperty.UpdateStrategy extension EpoxyModelProperty { /// A closure used to update an `EpoxyModelProperty` from an old value to a new value. public struct UpdateStrategy { public init(update: @escaping (Value, Value) -&gt; Value) { self.update = update } /// A closure used to update an `EpoxyModelProperty` from an old value to a new value. public var update: (_ old: Value, _ new: Value) -&gt; Value } } // MARK: Defaults extension EpoxyModelProperty.UpdateStrategy { /// Replaces the old value with the new value when an update occurs. public static var replace: Self { .init { _, new in new } } /// Chains the new closure value onto the old closure value, returning a new closure that first calls the old closure and then subsequently calls the new closure. public static func chain() -&gt; EpoxyModelProperty&lt;(() -&gt; Void)?&gt;.UpdateStrategy { .init { old, new in guard let new = new else { return old } guard let old = old else { return new } return { old() new() } } } /// Chains the new closure value onto the old closure value, returning a new closure that first calls the old closure and then subsequently calls the new closure. public static func chain&lt;A&gt;() -&gt; EpoxyModelProperty&lt;((A) -&gt; Void)?&gt;.UpdateStrategy { .init { old, new in guard let new = new else { return old } guard let old = old else { return new } return { a in old(a) new(a) } } } // Add more arities as needed } EpoxyModelProperty æœ‰ä¸‰ä¸ªå±æ€§ï¼škeyPathã€defaultValue å’Œ updateStrategyã€‚ keyPath å’Œ defaultValue é…åˆèŒƒå‹å¯ä»¥å¾ˆå¥½çš„è§£å†³ objc_getAssociatedObject ä¸­ç±»å‹è½¬æ¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å›çœ‹ä¸Šé¢æåˆ°è¿‡çš„è¿™ä¸ªä»£ç ç‰‡æ®µï¼š // This cast will never fail as the storage is only settable via this subscript and the `KeyPath` key is unique for any provider and value type pair. // swiftlint:disable:next force_cast return propertyStorage.value as! Property è¿™ä¹Ÿå°±è§£ç­”äº†ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä»…ä»…å®šä¹‰ä¸€ä¸ª [String: Any]ï¼Œé‚£ä¹ˆ String ç±»å‹çš„ Key å’Œ Any ç±»å‹çš„ Value æ˜æ˜¾æ— æ³•ä¿è¯å¯¹é½ã€‚ é‚£ä¹ˆä½ å¯èƒ½æƒ³è¯´æ”¹æˆ [KeyPath: Any] å‘¢ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºåœ¨è°ƒç”¨ subscript æ—¶ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ KeyPathï¼Œåˆ™ä¼šè§¦å‘ç³»ç»Ÿé»˜è®¤çš„é€šè¿‡ KeyPath å–å€¼çš„æ–¹æ³•ï¼Œä¸ä¼šèµ°è‡ªå®šä¹‰çš„ subscriptï¼Œæ‰€ä»¥ Map çš„ Key æ— è®ºå¦‚ä½•éƒ½éœ€è¦è‡ªå®šä¹‰ç±»å‹æ¥åŒ…ä¸€å±‚ï¼Œæ—¢ç„¶è¦åŒ…ä¸€å±‚ï¼Œä½•ä¸ç›´æ¥è¿ defaultValue ä¹Ÿå°è£…ä¸€ä¸‹å‘¢ï¼Ÿ è‡³äº updateStrategy å®šä¹‰äº†å±æ€§èµ‹å€¼æ—¶çš„æ–¹æ³•ï¼Œæ˜¯æ›¿æ¢åŸå€¼ï¼Ÿè¿˜æ˜¯ä¸¤ä¸ªå€¼éƒ½æ‰§è¡Œï¼Ÿè™½ç„¶å®ƒå’Œæœ¬æ–‡å†…å®¹æ— å…³ï¼Œä½†æ˜¯è¿™ä¸ªå®ç”¨çš„å±æ€§ç¡®å®ä¹Ÿæ˜¯ EpoxyModelProperty çš„å¿…è¦æ€§ä¹‹ä¸€ã€‚ è§£å†³ç–‘é—® é’ˆå¯¹ä¸Šè¿°ä¸‰ä¸ªé—®é¢˜ï¼š ä¸ºä½•ä¸æ‰‹åŠ¨å®šä¹‰ [String: Any]ï¼Ÿepoxy å±äºè¿‡åº¦å°è£… ç¼ºä¹çµæ´»æ€§ï¼Œè€Œä¸”éœ€è¦æ›´æ”¹åŸç±»å‹çš„å®šä¹‰ã€‚å¯¹äºæ— æ³•æ›´æ”¹å®šä¹‰çš„ç±»å‹ï¼Œåˆ™æ— æ³•ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚ å› ä¸º protocol æ˜¯ public çš„ï¼Œå¯¼è‡´ storage ä¼šè¢«æš´éœ²ç»™å¤–ç•Œï¼Œé€ æˆä¸€å®šç¨‹åº¦çš„éšæ‚£ã€‚ é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”¨ protocol è§„èŒƒå±æ€§å®šä¹‰åœ¨ Swift ä¸­ç»å¯¹ä¸ç®—æ˜¯è¿‡åº¦å°è£…ï¼Œè€Œæ˜¯å¾ˆå¸¸è§çš„æ–¹æ³•ï¼›å› ä¸ºæ— æ³•ç›´æ¥ä½¿ç”¨ KeyPath ç±»å‹ä½œä¸º Map çš„Keyï¼Œä¸ºäº†ä¿æŒç±»å‹å®‰å…¨ï¼Œåœ¨ä¸Šå±‚è°ƒç”¨ä¸­ä¹Ÿæ— æ³•ç›´æ¥ä½¿ç”¨ AnyKeyPathï¼Œæ‰€ä»¥å¿…ç„¶éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªç±»å‹æ¥åšè°ƒç”¨é“¾ä¸­çš„ â€œç´¢å¼•â€ã€‚ è€Œä¸”å…¶ä»–ä¸¤ä¸ªé—®é¢˜ç¡®å®æ˜¯å®é™…å­˜åœ¨çš„ã€‚ç‰¹åˆ«æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ï¼Œé™¤éä½¿ç”¨ objc_getAssociatedObject æ¥å®ç°ç›¸å…³åè®®ï¼Œå¦åˆ™åˆ™æ— æ³•ä½¿ç”¨è¿™å¥—æ–¹æ³•ã€‚ è‡³äºç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œè€ƒè™‘åˆ°å¤–éƒ¨å¯¹è¯¥ç±»å‹çš„æ‰©å±•æ€§ï¼Œæš´éœ² storage å±æ€§ç»™å¤–ç•Œæ˜¯å¿…ç„¶çš„ï¼Œå¦åˆ™å¤–éƒ¨å¦‚ä½•ç»™è¿™ä¸ªç±»å‹å¢åŠ æ–°çš„å­˜å‚¨å±æ€§å‘¢ï¼Ÿé™¤éä½ æ˜ç¡®ä¸å…è®¸å¤–éƒ¨ç»™è¿™ä¸ªç±»å‹å¢åŠ å­˜å‚¨å±æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª internal type åŒ…ä¸€å±‚ Mapã€‚ ç®€åŒ–ä»£ç  ç°åœ¨è®©æˆ‘ä»¬å­¦ä»¥è‡´ç”¨ï¼Œè€ƒè™‘ä¸€ä¸‹å¦‚ä½•ç®€åŒ–ä»£ç ã€‚ å…³é”®ç±»å‹æ˜¯ä¸‰ä¸ªåè®®ï¼šEpoxyModeledã€EpoxyModelStorage å’Œ EpoxyModelPropertyï¼Œç®€åŒ–è‚¯å®šä¹Ÿæ˜¯é’ˆå¯¹è¿™ä¸‰ä¸ªç±»å‹è¿›è¡Œç®€åŒ–ã€‚ ä½†æ˜¯å…¶å®å¯ä»¥åˆ å‡çš„ç©ºé—´å¹¶ä¸å¤šï¼Œä»…ä»…åœ¨ä½ ä¸éœ€è¦ updateStrategy æ—¶ï¼Œå¯ä»¥å°†å®ç°ç®€åŒ–ä¸ºä¸‹é¢çš„è¿™æ ·ï¼š public struct ModelProperty&lt;Value&gt; { public init&lt;Model&gt;( keyPath: KeyPath&lt;Model, Value&gt;, defaultValue: @escaping @autoclosure () -&gt; Value ) { self.keyPath = keyPath self.defaultValue = defaultValue } public let keyPath: AnyKeyPath public let defaultValue: () -&gt; Value } public struct ModelStorage { private var storage = [AnyKeyPath: Any]() public init() { } public subscript&lt;Property&gt;(property: ModelProperty&lt;Property&gt;) -&gt; Property { get { guard let propertyStorage = storage[property.keyPath] else { return property.defaultValue() } return propertyStorage as! Property } set { storage[property.keyPath] = newValue } } } public protocol Modeled { var storage: ModelStorage { get set } } extension Modeled { public subscript&lt;Property&gt;(property: ModelProperty&lt;Property&gt;) -&gt; Property { get { storage[property] } set { storage[property] = newValue } } } å…¶å®ä¸Šè¿°ä»£ç ä¹Ÿå°±ç›¸å½“äº updateStrategy = .replace çš„æƒ…å†µã€‚ä¸è¿‡ï¼ŒæŸ¥çœ‹è¿™ä»½ç®€åŒ–çš„ä»£ç æ˜¯ä¸æ˜¯æ„Ÿè§‰æ•´ä¸ªé€»è¾‘éƒ½æ›´æ¸…æ™°äº†å‘¢ğŸ˜ åœ¨è°ƒç”¨ä¸Šå’ŒåŸæœ¬å®ç°ä¹Ÿæ²¡æœ‰åŒºåˆ«ï¼š struct Action: Modeled { var storage = ModelStorage() } extension Action { var testString: String { get { self[testStringProperty] } set { self[testStringProperty] = newValue } } private var testStringProperty: ModelProperty&lt;String&gt; { .init(keyPath: \\Self.testString, defaultValue: &quot;default&quot;) } } var testAction = Action() print(testAction.testString) // &quot;default&quot; testAction.testString = &quot;123&quot; print(testAction.testString) // &quot;123&quot; å¯¹äº†ï¼ŒModeled ä¸­çš„ subscript å…¶å®å±äºç®€åŒ–ä»£ç çš„æ“ä½œï¼Œå¦‚æœå»æ‰è¿™éƒ¨åˆ†ä»£ç ï¼Œé‚£ä¹ˆåœ¨ testString çš„ get å’Œ set ä¸­ï¼Œä½¿ç”¨ self.storage[testStringProperty] ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¸å½±å“ä¸»è¦é€»è¾‘ã€‚ ","link":"https://blog.rakuyo.dev/epoxy-source-code-notes-2/"},{"title":"Github Actionï¼šåœ¨æ­¥éª¤ä¹‹é—´å…±äº«æ•°æ®","content":"Github Action å„ä¸ª Setp ä¹‹é—´æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å‡å¦‚æˆ‘ä»¬åœ¨ A Step ä¸­å®šä¹‰äº†ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œåœ¨æ¥ä¸‹æ¥çš„ Step ä¸­æ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚ é‚£ä¹ˆæ€ä¹ˆå…±äº«å‘¢ï¼Ÿåœ¨æœ€æ–°çš„ Github Action ä¸­ï¼Œå¯ä»¥é€šè¿‡ Environment files æ¥å®ç°ã€‚ Environment files å®ƒçš„åšæ³•æ˜¯é€šè¿‡ä¸€ä¸ªç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼Œåœ¨å„ä¸ªStepä¹‹é—´å…±äº«è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ã€‚ å®˜æ–¹çš„ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š steps: - name: Set the value id: step_one run: | echo &quot;action_state=yellow&quot; &gt;&gt; &quot;$GITHUB_ENV&quot; - name: Use the value id: step_two run: | printf '%s\\n' &quot;$action_state&quot; # This will output 'yellow' echo &quot;action_state=yellow&quot; &gt;&gt; &quot;$GITHUB_ENV&quot; è¿™æ®µå°±æ˜¯å…³é”®ä»£ç äº†ã€‚ è¢«æŠ›å¼ƒçš„ set-env å¦‚æœä½ åœ¨ Google ä¸Šæœç´¢è¿‡è¿™ä¸ªé—®é¢˜çš„è¯ï¼Œä½ å¯èƒ½ä¼šæœåˆ°è¿™ç¯‡æ–‡ç« ï¼šGitHub Actions ç¬¬15å¤©ï¼šåœ¨æ­¥éª¤ä¹‹é—´å…±äº«æ•°æ®ã€‚ è¿™ç¯‡æ–‡ç« ä¸­æåˆ°çš„ set-env æ–¹æ³•ï¼Œåœ¨åç»­çš„ Github Action ä¸­è¢«ç¦æ­¢ä½¿ç”¨äº†ï¼Œè¯¦è§å®˜æ–¹åšæ–‡ï¼šGitHub Actions: Deprecating set-env and add-path commands åœ¨æœ¬æ–‡æ’°å†™æ—¶ï¼Œå¦‚æœåœ¨ Github Action ä¸­æ²¡æœ‰ç»è¿‡ä»»ä½•é…ç½®åœ°å»ä½¿ç”¨ set-env çš„è¯ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼ŒStep æ‰§è¡Œå¤±è´¥ã€‚ â€œEnvironment filesâ€ çš„åšæ³•ä¹Ÿå¹¶ä¸éº»çƒ¦ï¼Œåè€Œè§‰å¾—æ¯” set-env ç®€å•å¾ˆå¤šï¼Œæ‰€ä»¥å°±ä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•å§ã€‚ ","link":"https://blog.rakuyo.dev/share-env-between-steps-in-github-action/"},{"title":"UIImage.size And CGImage.size","content":"è®°å½•ä¸€ä¸ªæœ€è¿‘å‘ç°çš„å°ç»†èŠ‚ï¼šUIImage.size å’Œ CGImage.size åœ¨ä¸€äº›æƒ…å†µä¸‹æ˜¯ä¸ç›¸ç­‰çš„ã€‚ å¦‚æœä½ çš„å›¾ç‰‡æ˜¯æ·»åŠ åˆ° Assets.xcassets å¹¶è®¾ç½®äº† 1xã€2x ç­‰ä¸åŒè§„æ ¼ï¼Œé‚£ä¹ˆ UIImage.size çš„å¤§å°å°†å§‹ç»ˆç­‰äº 1x æ—¶å€™çš„å°ºå¯¸ï¼Œä¸è®ºå½“å‰æœºå‹å®é™…ä½¿ç”¨äº†å“ªç§è§„æ ¼çš„å›¾ç‰‡ã€‚ è€Œ CGImage.size è¿”å›çš„åˆ™æ˜¯ UIImage.size * ImageScale ä¹‹åçš„ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœè¯¥å›¾ç‰‡æ˜¯ 2x å›¾ï¼Œé‚£ä¹ˆ CGImage.size å°±ä¼šæ˜¯ UIImage.size çš„äºŒå€ã€‚ è¿™ä¸€é—®é¢˜åœ¨ä½¿ç”¨ CGImage ç”»å›¾ä¼šæš´éœ²å‡ºæ¥ï¼Œå¾ˆå¤šæ—¶å€™ä¼šä½¿ç”¨ UIImage.size æˆ–è€… UIImageView.size è®¾ç½®ç”»å¸ƒï¼Œç„¶è€Œå› ä¸ºå¿½ç•¥äº† CGImage.sizeï¼Œå°±ä¼šå¯¼è‡´ç”»å‡ºæ¥çš„å›¾ç‰‡å°ºå¯¸åå¤§ï¼Œå‡ºç°æ˜¾ç¤ºçš„å›¾ç‰‡è¢«å‰ªè£çš„é—®é¢˜ã€‚ ","link":"https://blog.rakuyo.dev/uiimage-size-and-cgimage-size/"},{"title":"åŠ é€Ÿ git submodule","content":"iOS ä¸­æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹æ•°æ®åº“å°è£…ï¼šGRDBã€‚è¯¥ç»„ä»¶ä½¿ç”¨äº† git submodule æ¥ä¾èµ– SQLiteLibã€‚ è¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘ä»¬åªä½¿ç”¨ä¹‹å‰ä»‹ç»è¿‡çš„ è®¾ç½® SPM Mirrorï¼Œé‚£ä¹ˆè¿™ä¸ªå­æ¨¡å—å°±ä¼šæ˜¯ä¸€ä¸ªæ¼ç½‘ä¹‹é±¼ã€‚ é‚£ä¹ˆæ€ä¹ˆä¸ºè¿™ä¸ªå­æ¨¡å—è®¾ç½®é•œåƒå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git config --global url.[New].insteadOf [Old] å‘½ä»¤æ¥æ›¿æ¢ url ä¸­çš„æŸä¸ªéƒ¨åˆ†ã€‚å¯ä»¥å‚è€ƒï¼šEasier Git Repository Cloning with insteadOf --global å‚æ•°æ˜¯å¿…é¡»çš„ï¼Œspm çš„åŠ è½½è¯»å–çš„æ˜¯ ~/.gitconfig æ–‡ä»¶ï¼Œä¸ä¼šè¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ .git/config æ–‡ä»¶ã€‚æ‰€ä»¥è¿™ä¸ªæ›¿æ¢å¿…é¡»è®¾ç½®ä¸ºå…¨å±€æ›¿æ¢çš„ã€‚ New æ˜¯é•œåƒ urlï¼Œè€Œ Old æ˜¯ github urlï¼Œè®¾ç½®åæˆ‘ä»¬å¯ä»¥é€šè¿‡ git config --global -l æˆ–è€… git config --global -e å‘½ä»¤æ¥æŸ¥çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸã€‚ è®¾ç½®æˆåŠŸåä¸è®ºæ˜¯æ‰§è¡Œ git clone æˆ–è€… git submodule update --initï¼Œéƒ½ä¼šé€šè¿‡é•œåƒ url å»æ‰§è¡Œäº†ã€‚ å¦‚æœä½ æƒ³åœ¨å›¢é˜Ÿé¡¹ç›®ä¸­å…±äº«è¿™ä»½é…ç½®ï¼Œé‚£ä¹ˆå¯ä»¥å°†åœ°å€å­˜å‚¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚åƒä¸‹é¢è¿™æ ·ï¼š # .gitconfig-insteadof [url &quot;https://github.com/swiftlyfalling/SQLiteLib.git&quot;] insteadOf = https://your-organize-git/SQLiteLib.git ç„¶åé€šè¿‡ git config --global include.path .gitconfig-insteadof å°†è¿™ä¸ªé…ç½®æ–‡ä»¶æ·»åŠ åˆ° ~/.gitconfig æ–‡ä»¶ä¸­å³å¯ã€‚ æ·»åŠ å ~/.gitconfig å†…å®¹ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š ... [include] path = /Users/.../project/.gitconfig-insteadof ","link":"https://blog.rakuyo.dev/speed-up-git-submodule/"},{"title":"æå–ipaæ–‡ä»¶","content":"æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³è¦çœ‹çœ‹æŸä¸ª App çš„èµ„æºæ–‡ä»¶ï¼Œæˆ–è€…å•çº¯çœ‹çœ‹å®ƒå¼•ç”¨äº†å“ªäº›ä¸‰æ–¹åº“ç­‰ã€‚è¿™äº›å†…å®¹åªè¦æœ‰ä¸€ä¸ª ipa æ–‡ä»¶å°±å¯ä»¥çœ‹ï¼Œä¹Ÿæ— éœ€ç ¸å£³ã€‚ æœ¬æ–‡å°±è®°å½•ä¸€ä¸‹å¦‚ä½•ç®€å•çš„æå–æ‰‹æœºä¸­ App çš„ ipa æ–‡ä»¶ã€‚ é¦–å…ˆç¡®ä¿æ‰‹æœºä¸Šå·²ç»å®‰è£…äº†è¯¥ appã€‚ éšååœ¨ mac ä¸Šä¸‹è½½ Apple çš„å®˜æ–¹è½¯ä»¶ Apple Configurator å®‰è£…åæ‰“å¼€ï¼Œæ‰‹æœºè¿æ¥Macåä¼šåœ¨è½¯ä»¶ä¸Šæ˜¾ç¤ºå½“å‰è®¾å¤‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š é€‰ä¸­è®¾å¤‡ï¼Œéšåç‚¹å‡»å³ä¸Šè§’çš„ â€œæ·»åŠ â€ æŒ‰é’®ï¼Œé€‰æ‹© Appï¼š åœ¨å¼¹å‡ºçš„åˆ—è¡¨ä¸­é€‰æ‹©è¦æå– ipa çš„ Appï¼Œéšåç‚¹å‡» â€œæ·»åŠ â€ æŒ‰é’®ï¼š è¿™ä¸€æ­¥æœ‰å¯èƒ½ä¼šæç¤ºä½ è¦ç™»é™† Apple IDã€‚å‡ºç°è¿™ç§æƒ…å†µè¦ä¹ˆæ˜¯ä½ çš„ Mac æ²¡æœ‰ç™»å½•ï¼Œè¦ä¹ˆæ˜¯ä½ çš„æ‰‹æœºå’Œ Mac ç™»å½•çš„ä¸æ˜¯åŒä¸€ä¸ª IDã€‚æŒ‰ç…§æç¤ºç™»å½•å³å¯ã€‚ å› ä¸ºæˆ‘ä»¬çš„æ‰‹æœºä¸Šå·²ç»å®‰è£…äº†è¯¥ appï¼Œæ‰€ä»¥ Apple Configurator è‚¯å®šæ˜¯è£…ä¸ä¸Šçš„ï¼Œä¼šå¼¹å‡ºä¸‹é¢çš„å¼¹çª—ï¼š æ­¤æ—¶ä¸è¦æ“ä½œ Apple Configuratorï¼æ‰“å¼€ Finder è®¿è¾¾ Appï¼Œä½¿ç”¨å¿«æ·é”® Command + Shift + G æ‰“å¼€è·³è½¬å¼¹çª—ï¼Œåœ¨å¼¹çª—ä¸­è¾“å…¥ä¸‹é¢çš„è·¯å¾„ï¼š ~/Library/Group Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps/ è¿›åˆ°è·¯å¾„ä¸‹ï¼Œä¸€å±‚å±‚ç‚¹åˆ°æœ€é‡Œé¢ï¼Œå°±å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ ipa åŒ…äº†ï¼š Apple Configurator å¼¹çª—å…³é—­åï¼Œè¯¥ ipa å°±ä¼šè‡ªåŠ¨åˆ é™¤ã€‚æ‰€ä»¥è¯·åœ¨å…³é—­è½¯ä»¶ä¹‹å‰å°† ipa æ‹·è´å‡ºæ¥ã€‚ ","link":"https://blog.rakuyo.dev/extract-ipa-file/"},{"title":"Tuist æ³¨æ„äº‹é¡¹","content":"æœ€è¿‘åœ¨å­¦ä¹ ä½¿ç”¨ Tuist ç”Ÿæˆé¡¹ç›®ï¼Œæ‘†è„±çƒ¦äººçš„ .xcodeprojã€‚ä½†æ˜¯ Tuist å¥½ç”¨è™½ç„¶å¥½ç”¨ï¼Œä½†æ˜¯å› ä¸ºæœ€è¿‘æ–‡æ¡£æ­£åœ¨è¿ç§»ï¼ŒåŠ ä¹‹ä¸€äº›ä¸œè¥¿åªèƒ½ä»ç¤ºä¾‹ä¸­å‘æ˜ï¼Œæ•´ä¸ªå­¦ä¹ è¿‡ç¨‹æœ‰ç‚¹è´¹åŠ²ã€‚æ‰€ä»¥å¼€ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ã€‚ UIKit æ¨¡ç‰ˆ åœ¨æœ‰çš„åœ°æ–¹ä½ å¯ä»¥çœ‹åˆ° â€œé€šè¿‡ tuist init --template swiftui åˆ›å»º SwiftUI é¡¹ç›®â€ã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ˜¯åˆ›å»º UIKit é¡¹ç›®ã€‚ ä½†æ˜¯ï¼UIKit çš„æ¨¡æ¿å·²ç»åœ¨è¿™ä¸ª PR ä¸­è¢«åˆ é™¤ç²¾ç®€æ‰ï¼Œå¹¶è·Ÿéš 4.0.0 ç‰ˆæœ¬ä¸€èµ·å‘å¸ƒäº†ã€‚æ‰€ä»¥å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ 4.0+ ç‰ˆæœ¬çš„ Tuistï¼Œé‚£ä¹ˆæ‰§è¡Œ init æ“ä½œåé»˜è®¤ç”Ÿæˆçš„å°±æ˜¯ SwiftUI é¡¹ç›®äº†ã€‚ å®˜æ–¹è®¤ä¸ºå¤§å¤šæ•°äººå·²ç»è¿ç§»åˆ°SwiftUIäº†... æ‰€ä»¥å¦‚æœä½ æƒ³åˆ›å»º UIKit é¡¹ç›®ï¼Œé‚£ä¹ˆä½ æœ‰ä¸¤ç§ï¼ˆæˆ–è€…æ›´å¤šï¼‰é€‰æ‹©ï¼š æ‰‹åŠ¨æŠŠ UIKit æ¨¡æ¿ä»è¯¥ PR ä¸­æ‰¾å›æ¥ã€‚ æ¯åˆ›å»ºä¸€ä¸ªé¡¹ç›®éƒ½æ‰‹åŠ¨ä¿®æ”¹ä¸€ä¸‹ Info.plist ä»¥åŠæ·»åŠ  AppDelegate ç­‰æ–‡ä»¶ã€‚ å› ä¸ºæˆ‘æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæ‰€ä»¥æ˜¯æ‰‹åŠ¨æ·»åŠ çš„ç›¸å…³æ–‡ä»¶ã€‚ å¦‚æœé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼šè§£å†³ä»SwiftUIè¿å›UIKitæ—¶ï¼ŒSceneDelegateä¸æ‰§è¡Œçš„é—®é¢˜ã€‚ä¹‹å‰å·²ç»ä¸ºè¿™ä¸ªé—®é¢˜å•ç‹¬å‘è¿‡ä¸€ç‰‡æ–‡ç« äº†ï¼Œè¿™é‡Œå†é‡å¤æä¸€ä¸‹ã€‚ èµ„æºç”Ÿæˆ Tuist é›†æˆäº† SwiftGen æ¥å®ç°èµ„æºç”Ÿæˆï¼Œæ‰€ä»¥ SwiftGen çš„æ¨¡æ¿å¯ä»¥ç›´æ¥æ‹¿åˆ° Tuist é‡Œä½¿ç”¨ã€‚ Tuist çš„é»˜è®¤æ¨¡å—åœ¨è¿™é‡Œï¼šTemplatesã€‚ ä»¥æ–‡ä»¶èµ„æºçš„ç”Ÿæˆä¸ºä¾‹ï¼Œè¿™ä¸ªé»˜è®¤æ¨¡æ¿ å’Œ SwiftGen çš„ structured-swift5.stencil æ¨¡æ¿å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯å¤šäº†ä¸€äº› SwiftFormat å’Œ SwiftLint çš„å†…å®¹ã€‚ ä¸åŒ…å«ç›®å½•å±‚çº§ SwiftGen å¯¹äºä¸€ç§èµ„æºæœ‰å¤šä¸ªé»˜è®¤æ¨¡ç‰ˆï¼Œæ¯”å¦‚æ–‡ä»¶èµ„æºè¿˜æœ‰ flat-swift5.stencil è¿™ä¸ªä¸åŒ…å«æ–‡ä»¶å¤¹å±‚çº§çš„æ¨¡ç‰ˆã€‚å•ç‹¬ä½¿ç”¨ SwiftGen çš„è¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ --templateName å‚æ•°æ¥ä½¿ç”¨è¯¥æ¨¡æ¿ï¼Œä½†æ˜¯ Tuist é‡Œæ¯ç§ç±»å‹çš„èµ„æºåªæœ‰ä¸€ç§æ¨¡æ¿ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³ç”Ÿæˆçš„èµ„æºä¸åŒ…å«æ–‡ä»¶å¤¹ç›®å½•å±‚çº§ï¼Œåªèƒ½å‚è€ƒTuistå®˜æ–¹æ–‡æ¡£çš„å†…å®¹è‡ªå®šä¹‰æ¨¡æ¿ï¼š If you want to provide your own templates to synthesize accessors to other resource types, which must be supported by SwiftGen, you can create them at Tuist/ResourceSynthesizers/{name}.stencil, where the name is the camel-case version of the resource. Resource Template name strings Strings.stencil assets Assets.stencil plists Plists.stencil fonts Fonts.stencil coreData CoreData.stencil interfaceBuilder InterfaceBuilder.stencil json JSON.stencil yaml YAML.stencil files Files.stencil æ³¨æ„ï¼Œå®˜æ–¹çš„è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯æ›¿æ¢äº†é»˜è®¤å®ç°ï¼Œç›¸å…³ä»£ç åº”è¯¥æ˜¯è¿™é‡Œã€‚ å¦‚æœä½ ä¸æƒ³è¦†ç›–é»˜è®¤å®ç°ï¼Œæƒ³è¦è‡ªå®šä¹‰ä¸€ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥å‚è€ƒapp_with_pluginsè¿™ä¸ªç¤ºä¾‹ã€‚ è‡ªå®šä¹‰è§£æç±»å‹ æ–‡æ¡£æœ€åçš„éƒ¨åˆ†æœ‰æåˆ°ï¼Œå¯ä»¥é€šè¿‡ Project.resourceSynthesizers å±æ€§æ¥è®¾ç½®æœ¬é¡¹ç›®è‡ªåŠ¨ä¸ºå“ªäº›ç±»å‹çš„èµ„æºç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚ è¿™ä¸ªå±æ€§æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œå…¶é»˜è®¤å€¼å®šä¹‰åœ¨è¿™é‡Œï¼š extension [ResourceSynthesizer] { public static var `default`: Self { [ .strings(), .assets(), .plists(), .fonts(), ] } } å¯è§ä½¿ç”¨çš„æ˜¯é»˜è®¤æ¨¡æ¿ï¼Œè€Œä¸”ä¸åŒ…å« .filesã€‚å¦‚æœæœ‰éœ€è¦çš„è¯åˆ™éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚ ç¦ç”¨èµ„æºç”Ÿæˆ è™½ç„¶ä½ å¤§æ¦‚ç‡ä¸éœ€è¦ï¼Œä¸è¿‡è¿˜æ˜¯æä¸€å˜´ã€‚æ–‡æ¡£ä¸­ä¹Ÿæœ‰è¯´æ˜ï¼Œé‚£å°±æ˜¯å¯ä»¥é€šè¿‡è®¾ç½® Project.Options.disableSynthesizedResourceAccessors å±æ€§ï¼Œæ¥ç¦ç”¨èµ„æºçš„è‡ªåŠ¨ç”Ÿæˆã€‚ ç»„ä»¶åŒ– Tuist åº”è¯¥æ˜¯å®æ–½ç»„ä»¶åŒ–çš„å¥½æ‰‹ã€‚ ç›®å½•ç»“æ„ é¦–å…ˆè®©æˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œè¿™å…³ç³»åˆ°æˆ‘ä»¬å¦‚ä½•ç»„ç»‡ä¸»é¡¹ç›®å’Œå„ä¸ªç»„ä»¶ã€‚ åœ¨å®˜æ–¹æ–‡æ¡£é‡Œæˆ‘ä»¬èƒ½çœ‹åˆ°å¦‚ä¸‹ç›®å½•ç»“æ„ï¼š Tuist/ Config.swift Package.swift ProjectDescriptionHelpers/ Projects/ App/ Project.swift Feature/ Project.swift Workspace.swift Tuist æ–‡ä»¶å¤¹æ˜¯ Tuist çš„ä¸€äº›é…ç½®ï¼ŒWorkspace.swift ç”¨æ¥åŒ…å«å„ä¸ª Projectsã€‚ ä½†æ˜¯å¦‚æœä½ ä»”ç»†ç¿»çœ‹è¿‡ä»–ä»¬çš„ç¤ºä¾‹çš„è¯ï¼Œæ¯”å¦‚ ios_app_with_static_frameworks å’Œ ios_app_with_framework_and_resourcesï¼Œå°±ä¼šå‘ç°å…¶å®æ ¹ç›®å½•ä¸‹çš„å†…å®¹æ˜¯å¤šå˜çš„ã€‚ å¦‚æœä½ è·Ÿæˆ‘ä¸€æ ·å¥½å¥‡ â€œä»€ä¹ˆæ˜¯æœ€ä½³å®è·µâ€ï¼Œå¯ä»¥çœ‹è¿™ä¸ªè®¨è®ºã€‚ç„¶åç»“è®ºå°±æ˜¯ï¼šæ²¡æœ‰ä»€ä¹ˆæœ€ä½³å®è·µï¼Œå®Œå…¨å–å†³äºä½ çš„ä¸ªäººç”¨æ³•å’Œä¹ æƒ¯ã€‚ Tuist çœŸçš„éå¸¸çµæ´»ï¼Œæä¾›äº†å¾ˆå¤šä¾¿æ·çš„å†™æ³•ï¼Œä¸åŒäººç”¨ Tuist ä¼šå†™å‡ºä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¼šæœ‰ä¸åŒçš„ç”¨æ³•ã€‚ Tuist vs SPM å¯¹ç›®å½•ç»“æ„æœ‰äº†ä¸€äº›æ¦‚å¿µä¹‹åï¼Œå°±è¯¥è€ƒè™‘å¦‚ä½•ç»„ç»‡å„ä¸ªç»„ä»¶äº†ã€‚ å®˜æ–¹æ–‡æ¡£é‡Œæœ‰ä¸€ç¯‡æ–‡ç« ï¼šMigrate local Swift Packages è®²çš„æ˜¯å¦‚ä½•å°†æœ¬åœ°çš„ SPM ç»„ä»¶è¿ç§»åˆ° Tuistï¼Œæ”¹ä¸ºä½¿ç”¨ Tuist ç®¡ç†ã€‚ å›½å¤–åº”è¯¥æ˜¯å·²ç»æ²¡æœ‰ä»€ä¹ˆäººç”¨ CocoaPods åšç»„ä»¶åŒ–ç®¡ç†äº†ï¼Ÿ... è¿™é‡Œæˆ‘ä¹Ÿæ¨èä½¿ç”¨ Tuist + Multiple Projects æ¥åšå­ç»„ä»¶ã€‚é¦–å…ˆ SPM è¦æ¯” CocoaPods æ›´ç°ä»£æ›´å®˜æ–¹ï¼Œä½†æ˜¯ SPM æœ¬èº«æœ‰æ€§èƒ½é—®é¢˜ï¼Œå†åŠ ä¸Šå›½å†…è®¿é—®é—®é¢˜ï¼Œæ‰€ä»¥çœŸè¦å®é™…ç”¨èµ·æ¥å¾ˆéº»çƒ¦ã€‚å¦å¤–ä½¿ç”¨ Tuist æ¥ç®¡ç†é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨è‡ªå¸¦çš„ SwiftGenï¼Œä¸ç”¨å†åœ¨ SPM é‡Œè¿›è¡Œç›¸å…³é…ç½®ã€‚æœ€åä¸å¾—ä¸æçš„æ˜¯ï¼Œç”¨ Tuist åŠ è½½ä¾èµ–æ˜¯çœŸçš„å¿«... å•ç‹¬è¿è¡Œç»„ä»¶ æˆ‘ä¸ªäººå¯¹ç»„ä»¶åŒ–çš„æ ‡å‡†æ˜¯æ¯ä¸ªå­ç»„ä»¶åº”è¯¥éƒ½èƒ½ç‹¬ç«‹ç¼–è¯‘ï¼Œè¿›ä¸€æ­¥èƒ½ç‹¬ç«‹è¿è¡Œã€‚åŸºäºè¿™ä¸ªæ ‡å‡†çš„è¯ï¼Œä¼šæœ‰ä¸€äº›é—®é¢˜ã€‚ å–„ç”¨è½¯é“¾æ¥ é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ Tuist/ProjectDescriptionHelpers æ˜¯ä¸èƒ½è¢«å­é¡¹ç›®è¯»å–çš„ï¼Œæ¯”å¦‚å‰æ–‡æåˆ°çš„ç›®å½•ç»“æ„ä¸­ï¼š Tuist/ Config.swift Package.swift ProjectDescriptionHelpers/ Projects/ App/ Project.swift Feature/ Project.swift Tuist/ Config.swift Package.swift Workspace.swift åœ¨ Projects/Feature ä¸­æ‰§è¡Œ tuist generate å‘½ä»¤æ—¶ï¼Œæ˜¯è¯»å–ä¸åˆ°æ ¹ç›®å½•ä¸­ Tuist/ProjectDescriptionHelpers é‡Œçš„å…¬å…±æ–¹æ³•çš„ã€‚ ä¸€ä¸ªå¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨è½¯é“¾æ¥ï¼Œå°† ProjectDescriptionHelpers æ–‡ä»¶å¤¹è½¯é“¾åˆ° Projects/Feature/Tuist é‡Œã€‚ åŒç† Tuist/.swiftpm/configuration/mirrors.json æ–‡ä»¶ä¹Ÿå¯ä»¥è¿™ä¹ˆåšã€‚ æ˜¯å¦éœ€è¦å¤šä¸ª Config.swift ç»è¿‡è¿›ä¸€æ­¥å®è·µï¼Œä»¥åŠç›¸å…³ è®¨è®ºï¼Œå‘ç°å…¶å®ä¸å»ºè®® æœ‰å¤šä¸ª Config.swift æ–‡ä»¶ã€‚æ‰€ä»¥ Feature/Tuist/Config.swift æ–‡ä»¶åº”è¯¥æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚ æˆ‘ç°åœ¨ä½¿ç”¨çš„ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š Tuist/ Config.swift Package.swift ProjectDescriptionHelpers/ Projects/ App/ Project.swift Components/ FeatureA/ Project.swift FeatureB/ Project.swift Workspace.swift ä¹Ÿå°±æ˜¯è¯´å„ä¸ªç»„ä»¶å†…å®Œå…¨æ²¡æœ‰ Tuist æ–‡ä»¶å¤¹ï¼ˆä¾èµ–éƒ¨åˆ†åœ¨ Tuist/ProjectDescriptionHelpers è¿›è¡Œäº†å°è£…ï¼‰ è¿™æ—¶å‡å¦‚æˆ‘ä»¬åœ¨ Projects/Components/FeatureA ç›®å½•ä¸‹æ‰§è¡Œ tuist generateï¼Œå…¶å®è¯»å–çš„æ˜¯æ ¹ç›®å½•ä¸­ Tuist çš„é…ç½®ï¼Œç”Ÿæˆçš„æ˜¯ App é¡¹ç›®è€Œä¸æ˜¯ç»„ä»¶é¡¹ç›®ã€‚ è¿™ä¸ªæ—¶å€™è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³ â€œç»„ä»¶ç‹¬ç«‹è¿è¡Œâ€ çš„ï¼Œå› ä¸ºç°åœ¨è¿™ä¸ªç»„ä»¶ç®—æ˜¯ä¸€ä¸ª libï¼Œæ²¡æœ‰å‰ç«¯ AppDelegate ç­‰ç›¸åº”å…¥å£å»è¿è¡Œ Appã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦æ”¹æˆè¿™ç§æ–¹å¼å‘¢ï¼Ÿä¸€æ˜¯åŸºäºå®˜æ–¹æ¨èçš„ä¸è¦ä½¿ç”¨å¤šä¸ª Config.swift çš„å»ºè®®ï¼›äºŒæ˜¯å’Œç¾¤å‹è®¨è®ºåï¼Œå‘ç°ä¸€èˆ¬æµ‹è¯•ä¸€ä¸ª lib æ—¶ä¼šå•ç‹¬å»ºä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œæ¯”å¦‚ FeatureATestï¼Œè¯¥æµ‹è¯•é¡¹ç›®ä¸åœ¨ FeatureA ä¸‹ï¼›ä¸‰æ˜¯ç†æƒ³å¾ˆä¸°æ»¡ç°å®å¾ˆéª¨å¹²ï¼Œè¯æ˜¯è¿™ä¹ˆè¯´ï¼Œä½†æ˜¯å®é™…ä¸Šå‡ ä¹ä¸ä¼šå•ç‹¬è¿è¡ŒæŸä¸ª libã€‚ æ‰€ä»¥åŸºäºä»¥ä¸Šä¸‰ä¸ªç†ç”±ï¼Œå¦‚æœæœªæ¥éœ€è¦å•ç‹¬æµ‹è¯•æŸä¸ª libï¼Œé‚£ä¹ˆæœ€ä½³å®è·µåº”è¯¥æ˜¯æ–°å»ºä¸€ä¸ªç›¸å…³çš„ Test é¡¹ç›®ã€‚ ","link":"https://blog.rakuyo.dev/tuist-notes/"},{"title":"è§£å†³ä»SwiftUIè¿å›UIKitæ—¶ï¼ŒSceneDelegateä¸æ‰§è¡Œçš„é—®é¢˜","content":"æœ€è¿‘åœ¨ç ”ç©¶ Tuistï¼Œä¸€ä¸ªç”¨æ¥ç®¡ç† Xcode é¡¹ç›®çš„å·¥å…·ã€‚è¿™ä¸ªå·¥å…·å¥½åƒä» 4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œåˆ›å»ºæ–°é¡¹ç›®é»˜è®¤å°±æ˜¯ SwiftUI æ¨¡ç‰ˆäº†ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨å†ä» SwiftUI æ”¹å› UIKitã€‚ åœ¨æ”¹åŠ¨è¿‡ç¨‹ä¸­å‘ç° SceneDelegate ä¸æ‰§è¡Œï¼Œæœç´¢äº†ä¸€ç•ªåæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚ å…·ä½“çš„æ”¹åŠ¨æ–¹æ³•å’Œæµç¨‹å¯ä»¥å‚è€ƒï¼šHow to migrate from SwiftUI to UIKit App Delegate Life Cycle in Xcode è§£å†³æ–¹æ¡ˆå‡ºè‡ªè¿™é‡Œï¼šApp migrated to UIKit lifecycle doesn't call SceneDelegate æ’ä¸€å˜´ï¼ŒçœŸæ²¡æƒ³åˆ°è¿˜ä¼šæœ‰å…¶ä»–äººä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜... å¦‚ä¸Šè¿°é—®é¢˜é‡Œæ‰€è®²çš„é‚£æ ·ï¼Œè¿™ä¸ª bug çš„æ ¹æœ¬é—®é¢˜å¯èƒ½æ˜¯ï¼š do not turn off support multiple windows. It seems that disabling multiple windows prevents UIKit from launching a new scene when the previous scene is no longer available. ä¹Ÿå°±æ˜¯è¯´ SwiftUI çš„ @main å…¥å£æ²¡äº†ï¼ŒåŒæ—¶å› ä¸ºä¸æ”¯æŒå¤šçª—å£ï¼Œæ‰€ä»¥å¯¼è‡´åœ¨å½“å‰åœºæ™¯ä¸å¯ç”¨æ—¶ï¼Œæ— æ³•åˆ›å»º SceneDelegate çš„æ–°åœºæ™¯ã€‚ è§£å†³æ–¹æ¡ˆé™¤äº†æŠŠè®¾å¤‡ä¸Šçš„ app åˆ é™¤é‡æ–°å®‰è£…ä¹‹å¤–ï¼Œè¿˜å¯ä»¥æŠŠ Info.plist ä¸­çš„ scene configurations manifest åˆ é™¤ï¼Œç„¶åæ‰‹åŠ¨åˆ›å»ºå®ƒï¼š class AppDelegate: NSObject, UIApplicationDelegate { func application(_ application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions) -&gt; UISceneConfiguration { let configuration = UISceneConfiguration(name: nil, sessionRole: connectingSceneSession.role) if connectingSceneSession.role == .windowApplication { configuration.delegateClass = SceneDelegate.self } return configuration } } æ³¨æ„ï¼Œå¦‚æœä¸åˆ é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ä¸ä¼šè°ƒç”¨çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ é™¤ç„¶åæ‰‹åŠ¨åˆ›å»ºã€‚ æœ€ååæ§½ä¸€ä¸‹ï¼ŒçœŸçš„æ²¡æƒ³åˆ° iOS å°±è¿è¿™ä¸ªä¹Ÿä¼šæœ‰ç±»ä¼¼ â€œç¼“å­˜â€ çš„é—®é¢˜... æƒ³åˆ°äº† LaunchScreen ... ","link":"https://blog.rakuyo.dev/jie-jue-cong-swiftui-qian-hui-uikit-shi-scenedelegate-bu-zhi-xing-de-wen-ti/"},{"title":"CSSé€‰æ‹©å™¨","content":"CSS æœ‰å¤šç§é€‰æ‹©å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬é’ˆå¯¹ä¸åŒçš„ HTML æ ‡ç­¾è®¾ç½®æ ·å¼ã€‚ é€‰æ‹©å™¨ é€šé…ç¬¦é€‰æ‹©å™¨ é€šé…ç¬¦é€‰æ‹©å™¨ï¼ˆ*ï¼‰å¯ä»¥é€‰æ‹©ä»»ä½•å…ƒç´ ï¼Œé€šå¸¸ç”¨äºè®¾ç½®é»˜è®¤æ ·å¼ã€‚ * { margin: 0; padding: 0; } ç±»å‹é€‰æ‹©å™¨ ç±»å‹é€‰æ‹©å™¨ï¼ˆType Selectorsï¼‰ç›´æ¥ä½¿ç”¨ HTML æ ‡ç­¾æ¥é€‰æ‹©é€‰æ‹©å…ƒç´ ï¼š p { color: blue; } ä¸Šé¢çš„ä»£ç å°†æ‰€æœ‰çš„ &lt;p&gt; æ ‡ç­¾æ–‡æœ¬æ¸²æŸ“ä¸ºè“è‰²ã€‚ class é€‰æ‹©å™¨ ä¸ªäººç†è§£ class é€‰æ‹©å™¨ä»£è¡¨ç€ â€œä¸€ç±»æœ‰ç€ç›¸åŒæ ·å¼çš„æ ‡ç­¾â€ï¼Œæ‰€ä»¥è¯¥é€‰æ‹©å™¨å¯ä»¥ç”¨äºå¤šä¸ª HTML æ ‡ç­¾ã€‚ ç±»é€‰æ‹©å™¨ä½¿ç”¨ . å¼€å¤´ï¼Œåæ¥ç±»åï¼š &lt;style&gt; .first { font-weight: bold; text-decoration: line-through; } &lt;/style&gt; &lt;p class=&quot;first&quot;&gt;è¶…è¶ŠæŠ€æœ¯&lt;/p&gt; &lt;div&gt;å“ˆå“ˆ.&lt;/div&gt; &lt;p&gt;ä¸€èµ·å­¦å‰ç«¯!&lt;/p&gt; ä¸€ä¸ªæ ‡ç­¾ä¹Ÿå¯ä»¥åŒ…å«å¤šä¸ª classï¼Œå¤šä¸ª class ä¹‹é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ï¼š &lt;!-- åŒ…å«ä¸¤ä¸ª classï¼šinfo å’Œ highlight --&gt; &lt;p class=&quot;info highlight&quot;&gt;...&lt;/p&gt; æ­¤å¤–ï¼Œå½“ä½ åœ¨ä¸åŒçš„ HTML æ ‡ç­¾ä¸­ä½¿ç”¨äº†ç›¸åŒçš„ classï¼Œç„¶åè¿˜æƒ³é€‰æ‹©æŸä¸ªå…·ä½“çš„æ ‡ç­¾æ—¶ï¼Œä½ å¯ä»¥åƒä¸‹é¢è¿™æ ·ç»„åˆä½¿ç”¨ä¸¤ä¸ªé€‰æ‹©å™¨ï¼š &lt;style&gt; p.first { color: red; } &lt;/style&gt; &lt;p class=&quot;first&quot;&gt;è¯¥é¢œè‰²ä¼šæ˜¯çº¢è‰²&lt;/p&gt; &lt;span class=&quot;first&quot;&gt;è¯¥é¢œè‰²ä¸ä¼šæ˜¯çº¢è‰²&lt;/span&gt; id é€‰æ‹©å™¨ ä¸ªäººç†è§£è¿™é‡Œçš„ id åœ¨ä½¿ç”¨åœºæ™¯ä¸Šå°±å’Œæ•°æ®åº“ä¸­çš„ä¸»é”®ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥å®šä½æŸä¸ªå”¯ä¸€çš„ HTML æ ‡ç­¾ï¼Œæ‰€ä»¥è¯¥é€‰æ‹©å™¨æˆ–è€…è¯´ id å±æ€§çš„å€¼ï¼Œåœ¨ HTML æ–‡æ¡£ä¸­éœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œä¸èƒ½å‡ºç°åœ¨å¤šä¸ªå…ƒç´ ä¸Šã€‚ id é€‰æ‹©å™¨ä½¿ç”¨ # å·æ¥å®šä¹‰ï¼š &lt;style&gt; #my-id { background-color: yellow; } &lt;/style&gt; &lt;p id=&quot;my-id&quot;&gt;è¶…è¶ŠæŠ€æœ¯&lt;/p&gt; &lt;div&gt;å“ˆå“ˆ.&lt;/div&gt; &lt;p&gt;ä¸€èµ·å­¦å‰ç«¯!&lt;/p&gt; å› ä¸º id é€‰æ‹©å™¨çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥å°±æ²¡å¿…è¦åƒä¸Šé¢æåˆ°çš„ class é€‰æ‹©å™¨ä¸€æ ·ï¼Œé€šè¿‡æ ‡ç­¾å†è¿›ä¸€æ­¥ç¼©å°é€‰æ‹©èŒƒå›´äº†ã€‚ å±æ€§é€‰æ‹©å™¨ æˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥åœ¨ html æ ‡ç­¾ä¸Šè‡ªå®šä¹‰ä»»æ„çš„å±æ€§ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š &lt;!-- `data-rakuyo` ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºå®ƒä¸æ˜æ‰€ä»¥ï¼› ä½†æ˜¯å®ƒåˆå¾ˆå¥½ï¼Œå¯ä»¥ä¸€çœ¼è®©ä½ çœ‹å‡ºå®ƒæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ã€‚ --&gt; &lt;div data-rakuyo&gt;...&lt;/div&gt; å±æ€§é€‰æ‹©å™¨ä½¿ç”¨ [] ä¸­æ‹¬å·åŒ…è£¹å±æ€§åç§°ã€‚é’ˆå¯¹ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§é€‰æ‹©å™¨æ¥é€‰æ‹©è¯¥ div æ ‡ç­¾ï¼š /* é€‰æ‹©æ‰€æœ‰å¸¦æœ‰ `data-rakuyo` å±æ€§çš„å…ƒç´ ï¼Œä¸è®ºå…¶æ‰€å±å“ªä¸ª html æ ‡ç­¾ */ [data-rakuyo] { font-weight: bold; } å†è¿›ä¸€æ­¥ç¼©å°èŒƒå›´ï¼Œå±æ€§é€‰æ‹©å™¨å¯ä»¥é€šè¿‡æŒ‡å®šæ ‡ç­¾æ¥ç­›é€‰ â€œå…·æœ‰æŸäº›å±æ€§çš„æ ‡ç­¾â€ï¼š /* ä»…é™å¸¦æœ‰ `data-style` å±æ€§çš„ &lt;button&gt; æ ‡ç­¾ */ button[data-style] { font-weight: bold; } å¯ä»¥é€šè¿‡å…·ä½“çš„å±æ€§å€¼æ¥åšæ¡ä»¶ç­›é€‰ï¼š &lt;style&gt; [data-style=&quot;cancel&quot;] { color: gray; } [data-style=&quot;done&quot;] { color: black; } &lt;/style&gt; &lt;button data-style=&quot;cancel&quot;&gt;å–æ¶ˆ&lt;/button&gt; &lt;button data-style=&quot;done&quot;&gt;ä¸‹å•&lt;/button&gt; å±æ€§é€‰æ‹©å™¨è¿˜å¯ä»¥å€ŸåŠ©ä¸€äº›åŒ¹é…æ“ä½œç¬¦ï¼Œæ¯”å¦‚ $= å’Œ *= æ¥å®ç°ç‰¹å®šçš„åŠŸèƒ½ï¼š /* é€‰æ‹© `src` å±æ€§ä»¥ `https` å¼€å¤´çš„æ‰€æœ‰å›¾ç‰‡ */ img[src^=&quot;https&quot;] { color: red; } /* é€‰æ‹© `src` å±æ€§ä»¥ `.jpg` ç»“å°¾çš„æ‰€æœ‰å›¾ç‰‡ */ img[src$=&quot;.jpg&quot;] { border: 3px solid black; } /* é€‰æ‹© `href` å±æ€§åŒ…å« `external` *å­—ç¬¦ä¸²* çš„æ‰€æœ‰é“¾æ¥ */ a[href*=&quot;external&quot;] { color: green; } /* é€‰æ‹© `href` å±æ€§åŒ…å« `external` *å•è¯* çš„æ‰€æœ‰é“¾æ¥ */ a[href~=&quot;external&quot;] { color: green; } æ³¨æ„ *= å’Œ ~= çš„åŒºåˆ«ã€‚å‰è€…åŒ¹é…å­—ç¬¦ä¸²ï¼Œè€Œåè€…åŒ¹é…çš„æ˜¯ä¸€ä¸ªå®Œæ•´çš„å•è¯ã€‚ ä¼ªé€‰æ‹©å™¨ ä¼ªé€‰æ‹©å™¨åŒ…å« â€œä¼ªç±»é€‰æ‹©å™¨â€ å’Œ â€œä¼ªå…ƒç´ é€‰æ‹©å™¨â€ ä¸¤ç§ã€‚ ä¼ªç±»é€‰æ‹©å™¨ ä¼ªç±»é€‰æ‹©å™¨ç”¨äºå®šä¹‰å…ƒç´ åœ¨ç‰¹å®šçŠ¶æ€ä¸‹çš„æ ·å¼ï¼Œæ¯”å¦‚é¼ æ ‡æ‚¬åœæ—¶çš„æ ·å¼ã€‚æˆ–è€…ç”¨äºé€‰æ‹©ç¬¬nä¸ªå­å…ƒç´ ã€‚ /* è®¾ç½®è¡¨æ ¼ä¸­æŸä¸€åˆ—çš„æ–‡å­—ä¸æ¢è¡Œ */ .nowrap-column { white-space: nowrap; } å¯¹äºç‰¹å®šçŠ¶æ€ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ï¼š åç§° è¯´æ˜ ç¤ºä¾‹ :hover ç”¨äºåœ¨ç”¨æˆ·å°†é¼ æ ‡æ‚¬åœåœ¨å…ƒç´ ä¸Šæ—¶åº”ç”¨æ ·å¼ a:hover { color: red; } :active ç”¨äºé€‰å–è¢«ç”¨æˆ·æ¿€æ´»ï¼ˆä¾‹å¦‚é¼ æ ‡ç‚¹å‡»ï¼‰çš„å…ƒç´  button:active { background-color: gray; } :visited ç”¨äºé€‰å–ç”¨æˆ·å·²è®¿é—®è¿‡çš„é“¾æ¥ a:visited { color: purple; } :focus ç”¨äºé€‰å–å½“å‰è·å–äº†ç„¦ç‚¹çš„å…ƒç´ é€šå¸¸åœ¨ç”¨æˆ·é€šè¿‡é”®ç›˜æˆ–è€…é¼ æ ‡è¿›è¡Œäº¤äº’æ—¶å‡ºç° input:focus { border-color: blue; } å¯¹äºé€‰æ‹©å­å…ƒç´ ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ç”¨æ³•ï¼š åç§° è¯´æ˜ ç¤ºä¾‹ :nth-of-type(n) è¯¥é€‰æ‹©å™¨å…è®¸ä½ é€‰æ‹©ç›¸åŒç±»å‹çš„ä¸”ç‰¹å®šä½ç½®çš„å­å…ƒç´ è¯·æ³¨æ„ï¼Œnä»1å¼€å§‹ï¼Œä¸”ä¸èƒ½æ˜¯è´Ÿæ•° /* è¿™ä¼šä½¿æ¯éš”ä¸¤ä¸ªæ®µè½æ–‡å­—å˜ä¸ºçº¢è‰² */ p:nth-of-type(2n) { color: red; } :nth-child(n) è¯¥é€‰æ‹©å™¨å…è®¸ä½ é€‰æ‹©ç‰¹å®šä½ç½®çš„å­å…ƒç´  /* åˆ—è¡¨ä¸­çš„å¥‡æ•°é¡¹èƒŒæ™¯è‰²å˜ä¸ºæµ…ç°è‰² */ li:nth-child(odd) { background-color: lightgray; } :nth-last-child(n) è¯¥é€‰æ‹©å™¨ä¸:nth-child(n)ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒä»å…ƒç´ çš„æœ«å°¾å¼€å§‹è®¡æ•°ã€‚ /* * è¿™ä¼šä½¿æ¯ä¸ªæ— åºåˆ—è¡¨ï¼ˆulï¼‰çš„ * å€’æ•°ç¬¬äºŒä¸ªåˆ—è¡¨é¡¹ï¼ˆliï¼‰çš„æ–‡å­—é¢œè‰²å˜ä¸ºè“è‰² */ ul li:nth-last-child(2) { color: blue; } :first-childâ€œnth-child(1)â€ è¯¥é€‰æ‹©å™¨é€‰å–æŸä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´  /* * è¿™ä¼šä½¿æ¯ä¸ªæ— åºåˆ—è¡¨ï¼ˆulï¼‰çš„ç¬¬ä¸€ä¸ªåˆ—è¡¨é¡¹ï¼ˆliï¼‰çš„æ–‡å­—åŠ ç²— */ ul li:first-child { font-weight: bold; } :last-childâ€œnth-last-child(1)â€ è¯¥é€‰æ‹©å™¨é€‰å–æŸä¸ªå…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´  /* * è¿™ä¼šä½¿æ¯ä¸ªæ— åºåˆ—è¡¨ï¼ˆulï¼‰ * çš„æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹ï¼ˆliï¼‰çš„æ–‡å­—å˜ä¸ºæ–œä½“ */ ul li:last-child { font-style: italic; } æˆ‘è§‰å¾— :nth-of-type å’Œ :nth-child çš„æ¦‚å¿µæ¯”è¾ƒæ¥è¿‘ï¼ŒåŒæ—¶å®¹æ˜“æ··æ·†ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œç‰¹æ„å°†ä»–ä»¬ä¸¤ä¸ªå•ç‹¬æ‹¿å‡ºæ¥ï¼Œç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªé€‰æ‹©å™¨ä¹‹é—´çš„åŒºåˆ«ã€‚ &lt;div class=&quot;container&quot;&gt; &lt;p&gt;Paragraph 1&lt;/p&gt; &lt;div&gt;Div 1&lt;/div&gt; &lt;p&gt;Paragraph 2&lt;/p&gt; &lt;p&gt;Paragraph 3&lt;/p&gt; &lt;div&gt;Div 2&lt;/div&gt; &lt;/div&gt; é’ˆå¯¹ä¸Šé¢è¿™æ®µ htmlï¼Œä¸¤ä¸ªé€‰æ‹©å™¨çš„ç»“æœä¸ºï¼š é€‰æ‹©å™¨ ç»“æœ è¯´æ˜ .container p:nth-of-type(2) é€‰æ‹©åˆ° &lt;p&gt;Paragraph 2&lt;/p&gt; è¿™ä¸ªé€‰æ‹©å™¨å°†é€‰æ‹©å®¹å™¨ .container å†…çš„ç¬¬äºŒä¸ª &lt;p&gt; å…ƒç´ ã€‚åœ¨ç»™å®šçš„ HTML ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ª &lt;p&gt; å…ƒç´ æ˜¯ &quot;Paragraph 2&quot;ï¼Œå› æ­¤è¯¥é€‰æ‹©å™¨ä¼šå½±å“åˆ°è¿™ä¸ªæ®µè½å…ƒç´ ã€‚ .container p:nth-child(2) ä¸ä¼šé€‰æ‹©ä»»ä½•å…ƒç´  è¿™ä¸ªé€‰æ‹©å™¨å°†é€‰æ‹©å®¹å™¨ .container å†…æ‰€æœ‰çš„ &lt;p&gt; å…ƒç´ ä¸­çš„ç¬¬äºŒä¸ªå­å…ƒç´ ã€‚åœ¨ç»™å®šçš„ HTML ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ªå­å…ƒç´ æ˜¯ &quot;Div 1&quot;ï¼Œè€Œä¸æ˜¯ &lt;p&gt; å…ƒç´ ã€‚å› æ­¤ï¼Œè¿™ä¸ªé€‰æ‹©å™¨ä¸ä¼šé€‰æ‹©ä»»ä½•å…ƒç´ ï¼Œå› ä¸ºåœ¨è¯¥ç»“æ„ä¸­ï¼Œç¬¬äºŒä¸ªå­å…ƒç´ ä¸æ˜¯ &lt;p&gt; å…ƒç´ ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œnth-child(n) ä¼šå…ˆæŒ‰ç…§é¡ºåºé€‰æ‹©çˆ¶è§†å›¾çš„å­å…ƒç´ ï¼Œå†çœ‹è¯¥å­å…ƒç´ æ˜¯å¦ç¬¦åˆé™åˆ¶æ¡ä»¶ï¼Œå¦‚æœç¬¦åˆåˆ™æ ·å¼ç”Ÿæ•ˆï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆï¼›è€Œ nth-of-type(n) åˆ™ç›¸åï¼Œä¼šå…ˆé€‰æ‹©ç¬¦åˆè¦æ±‚çš„å…ƒç´ ï¼Œå†æŒ‰ç…§é¡ºåºè¿›è¡Œé€‰æ‹©ã€‚ åŒç†å¯å¾—ï¼Œå› ä¸º :first-childã€:last-child å’Œ :nth-child(1)ã€:nth-last-child(1) ç›¸åŒï¼Œæ‰€ä»¥å‡å¦‚ä½¿ç”¨ p:fist-childï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ ‡ç­¾ä¸æ˜¯ &lt;p&gt;ï¼Œé‚£ä¹ˆè¯¥æ ·å¼ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚ ä¼ªå…ƒç´ é€‰æ‹©å™¨ ä¼ªå…ƒç´ é€‰æ‹©å™¨ç”¨äºé€‰æ‹©å…ƒç´ çš„ç‰¹å®šéƒ¨åˆ†è€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚ä¼ªå…ƒç´ é€‰æ‹©å™¨ä»¥åŒå†’å· :: å¼€å¤´ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ä¼ªå…ƒç´ é€‰æ‹©å™¨ï¼š /* é€‰æ‹©å…ƒç´ çš„ç¬¬ä¸€è¡Œæ–‡æœ¬ */ p::first-line { font-weight: bold; } /* é€‰æ‹©å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­—æ¯ */ p::first-letter { font-size: 150%; } /* åœ¨å…ƒç´ å†…å®¹ä¹‹å‰æ’å…¥å†…å®¹ */ p::before { content: &quot;å‰ç½®å†…å®¹ &quot;; } /* åœ¨å…ƒç´ å†…å®¹ä¹‹åæ’å…¥å†…å®¹ */ p::after { content: &quot; åç½®å†…å®¹&quot;; } /* é€‰æ‹©ç”¨æˆ·é€‰ä¸­çš„æ–‡æœ¬éƒ¨åˆ† */ ::selection { background-color: yellow; color: black; } /* é€‰æ‹©è¾“å…¥æ¡†çš„å ä½ç¬¦æ–‡æœ¬ */ input::placeholder { color: gray; } é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›ä¸å¤ªå¸¸è§çš„ä¼ªå…ƒç´ é€‰æ‹©å™¨ï¼š /* é€‰æ‹©åˆ—è¡¨é¡¹çš„æ ‡è®°éƒ¨åˆ†ï¼ˆé€šå¸¸æ˜¯åˆ—è¡¨é¡¹å‰é¢çš„ç¬¦å·ï¼Œå¦‚åœ†ç‚¹æˆ–æ•°å­—ï¼‰ */ li::marker { color: red; } /* é€‰æ‹©å…ƒç´ çš„èƒŒæ™¯å±‚ï¼Œç”¨äºå¤„ç†å…¨å±å…ƒç´ çš„èƒŒæ™¯æ ·å¼ */ dialog::backdrop { background-color: rgba(0, 0, 0, 0.5); } /* é€‰æ‹©æ‹¼å†™é”™è¯¯çš„æ–‡æœ¬éƒ¨åˆ† */ ::spelling-error { text-decoration: underline wavy red; } /* é€‰æ‹©è¯­æ³•é”™è¯¯çš„æ–‡æœ¬éƒ¨åˆ† */ ::grammar-error { text-decoration: underline dashed blue; } ç»„åˆé€‰æ‹©å™¨ ç»„åˆé€‰æ‹©å™¨æ˜¯ CSS ä¸­çš„ä¸€ç§é€‰æ‹©å™¨ï¼Œå…è®¸ä½ é’ˆå¯¹åŒæ—¶æ»¡è¶³å¤šä¸ªæ¡ä»¶çš„å…ƒç´ åº”ç”¨æ ·å¼ã€‚ åä»£é€‰æ‹©å™¨ åä»£é€‰æ‹©å™¨ï¼ˆDescendant Selectorï¼‰å…è®¸ä½ é€‰æ‹©æŸä¸ªå…ƒç´ å†…éƒ¨çš„æ‰€æœ‰åä»£å…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Descendant Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container å†…éƒ¨çš„æ‰€æœ‰ p å…ƒç´  */ .container p { color: blue; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container p é€‰æ‹©å™¨ä¼šé€‰æ‹©æ‰€æœ‰åµŒå¥—åœ¨ .container å†…éƒ¨çš„ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„é¢œè‰²è®¾ä¸ºè“è‰²ã€‚å³ä¸¤ä¸ª &lt;p&gt; æ ‡ç­¾éƒ½ä¼šå˜æˆè“è‰²ã€‚ å­é€‰æ‹©å™¨ å­é€‰æ‹©å™¨ï¼ˆChild Selectorï¼‰ç”¨äºé€‰æ‹©æŸä¸ªå…ƒç´ çš„ç›´æ¥å­å…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Child Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container ä¸‹çš„ç›´æ¥å­å…ƒç´  p */ .container &gt; p { font-weight: bold; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container &gt; p é€‰æ‹©å™¨åªä¼šé€‰æ‹© .container ç›´æ¥å­å…ƒç´ ä¸­çš„ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„å­—ä½“åŠ ç²—ã€‚è€Œé‡Œå±‚çš„ This is another paragraph. å¹¶ä¸ä¼šè¢«åŠ ç²—ã€‚ å¯¹æ¯” åä»£é€‰æ‹©å™¨ æ¥çœ‹ï¼Œåä»£é€‰æ‹©å™¨ä¼šä¸€ç›´æŸ¥è¯¢åˆ°è¯¥å¶å­èŠ‚ç‚¹çš„æœ€æœ«ç«¯ï¼Œæ¸²æŸ“æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„æ ‡ç­¾ï¼Œä¸ç®¡ä¸­é—´æ˜¯å¦è¿˜æœ‰å…¶ä»–æ ‡ç­¾ï¼›è€Œ å­é€‰æ‹©å™¨ åªä¼šæ¸²æŸ“ä¸‹ä¸€ä¸ªå±‚çº§ï¼ˆç›´æ¥ï¼‰çš„å­èŠ‚ç‚¹ï¼Œå¹¶ä¸ä¼šè¿›ä¸€æ­¥æ·±å…¥ã€‚ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆAdjacent Sibling Selectorï¼‰é€‰æ‹©ç´§æ¥åœ¨æŒ‡å®šå…ƒç´ åçš„å…„å¼Ÿå…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Adjacent Sibling Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container åé¢ç´§é‚»çš„ p å…„å¼Ÿå…ƒç´  */ .container + p { color: green; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container + p é€‰æ‹©å™¨ä¼šé€‰æ‹©ç´§æ¥åœ¨ .container å…ƒç´ åé¢çš„ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„é¢œè‰²è®¾ä¸ºç»¿è‰²ã€‚å³ This is another paragraph. ä¼šè¢«æ¸²æŸ“ä¸ºç»¿è‰²ã€‚ æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š â€œç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨â€ å¼ºè°ƒ ç›¸é‚»ã€‚å¦‚æœæˆ‘ä»¬å°†ä»£ç è¿›è¡Œä¿®æ”¹ï¼š &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;span&gt;123&lt;/span&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; æ­¤æ—¶ .container ä¸å†æœ‰ä»»ä½•ç›¸é‚»çš„ &lt;p&gt; èŠ‚ç‚¹ï¼Œæ‰€ä»¥ .container + p ä¸ä¼šé€‰æ‹©ä»»ä½•çš„æ ‡ç­¾è¿›è¡Œæ¸²æŸ“ã€‚ â€œç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨â€ åªä¼šæ¸²æŸ“ç›¸é‚»çš„ ä¸€ä¸ª èŠ‚ç‚¹ã€‚å¦‚æœæˆ‘ä»¬å°†ä»£ç è¿›è¡Œä¿®æ”¹ï¼š &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;p&gt;This is another paragraph. 1&lt;/p&gt; &lt;p&gt;This is another paragraph. 2&lt;/p&gt; é‚£ä¹ˆåªæœ‰ç›¸é‚»çš„ç¬¬ä¸€ä¸ª &lt;p&gt; æ ‡ç­¾ï¼Œå³ This is another paragraph. 1 ä¼šè¢«æ¸²æŸ“ä¸ºç»¿è‰²ï¼Œå¦å¤–ä¸€ä¸ª &lt;p&gt; æ ‡ç­¾ä»ä¸ºé»‘è‰²ã€‚ é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆGeneral Sibling Selectorï¼‰é€‰æ‹©ä¸æŒ‡å®šå…ƒç´ ç›¸é‚»çš„æ‰€æœ‰å…„å¼Ÿå…ƒç´ ã€‚ &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;General Sibling Selector Example&lt;/title&gt; &lt;style&gt; /* é€‰æ‹© .container åçš„æ‰€æœ‰ p å…„å¼Ÿå…ƒç´  */ .container ~ p { font-style: italic; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=&quot;container&quot;&gt; &lt;p&gt;This is a paragraph.&lt;/p&gt; &lt;/div&gt; &lt;p&gt;This is another paragraph.&lt;/p&gt; &lt;p&gt;This is yet another paragraph.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.container ~ p é€‰æ‹©å™¨ä¼šé€‰æ‹©ç´§è·Ÿåœ¨ .container å…ƒç´ åçš„æ‰€æœ‰ &lt;p&gt; å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬çš„å­—ä½“æ ·å¼è®¾ä¸ºæ–œä½“ã€‚å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œè¯¥é€‰æ‹©å™¨å’Œ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ äº’ä¸ºä¸€å¯¹ã€‚ ç»„åˆé€‰æ‹©å™¨æ€»ç»“ åä»£é€‰æ‹©å™¨ï¼ˆ ï¼‰ å’Œ å­é€‰æ‹©å™¨ï¼ˆ&gt;ï¼‰ äº’ä¸ºä¸€å¯¹ï¼šåŒæ ·æ˜¯é€‰æ‹©å­å…ƒç´ ï¼Œå‰è€…ä¼šæ·±å…¥åˆ°å±‚çº§çš„æœ€æœ«ç«¯ï¼Œè€Œåè€…åªä¼šé€‰æ‹©ä¸‹ä¸€ä¸ªå±‚çº§ï¼Œç‚¹åˆ°ä¸ºæ­¢ã€‚ ç›¸é‚»å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆ+ï¼‰ å’Œ é€šç”¨å…„å¼Ÿé€‰æ‹©å™¨ï¼ˆ~ï¼‰ äº’ä¸ºä¸€å¯¹ï¼šåŒæ ·æ˜¯é€‰æ‹©ç›¸é‚»å…ƒç´ ï¼Œå‰è€…åªé€‰æ‹©åŒå±‚çº§å†…ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œè€Œåè€…ä¼šé€‰æ‹©åŒå±‚çº§å†…æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚ è¯¾åæ€è€ƒ ç°åœ¨æˆ‘ä»¬æå‡ºæ¥è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼šä»æ¥å£å¤„è·å–å•†å“çš„ä»·æ ¼ï¼ˆå¿½ç•¥æ¥å£è¯·æ±‚æ­¥éª¤ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªä»·æ ¼å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ &quot;Â¥35.66&quot;ã€‚é’ˆå¯¹è¯¥å­—ç¬¦ä¸²è¿›è¡Œæ¸²æŸ“ï¼Œè¦æ±‚å¦‚ä¸‹ï¼š æ–‡å­—é¢œè‰²å‡ä¸ºçº¢è‰²ã€‚ Â¥ å’Œ .66 éƒ¨åˆ†æ ·å¼ä¸€è‡´ï¼š15å·å­—ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„ Â¥ ç¬¦å·å¹¶ä¸ä¸€å®šå­˜åœ¨ã€‚ 35 éƒ¨åˆ†åŠ ç²—ï¼Œ18å·å­—ã€‚ ä½¿ç”¨ js+html+cssï¼Œç•™å‡ ç§’é’Ÿæ€è€ƒç»™å‡ºç­”æ¡ˆã€‚ ... ... ... ... ... å‚è€ƒç­”æ¡ˆå¦‚ä¸‹ï¼š &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;style&gt; /* æ ·å¼1ï¼šÂ¥ç¬¦å· 15 å·å­—ï¼Œçº¢è‰² */ .currency-sign, .after-dot { font-size: 15px; } /* æ ·å¼2ï¼šÂ¥ å’Œ . ä¹‹é—´çš„å†…å®¹ï¼Œ18å·å­—ï¼ŒåŠ ç²—ï¼Œçº¢è‰² */ .between { font-size: 18px; font-weight: bold; } .currency-sign, .after-dot, .between { color: red; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;span class=&quot;currency-value&quot;&gt;&lt;/span&gt; &lt;!-- ä½¿ç”¨ JavaScript å®šä¹‰å˜é‡ --&gt; &lt;script&gt; // å®šä¹‰å˜é‡ï¼Œä»£æ›¿æ¥å£è¯·æ±‚çš„æ­¥éª¤ const currencyValue = &quot;Â¥35.66&quot;; // è·å– span æ ‡ç­¾ const spanElement = document.querySelector('.currency-value'); // æ£€æŸ¥ span æ ‡ç­¾æ˜¯å¦å­˜åœ¨ if (spanElement) { // æ£€æŸ¥ currencyValue æ˜¯å¦åŒ…å« &quot;Â¥&quot; ç¬¦å· if (currencyValue.includes('Â¥')) { // æ¸²æŸ“ Â¥ ç¬¦å· const currencySignSpan = document.createElement('span'); currencySignSpan.innerText = 'Â¥'; currencySignSpan.classList.add('currency-sign'); spanElement.appendChild(currencySignSpan); } // åˆ å» &quot;Â¥&quot; ç¬¦å·åçš„å€¼ let valueWithoutSign = currencyValue.replace('Â¥', ''); // æŒ‰ &quot;.&quot; åˆ†éš”å€¼ const [beforeDot, afterDot] = valueWithoutSign.split('.'); // æ¸²æŸ“ &quot;.&quot; ä¹‹å‰çš„å†…å®¹ const beforeDotSpan = document.createElement('span'); beforeDotSpan.innerText = beforeDot; beforeDotSpan.classList.add('between'); spanElement.appendChild(beforeDotSpan); // æ¸²æŸ“ &quot;.&quot; ç¬¦å· å’Œ &quot;.&quot; ä¹‹åçš„å†…å®¹ const afterDotSpan = document.createElement('span'); afterDotSpan.innerText = '.' + afterDot; afterDotSpan.classList.add('after-dot'); spanElement.appendChild(afterDotSpan); } &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; ç„¶åæˆ‘ä»¬å¯ä»¥å†è¿›ä¸€æ­¥ï¼Œå¦‚æœæ”¹æˆ vue3 + TypeScript å‘¢ï¼Ÿ &lt;template&gt; &lt;span class=&quot;currency-value&quot;&gt; &lt;span v-if=&quot;hasCurrencySign&quot; class=&quot;currency-sign&quot;&gt;Â¥&lt;/span&gt; &lt;span class=&quot;between&quot;&gt;{{ beforeDot }}&lt;/span&gt; &lt;span class=&quot;after-dot&quot;&gt;.{{ finalAfterDot }}&lt;/span&gt; &lt;/span&gt; &lt;/template&gt; &lt;script setup lang=&quot;ts&quot;&gt; import { ref } from 'vue'; const currencyValue = ref&lt;string&gt;(&quot;Â¥35.66&quot;); const hasCurrencySign = currencyValue.value.includes('Â¥'); const [beforeDot, afterDot] = currencyValue.value.replace('Â¥', '').split('.'); const finalAfterDot = afterDot || '00'; &lt;/script&gt; &lt;style scoped&gt; /* æ ·å¼1ï¼šÂ¥ç¬¦å· 15 å·å­—ï¼Œçº¢è‰² */ .currency-sign, .after-dot { font-size: 15px; } /* æ ·å¼2ï¼šÂ¥ å’Œ . ä¹‹é—´çš„å†…å®¹ï¼Œ18å·å­—ï¼ŒåŠ ç²—ï¼Œçº¢è‰² */ .between { font-size: 18px; font-weight: bold; } .currency-sign, .after-dot, .between { color: red; } &lt;/style&gt; å¯è§å› ä¸º vue ä¸­çš„æ¨¡ç‰ˆå¯ä»¥ç›´æ¥å¼•ç”¨å˜é‡ï¼Œä¸ºæˆ‘ä»¬å‡å°‘äº†å¤§é‡çš„ DOM æ“ä½œï¼Œä»£ç é‡å¾—ä»¥å‡å°‘äº†ä¸å°‘ã€‚ ","link":"https://blog.rakuyo.dev/css-selector/"},{"title":"HTML å…ƒç´ æ˜¾ç¤ºæ¨¡å¼","content":"è®°å½•å‰ç«¯çš„å­¦ä¹ è¿‡ç¨‹ã€‚ æœ¬ç¯‡æ–‡ç« æ˜¯æœ€åŸºç¡€çš„ HTML éƒ¨åˆ†ã€‚ å…ƒç´ æ˜¾ç¤ºæ¨¡å¼ HTML å…ƒç´ ä¸€èˆ¬åˆ†ä¸º â€œå—å…ƒç´ â€ å’Œ â€œè¡Œå†…å…ƒç´ â€ã€‚ å—å…ƒç´  &lt;div&gt; æ˜¯æœ€å…¸å‹çš„å—å…ƒç´ ã€‚å…¶ä½™çš„è¿˜æœ‰ &lt;h1&gt; ~ &lt;h6&gt;ã€&lt;p&gt;ã€&lt;ul&gt;ã€&lt;ol&gt;ã€&lt;li&gt; ç­‰ã€‚ ç‰¹æ€§ï¼š ç‹¬å ä¸€è¡Œ é«˜åº¦ã€å®½åº¦ã€å¤–è¾¹è·å’Œå†…è¾¹è·éƒ½å¯ä»¥æ§åˆ¶ å®½åº¦é»˜è®¤æ˜¯å®¹å™¨ï¼ˆçˆ¶çº§å®½åº¦ï¼‰çš„ 100% æ˜¯ä¸€ä¸ªå®¹å™¨åŠç›’å­ï¼Œé‡Œé¢å¯ä»¥æ”¾è¡Œå†…æˆ–è€…å—çº§å…ƒç´  æ³¨æ„ï¼š æ–‡å­—ç±»å…ƒç´ å†…éƒ¨ä¸èƒ½ä½¿ç”¨å—çº§å…ƒç´  &lt;p&gt; æ ‡ç­¾ä¸»è¦ç”¨äºå­˜æ”¾æ–‡å­—ï¼Œå› æ­¤ &lt;p&gt; é‡Œé¢ä¸èƒ½æ”¾å—çº§å…ƒç´ ï¼Œç‰¹åˆ«æ˜¯ä¸èƒ½æ”¾ &lt;div&gt; åŒç†ï¼Œ&lt;h1&gt; ~ &lt;h6&gt; ç­‰éƒ½æ˜¯æ–‡å­—ç±»å—çº§æ ‡ç­¾ï¼Œé‡Œé¢ä¹Ÿä¸èƒ½æ”¾å…¶ä»–å—çº§å…ƒç´  è¡Œå†…å…ƒç´  æ˜¯æœ€å…¸å‹çš„è¡Œå†…å…ƒç´ ã€‚å…¶ä½™çš„è¿˜æœ‰ &lt;a&gt;ã€&lt;strong&gt;ã€&lt;b&gt;ã€&lt;em&gt;ã€&lt;i&gt;ã€&lt;del&gt;ã€&lt;s&gt;ã€&lt;ins&gt;ã€&lt;u&gt;ç­‰ã€‚ æœ‰çš„åœ°æ–¹ä¹Ÿå°†è¡Œå†…å…ƒç´ æˆä¸ºå†…è”å…ƒç´ ã€‚ ç‰¹æ€§ï¼š ç›¸é‚»è¡Œå†…å…ƒç´ åœ¨ä¸€è¡Œä¸Šï¼Œä¸€è¡Œå¯ä»¥æ˜¾ç¤ºå¤šä¸ª å®½ã€é«˜ç›´æ¥è®¾ç½®æ˜¯æ— æ•ˆçš„ é»˜è®¤å®½åº¦å°±æ˜¯å®ƒæœ¬èº«å†…å®¹çš„å®½åº¦ è¡Œå†…å…ƒç´ åªèƒ½å®¹çº³æ–‡æœ¬æˆ–å…¶ä»–è¡Œå†…å…ƒç´ ã€‚ æ³¨æ„ï¼š é“¾æ¥é‡Œä¸èƒ½å†æ”¾é“¾æ¥ ç‰¹æ®Šæƒ…å†µé“¾æ¥ &lt;a&gt; é‡Œé¢å¯ä»¥æ”¾å—çº§å…ƒç´ ï¼Œä½†æ˜¯ç»™ &lt;a&gt; è½¬æ¢æˆå—çº§æ¨¡å¼æœ€å®‰å…¨ ç¤ºä¾‹ ä¸‹é¢è¿™æ®µä»£ç å¯ä»¥ä½œä¸ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ã€‚ &lt;body&gt; &lt;h1&gt;ã€Šå‰ç«¯å°è¯¾ã€‹&lt;/h1&gt; &lt;h2&gt; ä¸€æœ¬å¸®ä½ å…¥é—¨ä¸è¿›é˜¶çš„å‰ç«¯ä¹¦ &lt;!-- h2 å’Œ p éƒ½æ˜¯å—çº§å…ƒç´ ï¼Œå†…éƒ¨å¯ä»¥ç›´æ¥åŒ…å«å…¶ä»–å…ƒç´ ï¼Œæ¯”å¦‚ &lt;hr&gt; --&gt; &lt;!-- html æ ‡ç­¾ä¹‹é—´ï¼Œé»˜è®¤å¥½åƒæ˜¯ä¼šæœ‰ä¸€äº›é—´è·çš„ã€‚æ‰€ä»¥è¿™ä¸ª &lt;hr&gt; å¦‚æœå†™åœ¨ &lt;p&gt; å¤–å±‚ï¼Œä¼šæœ‰ä¸ä¸€æ ·çš„ ui æ•ˆæœ --&gt; &lt;hr&gt; &lt;/h2&gt; &lt;!-- ç”¨ div è¿™ä¸ªå—çº§å…ƒç´ åŒ…ä¸€ä¸‹ï¼Œå¯ä»¥ä¿è¯ä»£ç å æ•´è¡Œ ä¸ç”¨ div åŒ…è£¹ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ çš„å¤§å°å°±æ˜¯ code çš„å¤§å° --&gt; &lt;div class=&quot;code-bg&quot;&gt; &lt;code&gt; const p = document.querySelector('p'); p.onclick = function() { alert('å™¢ï¼Œå™¢ï¼Œå™¢ï¼Œåˆ«ç‚¹æˆ‘äº†ã€‚'); } &lt;/code&gt; &lt;/div&gt; &lt;/body&gt; ","link":"https://blog.rakuyo.dev/html-element-display-mode/"},{"title":"Jellyfin + tinymediamanager + TMM åˆ®å‰Š","content":"ä½¿ç”¨ tinymediamanager é…åˆ TMMï¼ˆthemoviedbï¼‰å®ç° Jellyfin åˆ®å‰Šã€‚ ç½‘ä¸Šç°æœ‰çš„æ•™ç¨‹éƒ½æ¯”è¾ƒè€äº†ï¼Œæ‰€ä»¥å¼€ä¸€ç¯‡å¸–å­è®°å½•ä¸€ä¸‹è‡ªå·±é…ç½®çš„è¿‡ç¨‹ã€‚ TMM API Key å› ä¸ºæ˜¯ä½¿ç”¨ TMM æ¥å®ç°åˆ®å‰Šï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä¸Šå®˜ç½‘ ç”³è¯·ä¸€ä¸‹ API Keyã€‚ é¦–å…ˆä½ éœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œæ³¨å†Œè´¦å·æ¯”è¾ƒç®€å•ï¼Œæœ¬ç¯‡ä¸ä½œä»‹ç»ã€‚ åœ¨åˆæ¬¡ç™»å½•ï¼Œæœªé…ç½®è¿‡ API çš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•è®©æˆ‘ä»¬è¿›å…¥åˆ° API ç”³è¯·é¡µé¢ï¼š ç›´æ¥æ‹‰åˆ°é¡µé¢æœ€åº•éƒ¨ï¼Œç‚¹å‡» API ã€‚ ç‚¹å‡»è‡ªå·±çš„å¤´åƒï¼Œè¿›å…¥è´¦æˆ·è®¾ç½®é¡µé¢ï¼Œç„¶åç‚¹å‡»åˆ—è¡¨å·¦ä¾§çš„ API é€‰é¡¹ã€‚ æ³¨æ„ ç”³è¯·è¿‡ API ä¹‹åå°±ä¸èƒ½ä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•äº†ï¼Œä¼šè¿›å…¥æ–‡æ¡£é¡µé¢ã€‚åªèƒ½ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•æŸ¥çœ‹å·²ç»ç”³è¯·çš„ APIã€‚ åœ¨ API é€‰é¡¹é¡µé¢ï¼Œæˆ‘ä»¬é€‰æ‹© Developer ç±»å‹ï¼Œåˆ›å»º API Keyã€‚ è¿›å…¥åˆ°ä¿¡æ¯å¡«å†™é¡µé¢ï¼Œè¿™é‡Œæˆ‘å€Ÿç”¨ä¸€å¼ åˆ«äººçš„å›¾åšç¤ºä¾‹ï¼š ç»è¿‡å®é™…æµ‹è¯•ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š åº”ç”¨ä¿¡æ¯éƒ¨åˆ†ç›´æ¥æŒ‰ç…§ä¸Šå›¾æ‰€ç¤ºå¡«å†™å³å¯ï¼Œä¸€æ¨¡ä¸€æ ·å°±è¡Œã€‚ å§“åå¿…é¡»è¦ä½¿ç”¨è‹±æ–‡ã€‚ åœ°å€ä¿¡æ¯æ‰¾ä¸€ä¸ªéšæœºåœ°å€ç”Ÿæˆå™¨ç”Ÿæˆä¸€ä¸‹å³å¯ã€‚æ³¨æ„ åœ°å€1 å’Œ åœ°å€2 éƒ½è¦æœ‰ï¼Œå¯ä»¥æ˜¯ä¸­æ–‡ï¼Œä¸¤ä¸ªä¸€æ ·ä¹Ÿå¯ä»¥ã€‚ ç‚¹å‡»æäº¤åå³å¯å®Œæˆç”³è¯·ï¼Œç”³è¯·æ˜¯ç§’è¿‡çš„ï¼Œåœ¨æ–°é¡µé¢å¯ä»¥ç«‹åˆ»æŸ¥çœ‹åˆ°æˆ‘ä»¬ç”³è¯·çš„ keyï¼š æœ‰çš„æ–‡ç« é™„å›¾é‡Œï¼Œæ ‡é¢˜æ˜¾ç¤ºçš„æ˜¯ â€œAPIå¯†é’¥ï¼ˆv3 authï¼‰â€ã€‚åœ¨ TMM æœ€æ–°ç‰ˆé‡Œç›´æ¥æ˜¾ç¤º â€œAPI å¯†é’¥â€ äº†ï¼Œå…¶å®æ˜¯ä¸€å›äº‹ã€‚ NAS é…ç½® å›åˆ°ç¾¤æ™– NAS ä¸Šï¼Œé¦–å…ˆéœ€è¦é€šè¿‡ docker å®‰è£… tinymediamanager docker-compose çœæµç‰ˆï¼Œæˆ‘åšäº†ä¸€ä»½ docker-compose æ–‡ä»¶ï¼Œå¦‚æœæ‚¨æœ‰ç¼–ç¨‹ç»éªŒå¯ä»¥ç›´æ¥å‚è€ƒä½¿ç”¨ï¼š version: '3.8' services: tinymediamanager: container_name: tinymediamanager-tinymediamanager image: tinymediamanager/tinymediamanager:latest command: /app/tinyMediaManager -Dtmm.contentfolder=/data extra_hosts: - &quot;www.themoviedb.org:8.67.111.128&quot; - &quot;www.themoviedb.org:18.154.144.22&quot; - &quot;www.themoviedb.org:99.86.199.23&quot; - &quot;image.tmdb.org:84.17.46.53&quot; - &quot;image.tmdb.org:89.187.162.242&quot; - &quot;image.tmdb.org:138.199.46.66&quot; - &quot;api.themoviedb.org:13.33.33.60&quot; - &quot;api.themoviedb.org:13.224.167.10&quot; - &quot;api.themoviedb.org:99.84.192.81&quot; - &quot;api.thetvdb.org:192.241.234.54&quot; ports: - 4000:4000 volumes: - /volume1/video:/media:rw - /volume1/docker/tiny-media-manager/config:/config:rw - /volume1/docker/tiny-media-manager/data:/data:rw environment: PATH: &quot;/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot; LANG: &quot;en_US.UTF-8&quot; LC_ALL: &quot;en_US.UTF-8&quot; USER_ID: &quot;0&quot; GROUP_ID: &quot;0&quot; APP: &quot;tinyMediaManager&quot; UMASK: &quot;0022&quot; ALLOW_DIRECT_VNC: &quot;true&quot; LC_TIME: &quot;C.UTF-8&quot; ENABLE_CJK_FONT: &quot;1&quot; restart: always privileged: true network_mode: bridge è¯¥æ–‡ä»¶è®¾ç½®äº†ä»¥ä¸‹å†…å®¹ï¼š å®¹å™¨åï¼štinymediamanager-tinymediamanager é…ç½®äº† hostsï¼Œè§£å†³ TMDB è®¿é—®é—®é¢˜ å¯ç”¨ â€œè‡ªåŠ¨é‡æ–°å¯åŠ¨â€ ä½¿ç”¨é«˜çº§æƒé™æ‰§è¡Œå®¹å™¨ ç«¯å£å· 4000 æŒ‚è½½ä»¥ä¸‹è·¯å¾„ï¼Œå‡ä¸ºè¯»å†™æƒé™ æœ¬åœ° /volume1/videoï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†… /media æœ¬åœ° /volume1/docker/tiny-media-manager/configï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†… /config æœ¬åœ° /volume1/docker/tiny-media-manager/dataï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†… /data æ‰‹åŠ¨å®‰è£… å¦‚æœä¸æƒ³ä½¿ç”¨ docker-compose å®‰è£…ï¼Œå¯ä»¥æ‰‹åŠ¨å®‰è£… å®‰è£… tinymediamanager åœ¨æ³¨å†Œè¡¨ä¸­æœç´¢ tinymediamanagerï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒä¸ªå®˜æ–¹é•œåƒã€‚ å¤§éƒ¨åˆ†æ•™ç¨‹ä¸æ˜¯é€‰æ‹©ç¬¬ä¸€ä¸ª star æœ€å¤šçš„ï¼Œå°±æ˜¯é€‰æ‹©ç¬¬ä¸‰ä¸ªæ‰€è°“ â€œä¸­æ–‡æ›´å‹å¥½â€ çš„ã€‚å…¶å®åœ¨ 2024 å¹´ï¼Œå®˜æ–¹çš„ç”¨èµ·æ¥æ‰æ˜¯æœ€ç®€å•çš„ã€‚ ä¸‹è½½å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å…ˆä¸è¦æ‰“å¼€ï¼Œè¿›å…¥åç»­çš„é…ç½®æµç¨‹ã€‚ åˆ›å»º tinymediamanager å®¹å™¨ é¦–å…ˆé€šè¿‡ ssh ç™»å½•ç¾¤æ™–ï¼Œç„¶åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿è¡Œ tinymediamanager dockerã€‚ è¿™ä¸€æ­¥å¯ä»¥ç›´æ¥æ·»åŠ  hostï¼Œè§£å†³ tinymediamanager æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚é¿å…æˆ‘ä»¬åœ¨åç»­è¿›å…¥ docker å®¹å™¨å†…éƒ¨ä¿®æ”¹ hostã€‚ ä½†æ˜¯ä¸»è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œå¦‚æœåœ¨ DSM é‡Œæ‰‹åŠ¨å…³é—­å®¹å™¨å†é‡æ–°å¯åŠ¨ï¼Œé‚£ä¹ˆ host é…ç½®å°±å¤±æ•ˆäº†ã€‚å› ä¸º TMM å®¹å™¨å†…æ²¡æœ‰ viï¼ŒåŒæ—¶è€ƒè™‘ä»¥åå†æ¬¡ä¿®æ”¹ï¼Œä¸ªäººè¿˜æ˜¯å»ºè®®å°† /etc/hosts æ–‡ä»¶æŒ‚è½½å‡ºæ¥ï¼Œç„¶ååœ¨æ–‡ä»¶å†…æ·»åŠ ä¸‹åˆ— hostã€‚ docker run \\ --name=tinyMediaManager \\ --add-host=www.themoviedb.org:8.67.111.128 \\ --add-host=www.themoviedb.org:18.154.144.22 \\ --add-host=www.themoviedb.org:99.86.199.23 \\ --add-host=image.tmdb.org:84.17.46.53 \\ --add-host=image.tmdb.org:89.187.162.242 \\ --add-host=image.tmdb.org:138.199.46.66 \\ --add-host=api.themoviedb.org:13.33.33.60 \\ --add-host=api.themoviedb.org:13.224.167.10 \\ --add-host=api.themoviedb.org:99.84.192.81 \\ --add-host=api.thetvdb.org:192.241.234.54 \\ tinymediamanager/tinymediamanager:latest è¿è¡Œåˆ°ä¸‹é¢è¿™ä¸€æ­¥å°± ok äº†ï¼š æ­¤æ—¶å®¹å™¨å·²ç»åˆ›å»ºå¥½ï¼Œæˆ‘ä»¬å¯ä»¥ ctrl+c åœæ­¢è¿è¡Œï¼Œç„¶åå›åˆ° NAS ä¸Šåœæ­¢è¯¥å®¹å™¨ï¼Œå‡†è®¸åç»­çš„ç¼–è¾‘ã€‚ é…ç½® tinymediamanager å®¹å™¨ åœ¨ docker æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª TinyMediaManager ç›®å½•ï¼Œç„¶åæ–°å»º data æ–‡ä»¶å¤¹ã€‚ åœ¨å®¹å™¨å†…æ‰¾åˆ°åˆšæ‰æ–°åˆ›å»ºå¥½çš„å®¹å™¨ï¼Œç‚¹å‡» è¯¦æƒ…-&gt;è®¾ç½® è¿›å…¥é…ç½®ã€‚ ç«¯å£å·ä½¿ç”¨é»˜è®¤æˆ–æ ¹æ®ä½ çš„å®é™…æƒ…å†µå¡«å†™ã€‚ æ–‡ä»¶å¤¹æŒ‚è½½éœ€è¦æŒ‚è½½ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯åˆšæ‰åˆ›å»ºçš„ data æ–‡ä»¶å¤¹ï¼Œå¦ä¸€ä¸ªæ˜¯ä½ å½“å‰ å­˜å‚¨å½±ç‰‡ çš„æ–‡ä»¶å¤¹ã€‚ ç¯å¢ƒå˜é‡éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š USER_ID å’Œ GROUP_ID ä¿®æ”¹ä¸º 0ï¼ˆrootç”¨æˆ·ï¼‰ã€‚ PASSWORD å¯ä»¥ç›´æ¥åˆ æ‰ã€‚ å¢åŠ  ENABLE_CJK_FONT è¿™ä¸ª keyï¼Œå€¼ä¸º 1ã€‚ å¯¹äº ENABLE_CJK_FONTï¼Œè€ç‰ˆçš„æ•™ç¨‹é‡Œéƒ½éœ€è¦æ·»åŠ ï¼Œä¸ºäº†åˆ‡æ¢ä¸ºä¸­æ–‡åæ­£å¸¸æ˜¾ç¤ºã€‚æˆ‘åœ¨è£…æœ€æ–°ç‰ˆçš„æ—¶å€™ç›´æ¥åŠ ä¸Šäº†ï¼Œæ²¡æœ‰æµ‹è¯•ä¸åŠ å¯ä»¥ä¸å¯ä»¥ã€‚ å¡«å®Œåæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œå®¹å™¨äº†ã€‚ å®˜æ–¹é•œåƒè¾ƒå…¶ä»–é•œåƒçš„ä¼˜åŠ¿ æˆªæ­¢åˆ°æœ¬æ–‡å‘å¸ƒï¼Œå®˜æ–¹é•œåƒå·²ç»æ¥åˆ°äº† 5.x çš„ç‰ˆæœ¬ï¼Œè€Œå…¶ä»–ä¸¤ä¸ªé•œåƒè¿˜æ˜¯ 3.x çš„ç‰ˆæœ¬ã€‚ ç›¸æ¯”è¾ƒè€ç‰ˆï¼Œæ–°ç‰ˆçš„æŒ‚è½½ç›®å½•ä» /config å˜ä¸ºäº† /dataï¼Œé»˜è®¤ç«¯å£ä» 5800 å˜ä¸ºäº† 4000ã€‚ åœ¨å¯¹ä¸­æ–‡çš„æ”¯æŒä¸Šï¼Œæœ€æ–°çš„å®˜æ–¹é•œåƒå¯¹ä¸­æ–‡çš„æ”¯æŒå·²ç»å¾ˆå¥½äº†ï¼Œä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚è€Œå…¶ä»–ä¸¤ä¸ªé•œåƒç‰ˆæœ¬å¯¹ä¸­æ–‡çš„æ”¯æŒæ¯”è¾ƒéº»çƒ¦ï¼š æ•™ç¨‹ä¸­å¾€å¾€æåˆ°æˆ‘ä»¬éœ€è¦å°† /etc/cont-init.d/10-cjk-font.sh æ–‡ä»¶ä¸­çš„ http://dl-cdn.alpinelinux.org æ›¿æ¢ä¸º http://mirrors.tuna.tsinghua.edu.cn/ã€‚ æ­¤ä¸¾æ˜¯ä¸ºäº†ä¸‹è½½ä¸­æ–‡å­—ä½“ï¼Œç„¶è€Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ romancin çš„é•œåƒï¼Œé‚£ä¹ˆå°±ç®—æ›¿æ¢äº†ä¹Ÿæ²¡ç”¨ï¼Œè®¾ç½®ä¸ºä¸­æ–‡ä¾ç„¶ä¼šä¹±ç ã€‚è¿™æ˜¯å› ä¸ºè¯¥å­—ä½“åœ¨æ¸…åæºä¸‹å·²ç»å¤±æ•ˆäº†ï¼ˆé˜¿é‡Œäº‘å¥½åƒä¹Ÿå¤±æ•ˆäº†ï¼‰ã€‚æœ‰ç½‘å‹æåˆ°åä¸ºäº‘æ˜¯æœ‰æ•ˆçš„ï¼Œç»è¿‡æµ‹è¯•ç¡®å®å¯ä»¥ã€‚ æœ€åï¼Œåœ¨åˆ®å‰Šæ•ˆç‡å’Œç»“æœä¸Šï¼Œä¹Ÿæ˜¯æ–°ç‰ˆæ›´ä¸ºå‡ºè‰²ã€‚ tinymediamanager é…ç½® æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ http://nas-ip:4000/ è¿›å…¥ tinymediamanagerã€‚åˆå§‹æ˜¯ä¸€ä¸ªè‹±æ–‡çš„å¼•å¯¼é¡µé¢ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç›´æ¥ next å³å¯ã€‚ è¿›å…¥ä¸»é¡µé¢åï¼Œæˆ‘ä»¬è¿›å…¥è®¾ç½®ï¼Œä¿®æ”¹è¯­è¨€ä¸ºä¸­æ–‡ã€‚ ","link":"https://blog.rakuyo.dev/jellyfin-scraper-with-tmm/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨","content":"å‡å¦‚æˆ‘ä»¬æ²¡æœ‰å…¬ç½‘ IPï¼Œæˆ–è€…å…¬ç½‘ IP å‡ºç°æ•…éšœæš‚æ—¶æ— æ³•è®¿é—®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äº‘æœåŠ¡å™¨ + WireGuard çš„å½¢å¼å®ç°å†…ç½‘ç©¿é€ã€‚ æœ¬æ–‡ä¸ºã€Šç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬å››ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½® DDNS ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½® WireGuard ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½® Nginx è®¿é—® Docker æœåŠ¡ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäº”ï¼‰ï¼šä½¿ç”¨ certd å…è´¹ç‰ˆé…ç½®æ³›åŸŸåè¯ä¹¦ æˆ‘åœ¨è…¾è®¯äº‘ä¸Šæœ‰ä¸€å° Ubuntu è½»é‡çº§æœåŠ¡å™¨ï¼Œæœ¬æ–‡å°†ä»¥å…¶ä¸ºåŸºç¡€è¿›è¡Œå„ç§é…ç½®ã€‚ äº‘æœåŠ¡å™¨é…ç½® å¢åŠ è®°å½• é¦–å…ˆæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€æ¡æ–°çš„è®°å½•å€¼ï¼Œä½œä¸ºåˆ›å»º WireGuard éš§é“çš„å…¥å£ã€‚è¿™é‡Œå¯ä»¥å‚è€ƒä¹‹å‰çš„æµç¨‹ï¼šæ·»åŠ åŸŸåè®°å½•ã€‚ æ³¨æ„è¿™é‡Œçš„è®°å½•å€¼éœ€è¦å¡«å†™ä½ æœåŠ¡å™¨çš„å…¬ç½‘ IPã€‚ å¼€æ”¾ç«¯å£ æ¥ç€å»åˆ°æœåŠ¡å™¨ç®¡ç†åå°ï¼Œéœ€è¦åœ¨é˜²ç«å¢™ä¸­å¼€æ”¾ NAS ä¸­ WireGuard çš„ç«¯å£ã€‚åœ¨å‰æ–‡ç¤ºä¾‹ä¸­ï¼Œè¯¥å€¼ä¸º 51820ã€‚ åœ¨äº‘æœåŠ¡å™¨ä¸Šé…ç½® WireGuard å®‰è£… WireGuard æœåŠ¡ é¦–å…ˆæˆ‘ä»¬ ssh åˆ°è¿œç«¯äº‘æœåŠ¡å™¨ï¼Œç„¶åå®‰è£… WireGuard æœåŠ¡ï¼š apt update &amp;&amp; apt install wireguard -y # å…ˆæ›´æ–°å†å®‰è£… è¯¥è¿‡ç¨‹å¯èƒ½ä¼šè¶…æ—¶ï¼Œå¯ä»¥è¯•ç€ä¿®æ”¹ sources.list æºè§£å†³ã€‚ åˆ›å»ºé…ç½® ç„¶åæˆ‘ä»¬åˆ›å»ºå¹¶è¿›å…¥ wireguard æ–‡ä»¶å¤¹ã€‚ mkdir /etc/wireguard cd /etc/wireguard æ¥ç€æŒ‰ç…§ é…ç½® WireGuard æœåŠ¡ç«¯ çš„æ–¹å¼ï¼Œåˆ›å»ºå…¬ç§é’¥ã€‚ æ³¨æ„è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸¤å¥—å®¢æˆ·ç«¯é…ç½®ã€‚å› ä¸ºç°åœ¨æˆ‘ä»¬æ˜¯è¦å°†è¯¥äº‘æœåŠ¡å™¨ä½œä¸º WireGuard çš„æœåŠ¡ç«¯ï¼ŒNAS å’Œæˆ‘ä»¬çš„æ“ä½œç»ˆç«¯ï¼ˆæ¯”å¦‚ Macï¼‰éƒ½æ˜¯å®¢æˆ·ç«¯ã€‚ æ¥ç€æˆ‘ä»¬åˆ›å»º wg1.conf é…ç½®æ–‡ä»¶ã€‚ å› ä¸ºå‰æ–‡åˆ›å»ºçš„æ˜¯ wg0.confï¼Œè¿™é‡Œä¸ºäº†å’Œå‰æ–‡çš„å†…å®¹åŒºåˆ†å¼€ï¼Œæ‰€ä»¥å‘½åä¸º wg1.confã€‚æ‚¨ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸ªäººå–œæ¬¢éšæ„å‘½åã€‚ å®¢æˆ·ç«¯é…ç½® NAS é…ç½® é€šè¿‡ SSH è¿æ¥ NASï¼Œè¿›å…¥ /etc/wireguard æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ wg1.conf é…ç½®æ–‡ä»¶ã€‚ ä¿å­˜æ–‡ä»¶åï¼Œé€šè¿‡ wg-quick up wg1 å‘½ä»¤å¯åŠ¨é…ç½®ã€‚æˆ–è€…å‚è€ƒå‰æ–‡è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ã€‚ å®¢æˆ·ç«¯é…ç½® å®¢æˆ·ç«¯é…ç½®å°±ç®€å•å¾ˆå¤šäº†ï¼Œå’Œå‰æ–‡ä¸­çš„æ“ä½œæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚ æ³¨æ„ç«¯å£ã€IP å³å¯ã€‚ ","link":"https://blog.rakuyo.dev/synology-with-cloud/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½®Nginxè®¿é—®DockeræœåŠ¡","content":"å½“æˆ‘ä»¬é…ç½®å®Œ DDNS å’Œ WireGuard ä¹‹åï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®‰å…¨çš„è®¿é—®æˆ‘ä»¬ NAS ä¸Šçš„æ–‡ä»¶ä»¥åŠå„ç§æœåŠ¡äº†ã€‚ ä½†æ˜¯å¦‚æœä½ è§‰å¾—é€šè¿‡ç«¯å£è®¿é—® Docker ä¸­å„ä¸ªæœåŠ¡å¤ªç¹çï¼Œæˆ–è€… Docker æœåŠ¡å¤ªå¤šï¼Œè¦è®°çš„ç«¯å£å¤ªå¤šã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½® Nginx çš„æ–¹å¼ï¼Œæ¥ç»™å„ä¸ª Docker æœåŠ¡ç»‘å®šä¸€ä¸ªåŸŸåã€‚ æœ¬æ–‡ä¸ºã€Šç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸‰ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½® DDNS ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½® WireGuard ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½® Nginx è®¿é—® Docker æœåŠ¡ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäº”ï¼‰ï¼šä½¿ç”¨ certd å…è´¹ç‰ˆé…ç½®æ³›åŸŸåè¯ä¹¦ åœ¨äº‘å¹³å°æ·»åŠ è®°å½•å€¼ å‰é¢å‡ ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åœ¨è…¾è®¯äº‘ä¸Šè®¾ç½®è¿‡å¤šæ¡ä¸»æœºè®°å½•ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦å†æ·»åŠ ä¸€æ¡ä½œä¸ºæˆ‘ä»¬ Docker æœåŠ¡çš„å…¥å£åŸŸåã€‚ åŒæ ·æ˜¯åœ¨è…¾è®¯äº‘ æˆ‘çš„åŸŸå é¡µé¢ï¼Œç‚¹å‡»å·²æ³¨å†ŒåŸŸåï¼Œè¿›å…¥â€œè®°å½•ç®¡ç†â€é¡µé¢ã€‚ å•å‡»æ·»åŠ è®°å½•ï¼Œæ ¹æ®ä½ æœåŠ¡çš„éœ€æ±‚æ·»åŠ ä¸€æ¡ä¸»æœºè®°å½•ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¸º calibre-web æ·»åŠ åŸŸåï¼Œé‚£ä¹ˆä¸»æœºè®°å½•å¯ä»¥å†™ calibreã€‚ è®°å½•å€¼å’Œä½  NAS çš„å†…ç½‘ IP ç›¸åŒã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®¾ç½®çš„ 192.168.47.29ã€‚ é…ç½® NAS çš„ Nginx DSM æœ¬èº«è‡ªå¸¦ Nginxï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è‡ªå¸¦ Nginx çš„æ–¹å¼æ¥ä¸º Docker æœåŠ¡å¢åŠ é…ç½®ã€‚ DSM çš„ Nginx æ¯æ¬¡å¯åŠ¨æ—¶ä¼šæ ¹æ®æ¨¡æ¿æ–‡ä»¶é‡æ–°åˆ›å»ºï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¸ä¿®æ”¹æ–‡ä»¶æœ¬èº«ï¼Œæ‰€ä»¥æ— ç¢ã€‚ é€šè¿‡ ps aux|grep nginx å‘½ä»¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ° DSM åŠ è½½çš„æ˜¯ /etc/nginx/nginx.conf.runï¼Œåœ¨è¯¥æ–‡ä»¶æœ«å°¾æœ‰ä¸€è¡Œ include sites-enabled/*ã€‚è¿™ä»£è¡¨ç€æˆ‘ä»¬å¯ä»¥å°†æ–°å¢çš„é…ç½®æ”¾åˆ° /etc/nginx/sites-enabled æ–‡ä»¶å¤¹ä¸‹ã€‚ è¿›å…¥ sites-enabled æ–‡ä»¶å¤¹ï¼Œç„¶åé€šè¿‡ vim æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š cd /etc/nginx/sites-enabled vim calibre.baidu.com.conf # å¯ä½¿ç”¨ä½ è¦é…ç½®çš„æœåŠ¡çš„åŸŸåä½œä¸ºæ–‡ä»¶å åœ¨æ–‡ä»¶å†…å¡«å…¥ä¸‹é¢çš„å†…å®¹ï¼š server { listen 80; server_name calibre.baidu.com; # æœåŠ¡çš„åŸŸåï¼Œæ ¹æ®å®é™…æƒ…å†µæ›¿æ¢ #charset koi8-r; #access_log /var/log/nginx/host.access.log main; location / { proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; proxy_redirect off; proxy_pass http://172.17.0.1:8083; # å¡«å†™ç¾¤æ™–å®¹å™¨è¯¦æƒ…ä¸­è®¾ç½®çš„ç½‘å…³/IPåœ°å€+é…ç½®çš„ç«¯å£ # å¦‚æœæ‚¨è¦ä½¿ç”¨æœ¬åœ°å­˜å‚¨ç­–ç•¥ï¼Œè¯·å°†ä¸‹ä¸€è¡Œæ³¨é‡Šç¬¦åˆ é™¤ï¼Œå¹¶æ›´æ”¹å¤§å°ä¸ºç†è®ºæœ€å¤§æ–‡ä»¶å°ºå¯¸ client_max_body_size 2000m; } } ä¿å­˜åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å‘Šè¯‰ Nginx ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶å¯åŠ¨ï¼Œç„¶åé‡è½½ Nginx çš„é…ç½®æ–‡ä»¶ã€‚ /usr/bin/nginx -c /etc/nginx/nginx.conf.run -t /usr/bin/nginx -c /etc/nginx/nginx.conf.run -s reload ç°åœ¨æ‚¨åº”è¯¥å·²ç»å¯ä»¥ä½¿ç”¨ calibre.baidu.com ä»£æ›¿ sana.baidu.com:8083 æ¥è®¿é—®æ‚¨çš„ calibre-web æœåŠ¡äº†ã€‚ ","link":"https://blog.rakuyo.dev/synology-docker-public-access/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½®WireGuard","content":"å› ä¸ºé…ç½®äº†å…¬ç½‘ ipï¼Œä¸ºäº†å®‰å…¨ï¼Œä½¿ç”¨ WireGuard æ§åˆ¶è®¿é—®ã€‚ æœ¬æ–‡å‚è€ƒè‡ªï¼šç¾¤æ™–DS220+å®‰è£… WireGuard ä¿å§†çº§æ•™ç¨‹ æœ¬æ–‡ä¸ºã€Šç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬äºŒç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½® DDNS ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½® WireGuard ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½® Nginx è®¿é—® Docker æœåŠ¡ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäº”ï¼‰ï¼šä½¿ç”¨ certd å…è´¹ç‰ˆé…ç½®æ³›åŸŸåè¯ä¹¦ å®‰è£… WireGuard å¥—ä»¶ å¼€å¯ SSH å› ä¸º WireGuard å®‰è£…åéœ€è¦é€šè¿‡ SSH æ‰§è¡Œç›¸å…³å‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå¼€å¯ç¾¤æ™–çš„ SSH åŠŸèƒ½ã€‚ åœ¨ç¾¤æ™– â€œç»ˆç«¯æœºå’ŒSNMP -&gt; ç»ˆç«¯æœºâ€ ä¸­å‹¾é€‰ å¯åŠ¨SSHåŠŸèƒ½ï¼Œç«¯å£å·ä½¿ç”¨é»˜è®¤å³å¯ã€‚ç„¶åç‚¹å‡»åº”ç”¨å³å¯å®Œæˆå¼€å¯ã€‚ éšåæ‚¨å¯ä»¥å°è¯•åœ¨ç»ˆç«¯ä¸­é€šè¿‡å†…ç½‘æˆ–å…¬ç½‘ip/åŸŸåè®¿é—®ç¾¤æ™–ã€‚ å¦‚æœæ‚¨è¿˜æ²¡æœ‰å…¬ç½‘ipï¼Œé‚£ä¹ˆæ‚¨éœ€è¦åœ¨å†…ç½‘ç¯å¢ƒä¸‹å®Œæˆåç»­æ“ä½œï¼Œå› ä¸ºç¾¤æ™–çš„ QC æ˜¯ä¸æ”¯æŒ SSH è®¿é—®çš„ã€‚ å®‰è£… WireGuard å¥—ä»¶ é¦–å…ˆåœ¨ â€œå¥—ä»¶ä¸­å¿ƒ -&gt; è®¾ç½® -&gt; å¥—ä»¶æ¥æºâ€ ä¸­æ·»åŠ  spk7.imnks.com/ çŸ¿ç¥æºã€‚éšåæœç´¢ WireGuardï¼Œæ‰¾åˆ°å¯¹åº”å¥—ä»¶åç‚¹å‡»å®‰è£…ã€‚ å®‰è£…å®Œæˆåæˆ‘ä»¬é€šè¿‡ SSH è®¿é—®ç¾¤æ™–NASã€‚ æˆ‘è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œé¦–å…ˆæ‰§è¡Œäº† sudo su å‘½ä»¤ï¼Œé¿å…åç»­æƒé™é—®é¢˜ã€‚ SSH ç™»å½•ç¾¤æ™– NAS åï¼Œæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š # èµ‹äºˆWireguardå¥—ä»¶æƒé™ï¼Œåœ¨å®‰è£…ç¾¤æ™–å¥—ä»¶æ—¶ï¼Œæˆ‘ä»¬åœ¨ç®€ä»‹å¤„ä¹Ÿçœ‹åˆ°äº†è¯¥å‘½ä»¤ã€‚ sudo sed -i 's/package/root/g' /var/packages/WireGuard/conf/privilege è‡³æ­¤ WireGuard å¥—ä»¶å®‰è£…å®Œæˆã€‚ é…ç½® WireGuard æœåŠ¡ç«¯ ä¾æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è¿›å…¥ WireGuard é…ç½®æ–‡ä»¶å¤¹ï¼š # åˆ›å»ºç›¸å…³ç›®å½•ï¼Œè¯¥ç›®å½•å¯èƒ½å·²ç»å­˜åœ¨ï¼Œæ— è§†ç›¸å…³æŠ¥é”™å³å¯ã€‚ mkdir /etc/wireguard/ # è¿›å…¥Wireguardæ–‡ä»¶å¤¹ï¼Œåç»­æ“ä½œéƒ½å°†åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­è¿›è¡Œã€‚ cd /etc/wireguard/ åˆ›å»ºå…¬ç§é’¥ åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”ŸæˆæœåŠ¡ç«¯å…¬ç§é’¥ä»¥åŠå®¢æˆ·ç«¯å…¬ç§é’¥ï¼š #ç”ŸæˆæœåŠ¡å™¨ç«¯ç§é’¥ wg genkey &gt; server_privateKey #ç”ŸæˆæœåŠ¡å™¨ç«¯ç§é’¥å¯¹åº”çš„å…¬é’¥ wg pubkey &lt; server_privateKey &gt; server_publicKey # ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥åŠå¯¹åº”çš„å…¬é’¥ wg genkey | tee client_privateKey | wg pubkey &gt; client_publicKey # ä½¿ç”¨ cat å‘½ä»¤æŸ¥çœ‹å¯¹åº”å†…å®¹ã€‚ cat server_privateKey cat server_publicKey cat client_privateKey cat client_publicKey å¤åˆ¶å¥½è¿™äº›ç§˜é’¥ï¼Œåé¢é…ç½®æ–‡ä»¶æ—¶éœ€è¦ç”¨åˆ°ã€‚ åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ æŒ‰ç…§æ³¨é‡Šï¼Œå°†ä¸‹é¢é…ç½®ä¸­çš„å†…å®¹æ›¿æ¢ä¸ºæ‚¨åœ¨ä¸Šä¸€æ­¥ä¸­ç”Ÿæˆçš„å†…å®¹ã€‚ [Interface] PrivateKey = serverprivatekey # æ›¿æ¢ä¸ºæœåŠ¡å™¨ç§é’¥ Address = 10.8.0.1/24 PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth+ -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth+ -j MASQUERADE ListenPort = 51820 # ç«¯å£é»˜è®¤ 51820ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ MTU = 1420 [Peer] PublicKey = clientpublickey # æ›¿æ¢ä¸ºå®¢æˆ·ç«¯å…¬é’¥ AllowedIPs = 10.8.0.2/32 è¯´æ˜ï¼š ä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­çš„ Address å’Œ AllowedIPsï¼Œå‰ä¸‰ä½éœ€è¦åœ¨åŒä¸€å±€åŸŸç½‘å†…å¯¹é½ã€‚æœ€åä¸€ä½è¯¦è§åæ–‡ æ·»åŠ æ–°çš„å®¢æˆ·ç«¯ ä¸€èŠ‚ã€‚ ç¼–è¾‘åå†…å®¹åå›åˆ°ç»ˆç«¯ï¼Œä½¿ç”¨ vim æˆ–å…¶ä»–æ‰‹æ®µåœ¨ /etc/wireguard/ è·¯å¾„ä¸‹åˆ›å»º wg0.conf æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸ºä¸Šè¿°é…ç½®ã€‚ å¯åŠ¨æœåŠ¡ å…ˆå›åˆ°ç¾¤æ™–å¥—ä»¶ä¸­å¿ƒï¼Œå¯åŠ¨ WireGuard å¥—ä»¶ã€‚ ä¹‹å‰å¯åŠ¨äº†ä¹Ÿæ— æ‰€è°“ï¼Œé¡ºåºä¸é‡è¦ å†å›åˆ°SSHç»ˆç«¯ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åŠ è½½é…ç½®æ–‡ä»¶ï¼š # ä½¿ç”¨ `up` å‘½ä»¤åŠ è½½ wg0 é…ç½® sudo wg-quick up wg0 # ä½¿ç”¨ `down` å‘½ä»¤åœæ­¢ wg0ï¼Œå½“å‰ä¸æ‰§è¡Œ # sudo wg-quick down wg0 éšåæˆ‘ä»¬ä½¿ç”¨ wg å‘½ä»¤å³å¯æŸ¥çœ‹å½“å‰çŠ¶æ€ï¼š è¯´æ˜ï¼š æœ‰å®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™ peer æ‰ä¼šæ˜¾ç¤º keepaliveï¼Œæ­¤æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®å®¢æˆ·ç«¯è¿æ¥ï¼Œèƒ½å¤Ÿå±•ç¤ºå‡ºæ¥å¯¹åº”çš„é…ç½®å³å¯ã€‚ æœ€åæˆ‘ä»¬ä¸º wg0 æœåŠ¡æ·»åŠ å¼€æœºè‡ªå¯åŠ¨ï¼š sudo wg-autostart enable wg0 # å¼€å¯è‡ªå¯åŠ¨ # sudo wg-autostart disable wg0 # å…³é—­è‡ªå¯åŠ¨ å¤‡æ³¨ï¼šç¾¤æ™–çš„ WireGuard å¥—ä»¶æ— æ³•é€šè¿‡ systemctl æ¥é…ç½®å¼€å¯è‡ªå¯åŠ¨ï¼Œä¸çŸ¥é“æ˜¯ DSM çš„é—®é¢˜è¿˜æ˜¯å¥—ä»¶çš„é—®é¢˜ï¼Œè¿™é‡Œæ²¡æœ‰è¿›ä¸€æ­¥æ·±ç©¶ã€‚ è·¯ç”±å™¨è®¾ç½®ç›‘å¬ç«¯å£å·è½¬å‘ ä¸ºäº†æ›´å¥½çš„ç†è§£åé¢çš„æ“ä½œï¼Œæˆ‘ä»¬å…ˆå¤§è‡´è®²ä¸€ä¸‹å€ŸåŠ© WireGuard è¦åšçš„äº‹æƒ…ï¼š æˆ‘ä»¬ä¹‹å‰åœ¨ ç¾¤æ™–NASé…ç½®DDNS ä¸€æ–‡ä¸­é…ç½®äº† DDNSï¼Œåœ¨åé¢çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©ä¸Šé¢çš„åŸŸåæ¥æ„å»º WireGuard éš§é“ã€‚ç­‰åˆ°éš§é“å»ºç«‹å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å†å€ŸåŠ©ç«¯å£è½¬å‘ï¼Œé€šè¿‡éš§é“èµ°å†…ç½‘æœåŠ¡ã€‚ è…¾è®¯äº‘ä¸Šçš„é…ç½® å› ä¸ºä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„è®°å½•è¢«æˆ‘ä»¬ç”¨æ¥å»ºç«‹éš§é“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€æ¡è®°å½•æ¥ä½œä¸º NAS çœŸæ­£çš„å…¥å£ã€‚ æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æ–°å»ºä¸€æ¡è®°å½•ï¼Œä¸»æœºè®°å½•éšä½ å®šï¼Œæ³¨æ„è®°å½•å€¼éœ€è¦å¡«å†™ä¸º NAS åœ¨å†…ç½‘ä¸­çš„ IP åœ°å€ã€‚ åæ–‡æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹åŸŸåä½œä¸ºç¤ºä¾‹ï¼š ç”¨äºåˆ›å»º WireGuard éš§é“çš„åŸŸåï¼šgwa.baidu.comï¼Œè®°å½•å€¼ä¸ºå…¬ç½‘ ipï¼ˆ39.156.66.10ï¼‰ ä½œä¸º NAS å…¥å£çš„åŸŸåï¼šsana.baidu.comï¼Œè®°å½•å€¼ä¸º NAS å†…ç½‘ ipï¼ˆ192.168.47.29ï¼‰ è·¯ç”±å™¨é™æ€ IP åˆ†é… å› ä¸ºè·¯ç”±å™¨é‡å¯ä¼šå¯¼è‡´ ip å˜åŒ–ï¼Œè€Œæˆ‘ä»¬éœ€è¦ NAS å†…ç½‘çš„ IP å€¼ã€‚å¥½åœ¨ç°åœ¨å¤§éƒ¨åˆ†è·¯ç”±å™¨éƒ½æ”¯æŒ DHCP é™æ€ IP åˆ†é…ã€‚ ç™»å½•è·¯ç”±å™¨åå°ï¼Œæ ¹æ®ä½ çš„è·¯ç”±å™¨çš„è®¾ç½®ï¼Œå°†ç¾¤æ™–å¯¹åº”è®¾å¤‡çš„ IP æ·»åŠ åˆ° DHCP é™æ€ IP åˆ—è¡¨ï¼Œä½¿å…¶æ‹¥æœ‰å›ºå®šçš„ IP å€¼ã€‚ é€šè¿‡ NAS è®¾ç½®ç«¯å£è½¬å‘ æˆ‘è¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯é€šè¿‡ç¾¤æ™–è®¾ç½®ç«¯å£è½¬å‘ï¼Œè€Œä¸æ˜¯é€šè¿‡è·¯ç”±å™¨ã€‚å¦‚æœä½ å¸Œæœ›é€šè¿‡è·¯ç”±å™¨è¿›è¡Œè½¬å‘ï¼Œåˆ™å¯ä»¥åœ¨è·¯ç”±å™¨åå°ä¸Šè¿›è¡Œè®¾ç½®ã€‚ å…ˆç•™åœ¨è·¯ç”±å™¨ç®¡ç†åå°ï¼Œæˆ‘ä»¬éœ€è¦å¼€å¯è·¯ç”±å™¨çš„ UPnP åŠŸèƒ½ï¼Œè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä½¿ç”¨ NAS æ¥è®¾ç½®ç«¯å£è½¬å‘ã€‚ å¼€å¯è·¯ç”±å™¨çš„ UPnP ä¹‹åï¼Œæˆ‘ä»¬å›åˆ° NASï¼Œæ¥åˆ° â€œæ§åˆ¶é¢æ¿ -&gt; å¤–éƒ¨è®¿é—® -&gt; è·¯ç”±å™¨é…ç½®â€ é¡µé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç‚¹å‡»æ–°å¢æŒ‰é’®ï¼Œé€‰æ‹© â€œè‡ªå®šä¹‰ç«¯å£â€ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥ã€‚ åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œé€šè®¯åè®®æˆ‘ä»¬é€‰æ‹© UDPï¼Œç«¯å£è®¾ç½®ä¸º åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ ä¸€èŠ‚ä¸­ï¼ŒListenPort çš„å€¼ã€‚ æœ€åç‚¹å‡»å®Œæˆã€‚å®Œæˆåæˆ‘ä»¬å¯ä»¥å›åˆ°è·¯ç”±å™¨çš„ UPnP é¡µé¢ï¼Œåˆ·æ–°çœ‹çœ‹æ˜¯å¦æœ‰å¯¹åº”çš„è®°å½•ã€‚ é…ç½® WireGuard å®¢æˆ·ç«¯ ä¸‹è½½å®¢æˆ·ç«¯ WireGuard å®¢æˆ·ç«¯ä¸‹è½½å‚è€ƒï¼šWireGuardå®¢æˆ·ç«¯ã€‚Apple å¹³å°å‡éœ€è¦å›½å¤–çš„ Apple IDã€‚ åˆ›å»ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ å®‰è£…å®¢æˆ·ç«¯çš„é—´éš™ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡å¥½å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼š [Interface] PrivateKey = clientprivatekey # æ›¿æ¢ä¸ºå®¢æˆ·ç«¯ç§é’¥ Address = 10.8.0.2/32 # è¿™é‡Œéœ€è¦å¯¹åº”ä¸Šæ–‡ [åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶] ä¸€èŠ‚ä¸­ï¼Œpeer.AllowedIPs é‡Œå¯¹åº”çš„å€¼ MTU = 1420 [Peer] PublicKey = serverpublickey # æ›¿æ¢ä¸ºæœåŠ¡ç«¯å…¬é’¥ Endpoint = gwa.baidu.com:51820 # ç”¨äºåˆ›å»º WireGuard éš§é“çš„åŸŸåï¼ŒåŠ ä¸Šä¸Šæ–‡è®¾ç½®çš„ ListenPort ç«¯å£ AllowedIPs = 10.8.0.1/24, 192.168.47.29/24 # åˆ†åˆ«æ˜¯ [åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶] ä¸€èŠ‚ä¸­,Interface.Addressï¼Œä»¥åŠ NAS å†…ç½‘ IP PersistentKeepalive = 25 å°†ä¸Šè¿°å†…å®¹ä¿å­˜ä¸º wgnas.confï¼ˆæ–‡ä»¶åéšæ„ï¼‰ã€‚ä¹‹åæˆ‘ä»¬æ‰“å¼€ WireGuard å®¢æˆ·ç«¯ï¼Œé€‰æ‹©é€šè¿‡æ–‡ä»¶åˆ›å»ºéš§é“ï¼Œé€‰æ‹© wgnas.confï¼Œå³å¯å®Œæˆé…ç½®è®¾ç½®ã€‚ è‡³æ­¤ï¼Œæ‚¨çš„åŸŸåé…ç½®åº”è¯¥ç¬¦åˆä¸‹é¢çš„æƒ…å†µï¼š WireGuard å¼€å¯çŠ¶æ€ gwa.baidu.com sana.baidu.com å¼€å¯ æ— æ³•è®¿é—® èƒ½è®¿é—® NAS å…³é—­ æ— æ³•è®¿é—® æ— æ³•è®¿é—® å³åªæœ‰åœ¨å¼€ç€ WireGuard çš„å‰æä¸‹ï¼Œå¯ä»¥é€šè¿‡ sana.baidu.com è®¿é—®æ‚¨çš„ NAS æœåŠ¡ã€‚ æ·»åŠ æ–°çš„å®¢æˆ·ç«¯ ä¸Šé¢çš„æ­¥éª¤é‡Œæˆ‘ä»¬åªæ·»åŠ äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå› ä¸ºåŒä¸€æ—¶é—´ WireGuard åªèƒ½è¯†åˆ«ä¸€ä¸ªéš§é“ï¼Œå¦‚æœæ‚¨æœ‰å¤šå°è®¾å¤‡ï¼Œæˆ–è€…å¤šäººå…¬ç”¨åŒä¸€å° NASï¼Œåˆ™éœ€è¦è®¾ç½®å¤šä¸ª WireGuard å®¢æˆ·ç«¯é…ç½®ï¼Œä¸èƒ½å¤šå°è®¾å¤‡åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚ è®©æˆ‘ä»¬æ‰“å¼€ åˆ›å»ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶ ä¸­çš„åˆ›å»ºçš„é…ç½®æ–‡ä»¶ã€‚ å…¶ä¸­ Peer çš„éƒ¨åˆ†ä»£è¡¨ç€æ¯ä¸ªå®¢æˆ·ç«¯ã€‚å½“æˆ‘ä»¬éœ€è¦æ–°å¢å®¢æˆ·ç«¯æ—¶ï¼ŒæœåŠ¡ç«¯éœ€è¦æ·»åŠ ä¸€å¥—æ–°çš„ Peer é…ç½®ã€‚ [Interface] PrivateKey = serverprivatekey Address = 10.8.0.1/24 ... ListenPort = 51820 MTU = 1420 # ä¸Šè¿°å†…å®¹ä¿æŒä¸å˜ [Peer] PublicKey = clientpublickey AllowedIPs = 10.8.0.2/32 [Peer] # æ–°çš„ Peer é…ç½® PublicKey = clientpublickey01 # ä¸€å¥—æ–°çš„å®¢æˆ·ç«¯å…¬é’¥ AllowedIPs = 10.8.0.3/32 # æ³¨æ„è¿™é‡Œéœ€è¦ä¿®æ”¹ ip åœ°å€æœ€åä¸€ä½ï¼Œä¸€èˆ¬+1å³å¯ éšåæŒ‰ç…§ åˆ›å»ºå®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ ä¸­çš„æ–¹æ³•ï¼Œåœ¨æ–°çš„å®¢æˆ·ç«¯ä¸­åŠ è½½æ–°çš„é…ç½®æ–‡ä»¶å³å¯ã€‚ ","link":"https://blog.rakuyo.dev/synology-with-wireguard/"},{"title":"ç¾¤æ™–NASå…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½®DDNS","content":"æœ¬æ–‡ä½¿ç”¨DSM 7.0ã€‚è¯·æ‚¨ç¡®ä¿å·²ç»è·å–äº†å…¬ç½‘ ipï¼Œå¹¶ä¸”å·²ç»è´­ä¹°äº†åŸŸåã€‚ å› ä¸ºæˆ‘çš„åŸŸååœ¨è…¾è®¯äº‘ä¸Šï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ DDNS ä½¿ç”¨è…¾è®¯äº‘çš„æœåŠ¡ï¼Œæ­¥éª¤å‚è€ƒï¼šç¾¤æ™–ï¼ˆSynologyï¼‰NAS å¯ç”¨è…¾è®¯äº‘ DDNS å¹¶å®‰è£…å…è´¹è¯ä¹¦ æœ¬æ–‡ä¸ºã€Šç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ã€‹ç³»åˆ—æ–‡ç« çš„ç¬¬ä¸€ç¯‡ã€‚å…¨éƒ¨æ–‡ç« è¯·å‚è€ƒï¼š ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸€ï¼‰ï¼šé…ç½® DDNS ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäºŒï¼‰ï¼šé…ç½® WireGuard ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆä¸‰ï¼‰ï¼šé…ç½® Nginx è®¿é—® Docker æœåŠ¡ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆå››ï¼‰ï¼šé…ç½®äº‘æœåŠ¡å™¨ ç¾¤æ™– NAS å…¬ç½‘è®¿é—®é…ç½®ï¼ˆäº”ï¼‰ï¼šä½¿ç”¨ certd å…è´¹ç‰ˆé…ç½®æ³›åŸŸåè¯ä¹¦ è·å–è…¾è®¯äº‘ API å¯†é’¥ ç™»å½• è…¾è®¯äº‘ API å¯†é’¥ ï¼Œæ–°å»ºè…¾è®¯äº‘ API SecretId åŠ SecretKey å¯†é’¥ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¤åˆ¶å¥½æ‚¨çš„ Id ä»¥åŠ Keyï¼Œç‚¹å‡»ç¡®å®šå key å°†æ— æ³•æŸ¥çœ‹ã€‚ æ·»åŠ åŸŸåè®°å½• åœ¨ æˆ‘çš„åŸŸå é¡µé¢ï¼Œç‚¹å‡»å·²æ³¨å†ŒåŸŸåï¼Œè¿›å…¥â€œè®°å½•ç®¡ç†â€é¡µé¢ã€‚ å•å‡»æ·»åŠ è®°å½•ï¼Œæ·»åŠ ä¸€æ¡ä¸»æœºè®°å½•ä¸ºä»»æ„ï¼Œè®°å½•å€¼ä¸ºä»»æ„ IP çš„ A è®°å½•ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¯´æ˜ï¼š å‡å¦‚æ‚¨çš„åŸŸåä¸º baidu.comï¼Œä¸»æœºè®°å½•ä¸º abcï¼Œé‚£ä¹ˆå¯¹åº”çš„åŸŸåå°±æ˜¯ abc.baidu.comã€‚æ‰€ä»¥æœ¬æ­¥éª¤ä¸­çš„ä¸»æœºè®°å½•è¯·æ ¹æ®æ‚¨çš„å®é™…æƒ…å†µå¡«å†™ã€‚ è®°å½•å€¼å¯ä»¥å¡«å†™ä¸ºä»»æ„ IP åœ°å€ï¼ˆæ¯”å¦‚0.0.0.0ï¼‰ï¼Œæœ€å DDNS ç»‘å®šå®Œæˆåï¼Œè¯¥å€¼ä¼šè‡ªåŠ¨æ›´æ–°ä¸ºæ­£ç¡®çš„å…¬ç½‘ IP åœ°å€ï¼Œæ‰€ä»¥ç°åœ¨å¡«çš„å†…å®¹æ— æ‰€è°“ã€‚ ç¾¤æ™–é…ç½® DDNS é¦–å…ˆæŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºï¼Œè¿›å…¥ç¾¤æ™–æ·»åŠ  DDNS çš„é¢æ¿ å¤–éƒ¨åœ°å€åº”å½“å°±æ˜¯æ‚¨çš„å…¬ç½‘ ip åœ°å€ã€‚ å…¶ä½™å„å­—æ®µä¸ºï¼š æœåŠ¡ä¾›åº”å•†ï¼šè…¾è®¯äº‘ã€‚ ä¸»æœºåç§°ï¼šè¯·å¡«å†™ä¸Šä¸€æ­¥ä¸­æ‚¨æ·»åŠ çš„åŸŸååç§°ã€‚æ¯”å¦‚ abc.baidu.comã€‚ ç”¨æˆ·å/ç”µå­é‚®ä»¶ï¼šè¯·å¡«å†™æ‚¨è·å–åˆ°çš„ SecretId ä¿¡æ¯ã€‚ å¯†ç /å¯†é’¥ï¼šè¯·å¡«å†™æ‚¨è·å–åˆ°çš„ SecretKey ä¿¡æ¯ã€‚ ä» Tencent Cloud è·å–è¯ä¹¦ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºé»˜è®¤è¯ä¹¦ï¼šå‹¾é€‰é€‰é¡¹åï¼Œå¯è‡ªåŠ¨ä¸ºæ‚¨ç”³è¯·è…¾è®¯äº‘ TrustAsia SSL å…è´¹è¯ä¹¦å¹¶æ›¿æ¢ NAS çš„é»˜è®¤ SSL è¯ä¹¦ã€‚ å¤‡æ³¨ï¼š å¦‚æœæ‚¨ä¸éœ€è¦ httpsï¼Œé‚£ä¹ˆè¿™ä¸ªè¯ä¹¦ä¸å‹¾é€‰ä¹Ÿå¯ä»¥ã€‚ æ­¤æ—¶å¯ä»¥å•å‡»æµ‹è¯•è”æœºï¼Œæµ‹è¯•æ˜¯å¦èƒ½è”æœºæˆåŠŸã€‚å¦‚çŠ¶æ€æ æ˜¾ç¤ºä¸ºæ­£å¸¸ï¼Œåˆ™ä»£è¡¨è”æœºæˆåŠŸã€‚ æœ€åå•å‡»ç¡®å®šï¼Œå³å¯å®Œæˆè®¾ç½®ã€‚ç­‰å¾…è§£æç”Ÿæ•ˆåï¼ˆè§£æç”Ÿæ•ˆæ—¶é—´ä¸€èˆ¬éœ€è¦ 10åˆ†é’Ÿï¼‰ï¼Œå³å¯ä½¿ç”¨åŸŸåï¼ˆabc.baidu.com:5000ï¼Œéœ€è¦æºå¸¦ç«¯å£ï¼‰è®¿é—®NASã€‚ æ‰‹åŠ¨æ›´æ–° DDNSï¼ˆå¯é€‰ï¼‰ å®Œæˆè®¾ç½®åï¼Œå•å‡»ç¾¤æ™–é¢æ¿ä¸Šçš„ç«‹å³æ›´æ–°ï¼Œç³»ç»Ÿä¼šæ›´æ–°æœ€æ–°çš„ DDNS è§£æè®°å½•ï¼Œå¹¶ç¡®è®¤çŠ¶æ€æ˜¯å¦æ˜¾ç¤ºä¸ºæ­£å¸¸ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿”å› æˆ‘çš„åŸŸå é¡µé¢ï¼Œå•å‡»åŸŸåï¼Œå³å¯æŸ¥çœ‹è®°å½•å€¼æ˜¯å¦å·²å˜æ›´ä¸ºå…¬ç½‘ IP åœ°å€ã€‚ ","link":"https://blog.rakuyo.dev/synology-config-ddns/"},{"title":"Package.swift é™çº§é—®é¢˜æ’æŸ¥","content":"è¿‡å» Package.swift æ²¡æœ‰å¥½å¥½å†™ï¼Œtoolchain ç‰ˆæœ¬è·Ÿç€ Xcode èµ°ï¼Œæ²¡æœ‰å…¼å®¹ä¸åŒçš„ç‰ˆæœ¬ã€‚æœ€è¿‘ç ”ç©¶ç”¨ SPM ä»£æ›¿ CocoaPodsï¼Œæ‰€ä»¥è®¤çœŸçš„ç ”ç©¶æŠ˜è…¾äº†ä¸€ä¸‹ã€‚ æœ¬æ–‡æ€»ç»“æŠŠ Package.swift ä» 5.9 é™è‡³ 5.1 è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚ æœ¬æ–‡ä¸è®²è§£åŸºç¡€è¯­æ³•ã€‚ ç‰ˆæœ¬å·å‰çš„ç©ºæ ¼ ä¹‹å‰ 5.9 çš„æ—¶å€™æ˜¯è¿™ä¹ˆå†™çš„ï¼š // swift-tools-version: 5.9 ç›´æ¥å°† 5.9 æ”¹æˆ 5.1 ä¹‹åæŠ¥é”™äº†ï¼š horizontal whitespace sequence [U+0020] immediately preceding the version specifier is supported by only Swift â‰¥ 5.4; consider removing the sequence for Swift 5.1 åŸå› æ˜¯ version: å’Œ 5.1 ä¹‹é—´æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚è€Œè¿™ä¸ªç©ºæ ¼æ˜¯ Swift 5.4 æ—¶æ‰æ”¯æŒçš„ç‰¹æ€§... æ‰€ä»¥æ”¹æˆä¸‹é¢è¿™æ ·å°±å¯ä»¥äº†ï¼š // swift-tools-version:5.1 // â¬†ï¸æ³¨æ„è¿™é‡Œæ²¡æœ‰ç©ºæ ¼ å‚è€ƒè‡ªï¼šSwift Package Tools Version çš„å†™æ³• èµ„æºçš„å¼•ç”¨ åƒæˆ‘ä¸€æ ·æ²¡æœ‰æŒç»­å…³æ³¨ SPM å‘å±•çš„å¼€å‘è€…å¯èƒ½ä¸çŸ¥é“ï¼Œåœ¨ SPM ä¸­å¼•ç”¨èµ„æºæ˜¯ 5.3 å¼€å§‹æ‰æ”¯æŒçš„ç‰¹æ€§ã€‚ æ‰€ä»¥å¦‚æœä½ çš„åŒ…ä½¿ç”¨äº† Resource bundle æˆ–è€… Binary Frameworkï¼Œé‚£ä¹ˆä½ å°±ä¸èƒ½é™è‡³ 5.1 äº†ï¼Œæœ€ä½ä¹Ÿè¦ 5.3 ç‰ˆæœ¬æ‰è¡Œã€‚ çœç•¥ target.path æˆ‘æ²¡èƒ½æ‰¾åˆ°è¿™ä¸ªçš„ææ¡ˆï¼Œå¯èƒ½æ˜¯ Allow sources anywhere in ./Sources when only one target is present è¿™ä¸ªã€‚å¦‚æœå“ªä½æ˜ç¡®çŸ¥é“éº»çƒ¦åœ¨è¯„è®ºåŒºå‘ŠçŸ¥ã€‚ åœ¨ 5.9 ç‰ˆæœ¬ä¸Šï¼Œå¦‚æœæˆ‘ä»¬çš„ä»£ç éƒ½åœ¨ Sources ç›®å½•ä¸‹ï¼Œä¸”åªæœ‰ä¸€ä¸ª Targetï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸æ˜¾å¼æŒ‡å®š target.path å±æ€§ã€‚ ä½†æ˜¯åœ¨ 5.1 ç‰ˆæœ¬ä¸Šä¸è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ˜¾å¼åœ°æŒ‡å®š path è·¯å¾„ã€‚ ","link":"https://blog.rakuyo.dev/troubleshooting-package_swift-downgrade-issues/"},{"title":"è§£å†³é‡ç½®SPMç¼“å­˜å¤±è´¥çš„é—®é¢˜","content":"ç›¸ä¿¡ç»å¸¸ä½¿ç”¨ SPM çš„å°ä¼™ä¼´ï¼Œåº”è¯¥éƒ½é‡åˆ°è¿‡ä½¿ç”¨ Reset Package Caches æ—¶æŠ¥é”™ï¼šAn unknown error occurred. reference 'refs/remotes/origin/main' not found (-1)ï¼Œæˆ–è€…å…¶ä»–åˆ†æ”¯ã€‚ å…³äºè¿™ä¸ªé—®é¢˜åœ¨ stackoverflow ä¸Šæœ‰æ¯”è¾ƒå¤šçš„è®¨è®ºï¼Œä¾‹å¦‚è¿™ä¸ª SPM unknown error reference not found when changing branchã€‚ æ€æ¥æƒ³å»å†³å®šæ ¹æ®ä¸Šé¢çš„å›ç­”ï¼Œè®°å½•ä¸€ä¸‹è§£å†³æ–¹æ¡ˆã€‚ åœ¨æˆ‘çš„åœºæ™¯ä¸‹ï¼ˆXcode 15ï¼‰ï¼Œä»…ä»…åˆ é™¤ ~/Library/Caches/org.swift.swiftpm/repositories ä¸‹å¯¹åº”çš„ç›®å½•å³å¯è§£å†³é—®é¢˜ï¼Œä¹‹åé‡æ–° Rest å³å¯ã€‚ é—®é¢˜çš„å‘ç”Ÿ é“¾æ¥ä¸­æåˆ°äº†ä¸¤ç§è§‚ç‚¹ã€‚ä¸€å¼€å§‹ @mrwest09 æåˆ°ï¼Œå¦‚æœä½¿ç”¨ sshï¼ˆgit@ï¼‰å¼•å…¥ä¾èµ–ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿè¯¥é—®é¢˜ã€‚å®é™…ä¸Šè¿™ä¹Ÿç¬¦åˆæˆ‘çš„ä½¿ç”¨åœºæ™¯ï¼ˆä¸è¿‡æˆ‘æ²¡æœ‰è¯• httpsï¼‰ã€‚ ä½†æ˜¯åæ¥ @Ivan Vavilov ä¹Ÿæåˆ°ï¼Œä»–ä½¿ç”¨çš„ httpsï¼Œä½†æ˜¯ä¹Ÿä¾ç„¶å‡ºç°äº†è¯¥é—®é¢˜ã€‚ æ‰€ä»¥æ€ä¹ˆè¯´å¥½å‘¢ï¼Œè¿™ä¸ªé—®é¢˜çš„å‘ç”Ÿæœªå¿…å¯ä»¥éƒ½å½’ç»“åˆ° sshï¼Œè‡³äºçœŸæ­£çš„åŸå› ä»…ä»ä¸Šè¿°å›ç­”ä¸­å¯èƒ½æš‚æ—¶æ— ä»å¾—çŸ¥... é—®é¢˜çš„è§£å†³ ç›´æ¥æ–¹å¼ åˆ é™¤ ~/Library/Caches/org.swift.swiftpm/repositories ä¸‹çš„å†…å®¹å³å¯ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œå›ç­”ä¸­è¿˜æåˆ°äº†ä¸€ä¸ª â€œSwift package caches both in the derived data directory of your projectâ€ã€‚è¯¥ç¼“å­˜çš„å®é™…ç›®å½•åœ¨ ~/Library/Developer/Xcode/DerivedData/$project/SourcePackages/repositoriesã€‚ æˆ‘çš„åœºæ™¯ä¸‹ä»…åˆ é™¤ org.swift.swiftpm ä¸­çš„å†…å®¹å³å¯ã€‚å¦‚æœä½ ä»…åˆ é™¤å®ƒæ— æ•ˆï¼Œå¯ä»¥çœ‹å†è¯•è¯• ä¸€å¹¶ SourcePackages ä¸‹çš„å†…å®¹ã€‚ è‡ªåŠ¨åŒ–å¤„ç† å›ç­”ä¸­è¿˜æœ‰å¥½å¿ƒçš„å¤§ä½¬å†™äº†2ä¸ªè‡ªåŠ¨åˆ é™¤ç¼“å­˜çš„è„šæœ¬ï¼Œä¸€ä¸ªæ˜¯ï¼š #!/bin/bash if [[ $# -eq 0 ]] ; then echo 'Please call the script with the name of your project as it appears in the derived data directory. Case-insensitive.' echo 'For example: ./fix-spm-cache.sh myproject' exit 0 fi # Delete all directories named &quot;remotes&quot; from the global Swift Package Manager cache. cd ~/Library/Caches/org.swift.swiftpm/repositories for i in $(find . -name &quot;remotes&quot; -type d); do echo &quot;Deleting $i&quot; rm -rf $i done # Find derived data directories for all projects matching the script argument, and # delete all directories named &quot;remotes&quot; from source package repositories cache for those projects. cd ~/Library/Developer/Xcode/DerivedData/ for project in $(find . -iname &quot;$1*&quot; -type d -maxdepth 1); do for i in $(find &quot;$project/SourcePackages/repositories&quot; -name &quot;remotes&quot; -type d); do echo &quot;Deleting $i&quot; rm -rf $i done done è¿™ä¸ªè„šæœ¬åˆ é™¤äº†ä¸Šé¢æåˆ°çš„ä¸¤ä¸ªè·¯å¾„ä¸‹çš„ç¼“å­˜ï¼Œä½¿ç”¨æ—¶éœ€è¦ sh ./fix-spm-cache.sh myprojectã€‚ å¦å¤–ä¸€ä¸ªå¤§ä½¬ä½¿ç”¨äº†å¦å¤–ä¸€ä¸ªæ€è·¯ï¼Œç¼–å†™äº†ä¸€ä¸ª python è„šæœ¬ï¼š # Sometimes Xcode cannot resolve SPM(File -&gt; Packages -&gt; Resolve Package versions) if the dependency url is ssh # This script is a workaround to resolve package versions. # Usage: # python spmResolve.py # or # python3 spmResolve.py import os.path import subprocess import glob import json def main(): package_file = &quot;xcshareddata/swiftpm/Package.resolved&quot; xcodeproj = glob.glob('*.xcodeproj') xcworkspace = glob.glob('*.xcworkspace') spmproj = glob.glob('Package.resolved') package_resolved = &quot;&quot; if xcodeproj: package_resolved = xcodeproj[0] + f&quot;/project.xcworkspace/{package_file}&quot; elif xcworkspace: package_resolved = xcworkspace[0] + f&quot;/{package_file}&quot; elif spmproj: package_resolved = spmproj[0] else: print(f&quot;ğŸ˜± Cannot find *.xcodeproj, *.xcworkspace or Package.resolved file&quot;) exit(-1) update_package_resolved(package_resolved) def update_package_resolved(package_resolved): if not os.path.exists(package_resolved): print(f&quot;ğŸ˜± Package.resolved file doesn't exit: {package_resolved}&quot;) exit(-1) print(f&quot;Found: {package_resolved}&quot;) f = open(package_resolved) content = json.load(f) f.close() for pin in content[&quot;pins&quot;]: url = pin[&quot;location&quot;] if &quot;branch&quot; in pin[&quot;state&quot;]: branch = pin[&quot;state&quot;][&quot;branch&quot;] commit_hash = get_git_revision_hash(url, branch) print(f&quot;{url}, {branch}, {commit_hash}&quot;) pin[&quot;state&quot;][&quot;revision&quot;] = commit_hash elif &quot;version&quot; in pin[&quot;state&quot;]: version = pin[&quot;state&quot;][&quot;version&quot;] commit_hash = get_git_revision_by_tag(url, version) print(f&quot;{url}, {version}, {commit_hash}&quot;) pin[&quot;state&quot;][&quot;revision&quot;] = commit_hash with open(package_resolved, &quot;w&quot;) as output: json.dump(content, output, indent=4) # resolve SPM subprocess.run(['xcodebuild', '-resolvePackageDependencies']) print('ğŸ‰ Well done') def get_git_revision_hash(url, branch) -&gt; str: command = f'git ls-remote {url} refs/heads/{branch} | cut -f 1' return get_git_command_output(command) def get_git_revision_by_tag(url, version) -&gt; str: command = f'git ls-remote {url} -t {version} | cut -f 1' return get_git_command_output(command) def get_git_command_output(command) -&gt; str: return subprocess.check_output(command, stderr=subprocess.STDOUT, shell=True).decode('ascii').rstrip() if __name__ == '__main__': main() ä½¿ç”¨æ–¹å¼ä¸ºåœ¨åŒ…å« *.xcodeproj æˆ– *.xcworkspace æ–‡ä»¶çš„è·¯å¾„ä¸‹ï¼Œè°ƒç”¨ python spmResolve.pyã€‚ ","link":"https://blog.rakuyo.dev/fix-spm-cache/"},{"title":"ç§»é™¤å­—ç¬¦ä¸²ä¸­çš„ï¿½","content":"ä¸€ä¸ªéå¸¸éå¸¸éå¸¸å¸¸è§çš„éœ€æ±‚ï¼Œä¸€ä¸ªé™åˆ¶è¾“å…¥é•¿åº¦çš„è¾“å…¥æ¡†ï¼ŒåŒæ—¶ä¸é™åˆ¶ç”¨æˆ·è¾“å…¥å­—ç¬¦çš„ç±»å‹ã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆå‡å®šä¸€ä¸ªéœ€æ±‚ï¼š ä¸€ä¸ªæœ€å¤šè¾“å…¥6ä¸ªå­—ç¬¦çš„è¾“å…¥æ¡†ï¼Œä¸é™åˆ¶ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ç±»å‹ï¼Œå³å¯ä»¥è¾“å…¥ç©ºæ ¼ã€ä¸­æ–‡è‹±æ–‡ã€æ ‡ç‚¹ç¬¦å·ã€æ•°å­—ä»¥åŠ Emojiã€‚ åœ¨è¿™ä¸ªéœ€æ±‚ä¸‹è€ƒè™‘ä¸‹é¢è¿™ä¸ªåœºæ™¯ï¼š è¾“å…¥æ¡†ä¸Šå·²ç»æœ‰äº†æ–‡å­—ï¼š&quot; g,5å°±&quot;ï¼Œç”¨æˆ·å³å°†è¾“å…¥ä¸€ä¸ª ğŸ‰‘ï¸ã€‚ è¿™æ—¶ï¼Œä½ çš„ç¨‹åºå¾ˆå¯èƒ½å°±ä¼šå‡ºé—®é¢˜äº†ã€‚ å­—ç¬¦é•¿åº¦ æˆ‘ä»¬å¤§å®¶åº”è¯¥éƒ½çŸ¥é“ Swift.String çš„ count å±æ€§å’Œ ObjC çš„ length å±æ€§è·å–çš„ç»“æœä¸åŒã€‚ æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œå®é™…è¾“å‡ºç»“æœå¦‚æ³¨é‡Šæ‰€è¿°ã€‚ let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; print(string.count) // 6 print((string as NSString).length) // 8 å›åˆ°éœ€æ±‚å’Œåœºæ™¯ä¸Šï¼Œæˆ‘ç›¸ä¿¡ä½ æ—©å°±çŸ¥é“ï¼Œåœ¨åšè¿™ç§æˆªå–çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥ç”¨ string.count åˆ¤æ–­é•¿åº¦ã€‚ è¿™ç§æ—¶å€™æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨ utf16 ç¼–ç æ¥è·å–é•¿åº¦ï¼š let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; print(string.count) // 6 print(string.utf16.count) // 8 print((string as NSString).length) // 8 ç›´æ¥æˆªå– æå®šäº†é•¿åº¦ï¼Œå‰©ä¸‹çš„å°±æ˜¯æˆªå–äº†ï¼š extension String { func prefixed(_ maxLength: Int) -&gt; String { let sequence = utf16 guard sequence.count &gt; maxLength else { return self } let startIndex = sequence.startIndex let endIndex = sequence.index(startIndex, offsetBy: maxLength) let result = String(sequence[startIndex ..&lt; endIndex]) // ä»¥é˜²ä¸‡ä¸€ï¼Œå€ŸåŠ© Objective-C çš„èƒ½åŠ›è¿›è¡Œæˆªå– return result ?? (self as NSString).substring(to: maxLength) } } å› ä¸º String çš„ init?(_ codeUnits: Substring.UTF16View) æ„é€ å™¨è¿”å›å¯èƒ½ä¸ºç©ºï¼Œä¿é™©èµ·è§æœ€åè¿˜æ˜¯å€Ÿç”¨äº†ä¸€ä¸‹ ObjC çš„æ–¹æ³•æ¥åšæˆªå–ã€‚ å¥½äº†ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æ˜¯æˆ‘å†™è¿™ç¯‡åšå®¢ä¹‹å‰çš„ç†è§£å’Œåšæ³•ã€‚åé¢å¼€å§‹è¯´é—®é¢˜ã€‚ åŠä¸ª emoji å¯¹ä¸Šè¿°çš„åœºæ™¯åº”ç”¨è¯¥æ–¹æ³•åï¼Œæˆ‘ä»¬å¾—åˆ°çš„æˆªå–ç»“æœå…¶å®æ˜¯æœ‰é—®é¢˜çš„ï¼š &quot; g,5å°±ğŸ‰‘ï¸&quot;.prefixed(6) // g,5å°±ï¿½ 6çš„é•¿åº¦é™åˆ¶æ­£å¥½å¡åœ¨ ğŸ‰‘ï¸ çš„ç¼–ç ä¸Šï¼Œå¯¼è‡´æœ€åé—ç•™ä¸‹æ¥åŠä¸ª emojiã€‚ å¦‚æœä»…ä»…æ˜¯å±•ç¤ºè¿˜å¥½ï¼Œä½†æ˜¯å¦‚æœæ‹¿è¿™ä¸ªå­—ç¬¦ä¸²åœ¨ iOS 13 ä¸Šï¼Œä½¿ç”¨ JSONEncoder å»ç¼–ç ï¼Œå°±ä¼šé€ æˆé—ªé€€ï¼Œè€Œä¸”ä¸è®ºæ˜¯é€šè¿‡ try catch ä¹Ÿå¥½ï¼Œtry? ä¹Ÿå¥½ï¼Œéƒ½æ— æ³•æ•è·åˆ°è¯¥å¼‚å¸¸ï¼ˆEXC_BAD_ACCESSï¼‰ã€‚ è§£å†³é—®é¢˜ é€šè¿‡æ–­ç‚¹å¯çŸ¥ï¼ŒåŸæœ¬æ–¹æ³•çš„ result å±æ€§æ˜¯ nilï¼Œæœ€ç»ˆæ˜¯é€šè¿‡ ObjC çš„ substring æ–¹æ³•å¾—åˆ°äº†ç›®æ ‡å­—ç¬¦ä¸²ã€‚ å¾ˆæ˜æ˜¾è¿™ä¸ªé—®é¢˜æ˜¯ emoji æˆªå–ä¸å…¨å¯¼è‡´çš„ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥åˆ é™¤æ•´ä¸ª emojiï¼Œè€Œä¸æ˜¯æ®‹ç•™åŠä¸ªã€‚ è¿›ä¸€æ­¥æœç´¢ï¼Œæˆ‘æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼šSwift å­—ç¬¦ä¸² æˆªå– åŠä¸ªè¡¨æƒ…emoji \\u0000fffd çš„å¤„ç† åŸæ–‡è§£å†³æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œé€šè¿‡å®è·µï¼Œè¯¥æ–¹æ³•ç¡®å®å¯ä»¥è§£å†³é—®é¢˜ã€‚ // text:Optional(&quot;123456789ğŸ˜’&quot;) var newText = (text as NSString).substring(to: 10) newText = (text as NSString).substring(to: maxLength) // æœ‰å¯èƒ½ä¼šæˆªå–åˆ°åŠä¸ªè¡¨æƒ…ï¼Œæ‰€ä»¥è¿™é‡Œå‰”é™¤æ‰åŠä¸ªè¡¨æƒ…çš„æƒ…å†µ if let data = newText.data(using: .utf8), let temp = NSString(data: data, encoding: String.Encoding.utf8.rawValue), temp.contains(&quot;\\u{0000fffd}&quot;) { newText = temp.replacingOccurrences(of: &quot;\\u{0000fffd}&quot;, with: &quot;&quot;) as String } è¿›ä¸€æ­¥ä¼˜åŒ– å…¶å®ä¸Šé¢çš„æ–¹æ³•æ— éœ€å°† data è½¬ä¸º NSStringï¼Œç›´æ¥ä½¿ç”¨ String å» contains ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸ªæš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚ ä½†æ˜¯å¯¹äºæ— æ³•é¢„æµ‹çš„ç”¨æˆ·è¾“å…¥ï¼Œæ¯ä¸€æ¬¡æˆªå–éƒ½è¦å…ˆå°† text è½¬ä¸º dataï¼Œå†è½¬å› stringï¼Œæœ€åæ‰èƒ½åšåˆ¤æ–­ï¼Œæˆ‘æ˜¯ä¸å¤ªæƒ³æ¥å—çš„ã€‚ æ‰€ä»¥æˆ‘ç›´æ¥å°†è¿™ä¸ªç­”æ¡ˆä¸¢ç»™äº† ChatGPTï¼Œç»“æœä¸€ç³»åˆ—çš„è°ƒæ•™å’Œå®è·µï¼Œæœ€ç»ˆå¾—åˆ°äº†å¦‚ä¸‹ç‰ˆæœ¬çš„æ–¹æ³•ï¼š extension String { func prefixed(_ maxLength: Int) -&gt; String { let sequence = utf16 guard sequence.count &gt; maxLength else { return self } let startIndex = sequence.startIndex var endIndex = sequence.index(startIndex, offsetBy: maxLength) while endIndex &gt; startIndex &amp;&amp; UTF16.isTrailSurrogate(sequence[endIndex]) { endIndex = sequence.index(before: endIndex) } let result = String(sequence[..&lt;endIndex]) return result ?? (self as NSString).substring(to: maxLength) } } ä¸€äº› UTF-16 çš„æ¦‚å¿µ å¦‚æœä½ å¯¹ â€œä¸ºä»€ä¹ˆâ€ ä¸æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆç°åœ¨ä½ å·²ç»å¾—åˆ°äº†ç­”æ¡ˆï¼Œå¯ä»¥å…³é—­æ‰è¿™ä¸ªé¡µé¢äº†ã€‚ ä¸‹é¢çš„å†…å®¹å°†å…ˆä»‹ç»ä¸€äº›å’Œ UTF-16 æœ‰å…³çš„æ¦‚å¿µã€‚ UTF-16 UTF-16ç¼–ç çš„å­—ç¬¦å¯ä»¥æ˜¯1ä¸ªæˆ–2ä¸ª16ä½ç å…ƒã€‚ é‚£äº›åªéœ€è¦1ä¸ª16ä½ç å…ƒçš„å­—ç¬¦è¢«ç§°ä¸ºBMPï¼ˆåŸºæœ¬å¤šæ–‡æœ¬å¹³é¢ï¼‰å­—ç¬¦ï¼Œå¦‚è‹±æ–‡å­—æ¯ï¼Œæ•°å­—ï¼Œæ ‡ç‚¹ç¬¦å·ç­‰ã€‚ è€Œé‚£äº›éœ€è¦2ä¸ª16ä½ç å…ƒçš„å­—ç¬¦è¢«ç§°ä¸ºéBMPå­—ç¬¦ï¼Œå¦‚æŸäº›emojiã€‚ Surrogate Pairs åœ¨ Unicodeæ ‡å‡†ä¸­ï¼Œè¿˜åŒ…å« &quot;Low surrogate&quot; å’Œ &quot;High surrogate&quot; ä¸¤ä¸ªæ¦‚å¿µï¼Œæˆ–è€…ä¹Ÿç§°ä¸ºå‰å¯¼ä»£ç†ï¼ˆlead surrogateï¼‰å’Œ å°¾éšä»£ç†ï¼ˆtrail surrogateï¼‰ã€‚ å®ƒä»¬å…±åŒç»„æˆäº† &quot;surrogate pairs&quot;ï¼Œå³ä¸€ä¸ªä»£ç†å¯¹ã€‚ å®ƒè¢«ç”¨æ¥è¡¨ç¤ºåœ¨ UTF-16 ç¼–ç ä¸­ï¼Œä¸èƒ½ç”¨å•ä¸ª16ä½ç¼–ç å•å…ƒæ‰€è¡¨ç¤ºçš„å­—ç¬¦ï¼Œå–å€¼èŒƒå›´åœ¨ U+10000 è‡³ U+10FFFF ä¹‹é—´ã€‚ &quot;High surrogate&quot; æ˜¯ä¸€ä¸ªä»£ç†å¯¹ä¸­çš„ç¬¬ä¸€ä¸ª16ä½ç¼–ç å•å…ƒï¼Œå…¶èŒƒå›´ä» U+D800 åˆ° U+DBFFã€‚ &quot;Low surrogate&quot; æ˜¯ä¸€ä¸ªä»£ç†å¯¹ä¸­çš„ç¬¬äºŒä¸ª16ä½ç¼–ç å•å…ƒï¼Œå…¶èŒƒå›´ä» U+DC00 åˆ° U+DFFFã€‚ ä¾‹å¦‚ï¼Œemoji &quot;ğŸ‰‘ï¸&quot; åœ¨UTF-16ç¼–ç ä¸‹ï¼Œæ˜¯ç”±ä¸¤ä¸ª16ä½ç å…ƒç»„æˆçš„ï¼š0xD83D å’Œ 0xDD91ã€‚è¿™ä¸¤ä¸ªç å…ƒå°±æ˜¯ä¸€ä¸ªä»£ç†å¯¹ï¼Œå…¶ä¸­ 0xD83D æ˜¯å‰å¯¼ä»£ç†ï¼Œ0xDD91 æ˜¯å°¾éšä»£ç†ã€‚ å›åˆ°éœ€æ±‚å’Œåœºæ™¯ å¯¹äºå­—ç¬¦ä¸² &quot; g,5å°±ğŸ‰‘ï¸&quot;ï¼Œå½“æˆ‘ä»¬çš„æœ€å¤§é•¿åº¦ä¸º 6 ä½æ—¶ï¼Œæˆªå–çš„ä¸ºæ­¢æ°å¥½åœ¨ 0xD83D å’Œ 0xDD91 çš„ä¸­é—´ã€‚æ­¤æ—¶ endIndex æŒ‡å‘çš„æ˜¯ç¬¬7ä½ï¼Œå³ 0xDD91 å°¾éšä»£ç†ã€‚ æ‰€ä»¥æˆ‘ä»¬ç”¨ UTF16.isTrailSurrogate æ–¹æ³•åˆ¤æ–­ï¼Œå¦‚æœæˆªå–çš„æœ«å°¾æ˜¯ä¸€ä¸ªå°¾éšä»£ç†ï¼Œåˆ™å‘å‰ç§»åŠ¨ä¸€ä½ï¼Œå°†æ•´ä¸ª emoji èˆæ‰ã€‚ ä¸€äº›å…¶ä»–çš„æƒ³æ³• å…¶å®å…¶ä»–æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š é€šè¿‡æ–‡æ¡£å¯çŸ¥ï¼Œinit?(_ codeUnits: Substring.UTF16View) å½“ codeUnits éæ³•æ—¶è¿”å› nilã€‚æ‰€ä»¥ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç‚¹æ¥ç¼–å†™é€’å½’/å¾ªç¯ï¼Œé€’å‡ endIndexã€‚ æå‰åˆ¤æ–­æ‰€è¦æˆªå–çš„å­—ç¬¦æ˜¯å¦æ˜¯ emojiï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ•´ä¸ª emoji æˆªæ‰ã€‚ ä» &quot; g,5å°±ï¿½&quot; ä¸­åˆ¤æ–­æ˜¯å¦åŒ…å« ï¿½ è¿™ä¸ªå­—ç¬¦ï¼Œå¦‚æœæœ‰å°±å…¨å±€æ›¿æ¢ã€‚ å…¶ä¸­ç¬¬ä¸‰ä¸ªæ–¹æ³•æˆ‘è¿˜å…·ä½“å®è·µäº†ä¸€ä¸‹ã€‚ é¦–å…ˆæˆ‘ä»¬æ²¡æœ‰åŠæ³•é€šè¿‡ utf16 ç›´æ¥å¾—åˆ° String å¯¹è±¡ï¼Œå› ä¸º ï¿½ è¿™ä¸ªç¬¦å·ä¼šå¯¼è‡´åˆå§‹åŒ–å¤±è´¥ã€‚æ‰€ä»¥åªèƒ½é€šè¿‡ NSString æ¥æ‹¿åˆ°ç›®æ ‡å­—ç¬¦ä¸²ã€‚ å…¶æ¬¡ï¼Œå½“æˆ‘ä»¬æ‹¿åˆ°äº† NSString å¯¹è±¡åï¼Œç›´æ¥è°ƒç”¨ .contains(&quot;ï¿½&quot;)ï¼Œè¿”å›å€¼å±…ç„¶æ˜¯ falseã€‚ let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; let original = (string as NSString).substring(to: 6) print(original.contains(&quot;ï¿½&quot;)) // false æ­¤æ—¶ï¼Œåªè¦å‘æ–‡ä¸­æåˆ°çš„ç¬¬ä¸€ç§æ–¹æ³•é‚£æ ·ï¼Œå¯¹ string è½¬ä¸€æ¬¡ data å³å¯åˆ¤æ–­æˆåŠŸã€‚ let string = &quot; g,5å°±ğŸ‰‘ï¸&quot; let original = (string as NSString).substring(to: 6) let utf8Data = original.data(using: .utf8)! if let test = String(data: utf8Data, encoding: .utf8) { print(test.contains(&quot;ï¿½&quot;)) // true } ä½†æ˜¯è¿™ä¸€å¥—ä¸‹æ¥ç¡®å®æœ‰ç‚¹å¾—ä¸å¿å¤±äº†ã€‚ ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆæ˜¯ falseï¼Ÿ ç»è¿‡ç¿»é˜…èµ„æ–™ï¼Œæ€€ç–‘è¿™æ˜¯å› ä¸º NSString å’Œ String çš„åº•å±‚å¤„ç†ä¸åŒå¯¼è‡´çš„ã€‚ å¯¹äº NSStringï¼Œå…è®¸å­˜åœ¨æ— æ•ˆå­—ç¬¦ï¼Œæ‰€ä»¥ &quot; g,5å°±ï¿½&quot; ä¸­çš„ ï¿½ å’Œæˆ‘ä»¬æ‰‹å†™çš„ ï¿½ å¹¶éæ˜¯ç»Ÿä¸€ä¸ªå«ä¹‰ï¼Œåè€…ä»£è¡¨ä¸€ä¸ª â€œUnicodeæ›¿æ¢å­—ç¬¦â€ï¼Œå®ƒç”¨æ¥æ›¿æ¢æ— æ³•è¯†åˆ«æˆ–æ— æ•ˆçš„Unicodeå­—ç¬¦ã€‚è€Œ NSString ä¸­çš„ ï¿½ å°±åªæ˜¯ä¸€ä¸ªæ— æ•ˆçš„ Unicodeï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ‰ä¼šä¸åŒ¹é…ã€‚ è¿™å…¶å®ä¹Ÿèƒ½å›ç­”æœ€å¼€å§‹çš„é‚£ä¸ªæ–¹æ¡ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦å…ˆè½¬ dataï¼Œå†è½¬ä¸€æ¬¡ stringï¼Œæœ€åæ‰èƒ½åˆ¤æ–­æˆåŠŸã€‚ ","link":"https://blog.rakuyo.dev/remove-illegal-characters-from-string/"},{"title":"è®° podspec è½¬ podspec.json","content":"å¦‚æœä½ åƒæˆ‘ä¸€æ ·ä½¿ç”¨ Xcode 14.3 &amp; CocoaPods 12.4.1ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å¾ˆæœ‰å¯èƒ½é‡åˆ°è·Ÿæˆ‘ä¸€æ ·é—®é¢˜ï¼šXcode 14.3 has pod lib lint failã€‚ å¦‚æœä½ æ­£åœ¨å¼€å‘çš„æ˜¯ä¸€ä¸ªç§æœ‰ podï¼Œé‚£è¿˜å¥½è¯´ï¼Œå¯ä»¥ç›´æ¥å°† podspec æ–‡ä»¶ push åˆ°è‡ªå·±çš„ git spec ä¸Šã€‚ ä½†æ˜¯å¦‚æœä½ åƒæˆ‘ä¸€æ ·ï¼Œç§æœ‰ spec repo ä¸­å­˜å‚¨çš„æ˜¯ podspec.jsonï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„è¿™ä¸ªå‘½ä»¤ä¹Ÿè®¸ä¼šå¸®åˆ°ä½ ï¼š pod ipc spec Name.podspec &gt;&gt; Name.podspec.json ä½¿ç”¨è¯¥å‘½ä»¤å¯ä»¥å°† podspec æ–‡ä»¶è½¬æ¢ä¸º podspec.json æ–‡ä»¶ï¼Œä¹‹åä½ å°±å¯ä»¥å°† json æ–‡ä»¶æ¨åˆ° git spec repo é‡Œäº†ã€‚ ","link":"https://blog.rakuyo.dev/ji-podspec-zhuan-podspecjson/"},{"title":"CGO ä¸ WireGuardKit ç¼–è¯‘","content":"CGO æ˜¯ä¸€ç§åœ¨ iOS å¹³å°ä¸Šè¿è¡Œ Go ä»£ç çš„æ–¹æ¡ˆã€‚è€Œ WireGuard ä¸€ç§ VPN æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€éƒ¨åˆ† Go ä»£ç ï¼ŒåŒæ—¶é¡¹ç›®æä¾›äº†ä¸€ä¸ª Makefile è„šæœ¬ï¼Œä½¿ç”¨ CGO æ¥å°†ç›¸å…³ä»£ç ç¼–è¯‘æˆ iOS é™æ€åº“ã€‚ å†™è¿™ç¯‡æ–‡ç« çš„å¥‘æœºæ˜¯ï¼Œå› ä¸ºå¸Œæœ›ä½¿ç”¨ Mac Catalyst å°†å†…éƒ¨å·¥å…·å¸¦åˆ° macOS å¹³å°ï¼Œæˆ‘åˆå›è¿‡å¤´å»çœ‹ä¸€å¹´å‰ï¼ˆæ°å·§æ˜¯22å¹´3æœˆï¼‰ç ”ç©¶ WireGuard çš„è¿‡ç¨‹ã€‚ å‘ç°è™½ç„¶å½“æ—¶çš„ç ”ç©¶æˆåŠŸï¼Œ.xcframewrok æ–‡ä»¶è¿˜åœ¨ï¼Œä½†æ˜¯è¿‡ç¨‹å·²ç»æ¨¡ç³Šä¸æ¸…äº†ã€‚å¦å¤–è¿˜éœ€è¦é’ˆå¯¹ Mac Cataglyst æ„å»ºå‡ºæ–°çš„é™æ€åº“ï¼Œæ‰€ä»¥åˆè¦ä»å¤´è¿›è¡Œæ¢³ç†ä¸è¿‡å¥½åœ¨æ˜¯ â€œæ¨¡ç³Šä¸æ¸…â€ï¼Œè€Œä¸æ˜¯ â€œä¸€å¹²äºŒå‡€â€ï¼Œå¤šå°‘è¿˜è®°å¾—ä¸€äº›ã€‚ Makefile æˆ‘å¯¹ Go è¯­è¨€å‡ ä¹å¯ä»¥è¯´æ˜¯ä¸€çªä¸é€šçš„ã€‚ è€Œå¯¹äº Makefile ä¹Ÿåªæœ‰å¾ˆå°‘å¾ˆå°‘çš„äº†è§£ã€‚ æƒ³è¦æ‰§è¡Œ Makefile æ–‡ä»¶ä¸­çš„è„šæœ¬ï¼Œå°±åœ¨å‘½ä»¤è¡Œä¸­ï¼Œåœ¨è¿›å…¥å¯¹åº”ç›®å½•åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # å‰ææ˜¯è¯´ï¼Œç”µè„‘ä¸Šè¦å®‰è£… makeã€‚ä¸€èˆ¬å®‰è£…äº† Xcode å‘½ä»¤è¡Œçš„è¯éƒ½æ˜¯æœ‰çš„ã€‚ make è¿™é‡Œæˆ‘å°†è¯¥ Makefile å…ˆè´´è¿‡æ¥ï¼š # These are generally passed to us by xcode, but we set working defaults for standalone compilation too. ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) CONFIGURATION_BUILD_DIR ?= $(CURDIR)/out CONFIGURATION_TEMP_DIR ?= $(CURDIR)/.tmp export PATH := $(PATH):/usr/local/bin:/opt/homebrew/bin export CC ?= clang LIPO ?= lipo DESTDIR ?= $(CONFIGURATION_BUILD_DIR) BUILDDIR ?= $(CONFIGURATION_TEMP_DIR)/wireguard-go-bridge CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -arch GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 GOOS_macosx := darwin GOOS_iphoneos := ios build: $(DESTDIR)/libwg-go.a version-header: $(DESTDIR)/wireguard-go-version.h REAL_GOROOT := $(shell go env GOROOT 2&gt;/dev/null) export GOROOT := $(BUILDDIR)/goroot $(GOROOT)/.prepared: [ -n &quot;$(REAL_GOROOT)&quot; ] mkdir -p &quot;$(GOROOT)&quot; rsync -a --delete --exclude=pkg/obj/go-build &quot;$(REAL_GOROOT)/&quot; &quot;$(GOROOT)/&quot; cat goruntime-*.diff | patch -p1 -f -N -r- -d &quot;$(GOROOT)&quot; touch &quot;$@&quot; define libwg-go-a $(BUILDDIR)/libwg-go-$(1).a: export CGO_ENABLED := 1 $(BUILDDIR)/libwg-go-$(1).a: export CGO_CFLAGS := $(CFLAGS_PREFIX) $(ARCH) $(BUILDDIR)/libwg-go-$(1).a: export CGO_LDFLAGS := $(CFLAGS_PREFIX) $(ARCH) $(BUILDDIR)/libwg-go-$(1).a: export GOOS := $(GOOS_$(PLATFORM_NAME)) $(BUILDDIR)/libwg-go-$(1).a: export GOARCH := $(GOARCH_$(1)) $(BUILDDIR)/libwg-go-$(1).a: $(GOROOT)/.prepared go.mod go build -ldflags=-w -trimpath -v -o &quot;$(BUILDDIR)/libwg-go-$(1).a&quot; -buildmode c-archive rm -f &quot;$(BUILDDIR)/libwg-go-$(1).h&quot; endef $(foreach ARCH,$(ARCHS),$(eval $(call libwg-go-a,$(ARCH)))) $(DESTDIR)/wireguard-go-version.h: go.mod $(GOROOT)/.prepared sed -E -n 's/.*golang\\.zx2c4\\.com\\/wireguard +v[0-9.]+-[0-9]+-([0-9a-f]{8})[0-9a-f]{4}.*/#define WIREGUARD_GO_VERSION &quot;\\1&quot;/p' &quot;$&lt;&quot; &gt; &quot;$@&quot; $(DESTDIR)/libwg-go.a: $(foreach ARCH,$(ARCHS),$(BUILDDIR)/libwg-go-$(ARCH).a) @mkdir -vp &quot;$(DESTDIR)&quot; $(LIPO) -create -output &quot;$@&quot; $^ clean: rm -rf &quot;$(BUILDDIR)&quot; &quot;$(DESTDIR)/libwg-go.a&quot; &quot;$(DESTDIR)/wireguard-go-version.h&quot; install: build .PHONY: clean build version-header install è¿™ä¸ªè„šæœ¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š å®šä¹‰å˜é‡ï¼šæœ€å¼€å§‹çš„å‡ è¡Œéƒ½æ˜¯å®šä¹‰å˜é‡ï¼Œå…¶ä¸­ ?= è¯­æ³•åˆ™æ˜¯è®¾ç½®é»˜è®¤å€¼ï¼Œæ„æ€æ˜¯å¯ä»¥ä»å¤–éƒ¨è®¾ç½®è¯¥å€¼ã€‚ å®šä¹‰ç›®æ ‡ï¼šæ­¤åè„šæœ¬å®šä¹‰äº†4ä¸ªç›®æ ‡ï¼Œåˆ†åˆ«æ˜¯ buildã€version-headerã€clean å’Œ installã€‚å…¶ä¸­ version-header ç›®æ ‡å†…è¿˜å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼šlibwg-go-aã€‚ ç›®æ ‡çš„æ‰§è¡Œé¡ºåºï¼šæœ€åçš„ .PHONY ç”¨æ¥å®šä¹‰ç›®æ ‡æ‰§è¡Œé¡ºåºï¼Œè„šæœ¬å°†æŒ‰ç…§è¯¥å€¼çš„é¡ºåºå»æ‰§è¡Œç›®æ ‡ã€‚ çœ‹å®Œå¤§å—æˆ‘ä»¬æ¥çœ‹ç»†èŠ‚ã€‚ å®šä¹‰å˜é‡ åœ¨æ­¤ä¸è§£é‡Šæ¯ä¸ªå˜é‡çš„ä½œç”¨ï¼Œå…ˆé‡ç‚¹å…³æ³¨ä¸‹é¢å‡ ä¸ªï¼š ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 GOOS_macosx := darwin GOOS_iphoneos := ios ä¸Šé¢å·²ç»æåˆ°äº†ï¼Œè¿™ä¸ª Makefile æ˜¯ç”¨æ¥æ„å»º iOS é™æ€åº“çš„ã€‚ é‚£ä¹ˆ ARCHS è¿™ä¸ªå˜é‡å°±ä»£è¡¨ç€è¿™ä¸ªåº“æ‰€æ”¯æŒçš„æ¶æ„ã€‚é»˜è®¤æ˜¯ x86_64 å’Œ arm64 ä¸¤ä¸ªã€‚ PLATFORM_NAME å’Œ SDKROOT è¦ä¸€èµ·çœ‹ï¼Œæ ¹æ®æŒ‡å®šçš„å¹³å°è·å–å¯¹åº” SDK çš„è·¯å¾„ï¼Œå³ç”¨ä½•ç§ SDK æ¥æ„å»ºé™æ€åº“ã€‚ PLATFORM_NAME å¯é€‰çš„å€¼åŒ…æ‹¬ï¼š å€¼ å«ä¹‰ iphoneos iOS macosx macOS iphonesimulator iOS æ¨¡æ‹Ÿå™¨ åé¢å‡ ä¸ªå˜é‡åˆ™æ˜¯å®šä¹‰äº†ä¸€äº› CGO çš„å‚æ•°ï¼Œæ³¨æ„è¿™é‡Œæ˜¯æ²¡æœ‰ iphonesimulator å¯¹åº”çš„å‚æ•°çš„ï¼Œåªæœ‰ iOS å’Œ macOSã€‚ libwg-go-a å‡½æ•° å‰å‡ è¡Œæ˜¯ä½¿ç”¨ export æ¥å®šä¹‰ä¸€äº›ç¯å¢ƒå˜é‡ï¼ŒCGO_CFLAGS å’Œ CGO_LDFLAGS ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸¤ä¸ª CGO å‚æ•°ï¼Œç”¨æ¥æŒ‡å®š C ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨çš„é€‰é¡¹ï¼Œåé¢è¿˜ä¼šæåŠã€‚ å‡½æ•°å†…çš„ $(1) æŒ‡çš„æ˜¯è¯¥æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚åœ¨ libwg-go-a å‡½æ•°çš„ä¸‹ä¸€è¡Œæ˜¯ä¸€ä¸ª foreach è¯­å¥ï¼Œå®ƒçš„ä½œç”¨æ˜¯éå† ARCHSï¼Œå†å°†æ¯ä¸€ä¸ª ARCH ä½œä¸º libwg-go-a å‡½æ•°çš„å‚æ•°ä¼ å…¥ï¼Œæ¥è°ƒç”¨ libwg-go-a å‡½æ•°ã€‚æ‰€ä»¥è¿™é‡Œçš„ $(1) å°±æ˜¯æˆ‘ä»¬åœ¨æœ€ä¸Šé¢å®šä¹‰çš„ ARCHS é‡Œçš„å†…å®¹ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„åˆ° $(GOOS_$(PLATFORM_NAME)) è¿™é‡Œï¼Œä»£ç å€ŸåŠ© PLATFORM_NAME å˜é‡å¥—äº†ä¸€å±‚ï¼Œæ¥æ‹¼æ¥è·å– GOOS_macosx æˆ–è€… GOOS_iphoneos çš„å€¼ã€‚ å…¶ä¸­æ¯”è¾ƒå…³é”®çš„ go build å‘½ä»¤ï¼Œå°±æ˜¯çœŸæ­£è´Ÿè´£æ„å»ºé™æ€åº“çš„å‘½ä»¤ã€‚æœ€åç”Ÿæˆçš„é™æ€åº“æ–‡ä»¶ååˆ™æ˜¯ libwg-go-$(1).aã€‚ å°ç»“ åˆ°è¿™é‡Œ Makefile å¤§è‡´å°±ç®—æ˜¯è¯´å®Œäº†ï¼Œå¼„æ˜ç™½äº†è¿™ä¸ªæ–‡ä»¶çš„å¤§è‡´ç»“æ„ä¸å„éƒ¨åˆ†çš„ä½œç”¨ï¼Œåé¢æ‰å¥½åŠ¨æ‰‹å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚ é€šè¿‡ä¿®æ”¹ ARCHS å’Œ PLATFORM_NAME çš„å€¼ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° iOS å’Œ macOS å¹³å°çš„é™æ€åº“ï¼Œå¤§ä½“ä¸Šå·¥ä½œä¹Ÿå°±ç»“æŸäº†ã€‚ ä½†æ˜¯å¾€å¾€è¿˜ä¼šæœ‰äº›é¢å¤–å·¥ä½œè¦å¤„ç†ã€‚ ç¼–è¯‘æ”¯æŒæ¨¡æ‹Ÿå™¨çš„é™æ€åº“ è™½ç„¶ WireGuard VPN æœ¬èº«ä¸æ”¯æŒæ¨¡æ‹Ÿå™¨ï¼Œä½†æ˜¯è·³å‡ºè¿™ä¸ªè¯é¢˜ï¼Œä¸Šé¢æœ‰æåˆ°ï¼Œè¿™ä¸ªè„šæœ¬ç°åœ¨æ˜¯ä¸æ”¯æŒ iphonesimulator çš„ï¼Œå¦‚æœæƒ³è¦æ”¯æŒæ¨¡æ‹Ÿå™¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å…¶å®ä¸æ”¯æŒçš„åŸå› å¾ˆç®€å•ï¼šå› ä¸ºä¸å­˜åœ¨ GOOS_iphonesimulator å˜é‡ï¼ˆæƒ³ä¸€æƒ³ $(GOOS_$(PLATFORM_NAME))ï¼‰ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å®šä¹‰è¯¥å˜é‡ã€‚é€šè¿‡æŸ¥é˜…èµ„æ–™ï¼Œæ¨¡æ‹Ÿå™¨å¯¹åº”çš„ GOOS ä¹Ÿä¸º iosï¼Œæ‰€ä»¥å˜é‡å®šä¹‰å¦‚ä¸‹ï¼š GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 GOOS_macosx := darwin GOOS_iphoneos := ios +GOOS_iphonesimulator := ios ä¹‹åå†æ‰§è¡Œ make å‘½ä»¤ï¼Œå°±å¯ä»¥å¾—åˆ°æ”¯æŒ iOS æ¨¡æ‹Ÿå™¨çš„é™æ€åº“äº†ã€‚ ç¼–è¯‘æ”¯æŒ Mac Cataglyst çš„é™æ€åº“ å›å½’ä¸šåŠ¡ï¼Œæœ¬æ¬¡æˆ‘çš„å·¥ä½œæ˜¯è¦ç¼–è¯‘æ”¯æŒ Mac Cataglyst çš„é™æ€åº“ï¼Œé‚£ä¹ˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ x86_64-apple-ios13.0-macabi é€šè¿‡æŸ¥æ‰¾èµ„æ–™ï¼Œæˆ‘äº†è§£åˆ° -target x86_64-apple-ios13.0-macabi è¿™ä¸ªç”¨äºæè¿°ç‰¹å®šæ“ä½œç³»ç»Ÿå’Œå¤„ç†å™¨æ¶æ„çš„æ ‡è¯†ç¬¦ï¼š x86_64 è¡¨ç¤ºå¤„ç†å™¨æ¶æ„ä¸º 64 ä½çš„ Intel æˆ– AMD å¤„ç†å™¨ï¼› apple è¡¨ç¤ºè¿è¡Œåœ¨è‹¹æœæ“ä½œç³»ç»Ÿä¸Šï¼› ios13.0 è¡¨ç¤ºæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸º iOS 13.0ï¼› macab è¡¨ç¤ºä½¿ç”¨çš„æ˜¯ Mac ä¸Šçš„åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆMac Application Binary Interfaceï¼‰ï¼Œå³æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„ Mac Cataglystã€‚ é€šè¿‡ä½¿ç”¨è¿™ä¸ªæ ‡è¯†ç¬¦ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºå‡ºæ”¯æŒ Mac Cataglyst çš„é™æ€åº“ã€‚ æ¥ç€é€šè¿‡è¿™ä¸ªå›å¤å¾—çŸ¥ï¼Œè¯¥å€¼éœ€è¦èµ‹å€¼ç»™ CGO_CFLAGS å˜é‡ã€‚å›åˆ°è„šæœ¬ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒCGO_CFLAGS ä¸Šä½¿ç”¨ CFLAGS_PREFIX è¿›è¡Œå°è£…ã€‚ åœ¨è¿™ä¸€æ­¥æˆ‘é‡åˆ°äº†2ä¸ªé—®é¢˜ï¼š ä¸è¦ç›´æ¥å°† -target x86_64-apple-ios13.0-macabi å†™åœ¨ CFLAGS_PREFIX çš„æœ«å°¾ã€‚ çœç•¥ä¸€äº›ä»£ç åï¼ŒæŠŠä¸¤è¡Œç›¸å…³ä»£ç æ”¾åœ¨ä¸€èµ·çœ‹ï¼š CFLAGS_PREFIX := -isysroot $(SDKROOT) -arch $(BUILDDIR)/libwg-go-$(1).a: export CGO_CFLAGS := $(CFLAGS_PREFIX) $(ARCH) å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Š export çš„å†…å®¹æ˜¯ -isysroot $(SDKROOT) -arch x86_64ã€‚ å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ CFLAGS_PREFIX çš„æœ«å°¾æ·»åŠ ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠ -arch x86_64 éš”å¼€ï¼Œç»§è€ŒæŠ¥é”™ã€‚æ‰€ä»¥æ·»åŠ åˆ° -arch å‰å³å¯ã€‚ æ‰¾ä¸åˆ° x86_64-apple-ios13.0-macabiã€‚ ç›¸å…³çš„é—®é¢˜åœ¨ golang/go çš„ github ä¸Šæ˜¯å¯ä»¥æœåˆ°çš„ï¼Œå¯æƒœè¿™ä¸ªé—®é¢˜æ˜¯é’ˆå¯¹ go-mobile çš„ï¼Œä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°å›å¤ä¸­çš„ï¼Œ-iosversion=14 å­—æ ·ã€‚ äºæ˜¯å°†å…¶æ”¹ä¸º x86_64-apple-ios14.0-macabiï¼Œæœæ–­è§£å†³é—®é¢˜ã€‚ ç¼–è¯‘ Mac Cataglyst è™½ç„¶æ“ä½œçš„æ˜¯ iOS Appï¼Œä½†æ˜¯æœ€ç»ˆè¿˜æ˜¯è¿è¡Œåœ¨ macOS ä¸Šï¼Œæ‰€ä»¥è¿˜æ˜¯è¦ä½¿ç”¨ macosx çš„ sdk è¿›è¡Œæ„å»ºã€‚ ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) -CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -arch +CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -target x86_64-apple-ios14.0-macabi -arch ä½†æ˜¯è¿è¡Œä»£ç åä¼šå‘ç° arm64 æ¶æ„çš„åŒ…æ‰“ä¸å‡ºã€‚ Warning å…¶å®åˆ°è¿™é‡Œï¼Œæœ‰å…³ WireGuard çš„ç›¸å…³å·¥ä½œå·²ç» â€œç»“æŸâ€ äº†ã€‚å› ä¸ºè™½ç„¶æœ€åæˆ‘æ‰“å‡ºäº†åŒ…ï¼Œä½†æ˜¯æˆªæ­¢åˆ°æœ¬æ–‡å‘å¸ƒï¼Œæˆ‘è¿˜æœªèƒ½æˆåŠŸå°†é¡¹ç›®è¿è¡Œèµ·æ¥ï¼Œæ‰€ä»¥å¹¶ä¸çŸ¥é“æ¥ä¸‹æ¥çš„æ“ä½œæ˜¯å¦æ­£ç¡®ã€‚ é€šè¿‡å°† GOOS_macosx å¯¹åº”çš„å€¼ä¿®æ”¹ä¸º ios å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥æœ€ç»ˆä¿®æ”¹ä¸ºï¼š ARCHS ?= x86_64 arm64 PLATFORM_NAME ?= macosx SDKROOT ?= $(shell xcrun --sdk $(PLATFORM_NAME) --show-sdk-path) -CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -arch +CFLAGS_PREFIX := $(if $(DEPLOYMENT_TARGET_CLANG_FLAG_NAME),-$(DEPLOYMENT_TARGET_CLANG_FLAG_NAME)=$($(DEPLOYMENT_TARGET_CLANG_ENV_NAME)),) -isysroot $(SDKROOT) -target x86_64-apple-ios14.0-macabi -arch GOARCH_arm64 := arm64 GOARCH_x86_64 := amd64 -GOOS_macosx := darwin +GOOS_macosx := ios GOOS_iphoneos := ios GOOS_maccatalyst := ios GOOS_iphonesimulator := ios å‚è€ƒ golang/go with issue #36856 golang/go with issue #47228 Re: Support for M1 MacBook Simulators ","link":"https://blog.rakuyo.dev/cgo-and-wireGuardkit-compilation/"},{"title":"epoxy æºç ç¬”è®°1ï¼šDiffing ç®—æ³•","content":"æœ€è¿‘å¼€å§‹é˜…è¯»å­¦ä¹  epoxy çš„æºç ï¼Œå¼€ä¸ªæ–°çš„ç³»åˆ—æ¥è®°å½•ä¸€ä¸‹å­¦ä¹ æˆåŠŸã€‚ æœ¬ç³»åˆ—æ–‡ç« ä¸å¯¹ epoxy æ˜¯ä»€ä¹ˆè¿›è¡Œè®²è§£ï¼Œç›´æ¥è®²è§£å…¶ä¸­çš„éƒ¨åˆ†æºç å†…å®¹ã€‚ å¦‚æœç›¸æ¯”è¾ƒæ–‡å­—ï¼Œæ‚¨æ›´å–œæ¬¢ç›´æ¥é˜…è¯»ä»£ç +æ³¨é‡Šï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è·³åˆ°æ–‡ç« æœ«å°¾çš„ æ€»ç»“ ä¸€èŠ‚ï¼Œè¯¥å°èŠ‚åŒ…å«äº†ä¸€ä¸ªå®Œæ•´çš„ï¼Œå¸¦æ³¨é‡Šè®²è§£çš„æºç ã€‚ ç›®å½• æºç  ContiguousArray é¢„å¡«å……æ•°ç»„ entries è®°å½•æ–°å…ƒç´  Entry å¯¹è±¡å’Œ trackNewIndex(_:) æ–¹æ³• è®°å½•æ—§å…ƒç´  NewRecord &amp; OldRecord ç¡®å®šå…ƒç´ å˜åŠ¨ ä¸­åœºä¼‘æ¯ åˆ é™¤ã€æ–°å¢ä¸ç§»åŠ¨ åˆ é™¤ æ–°å¢å’Œç§»åŠ¨ æ€»ç»“ æºç  æœ¬æ–‡ä¸»è¦è®²è§£ Collection+Diff.swift æ–‡ä»¶ä¸­çš„ makeChangeset(from:) æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥å¿«é€Ÿæ¯”è¾ƒå‡ºä¸¤ä¸ªé›†åˆä¹‹é—´çš„åŒºåˆ«ï¼ŒåŒæ—¶è¿”å›å¢åˆ æ”¹çš„ç´¢å¼•é›†åˆã€‚ é¦–å…ˆè´´ä¸€ä¸‹ç›¸å…³çš„æºç ï¼š // MARK: - Collection extension Collection where Element: Diffable, Index == Int { /// Diffs two collections (e.g. `Array`s) of `Diffable` items, returning an `IndexChangeset` /// representing the minimal set of changes to get from the other collection to this collection. /// /// - Parameters: /// - from other: The collection of old data. public func makeChangeset(from other: Self) -&gt; IndexChangeset { // Arranging the elements contiguously prior to diffing improves performance by ~40%. let new = ContiguousArray(self) let old = ContiguousArray(other) /// The entries in both this and the other collection, keyed by their `dataID`s. var entries = [AnyHashable: Entry](minimumCapacity: new.count) var duplicates = [Entry]() var newResults = ContiguousArray&lt;NewRecord&gt;() newResults.reserveCapacity(new.count) for index in new.indices { let id = new[index].diffIdentifier let entry = entries[id, default: Entry()] if entry.trackNewIndex(index) { duplicates.append(entry) } entries[id] = entry newResults.append(NewRecord(entry: entry)) } var oldResults = ContiguousArray&lt;OldRecord&gt;() oldResults.reserveCapacity(old.count) for index in old.indices { let id = old[index].diffIdentifier let entry = entries[id] entry?.pushOldIndex(index) oldResults.append(OldRecord(entry: entry)) } for newIndex in new.indices { let entry = newResults[newIndex].entry if let oldIndex = entry.popOldIndex() { let newItem = new[newIndex] let oldItem = other[oldIndex] if !oldItem.isDiffableItemEqual(to: newItem) { entry.isUpdated = true } newResults[newIndex].correspondingOldIndex = oldIndex oldResults[oldIndex].correspondingNewIndex = newIndex } } var deletes = [Int]() var deleteOffsets = [Int]() deleteOffsets.reserveCapacity(old.count) var runningDeleteOffset = 0 for index in old.indices { deleteOffsets.append(runningDeleteOffset) let record = oldResults[index] if record.correspondingNewIndex == nil { deletes.append(index) runningDeleteOffset += 1 } } var inserts = [Int]() var updates = [(Int, Int)]() var moves = [(Int, Int)]() var insertOffsets = [Int]() insertOffsets.reserveCapacity(new.count) var runningInsertOffset = 0 for index in new.indices { insertOffsets.append(runningInsertOffset) let record = newResults[index] if let oldArrayIndex = record.correspondingOldIndex { if record.entry.isUpdated { updates.append((oldArrayIndex, index)) } let insertOffset = insertOffsets[index] let deleteOffset = deleteOffsets[oldArrayIndex] if (oldArrayIndex - deleteOffset + insertOffset) != index { moves.append((oldArrayIndex, index)) } } else { inserts.append(index) runningInsertOffset += 1 } } EpoxyLogger.shared.assert( old.count + inserts.count - deletes.count == new.count, &quot;Failed sanity check for old count with changes matching new count.&quot;) return IndexChangeset( inserts: inserts, deletes: deletes, updates: updates, moves: moves, newIndices: oldResults.map { $0.correspondingNewIndex }, duplicates: duplicates.map { $0.newIndices }) } // MARK: - Entry /// A bookkeeping refrence type for the diffing algorithm. private final class Entry { // MARK: Internal private(set) var oldIndices = [Int]() private(set) var newIndices = [Int]() var isUpdated = false /// Tracks an index from the new indices, returning `true` if this entry has previously tracked /// a new index as a means to identify duplicates and `false` otherwise. func trackNewIndex(_ index: Int) -&gt; Bool { let previouslyEmpty = newIndices.isEmpty newIndices.append(index) // We've encountered a duplicate, return true so we can track it. if !previouslyEmpty, newIndices.count == 2 { return true } return false } func pushOldIndex(_ index: Int) { oldIndices.append(index) } func popOldIndex() -&gt; Int? { guard currentOldIndex &lt; oldIndices.endIndex else { return nil } defer { currentOldIndex += 1 } return oldIndices[currentOldIndex] } // MARK: Private private var currentOldIndex = 0 } // MARK: - OldRecord /// A bookkeeping type for pairing up an old element with its new index. private struct OldRecord { var entry: Entry? var correspondingNewIndex: Int? = nil } // MARK: - NewRecord /// A bookkeeping type for pairing up a new element with its old index. private struct NewRecord { var entry: Entry var correspondingOldIndex: Int? = nil } makeChangeset(from:) æ–¹æ³•æ˜¯ Collection&lt;Diffable&gt; çš„ä¸€ä¸ªæ‰©å±•ï¼Œå®é™…ä½¿ç”¨æ—¶ä½ å¯ä»¥ç®€å•çš„ç†è§£ä¸ºä¸€ä¸ª [Diffable]ã€‚æ–¹æ³•æ¥æ”¶ä¸€ä¸ªåŒç±»å‹çš„é›†åˆï¼Œè¿”å›ä¸€ä¸ª IndexChangeset ç±»å‹çš„ç»“æ„ä½“ã€‚ è¿”å›å€¼æš‚ä¸”å¿½ç•¥ï¼Œå’±ä»¬ç›´æ¥æ¥çœ‹å‡½æ•°ä½“ã€‚ ContiguousArray let new = ContiguousArray(self) let old = ContiguousArray(other) å‡½æ•°ä½“å†…é¦–å…ˆå°† self å’Œ other è½¬æ¢ä¸º ContiguousArray ç±»å‹çš„æ•°ç»„ã€‚ä»å˜é‡åä¸Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œself ä»£è¡¨ç€æ–°çš„é›†åˆï¼Œè€Œ other ä»£è¡¨ç€æ—§çš„çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯è¢«æ¯”è¾ƒçš„é›†åˆã€‚ ContiguousArray å’Œ Array ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äº ContiguousArray èƒ½ä¿è¯å­å…ƒç´ åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œè¿™å°±å…è®¸ CPU é€šè¿‡æŒ‡é’ˆè¿›è¡Œè¿ç»­è®¿é—®ï¼Œå¤§å¹…æå‡æ€§èƒ½ã€‚è€Œ Array æˆ‘ä»¬å¤§å®¶éƒ½çŸ¥é“ï¼Œå®ƒçš„å†…éƒ¨ä½¿ç”¨äº† â€œç¼“å†²åŒºâ€ï¼Œé€»è¾‘ä¸Šæ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯å†…å­˜ä¸Šæœªå¿…æ˜¯è¿ç»­çš„ã€‚ å› ä¸ºåœ¨åç»­çš„ç®—æ³•ä¸­ï¼Œself å’Œ other çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥è¿™é‡Œå°†å…¶è½¬æ¢ä¸º ContiguousArray æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ é€šè¿‡æºç ä¸­çš„æ³¨é‡Šæˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“ï¼Œå°† self å’Œ other è½¬æ¢ä¸º ContiguousArray ç±»å‹ï¼Œå¯ä»¥æå‡å¤§çº¦ 40% çš„æ€§èƒ½ã€‚ åæ–‡ä¸­ï¼Œå°†ä½¿ç”¨ new ä»£è¡¨ selfï¼Œä½¿ç”¨ old ä»£è¡¨ otherã€‚å’Œè¿™é‡Œçš„å˜é‡å£°æ˜ä¿æŒåŒæ­¥ã€‚ é¢„å¡«å……æ•°ç»„ æ¯•ç«Ÿæ˜¯ä¸€ä¸ªè®²ç©¶æ•ˆç‡çš„ç®—æ³•ï¼Œåæ–‡ä¸­éšå¤„å¯è§ .init(minimumCapacity:) ã€ reserveCapacity(_:) æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼šè®¾ç½®æ•°ç»„çš„é•¿åº¦ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ Swift æ•°ç»„æ‰©å®¹é€šå¸¸æ˜¯ç›´æ¥ *2ã€‚ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬æœ‰æåˆ°ï¼Œæ•´ä¸ªç®—æ³•ä¸­æ•°æ®æºçš„å¤§å°æ˜¯å·²çŸ¥çš„ï¼Œé‚£ä¹ˆä½œä¸ºä¸€ä¸ªè®²ç©¶æ•ˆç‡çš„ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºæ•°ç»„çš„åŒæ—¶å°±è®¾å®šå¥½æ•°ç»„çš„å¤§å°ï¼Œé¿å…åœ¨åç»­æ“ä½œä¸­è§¦å‘æ•°ç»„çš„è‡ªåŠ¨æ‰©å®¹ï¼Œå‡å°‘å› ä¸ºæ‰©å®¹è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚ entries var entries = [AnyHashable: Entry](minimumCapacity: new.count) entries è¿™ä¸ªå­—å…¸å˜é‡çš„ä½œç”¨æ˜¯ï¼Œå°† new å’Œ old ä¸­ï¼Œä½¿ç”¨ç›¸åŒ id çš„å…ƒç´ ç´¢å¼•å€¼å¯¹åº”èµ·æ¥ã€‚ ç°åœ¨è¿™ä¹ˆè®²å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œåé¢ç»“åˆé€»è¾‘ä¸€èµ·æ¥è°ˆã€‚ è®°å½•æ–°å…ƒç´  var newResults = ContiguousArray&lt;NewRecord&gt;() newResults.reserveCapacity(new.count) for index in new.indices { let id = new[index].diffIdentifier let entry = entries[id, default: Entry()] if entry.trackNewIndex(index) { duplicates.append(entry) } entries[id] = entry newResults.append(NewRecord(entry: entry)) } ä»£ç é¦–å…ˆä½¿ç”¨æ–°åºåˆ—çš„ç´¢å¼•è¿›è¡Œéå†ï¼Œä½¿ç”¨å¯¹åº”å…ƒç´ çš„ idï¼Œå°è¯•å» entries ä¸­æŸ¥æ‰¾å…ƒç´ ã€‚ è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªå°æŠ€å·§ï¼šDictionay çš„ defaultã€‚å½“ä¸å­˜åœ¨ id å¯¹åº”çš„å…ƒç´ æ—¶ï¼Œå°†è¿”å› default å¯¹åº”çš„å†…å®¹ã€‚è¿™é‡Œå³æ˜¯è¿”å›ä¸€ä¸ªç©ºçš„ Entry å¯¹è±¡ã€‚ ç¨åè®²è§£ Entry å¯¹è±¡å’Œ trackNewIndex(_:) æ–¹æ³•çš„å…·ä½“å†…å®¹ï¼Œå…ˆå¤§è‡´è¯´ä¸€ä¸‹ï¼š Entry å¯¹è±¡ç”¨æ¥è®°å½• â€œæ‹¥æœ‰åŒä¸€ä¸ª id çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå…¶åœ¨æ–°ã€æ—§ä¸¤ä¸ªæ•°ç»„ä¸­çš„ä½ç½®â€ã€‚ trackNewIndex(_:) æ–¹æ³•æ¥æ”¶ç´¢å¼•ä½œä¸ºå‚æ•°ï¼Œå¹¶å­˜å‚¨åˆ° Entry å¯¹è±¡ä¸­ã€‚åŒæ—¶è¯¥æ–¹æ³•ä¼šè¿”å›è¿™ä¸ª Entry å¯¹è±¡æ˜¯å¦å·²ç»åœ¨ä¹‹å‰å‡ºç°è¿‡ï¼ˆç›¸å½“äºä¸€ä¸ªé‡å¤æ£€æŸ¥ï¼‰ã€‚ ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“è¿™ä¸ª for å¾ªç¯å¤§è‡´çš„å«ä¹‰å’Œä½œç”¨äº†ï¼š å®ƒéå†æ–°æ•°ç»„ï¼Œé¦–å…ˆæ ¹æ® id å°†æ•°ç»„å…ƒç´ å­˜å‚¨åˆ° entries å¯¹è±¡ä¸­ï¼Œå…¶æ¬¡å¯¹è¯¥æ•°ç»„åšä¸€ä¸ª â€œé‡å¤æ£€æŸ¥â€ï¼Œå¹¶è®°å½•ä¸‹é‡å¤çš„æ¬¡æ•°ã€‚ Entry å¯¹è±¡å’Œ trackNewIndex(_:) æ–¹æ³• Entry å¯¹è±¡æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå®ƒçš„å®Œæ•´å£°æ˜æ¯”è¾ƒé•¿ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†é‡å¤è´´äº†ï¼Œè¯»è€…å¯ä»¥ç¿»åˆ°æœ€ä¸Šé¢ è‡ªè¡ŒæŸ¥çœ‹ã€‚ æˆ‘ä»¬å…ˆæŠŠç›®å…‰é›†ä¸­åœ¨ newIndices è¿™ä¸ªå±æ€§ä»¥åŠ trackNewIndex(_:) æ–¹æ³•ä¸Šã€‚ trackNewIndex(_:) æ–¹æ³•çš„å®ç°ä¸ºï¼š /// Tracks an index from the new indices, returning `true` if this entry has previously tracked a new index as a means to identify duplicates and `false` otherwise. func trackNewIndex(_ index: Int) -&gt; Bool { let previouslyEmpty = newIndices.isEmpty newIndices.append(index) // We've encountered a duplicate, return true so we can track it. if !previouslyEmpty, newIndices.count == 2 { return true } return false } è¯¥æ–¹æ³•å°†å‚æ•°å­˜å‚¨åˆ° newIndices é‡Œã€‚è¿™æ˜¯å®ƒçš„ä½œç”¨ä¹‹ä¸€ï¼šè®°å½•è¯¥ id åœ¨æ–°æ•°ç»„ï¼ˆnewï¼‰ä¸­çš„ä½ç½®ã€‚ ç„¶ååˆ¤æ–­ï¼Œå¦‚æœ newIndices ä¸­çš„å…ƒç´ ç­‰äº 2ï¼Œåˆ™æ„å‘³ç€å‡ºç°äº†é‡å¤ã€‚è¿™å¾ˆå¥½ç†è§£ï¼ŒnewIndices å¤§äº 1 æ„å‘³ç€åŒä¸€ä¸ª id å‡ºç°äº†ä¸¤æ¬¡ã€‚ä¸è¿‡æˆªæ­¢åˆ°å‘æ–‡æˆ‘ä¹Ÿæ²¡èƒ½ç†è§£ï¼Œä¸ºä»€ä¹ˆæ˜¯ == 2 è€Œä¸æ˜¯ &gt;= 2ã€‚ç»“åˆåæ–‡æ¨æ–­ï¼ŒçŒœæµ‹æ˜¯ä¸å¸Œæœ› duplicates ä¸­å‡ºç°é‡å¤çš„å…ƒç´ ã€‚ è®°å½•æ—§å…ƒç´  var oldResults = ContiguousArray&lt;OldRecord&gt;() oldResults.reserveCapacity(old.count) for index in old.indices { let id = old[index].diffIdentifier let entry = entries[id] entry?.pushOldIndex(index) oldResults.append(OldRecord(entry: entry)) } è®°å½•æ—§å…ƒç´ çš„é€»è¾‘æ¯”è®°å½•æ–°å…ƒç´ çš„é€»è¾‘è¦ç®€å•ä¸€äº›ï¼šå½“æˆ‘ä»¬é€šè¿‡ idï¼Œå¦‚æœåœ¨ entries æ˜ å°„è¡¨ä¸­æŸ¥åˆ°å¯¹åº”å…ƒç´ æ—¶ï¼ˆæ„å‘³ç€è¯¥ id å­˜åœ¨å¯¹åº”çš„æ–°å…ƒç´ ï¼‰ï¼Œåˆ™å­˜å‚¨è¯¥å…ƒç´ åœ¨æ—§æ•°æ®ä¸­çš„ç´¢å¼•å€¼ã€‚å¦åˆ™ä¸è¿›è¡Œå­˜å‚¨ï¼ˆå› ä¸º entries çš„æ„æ€æ˜¯å­˜å‚¨ â€œæ–°-æ—§â€ çš„å¯¹åº”å…³ç³»ï¼Œä¸å­˜åœ¨æ–°ï¼Œé‚£ä¹ˆæ—§å°±æ²¡æœ‰æ„ä¹‰ï¼‰ã€‚ NewRecord &amp; OldRecord åœ¨éå†æ–°é›†åˆå’Œæ—§é›†åˆçš„å¾ªç¯ä¸­ï¼Œæœ«å°¾éƒ½æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¯¹åº”çš„ XXRecord å¯¹è±¡ã€‚è¿™ä¸¤ä¸ªç±»å‹çš„å£°æ˜æ¯”è¾ƒç›¸ä¼¼ï¼Œé™¤äº†å­˜å‚¨å¯¹åº”çš„ Entry ä¹‹å¤–ï¼Œè¿˜å¸¦æœ‰ä¸€ä¸ª Int? ç±»å‹çš„ correspondingXXXIndex å±æ€§ï¼Œè¯¥å±æ€§é»˜è®¤æ˜¯ nilã€‚ correspondingOldIndex æ„å‘³ç€åœ¨æ–°é›†åˆä¸­ï¼Œè¯¥å…ƒç´ åœ¨æ—§é›†åˆä¸­çš„ä½ç½®ã€‚ correspondingNewIndex æ„å‘³ç€åœ¨æ—§é›†åˆä¸­ï¼Œè¯¥å…ƒç´ åœ¨æ–°é›†åˆä¸­çš„ä½ç½®ã€‚ å¦‚æœæ˜¯ nilï¼Œåˆ™æ„å‘³ç€è¯¥å…ƒç´ åœ¨å¦å¤–çš„é›†åˆä¸­ä¸å­˜åœ¨ã€‚ è¿™ä¸¤ä¸ªå±æ€§éƒ½åœ¨åé¢çš„ç®—æ³•ä¸­èµ·åˆ°äº†é‡è¦çš„ä½œç”¨ã€‚ ç¡®å®šå…ƒç´ å˜åŠ¨ for newIndex in new.indices { let entry = newResults[newIndex].entry if let oldIndex = entry.popOldIndex() { let newItem = new[newIndex] let oldItem = other[oldIndex] if !oldItem.isDiffableItemEqual(to: newItem) { entry.isUpdated = true } newResults[newIndex].correspondingOldIndex = oldIndex oldResults[oldIndex].correspondingNewIndex = newIndex } } è¿™ä¸ªå¯¹æ–°é›†åˆçš„éå†ï¼Œç¡®å®šäº†ä¸¤ä¸ªé›†åˆä¹‹é—´å…ƒç´ çš„å˜åŠ¨ã€‚ é¦–å…ˆæ˜¯å¯¹æ–°é›†åˆçš„éå†ï¼Œå› ä¸º newResults å¯ä»¥è¯´å°±æ˜¯ new é€šè¿‡ map å¾—åˆ°çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ newIndex ç›´æ¥ä» newResults ä¸­è¿›è¡Œå–å€¼ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ˜¯å¦ä¼šè¶Šç•Œã€‚ ä½ åº”è¯¥è¿˜è®°å¾—ï¼Œentry å¯¹è±¡ä¸­å­˜å‚¨ç€è¯¥ id å¯¹åº”çš„å…ƒç´ åœ¨æ–°ã€è€é›†åˆä¸­å¯¹åº”çš„ç´¢å¼•ã€‚å¦‚æœåœ¨æ–°ã€è€é›†åˆä¸­ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå¯¹åº”çš„ç´¢å¼•ä¹Ÿå°±ä¸å­˜åœ¨ã€‚æ‰€ä»¥é€šè¿‡ popOldIndex() æ–¹æ³•ï¼ˆé€šè¿‡æ–¹æ³•åä¹Ÿèƒ½çœ‹å‡ºå®ƒçš„ä½œç”¨ï¼‰ï¼Œå¯ä»¥é€šè¿‡ entry å¯¹è±¡åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ—§çš„å…ƒç´ ã€‚ åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬åº”è¯¥èƒ½çŸ¥é“ï¼šå¦‚æœ newResults ä¸­çš„æŸä¸€ä¸ªå…ƒç´ çš„ correspondingOldIndex æ˜¯ nilï¼Œé‚£ä¹ˆè¯¥å…ƒç´ å°±æ˜¯æ–°å¢çš„ã€‚é‚£ä¹ˆåè¿‡æ¥ï¼ŒoldResults ä¸­çš„é€»è¾‘ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ å®é™…ä¸Šä¸Šä¸€èŠ‚ä¸­ï¼Œå…³äº correspondingOldIndex å’Œ correspondingNewIndex è¿™ä¸¤ä¸ªå±æ€§çš„ä½œç”¨ï¼Œä¹Ÿæ˜¯æˆ‘é€šè¿‡è¿™ä¸ªå¾ªç¯æ¨æ–­å‡ºæ¥çš„ã€‚ æ¥ç€å¾€ä¸‹çœ‹ã€‚å¦‚æœå­˜åœ¨æ—§çš„å…ƒç´ ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦æ¯”è¾ƒæ–°æ—§ä¸¤ä¸ªå…ƒç´ æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™é€šè¿‡ entry.isUpdated è®°å½•è¯¥å…ƒç´ å‘ç”Ÿäº†æ›´æ–°ã€‚ æœ€ååœ¨ newResults å’Œ oldResults ä¸­è®°å½•è¯¥å…ƒç´ åœ¨å¦å¤–ä¸€ä¸ªæ•°ç»„ä¸­çš„ä½ç½®ã€‚ ä¸­åœºä¼‘æ¯ åˆ°äº†è¿™é‡Œï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥å°ç»“ä¸€ä¸‹ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ newResultsã€oldResults å’Œ entries ä¸‰ä¸ªå˜é‡çš„ä½œç”¨ã€‚ entries çš„ä¸»è¦å°±æ˜¯å°†æ–°æ—§ä¸¤ä¸ªæ•°ç»„ï¼Œé€šè¿‡ç›¸åŒçš„ id åšä¸€ä¸ªåŒ¹é…ï¼ŒåŒæ—¶è®°å½•ç›¸åº”çš„ç´¢å¼•ã€‚åŒ¹é…åˆ°ä¸€èµ·ä¹‹åç”¨æ¥åˆ›å»º newResults å’Œ oldResults å¯¹è±¡ã€‚è¯¥å˜é‡ä¸»è¦ä½œç”¨äºç®—æ³•çš„å‰åŠéƒ¨åˆ†ï¼Œä¸ºåˆ›å»º newResults å’Œ oldResults è€Œç”Ÿï¼Œåˆ›å»ºå®Œä¹‹åå®ƒçš„ä»»åŠ¡å°±ç»“æŸäº†ã€‚ newResults å’Œ oldResults è¿™ä¸¤ä¸ªå˜é‡æœ€ä¸»è¦çš„ä½œç”¨ï¼ŒæŒ‰æˆ‘çš„ç†è§£å°±æ˜¯ï¼šâ€œé€šè¿‡ä¸€ä¸ªInt ç±»å‹çš„å¯é€‰å€¼ï¼Œè®°å½•äº† entry çš„å‰ä¸–ä»Šç”Ÿâ€ã€‚ correspondingXXXIndex çš„å­˜åœ¨æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š æ˜¯å¦ä¸ºç©ºæ„å‘³ç€æœ‰å‰ä¸–ï¼Œæˆ–è€…æœ‰ä»Šç”Ÿ ä¸åªæ˜¯æœ‰ï¼Œè¿˜èƒ½æ‹¿åˆ°å¯¹åº”çš„ä½ç½® æ„Ÿæ…¨ä¸€ä¸‹å¦‚æœæ²¡æœ‰ â€œå¯é€‰å€¼â€ è¿™ä¸ªæ¦‚å¿µï¼Œåˆ™éœ€è¦å€ŸåŠ© Bool + Int ä¸¤ä¸ªå˜é‡æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚æˆ–è€…åˆ¤æ–­ä¸€ä¸‹ nilï¼Ÿ åˆ é™¤ã€æ–°å¢ä¸ç§»åŠ¨ åœ¨å¾—åˆ° newResults å’Œ oldResults ä¸¤ä¸ªå¯¹è±¡åï¼Œè¦è®¡ç®—å‡ºä¸¤ä¸ªé›†åˆä¹‹é—´çš„å·®å¼‚å°±æ¯”è¾ƒç®€å•äº†ã€‚ åˆ é™¤ åé¢çš„ç®—æ³•é¦–å…ˆå¤„ç†çš„æ˜¯åˆ é™¤æ“ä½œã€‚ var deletes = [Int]() var deleteOffsets = [Int]() deleteOffsets.reserveCapacity(old.count) var runningDeleteOffset = 0 for index in old.indices { deleteOffsets.append(runningDeleteOffset) let record = oldResults[index] if record.correspondingNewIndex == nil { deletes.append(index) runningDeleteOffset += 1 } } å…¶å®ä¸Šæ–‡å·²ç»åšäº†è§£é‡Šï¼šå¦‚æœ correspondingNewIndex æ˜¯ nilï¼Œåˆ™æ„å‘³ç€è¯¥å…ƒç´ æ˜¯è¢«åˆ é™¤çš„å…ƒç´ ã€‚æ‰€ä»¥è¿™æ¬¡æ˜¯å¯¹ old è¿›è¡Œéå†ï¼Œè€Œä¸æ˜¯éå† new ã€‚ é™¤äº†å°†è¢«åˆ é™¤çš„å…ƒç´ è®°å½•åˆ° deletes ä¹‹å¤–ï¼Œè¯¥å¾ªç¯è¿˜å°† â€œåœ¨è¿™ä¸ªä½ç½®ä¹‹å‰ï¼Œæœ‰å¤šå°‘ä¸ªè¢«åˆ é™¤äº†å¤šå°‘ä¸ªå…ƒç´ â€ è®°å½•åˆ°äº† deleteOffsets æ•°ç»„ä¸­ã€‚ ä¾‹å¦‚ [1, 2, 3, 4, 5, 6, 7] å’Œ [2, 3, 5, 7] è¿™ä¸¤ä¸ªé›†åˆåšæ¯”è¾ƒï¼Œé‚£ä¹ˆ deleteOffsets çš„å€¼å°±æ˜¯ [0, 1, 1, 1, 2, 2, 3]ã€‚ä»£è¡¨ç€ â€œ5è¿™ä¸ªå…ƒç´ ä¹‹å‰ï¼Œæœ‰ä¸¤ä¸ªå…ƒç´ è¢«åˆ é™¤æ‰äº†â€ã€‚ è¯¥ç®—æ³•æ˜¯å…ˆå°† runningDeleteOffset æ·»åŠ åˆ° deleteOffsets é‡Œï¼Œå†åšé€’å¢æ“ä½œã€‚æ‰€ä»¥è®°å½•çš„æ˜¯ â€œæœ¬å…ƒç´ ä¹‹å‰ï¼Œè¢«åˆ é™¤äº†å¤šå°‘ä¸ªå…ƒç´ â€ã€‚ æ–°å¢å’Œç§»åŠ¨ var inserts = [Int]() var updates = [(Int, Int)]() var moves = [(Int, Int)]() var insertOffsets = [Int]() insertOffsets.reserveCapacity(new.count) var runningInsertOffset = 0 for index in new.indices { insertOffsets.append(runningInsertOffset) let record = newResults[index] if let oldArrayIndex = record.correspondingOldIndex { if record.entry.isUpdated { updates.append((oldArrayIndex, index)) } let insertOffset = insertOffsets[index] let deleteOffset = deleteOffsets[oldArrayIndex] if (oldArrayIndex - deleteOffset + insertOffset) != index { moves.append((oldArrayIndex, index)) } } else { inserts.append(index) runningInsertOffset += 1 } } é¦–å…ˆæˆ‘ä»¬å‘ç°éå†çš„å¼€å¤´ï¼Œç”¨äº† record.correspondingOldIndex æ¥åšåˆ¤æ–­ï¼Œæ„å‘³ç€ â€œè¯¥å…ƒç´ æœ‰æ²¡æœ‰å¯¹åº”çš„è€å…ƒç´ â€ã€‚ ç„¶åä»ä¸‹å¾€ä¸Šçœ‹ else çš„é€»è¾‘ï¼Œå’Œåˆ é™¤çš„æ—¶å€™ä¸€æ ·ï¼Œè¿™æ¬¡å¾ªç¯é€šè¿‡ inserts è®°å½•äº† â€œè¯¥å…ƒç´ ä¹‹å‰ï¼Œæ’å…¥äº†å¤šå°‘ä¸ªå…ƒç´ â€ã€‚è¿™é‡Œæˆ‘å°±ä¸ç”¨å…·ä½“çš„ä¾‹å­ä¸¾ä¾‹äº†ï¼Œå¤§å®¶åº”è¯¥å¯ä»¥æ˜ç™½ã€‚ é‚£ä¹ˆå†å›åˆ° if é‡Œçš„é€»è¾‘ï¼Œé¦–å…ˆ isUpdated æ˜¯ä¹‹å‰å·²ç»åˆ¤æ–­è¿‡äº†çš„ã€‚ é‚£ä¹ˆ (oldArrayIndex - deleteOffset + insertOffset) != index è¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬æ˜ç¡®æ¯ä¸ªå‚æ•°çš„å«ä¹‰ï¼š index æ˜¯æŸä¸ªå…ƒç´ åœ¨ â€œæ–°é›†åˆâ€ ä¸­çš„ä½ç½®ã€‚ oldArrayIndex æ˜¯è¯¥å…ƒç´ åœ¨ â€œæ—§é›†åˆâ€ ä¸­çš„ä½ç½®ã€‚ deleteOffset æ„å‘³ç€è¯¥å…ƒç´ ä¹‹å‰åˆ é™¤äº†å‡ ä¸ªå…ƒç´ ã€‚ insertOffset æ„å‘³ç€è¯¥å…ƒç´ ä¹‹å‰æ·»åŠ äº†å‡ ä¸ªå…ƒç´ ã€‚ é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç†è§£äº†ï¼šå¯¹äºæ—§é›†åˆè€Œè¨€ï¼Œå¦‚æœå»æ‰è¢«åˆ é™¤çš„ï¼Œå†åŠ ä¸Šæ–°å¢çš„ï¼Œå¦‚æœç´¢å¼•ä½ç½®ä¸å˜ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ çš„ä½ç½®æ²¡æœ‰å‘ç”Ÿç§»åŠ¨ã€‚ é€šè¿‡å…·ä½“çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹ï¼š [1, 2, 3, 4, 5, 6, 7] å’Œ [2, 3, 7, 5]ã€‚æˆ‘ä»¬éå†çš„æ˜¯åè€…ï¼Œå³æ–°é›†åˆã€‚deleteOffsets æ˜¯ [0, 1, 1, 1, 2, 2, 3]ã€‚ å‡è®¾æ­¤æ—¶æˆ‘ä»¬éå†åˆ°äº†æ–°é›†åˆä¸­çš„ 3ã€‚ é‚£ä¹ˆ index æ˜¯ 1ï¼ŒoldArrayIndex æ˜¯ 2ï¼ŒdeleteOffset æ˜¯ 1ï¼ŒinsertOffset æ˜¯ 0ã€‚è¡¨è¾¾å¼ä¸º 2 - 1 - 0 == 1ï¼Œä¸ç¬¦åˆæ¡ä»¶ï¼ˆæ³¨æ„ä»£ç ä¸­ç”¨çš„æ˜¯ != å·ï¼‰ï¼Œé‚£ä¹ˆåˆ™ä¸ä¼šæ·»åŠ åˆ° moves é‡Œï¼Œæ„å‘³ç€ 3 è¿™ä¸ªå…ƒç´ æ²¡æœ‰è¢«ç§»åŠ¨ã€‚ å†å‡è®¾æ­¤æ—¶æˆ‘ä»¬éå†åˆ°äº†æ–°é›†åˆä¸­çš„ 7ã€‚ é‚£ä¹ˆ index æ˜¯ 2ï¼ŒoldArrayIndex æ˜¯ 6ï¼ŒdeleteOffset æ˜¯ 3ï¼ŒinsertOffset æ˜¯ 0ã€‚è¡¨è¾¾å¼ä¸º 6 - 3 - 0 != 2ï¼Œç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥åˆ¤æ–­ 7 å‘ç”Ÿäº†ç§»åŠ¨ã€‚ æœ€åéå†åˆ° 5 çš„æ—¶å€™ï¼Œ index æ˜¯ 3ï¼ŒoldArrayIndex æ˜¯ 4ï¼ŒdeleteOffset æ˜¯ 2ï¼ŒinsertOffset æ˜¯ 0ã€‚è¡¨è¾¾å¼ä¸º 4 - 2 - 0 != 3ï¼Œç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥åˆ¤5 ä¹Ÿæ˜¯å‘ç”Ÿäº†ç§»åŠ¨ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç­›é€‰å‡ºå“ªäº›å…ƒç´ å‘ç”Ÿäº†ç§»åŠ¨ã€‚ æ€»ç»“ epoxy çš„ Diffing ç®—æ³•å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š å°†è¾“å…¥è½¬æ¢ä¸º ContiguousArray ç±»å‹ï¼Œæå‡æ•ˆç‡ã€‚ ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œå°†åŒä¸€ä¸ª id çš„å…ƒç´ ä»æ–°æ—§ä¸¤ä¸ªé›†åˆä¸­æ‘˜å‡ºæ¥ï¼ŒåšåŒ¹é…ï¼ŒåŒæ—¶è®°å½•åŸæœ¬çš„ä½ç½®ã€‚ åˆ©ç”¨è¿™ä¸ªå“ˆå¸Œè¡¨ï¼Œé…åˆ LCS ç®—æ³•ï¼Œæ‰¾å‡ºå“ªäº›å…ƒç´ è¢«åˆ é™¤ï¼Œå“ªäº›å…ƒç´ æ˜¯æ–°å¢çš„ã€‚ æ ¹æ®éœ€æ±‚ï¼Œè¿›ä¸€æ­¥å°†ç¬¬ä¸‰æ­¥çš„ç»“æœè¿›è¡Œå¤„ç†ã€‚ æœ€åè´´ä¸Šä¸€ä¸‹æˆ‘è‡ªå·±å¯¹æºä»£ç åšçš„æ³¨é‡Šï¼š /// å¯¹ä¸¤ä¸ª `Diffable` å…ƒç´ é›†åˆï¼ˆä¾‹å¦‚ `Array`ï¼‰è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ï¼Œè¿”å›ä¸€ä¸ª `IndexChangeset`ï¼Œè¡¨ç¤ºä» `other` åˆ°æ­¤é›†åˆçš„æœ€å°æ›´æ”¹é›†åˆã€‚ /// /// - Parameters: /// - from other: æ—§æ•°æ®é›†åˆã€‚ public func makeChangeset(from other: Self) -&gt; IndexChangeset { // åœ¨è¿›è¡Œå·®å¼‚åŒ–å¤„ç†ä¹‹å‰å°†å…ƒç´ è¿ç»­æ’åˆ—å¯ä»¥æé«˜å¤§çº¦40%çš„æ€§èƒ½ã€‚ let new = ContiguousArray(self) let old = ContiguousArray(other) // é€šè¿‡ `dataID`ï¼Œå°† `self` å’Œ `other` çš„å¯¹åº”å…ƒç´ å­˜å‚¨åˆ° `entries` é‡Œã€‚ var entries = [AnyHashable: Entry](minimumCapacity: new.count) var duplicates = [Entry]() // ç”¨æ¥è®°å½•æ–°å…ƒç´ ï¼ˆ`self`ï¼‰å’Œæ—§ç´¢å¼•çš„ä¸€ä¸ªå¯¹åº”å…³ç³» var newResults = ContiguousArray&lt;NewRecord&gt;() newResults.reserveCapacity(new.count) // for index in new.indices { // `new` å…¶å®å°±æ˜¯ `self`ï¼Œä» `self` é‡Œæ‹¿æ ‡è¯†ç¬¦ let id = new[index].diffIdentifier let entry = entries[id, default: Entry()] // 1. è®°å½•è¿™ä¸ªæ–°å…ƒç´ çš„ä½ç½® // 2. åˆ¤æ–­å½“å‰æ•°ç»„çš„é‡å¤æ€§ï¼Œå› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥å†…éƒ¨æ•°æ®æœ‰å¯èƒ½ä¼šæœ‰é‡å¤çš„æƒ…å†µã€‚ if entry.trackNewIndex(index) { duplicates.append(entry) } entries[id] = entry // `correspondingOldIndex` é»˜è®¤æ˜¯ `nil` newResults.append(NewRecord(entry: entry)) } // ç”¨æ¥è®°å½•æ—§å…ƒç´ ï¼ˆ`other`ï¼‰å’Œæ–°ç´¢å¼•çš„ä¸€ä¸ªå¯¹åº”å…³ç³» var oldResults = ContiguousArray&lt;OldRecord&gt;() oldResults.reserveCapacity(old.count) for index in old.indices { // ä» `other` é‡Œæ‹¿æ ‡è¯†ç¬¦ let id = old[index].diffIdentifier // ç”¨ `other` çš„ `id`ï¼Œå» `self` é‡Œæ‰¾å¯¹åº”çš„å€¼ let entry = entries[id] // å¦‚æœæ‰¾åˆ°çš„è¯ï¼Œå°±å°†æ—§çš„ç´¢å¼•å­˜å‚¨åˆ° `entry` é‡Œã€‚ // `entry` é‡Œæ—¢å­˜å‚¨äº†æ–°ï¼ˆ`self`ï¼‰çš„ç´¢å¼•ï¼Œåˆå­˜å‚¨äº†æ—§ï¼ˆ`other`ï¼‰çš„ç´¢å¼•ã€‚ // å› ä¸º `id` æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å°±é€šè¿‡ `id` æŠŠæ–°æ—§ä¸¤ä¸ªå…ƒç´ çš„ç´¢å¼•å¯¹åº”èµ·æ¥äº†ã€‚ entry?.pushOldIndex(index) // `correspondingNewIndex` é»˜è®¤æ˜¯ `nil` oldResults.append(OldRecord(entry: entry)) } for newIndex in new.indices { // `newResults` æ˜¯é€šè¿‡éå† new å¾—åˆ°çš„ // æ‰€ä»¥ `index` æ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ `new` çš„ `index` æ‹¿åˆ° `newResults` çš„å…ƒç´  let entry = newResults[newIndex].entry // å¦‚æœå­˜åœ¨æ–°å…ƒç´ å¯¹åº”çš„è€å…ƒç´ çš„è¯ï¼Œå¯èƒ½å¯¹åº”æ›´æ–°æ“ä½œ if let oldIndex = entry.popOldIndex() { let newItem = new[newIndex] let oldItem = other[oldIndex] // å¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œåˆ™æ˜¯æ›´æ–°æ“ä½œ if !oldItem.isDiffableItemEqual(to: newItem) { entry.isUpdated = true } // è®°å½•ä¸¤ä¸ªå…ƒç´ ç›¸å¯¹çš„ä½ç½® // å¯èƒ½ä» `old` æ›´æ–°åˆ° `new`ï¼Œæ‰€ä»¥ç´¢å¼•æ˜¯æœ‰éœ€è¦çš„ newResults[newIndex].correspondingOldIndex = oldIndex oldResults[oldIndex].correspondingNewIndex = newIndex } } // åˆ é™¤æ“ä½œ var deletes = [Int]() var deleteOffsets = [Int]() deleteOffsets.reserveCapacity(old.count) var runningDeleteOffset = 0 for index in old.indices { deleteOffsets.append(runningDeleteOffset) let record = oldResults[index] // è¿™é‡Œç­‰äº `nil`ï¼Œæ„å‘³ç€åœ¨ä¸Šä¸€ä¸ªå¾ªç¯ä¸­ï¼Œæ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„ `new` å…ƒç´  // æ‰€ä»¥æ„å‘³ç€åœ¨ `new` æ•°ç»„ä¸­ï¼Œæ²¡æœ‰è¯¥å…ƒç´ å­˜åœ¨ï¼Œæ‰€ä»¥è¯¥å…ƒç´ è¢«åˆ é™¤äº† if record.correspondingNewIndex == nil { deletes.append(index) runningDeleteOffset += 1 } } var inserts = [Int]() var updates = [(Int, Int)]() var moves = [(Int, Int)]() var insertOffsets = [Int]() insertOffsets.reserveCapacity(new.count) var runningInsertOffset = 0 for index in new.indices { insertOffsets.append(runningInsertOffset) let record = newResults[index] // æœ‰æ–°ï¼Œæœ‰è€ if let oldArrayIndex = record.correspondingOldIndex { if record.entry.isUpdated { // æ›´æ–°ï¼Œè®°å½•å…ƒç´ çš„å¯¹åº”å…³ç³» updates.append((oldArrayIndex, index)) } // `insertOffsets` å’Œ `deleteOffsets` é‡Œçš„å€¼ï¼Œç±»ä¼¼äº `[0, 0, 1, 1, 1]` è¿™ç§å½¢å¼ // å…¶é•¿åº¦åˆ†åˆ«ç­‰äº `new` å’Œ `old`ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”çš„ `index` å–å€¼ä¸ä¼šå¯¼è‡´æº¢å‡º let insertOffset = insertOffsets[index] let deleteOffset = deleteOffsets[oldArrayIndex] // æ—§ä½ç½® - åˆ é™¤äº†çš„å…ƒç´ ä¸ªæ•° + æ–°å¢äº†çš„å…ƒç´ ä¸ªæ•° != æ–°ä½ç½® -&gt; ç§»åŠ¨äº† if (oldArrayIndex - deleteOffset + insertOffset) != index { moves.append((oldArrayIndex, index)) } } // æœ‰æ–°ï¼Œæ²¡è€ else { // æ„å‘³ç€æ–°çš„å…ƒç´ ç›¸å¯¹äºè€çš„å…ƒç´ æ¥è¯´æ˜¯æ’å…¥è¿›æ¥çš„ inserts.append(index) runningInsertOffset += 1 } } EpoxyLogger.shared.assert( old.count + inserts.count - deletes.count == new.count, &quot;Failed sanity check for old count with changes matching new count.&quot;) return IndexChangeset( inserts: inserts, deletes: deletes, updates: updates, moves: moves, newIndices: oldResults.map { $0.correspondingNewIndex }, duplicates: duplicates.map { $0.newIndices }) } åè®° æ–‡ç« ç®—æ˜¯å†™å®Œäº†ï¼Œä½†æ˜¯æ„Ÿæ…¨è‡ªå·±è™½ç„¶èŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œç®—æ˜¯ â€œå¼„æ˜ç™½â€ äº†æœ¬ç®—æ³•ï¼Œä½†æ˜¯ä¹Ÿä»…é™äºçœ‹æ‡‚ï¼Œç„¶åæ„Ÿæ…¨å®ƒçš„ç²¾å¦™ã€‚ç”šè‡³ä¸æ•¢è‚¯å®šä»¥åé‡åˆ°ç›¸ä¼¼çš„éœ€æ±‚æ—¶ï¼Œèƒ½ç”¨ä¸Šè¯¥ç®—æ³•ã€‚å“ï¼Œå¸Œæœ›ä»Šåè¿˜èƒ½æœ‰æ‰€é•¿è¿›ã€‚ ","link":"https://blog.rakuyo.dev/epoxy-source-code-notes-1/"},{"title":"åŠ é€Ÿ Swift Package Manager","content":"è™½ç„¶å›½å†…å®é™…å¼€å‘ç”¨ Swift Package Managerï¼ˆåç§° SPMï¼‰çš„æ¯”è¾ƒå°‘ï¼Œä½†æ˜¯å›½å¤–çš„ä¸€äº›å¼€æºåº“é‡Œå´ç»å¸¸ç”¨åˆ°ã€‚æ‰€ä»¥ç»å¸¸é‡åˆ°é¡¹ç›® clone ä¸‹æ¥ä¹‹åï¼ŒSPM åŠ è½½å¤±è´¥å¯¼è‡´é¡¹ç›®æ— æ³•è¿è¡Œçš„é—®é¢˜ã€‚ ç½‘ä¸Šå…³äº SPM åŠ é€Ÿçš„æ–‡ç« ä¹Ÿæœ‰å¾ˆå¤šï¼Œæ–¹æ³•ä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œæœ¬æ–‡æŒ‘é€‰å‡ ä¸ªè¿›è¡Œè®°å½•ã€‚ æ ¹æœ¬é—®é¢˜ æ ¹æœ¬é—®é¢˜è¿˜æ˜¯ Xcode å†…éƒ¨æœåŠ¡æ— æ³•è¿æ¥ä»£ç†ï¼Œå¯¼è‡´è®¿é—® Github ç»å¸¸è¶…æ—¶ã€‚ æ‰€ä»¥è§£å†³æ–¹æ¡ˆè¿˜æ˜¯è¦ä»ä»£ç†å…¥æ‰‹ã€‚ è§£å†³æ–¹æ¡ˆ å…ˆåˆ—ä¸¾ä¸€ä¸‹æœ¬æ–‡è®°å½•çš„å‡ ç§è§£å†³æ–¹æ¡ˆï¼š è·¯ç”±å™¨ç«¯ç›´æ¥è®¾ç½®ä»£ç† é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æ‹‰å– ClashX å¢å¼ºæ¨¡å¼ ä»£ç† Xcode è®¾ç½® SPM Mirror ä»¥ä¸Šæ–¹æ³•åœ¨æˆ‘çœ‹æ¥è°ˆä¸ä¸Šå“ªä¸ªæ›´å¥½ã€‚å¼€å‘åº”å½“åœ¨åˆé€‚çš„æ—¶å€™é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚ è·¯ç”±å™¨ç«¯ç›´æ¥è®¾ç½®ä»£ç† åœ¨è·¯ç”±å™¨ä¸Šç›´æ¥è®¾ç½®ä»£ç†ï¼Œä»ç½‘ç»œæºå¤´è§£å†³é—®é¢˜ã€‚ä½†æ˜¯å“ªæ€•æ˜¯åœ¨ä¸€äº›å…¬å¸ï¼Œä¹Ÿä¸å¤ªæ–¹ä¾¿æ·»åŠ è½¯è·¯ç”±ç­‰æ–¹æ³•åšè¿™äº›æ“ä½œã€‚æœ‰æ¡ä»¶çš„ä¸ªäººå¯ä»¥æä¸€ä¸‹ã€‚ é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æ‹‰å– å‚è€ƒ å¦‚ä½•è®©swift package managerèµ°ä»£ç† å…·ä½“æ–¹æ³•ï¼š é¦–å…ˆæ˜¯æ‰“å¼€ç»ˆç«¯ï¼Œç„¶ååœ¨ç»ˆç«¯å†…æŒ‰ç…§ â€œä¸ºç»ˆç«¯è®¾ç½®ä»£ç†â€ çš„æ–¹æ³•ï¼Œè®¾ç½® https_proxy ã€ http_proxy å’Œ all_proxy åœ¨ é¡¹ç›®æ ¹ç›®å½•ä¸‹ æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼š xcodebuild -resolvePackageDependencies -scmProvider system é€šè¿‡å‘½ä»¤è¡Œç›´æ¥æ‹‰å– SPM ä¾èµ–ï¼Œæ‰§è¡Œå®Œæˆåæ‰“å¼€é¡¹ç›®å³å¯ã€‚ æœ‰çš„æ–‡ç« å¯èƒ½æåˆ°å¯ä»¥ä¸º git config è®¾ç½®ä»£ç†ï¼Œå…¶å‘½ä»¤ä¸ºï¼š # éœ€è¦å°†ç«¯å£æ›¿æ¢æˆè‡ªå·±çš„ç«¯å£ git config --global http.proxy 'http://127.0.0.1:1080' git config --global https.proxy 'http://127.0.0.1:1080' è¿™é‡Œæˆ‘æ²¡æœ‰è¿›è¡Œå°è¯•ï¼Œæœ‰æƒ³æ³•çš„è¯»è€…å¯ä»¥è‡ªè¡Œå°è¯•ã€‚ ClashX å¢å¼ºæ¨¡å¼ ClashX Pro çš„å¢å¼ºæ¨¡å¼å¯ä»¥ç©¿é€ç»å¤§å¤šæ•°è½¯ä»¶ï¼ŒåŒ…æ‹¬ç»ˆç«¯ã€Xcodeã€‚å¼€å¯åç›´æ¥ä½¿ç”¨ Xcode å³å¯ä¸‹è½½ä¾èµ–ã€‚ è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼šå¢å¼ºæ¨¡å¼ä¼šå¯¼è‡´ä¸€äº›å†…ç½‘æœåŠ¡ä¸å¯ç”¨ï¼Œæ‰€ä»¥å»ºè®®ä»…åœ¨éœ€è¦æ—¶ä¸´æ—¶æ‰“å¼€ï¼Œä¸å»ºè®®å¸¸é©»ä½¿ç”¨ã€‚æ‰€ä»¥ä½ éœ€è¦è®°å¾—åœ¨ Fetch æˆåŠŸåå…³é—­å¢å¼ºæ¨¡å¼ã€‚ å¦‚æœå¥½å¥‡ ClashX åšäº†ä»€ä¹ˆï¼Œå¯ä»¥å‚è€ƒï¼šè¯·é—®ä¸‹å¢å¼ºæ¨¡å¼æ˜¯åšäº†ä»€ä¹ˆå¤„ç† ä»£ç† Xcode å¦‚æœä½ æ²¡æœ‰æˆ–è€…ä¸æƒ³ä½¿ç”¨ ClashXï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ Proxifier è¿›è¡Œæ‹¦æˆªï¼Œç„¶åå†èµ°ä»£ç†ã€‚ï¼ˆä¸è¿‡è™½ç„¶ Proxifier æä¾›äº†å…è´¹è¯•ç”¨ï¼Œä½†ä»ç„¶ç®—æ˜¯æ”¶è´¹é‚£ä¸€æ¡£çš„ï¼‰ æœ‰æ¡ä»¶çš„ä¼™ä¼´å¯ä»¥æŸ¥çœ‹ Xcodeè®¾ç½®SPMä»£ç† è¿™ç¯‡æ–‡ç« ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„ä»‹ç»ã€‚ è®¾ç½® SPM Mirror ä»‹ç»å’Œä½¿ç”¨æ–¹æ³• æœ€è¿‘å¶ç„¶é—´å‘ç°ï¼ŒSPM åœ¨ Swift 5 æä¾›äº†ä¸€ä¸ª Mirror é•œåƒåŠŸèƒ½ï¼Œææ¡ˆåœ¨è¿™é‡Œï¼šPackage Manager Dependency Mirroring å³å¦‚ä¸‹å‘½ä»¤ï¼š swift package config set-mirror --original https://github.com/QMUI/LookinServer.git --mirror http://git.aaaaaa.top/LookinServer.git --original æ˜¯åŸåœ°å€ï¼Œè€Œ --mirror åˆ™æ˜¯é•œåƒä»“åº“çš„ urlã€‚ æ‰€ä»¥æœ‰æ¡ä»¶çš„é€šè¿‡å¯ä»¥åœ¨å†…ç½‘ Git ä¸Š Fork Github Repoï¼Œæˆ–è€…åœ¨å›½å†…æ‰¾å¯»ç°æœ‰é•œåƒï¼Œç„¶åé€šè¿‡ Mirror ä¸‹è½½ä¾èµ–ã€‚ ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šææ¡ˆä¸­æœ‰å¦‚ä¸‹è¿™ä¹ˆä¸€å¥è¯ï¼š The Package.resolved file will contain the mirror URLs that were used during dependency resolution. ä½†æ˜¯åœ¨ Xcode 15 ä¸Šå®è·µåå‘ç° Package.resolved æ˜¾ç¤ºçš„è¿˜æ˜¯ Original URLï¼Œä¸æ˜¯ Mirror URLã€‚ æœç´¢åå‘ç°æœ‰è¿™ä¹ˆä¸€ä¸ª issueï¼šSwiftPM: mirrored URLs end up in Package.resolved fileã€‚ä¹Ÿå°±æ˜¯è¯´ Package.resolved æ–‡ä»¶ä¸­æ˜¾ç¤º Original URL åœ¨ç°åœ¨æ˜¯æ­£ç¡®è¡Œä¸ºã€‚è‡³äº Fetch æ—¶ä½¿ç”¨çš„å“ªä¸ª urlï¼Œå¯ä»¥åœ¨ Report navigator ä¸­æŸ¥çœ‹å…·ä½“çš„ logã€‚ Package.swift å¦‚æœä½ å¼€å‘çš„æ˜¯ä¸€ä¸ª Swift æ¡†æ¶ï¼Œè¦ç®¡ç† Package.swift ä¸­çš„ä¾èµ–ï¼ˆä½¿ç”¨è¯¥æ–‡ä»¶æ‰“å¼€é¡¹ç›®ï¼‰ï¼Œ é‚£ä¹ˆå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚ xcodeproj ä½†æ˜¯å¦‚æœä½ æ˜¯æƒ³ä¸º xcodeproj ä¸­æ·»åŠ çš„ä¾èµ–è®¾ç½® mirrorï¼Œé‚£ä¹ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ä½¿ç”¨ swift package config set-mirror å‘½ä»¤æ˜¯ä¼šæŠ¥é”™çš„ï¼šerror: Could not find Package.swift in this directory or any of its parent directories. é€šè¿‡æŠ¥é”™å¯çŸ¥è¯¥æ–¹æ³•ä»…é€‚ç”¨äº Package.swift ç®¡ç†çš„é¡¹ç›®ã€‚ä½†æ˜¯åˆ«ç€æ€¥ã€‚ åœ¨ Apple æ–‡æ¡£ Adding package dependencies to your app ä¸­æœ‰è¿™ä¹ˆä¸€å°æ®µæè¿°ï¼š You can find the Package.resolved file inside your .xcodeproj directory at [appName].xcodeproj/project.workspace/xcshareddata/swiftpm/Package.resolved. é€šè¿‡è¿™æ®µæè¿°æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œproject.workspace é‡Œé¢æœ‰ä¸€ä¸ª swiftpm ç›®å½•ï¼Œè¿›å…¥åä¼šå‘ç°è¯¥ç›®å½•ä¸‹å°±æœ‰ä¸€ä¸ª configuration æ–‡ä»¶å¤¹ã€‚ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°† set-mirror å‘½ä»¤ç”Ÿæˆçš„ mirrors.json æ–‡ä»¶æ”¾åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼Œå³å¯å®Œæˆé•œåƒè®¾ç½®ã€‚ æ³¨æ„ï¼šä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„ .gitignore æ–‡ä»¶é…ç½®ä¼šå¯¼è‡´è¯¥è·¯å¾„ä¸ä¼šè¢«æäº¤åˆ° git ä¸Šã€‚è¿™ç‚¹è¯·æ‚¨æ³¨æ„ã€‚ æ­¤æ—¶å›åˆ° Xcode ä¸­æ·»åŠ ä¾èµ–ï¼Œå°±ä¼šå‘ç°é€Ÿåº¦ ... å¥½åƒæ²¡æœ‰å˜åŒ–ã€‚è¿™å°±ååˆ†å°´å°¬äº†... é€šè¿‡è¿›ä¸€æ­¥è§‚å¯Ÿã€æŸ¥çœ‹ log ä»¥åŠæœç´¢ç›¸å…³èµ„æ–™ã€‚æˆ‘è¿›ä¸€æ­¥ç¡®å®šï¼šmirror è¿™ä¸ªé…ç½®ä»…é€‚ç”¨äº Package.swift è½¯ä»¶åŒ…ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ Xcode é‡Œé€šè¿‡ä¸€ä¸ª github çš„ url æ¥æ·»åŠ ä¾èµ–ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸ä¼šèµ° mirror é…ç½®çš„ã€‚ä½†æ˜¯è¯¥ä¾èµ–æ‰€ä¾èµ–çš„å…¶ä»–ç»„ä»¶ï¼Œåˆèƒ½èµ° mirror é…ç½®ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ª Package.swift è½¯ä»¶åŒ…ã€‚ æ‰€ä»¥å›åˆ°è¿™å°èŠ‚è®¨è®ºçš„é—®é¢˜ä¸Šï¼šä½ åªèƒ½ä½¿ç”¨ä¸Šé¢æåˆ°çš„å…¶ä»–æ–¹æ³•ï¼Œæ¥è§£å†³åœ¨ Xcode é‡Œå‘ project æ·»åŠ ä¾èµ–çš„é—®é¢˜ã€‚ æˆ‘ä»¬è¦æ”¾å¼ƒå—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œæˆ‘æƒ³åˆ°äº†ä¸€ä¸ªæŠ˜ä¸­/å–å·§çš„æ–¹æ³•æ¥è§£å†³è¯¥é—®é¢˜ã€‚è¯¦è§æˆ‘åœ¨ stackoverflow ä¸Šçš„å›ç­”ã€‚ æ€»ç»“ è®©æˆ‘ä»¬å›åˆ°å®é™…åœºæ™¯ä¸‹æ¥çœ‹çœ‹ä¸Šè¿°æåˆ°çš„å‡ ä¸ªè§£å†³æ–¹æ¡ˆï¼š ä½ çš„ CI/CD åªèƒ½è®¿é—®å†…éƒ¨ç½‘ç»œï¼š ä¸è®ºä½ æ˜¯åœ¨å¼€å‘åº”ç”¨ç¨‹åºï¼Œè¿˜æ˜¯ä½ æˆ–ä½ çš„å…¬å¸åœ¨å¼€å‘ SPM è½¯ä»¶åŒ…ã€‚åœ¨åªèƒ½è®¿é—®å†…éƒ¨ç½‘ç»œï¼Œå®Œå…¨æ— æ³•è®¿é—® Github çš„æƒ…å†µä¸‹ï¼Œä½ åªèƒ½é€šè¿‡ mirror çš„æ–¹å¼æ¥ä½¿ç”¨ SPMã€‚ ä½ çš„å…¬å¸æ²¡æœ‰é‚£ä¹ˆå¤šè¦æ±‚ï¼Œè€Œä¸”äººå‡å…·å¤‡æ­æ¢¯å­çš„èƒ½åŠ›/ä½ æ˜¯å…·æœ‰æ­æ¢¯å­èƒ½åŠ›çš„ä¸ªäººå¼€å‘è€…ï¼š é‚£ä¹ˆå…¶ä»–å‡ ç§æ–¹æ³•éƒ½å¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚ ","link":"https://blog.rakuyo.dev/accelerated-swift-package-manager/"},{"title":"åœ†è§’ & ç¦»å±æ¸²æŸ“å®è·µ","content":"ä¸‹æ–‡ä¸»è¦é’ˆå¯¹å„ç§åŠ åœ†è§’çš„æƒ…å†µè¿›è¡Œå®è·µï¼Œçœ‹çœ‹ä¼šä¸ä¼šå‡ºç°ç¦»å±æ¸²æŸ“çš„æƒ…å†µã€‚ æµ‹è¯•æ¡ä»¶ æµ‹è¯•å¹³å°ï¼šiPhone 12ï¼ŒiOS 16.3.1ï¼ŒXcode 14.2ã€‚ æµ‹è¯•æ–¹æ³•ï¼šè¿è¡Œé¡¹ç›®åï¼Œé€šè¿‡ Xcode è®¾ç½® â€œDebug -&gt; View Debugging -&gt; Rendering -&gt; Color Off-screen Renderedâ€ æ¥æ‰“å¼€ç¦»å±æ¸²æŸ“æ£€æµ‹ã€‚ ä¸»è¦æµ‹è¯•ç‚¹ï¼š æ˜¯å¦å¼€å¯ masksToBounds æ˜¯å¦è®¾ç½®å›¾ç‰‡ æ˜¯å¦è®¾ç½®èƒŒæ™¯è‰²â€ çˆ¶è§†å›¾æ˜¯å¦å…·æœ‰é€æ˜åº¦ ç»“è®º è¿™é‡Œå…ˆæŠŠç»“è®ºæ”¾åˆ°æœ€å‰é¢ï¼Œåé¢æ‚¨å¯ä»¥è·³è¿‡å®è·µè¿‡ç¨‹ï¼Œç›´æ¥åˆ‡åˆ°è§£å†³æ–¹æ¡ˆä¸€èŠ‚ã€‚ âœ… ä»£è¡¨ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼›âŒ ä»£è¡¨ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ UIView UIImageView UIButtonï¼ˆåªæœ‰æ–‡å­—ï¼‰ UIButtonï¼ˆå›¾ç‰‡/èƒŒæ™¯å›¾ï¼‰ ç›´æ¥è®¾ç½® âœ… âœ… âœ… âŒ èƒŒæ™¯è‰²ï¼ˆéé€æ˜ï¼‰ âœ… âŒ âœ… âŒ çˆ¶è§†å›¾å…·æœ‰é€æ˜åº¦ï¼ˆalphaï¼‰ âŒ âŒ âŒ âŒ ä¸‹é¢é‡ç‚¹è¯´ä¸€ä¸‹ UIImageView å’Œ UIButton çš„æµ‹è¯•è¿‡ç¨‹ï¼š UIImageView iOS 9 å¯¹ UIImageView è¿›è¡Œäº†ä¸€ç³»åˆ—ä¼˜åŒ–ï¼Œç›¸æ¯”è¾ƒè¿‡å»è€Œè¨€ï¼Œè§¦å‘ç¦»å±æ¸²æŸ“çš„åœºæ™¯è¦å°äº†ä¸å°‘ ç›´æ¥è®¾ç½® lazy var testView = UIImageView().then { $0.image = UIImage(named: &quot;Forms/share-cover&quot;) $0.layer.masksToBounds = true $0.layer.cornerRadius = 30 } ä¸€ä¸ªè®¾ç½®äº†å›¾ç‰‡çš„ UIImageViewã€‚ç¤ºä¾‹ä¸­åŒæ—¶è®¾ç½®äº† masksToBounds å’Œ cornerRadiusã€‚ä»å›¾ç‰‡ä¸Šå¯ä»¥çœ‹å‡ºæ¥ï¼Œå¹¶ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼š UIImageView ä¸è®¾ç½® masksToBoundsï¼Œåªè®¾ç½® cornerRadius çš„è¯ä¸ä¼šæ˜¾ç¤ºåœ†è§’ã€‚ æ·»åŠ èƒŒæ™¯è‰² é‚£å¦‚æœæˆ‘ä»¬æ‰‹è´±å†ç»™å®ƒæ·»åŠ ä¸€ä¸ªèƒŒæ™¯è‰²å‘¢ï¼Ÿ lazy var testView = UIImageView().then { $0.image = UIImage(named: &quot;Forms/share-cover&quot;) $0.layer.masksToBounds = true $0.layer.cornerRadius = 30 $0.backgroundColor = .white // æ·»åŠ ä¸€ä¸ªç™½è‰²çš„èƒŒæ™¯è‰² } æœç„¶æ‰‹è´±æ˜¯æ²¡æœ‰å¥½å¤„çš„ï¼Œè®¾ç½®äº†èƒŒæ™¯è‰²ååˆ™ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ UIButton UIButton é»˜è®¤ä¹Ÿæ˜¯æ²¡æœ‰èƒŒæ™¯è‰²çš„ï¼Œéœ€è¦åŒæ—¶è€ƒè™‘æ–‡å­—å’Œå›¾ç‰‡ä¸¤ç§æƒ…å†µã€‚ æ–‡å­— å¦‚æœä¸è®¾ç½®èƒŒæ™¯è‰²çš„è¯ï¼Œåªæœ‰æ–‡å­—çš„ UIButton å¯¹è±¡æ˜¯æ˜¾ç¤ºä¸å‡ºæ¥åœ†è§’çš„ï¼Œä¸è¿‡æˆ‘ä¹Ÿæ˜¯åˆ†åˆ«æµ‹äº†ä¸€ä¸‹ã€‚ lazy var testView = UIButton(type: .custom).then { $0.setTitle(&quot;è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜&quot;, for: .normal) $0.layer.cornerRadius = 30 } ç»“è®ºæ˜¯ï¼šä¸è®ºè®¾ç½®ä¸è®¾ç½®èƒŒæ™¯è‰²ï¼Œåªæœ‰æ–‡å­—çš„ UIButton å¯¹è±¡æ·»åŠ åœ†è§’åéƒ½ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ åŒæ—¶åªéœ€è¦è®¾ç½® cornerRadiusï¼Œä¸éœ€è¦å¼€å¯ masksToBounds å°±å¯ä»¥æ˜¾ç¤ºå‡ºæ¥åœ†è§’ã€‚ å›¾ç‰‡ &amp; èƒŒæ™¯å›¾ å› ä¸ºç°è±¡ä¸€è‡´ï¼Œæ‰€ä»¥å›¾ç‰‡å’ŒèƒŒæ™¯å›¾åœ¨è¿™é‡Œå½’ä½ä¸€ç±»è¿›è¡Œè®¨è®ºã€‚ å¸¦å›¾ç‰‡çš„ UIButton æ˜¯é‡ç‚¹æµ‹è¯•å¯¹è±¡ï¼Œåˆ†ä¸‹é¢å‡ ç§æƒ…å†µï¼š ç›´æ¥è®¾ç½® lazy var testView = UIButton(type: .custom).then { $0.setTitle(&quot;è¿™æ˜¯ä¸€ä¸ªæ ‡é¢˜&quot;, for: .normal) $0.layer.masksToBounds = true $0.layer.cornerRadius = 30 $0.setImage(UIImage(named: &quot;Forms/share-cover&quot;), for: .normal) } å¦‚æœ UIButton åªè®¾ç½® cornerRadius è€Œä¸å¼€å¯ masksToBoundsï¼Œé‚£ä¹ˆå›¾ç‰‡æ˜¯ä¸ä¼šæ˜¾ç¤ºå‡ºåœ†è§’çš„ã€‚ ä»å›¾ä¸Šçœ‹ï¼Œæ˜¯ä¼šè§¦å‘ç¦»å±æ¸²æŸ“ã€‚ å°è¯•è§£å†³ç¦»å±æ¸²æŸ“é—®é¢˜ å®è·µäº†å“ªäº›æƒ…å†µä¼šè§¦å‘ç¦»å±æ¸²æŸ“ï¼Œæ¥ä¸‹æ¥å°±æƒ³åŠæ³•å°è¯•è§£å†³è¿™äº›é—®é¢˜ã€‚ ç”¨çˆ¶è§†å›¾è¿›è¡ŒåŒ…è£¹ æœ‰çš„æ–‡ç« ä¼šæåˆ°ç”¨ä¸€ä¸ªçˆ¶è§†å›¾åŒ…è£¹éœ€è¦æ·»åŠ åœ†è§’çš„è§†å›¾ï¼Œç„¶åå°†åœ†è§’æ·»åŠ åˆ°çˆ¶è§†å›¾ä¸Šã€‚ å®è·µå‘ç°è¯¥æ–¹æ³•å¹¶ä¸èƒ½è§£å†³ç¦»å±æ¸²æŸ“é—®é¢˜ã€‚ é¿å…å¼€å¯ masksToBounds UIImageView è§†å›¾å¯ä»¥åœ¨ä¸å¼€å¯ masksToBoundsï¼Œä»…è®¾ç½® cornerRadius çš„æƒ…å†µä¸‹æ˜¾ç¤ºåœ†è§’ï¼ŒåªåŒ…å«æ–‡å­—çš„ UIButton å¯¹è±¡ä¹Ÿä¸€æ ·ã€‚ æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸å¼€å¯ masksToBounds ä¹Ÿå¯ä»¥é¿å…è§¦å‘ç¦»å±æ¸²æŸ“ã€‚ ä¸ºå›¾ç‰‡æ·»åŠ åœ†è§’ ç›´æ¥ä¸ºå›¾ç‰‡æ·»åŠ åœ†è§’æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„é¿å…ç¦»å±æ¸²æŸ“çš„æ–¹æ³•ã€‚åªä¸è¿‡ç°åœ¨æ¯”è¾ƒå¸¸ç”¨çš„ UIImageView è§†å›¾å·²ç»ä¸ä¼šè§¦å‘ç¦»å±æ¸²æŸ“äº†ï¼Œä½†æ˜¯ UIButton ä¾ç„¶å¯ä»¥è¿™ä¹ˆåšã€‚ ä¸‹é¢æå‡ ç‚¹å®é™…éœ€æ±‚é‡Œå¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜ï¼š â€œæ‹¼æ¥å›¾ç‰‡â€ ä¾‹å¦‚å¾®ä¿¡çš„ç¾¤èŠå¤´åƒï¼Œå¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªå›¾ç‰‡åœ¨ä¸€ä¸ªè§†å›¾æ§ä»¶ä¸­è¿›è¡Œå±•ç¤ºã€‚ è¿™ä¸ªæ—¶å€™æœ€å¥½å°†å¤šå¼ å›¾ç‰‡æ‹¼åˆ°ä¸€èµ·ï¼Œç„¶åå¯¹è¿™å¼ å›¾ç‰‡æ•´ä½“è®¾ç½®åœ†è§’ã€‚è€Œä¸æ˜¯åœ¨ä¸€ä¸ª UIView ä¸­å°è¯•æ·»åŠ å¤šä¸ª UIImageVIewï¼Œå†å¯¹ UIView è®¾ç½®åœ†è§’ã€‚ è§†å›¾å°ºå¯¸ä¸å›ºå®š ä¸€èˆ¬ UIButton ä¼šé‡åˆ° â€œå°ºå¯¸ä¸å›ºå®š + éœ€è¦åœ†è§’ + èƒŒæ™¯è‰²â€ çš„æƒ…å†µã€‚ ä¾‹å¦‚é¡µé¢æŸä¸ªä½ç½®æœ‰ä¸€ä¸ª â€œè·ç¦»å±å¹•ä¸¤ä¾§ 10pxï¼Œå¯ç”¨çŠ¶æ€èƒŒæ™¯è‰²ä¸ºè“è‰²ï¼Œä¸å¯ç”¨çŠ¶æ€ä¸‹ä¸ºç°è“è‰²â€ çš„æŒ‰é’®ã€‚ æ­¤æ—¶å¯ä»¥è€ƒè™‘æ‰¾ UI åˆ‡ä¸€ä¸ªå¸¦åœ†è§’çš„çº¯è‰²å›¾ç‰‡ç›´æ¥ç”¨ä½œåº•è‰²ï¼Œä½†æ˜¯æˆ‘ä»¬å¼€å‘ä¹Ÿå¯ä»¥è‡ªå·±ç”Ÿæˆè¿™æ ·ä¸€å¼ å›¾ç‰‡ï¼Œç„¶åé€šè¿‡æ‹‰ä¼¸æ¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœã€‚ é¦–å…ˆæˆ‘ä»¬å…ˆæ‰¾å–µç¥å€Ÿç”¨ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æšä¸¾ï¼Œæ¥è¡¨ç¤ºåœ†è§’ï¼š extension UIImage { enum Radius { /// åœ†è§’åŠå¾„åº”è¯¥æŒ‰ç…§å›¾ç‰‡**å®½åº¦**çš„æ¯”ä¾‹è®¡ç®—ã€‚ /// é€šå¸¸å…³è”çš„å€¼åº”è¯¥åœ¨0å’Œ0.5ä¹‹é—´ï¼Œå…¶ä¸­0è¡¨ç¤ºæ²¡æœ‰åœ†è§’ï¼Œ0.5è¡¨ç¤ºä½¿ç”¨å›¾ç‰‡å®½åº¦çš„ä¸€åŠä½œä¸ºåœ†è§’åŠå¾„ã€‚ case widthFraction(CGFloat) /// åœ†è§’åŠå¾„åº”è¯¥æŒ‰ç…§å›¾ç‰‡**é«˜åº¦**çš„æ¯”ä¾‹è®¡ç®—ã€‚ /// é€šå¸¸å…³è”çš„å€¼åº”è¯¥åœ¨0å’Œ0.5ä¹‹é—´ï¼Œå…¶ä¸­0è¡¨ç¤ºæ²¡æœ‰åœ†è§’ï¼Œ0.5è¡¨ç¤ºä½¿ç”¨å›¾ç‰‡é«˜åº¦çš„ä¸€åŠä½œä¸ºåœ†è§’åŠå¾„ã€‚ case heightFraction(CGFloat) /// ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„ç‚¹å€¼ä½œä¸ºåœ†è§’åŠå¾„ã€‚ case point(CGFloat) func compute(with size: CGSize) -&gt; CGFloat { let cornerRadius: CGFloat switch self { case .point(let point): cornerRadius = point case .widthFraction(let widthFraction): cornerRadius = size.width * widthFraction case .heightFraction(let heightFraction): cornerRadius = size.height * heightFraction } return cornerRadius } } } ä¹‹åç”Ÿæˆçº¯è‰²å›¾ç‰‡ï¼š extension UIImage { static func color( _ color: UIColor, size: CGSize = .init(width: 1, height: 1), radius: Radius? = nil ) -&gt; UIImage { let cornerRadius = radius?.compute(with: size) let renderer = UIGraphicsImageRenderer(size: size) let image = renderer.image { _ in let rect = CGRect(origin: .zero, size: size) let path: UIBezierPath if let cornerRadius = cornerRadius { path = .init(roundedRect: rect, cornerRadius: cornerRadius) } else { path = .init(rect: rect) } color.setFill() path.fill() } guard let cornerRadius = cornerRadius else { return image } let insets = { UIEdgeInsets(top: $0, left: $0, bottom: $0, right: $0) }(cornerRadius) return image.resizableImage(withCapInsets: insets, resizingMode: .stretch) } } ä½ è¿˜å¯ä»¥æ‰©å±•è¿™ä¸ªæ–¹æ³•ï¼Œé…ç½®éœ€è¦åœ†è§’çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ä¸ºå››ä¸ªè¾¹éƒ½æ·»åŠ åœ†è§’ï¼Œæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚ ","link":"https://blog.rakuyo.dev/off-screen-rendering-practice/"},{"title":"iOSè‡ªç¼–ç¬”è¯•é¢˜","content":"æœ€è¿‘è¦è´Ÿè´£é¢è¯•ï¼Œäºæ˜¯å„å¤„æœç½—äº†ä¸€äº›é¢è¯•é¢˜ï¼Œç”¨äºç¬”è¯•ï¼ˆä¸åŒ…å«ç®—æ³•ï¼‰ï¼Œä¹Ÿå½“ä½œè‡ªå·±çš„ä¸€ä¸ªå¤ä¹ ã€‚ é¢è¯•é¢˜éƒ¨åˆ†è¯·å‚è€ƒï¼šiOSè‡ªç¼–é¢è¯•é¢˜ è§„åˆ™ï¼š 40åˆ†é’Ÿä½œç­”æ—¶é—´ã€‚ ç¦æ­¢ä½¿ç”¨æ‰‹æœºæŸ¥é˜…ç­”æ¡ˆã€‚ç¦æ­¢ä½¿ç”¨ ChatGPT ç±»è½¯ä»¶æŸ¥é˜…ç­”æ¡ˆã€‚ ç±»åã€å˜é‡åä»¥åŠæ–¹æ³•åï¼Œä¸è®°å¾—å…¨æ‹¼çš„å…è®¸ä½¿ç”¨ç¼©å†™ã€‚ æ³¨ï¼š æœ¬é¢˜ç›®å¤šæ•°ç”± ChatGPT ç”Ÿæˆï¼Œå¯¹åº”ç­”æ¡ˆå·²è®°å½•åœ¨å†Œã€‚ Swift Swiftä¸­çš„letå’Œvaræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä½•æ—¶åº”è¯¥ä½¿ç”¨letï¼Ÿ Swiftä¸­çš„å±æ€§ï¼ˆPropertyï¼‰æœ‰å“ªäº›ç±»å‹ï¼Ÿå®ƒä»¬çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ Swiftçš„å¸¸é‡ï¼ˆstaticï¼‰åœ¨ä»€ä¹ˆæ—¶å€™ç¡®å®šï¼Ÿ åœ¨Swiftä¸­ï¼Œswitch case ä¸€ä¸ª NSObject å­ç±»æ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯ä»€ä¹ˆï¼Ÿ è¯·è§£é‡Š Swift ä¸­çš„èŒƒå‹æ“¦é™¤ï¼ˆGeneric Erasureï¼‰æ˜¯ä»€ä¹ˆï¼Œå¹¶æä¾›ä¸€ä¸ªèŒƒå‹æ“¦é™¤çš„ä¾‹å­ã€‚ iOS å¼€å‘ ä½ åœ¨å®é™…å·¥ä½œä¸­ä½¿ç”¨è¿‡UICollectionViewCompositionalLayoutå—ï¼Ÿå¦‚æœä½¿ç”¨è¿‡ï¼Œè¯·è¯¦ç»†æè¿°ä¸€ä¸‹å®ç°çš„åŠŸèƒ½ã€‚ è¯·åˆ—ä¸¾5-10ä¸ªä½ æœ€å¸¸ç”¨çš„ä¸‰æ–¹åº“ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªä½ æœ€å–œæ¬¢çš„è¿›è¡Œä»‹ç»ï¼Œé˜è¿°åŸå› ã€‚ æ¶æ„ç›¸å…³ï¼š ä»€ä¹ˆæ˜¯å•ä¾‹æ¨¡å¼ï¼Ÿåœ¨iOSå¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªå•ä¾‹ï¼Ÿ ä»£ç æ ¼å¼è§„èŒƒ è¯·åˆ—å‡ºä½ è®¤ä¸ºçš„ Swift ä»£ç æ ¼å¼è§„èŒƒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºç¼©è¿›ã€ç©ºæ ¼ã€å‘½åç­‰æ–¹é¢ã€‚ åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ å¦‚ä½•ç¡®ä¿ä»£ç æ ¼å¼çš„ä¸€è‡´æ€§ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚ è¯·è®¾è®¡ä¸€ä¸ªå°æ¨¡å—ï¼Œå°½å¯èƒ½å…¨é¢åœ°å‘æˆ‘å±•ç¤ºä½ è‡ªå·±çš„ç¼–ç é£æ ¼ã€‚ ","link":"https://blog.rakuyo.dev/ios-self-paced-test-questions/"},{"title":"iOSè‡ªç¼–é¢è¯•é¢˜","content":"æœ€è¿‘è¦è´Ÿè´£é¢è¯•ï¼Œäºæ˜¯å„å¤„æœç½—äº†ä¸€äº›é¢è¯•é¢˜ï¼Œç”¨äºå½“é¢é¢è¯•ä½¿ç”¨ï¼ˆéç¬”è¯•é¢˜ï¼‰ï¼Œä¹Ÿå½“ä½œè‡ªå·±çš„ä¸€ä¸ªå¤ä¹ ã€‚åŒæ—¶æä¾›äº†ä¸€ä¸ªæˆ‘è‡ªå·±è§’åº¦çš„è¯„åˆ¤ï¼Œä»…ä¾›å‚è€ƒã€‚ ç¬”è¯•é¢˜éƒ¨åˆ†è¯·å‚è€ƒï¼šiOSè‡ªç¼–ç¬”è¯•é¢˜ ä»¥ä¸‹æ‰€ä»¥ç­”æ¡ˆï¼Œå¦‚æœé¢è¯•æ—¶æœªèƒ½å›ç­”ï¼Œä½œä¸ºè¡¥å……é—®é¢˜å›ç­”æ­£ç¡®åï¼Œç›¸åº”åˆ†å€¼ - 1ã€‚ å›ç­”äº†å…¶ä»–ç­”æ¡ˆï¼Œæ­£ç¡®ä¸”åˆç†çš„æƒ…å†µä¸‹ï¼Œé…Œæƒ…ç»™åˆ†ã€‚ Swift ç›¸å…³ ä¸»è¦è€ƒå¯ŸSwiftè¯­æ³•ç›¸å…³å†…å®¹ åŸºç¡€ ä»€ä¹ˆæ˜¯Swiftæ–¹æ³•é»˜è®¤å€¼ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨å®ƒï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 åœ¨å®šä¹‰å‡½æ•°æ—¶ç»™å‚æ•°èµ‹ä¸€ä¸ªé»˜è®¤å€¼ï¼Œè°ƒç”¨è¯¥å‡½æ•°æ—¶å¯ä»¥ä¸ä¼ è¯¥å‚æ•°å€¼ 3 å‡å°‘å‡½æ•°é‡è½½çš„éœ€è¦ 1 é¿å…åœ¨è°ƒç”¨å‡½æ•°æ—¶å¤šæ¬¡è¾“å…¥ç›¸åŒçš„å€¼ ä»€ä¹ˆæ˜¯Optionalç±»å‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨Optionalç±»å‹ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå€¼å¯èƒ½å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨çš„æƒ…å†µ 1 Optional ç±»å‹çš„ä½œç”¨æ˜¯ä¸ºé¿å…å› ä¸ºæ²¡æœ‰å¤„ç† nil è€Œå¯¼è‡´ç¨‹åºå´©æºƒçš„é—®é¢˜ 1 Optional ç±»å‹å¯ä»¥é€šè¿‡åœ¨ç±»å‹åååŠ ä¸€ä¸ª ? æ¥å®šä¹‰ 2 å¦‚æœä¸€ä¸ª Optional ç±»å‹çš„å˜é‡æœ‰å€¼ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¯é€‰ç»‘å®š ï¼ˆif letï¼‰å°†å…¶å–å‡º 3 åœ¨ä½¿ç”¨ Optional ç±»å‹æ—¶ï¼Œå°½é‡é¿å…ä½¿ç”¨å¼ºåˆ¶è§£åŒ… 3 Optional çš„å®é™…å®ç°æ˜¯ä¸€ä¸ªæšä¸¾ Swiftä¸­çš„structå’Œclassæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨structï¼Ÿ åŒºåˆ«ï¼š å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 class æ”¯æŒç»§æ‰¿ï¼Œè€Œ struct ä¸æ”¯æŒç»§æ‰¿ - 1 class æ”¯æŒç±»å‹è½¬æ¢ï¼Œè€Œ struct ä¸æ”¯æŒç±»å‹è½¬æ¢ è¿™é‡Œçš„ç±»å‹è½¬æ¢æŒ‡çš„æ˜¯å­ç±»å’Œçˆ¶ç±»ä¹‹é—´çš„éšå¼ç±»å‹è½¬æ¢ 1 class æ˜¯å¼•ç”¨ç±»å‹ï¼Œè€Œ struct æ˜¯å€¼ç±»å‹ - ä½¿ç”¨æƒ…å†µï¼š å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å¦‚æœå¯¹è±¡çš„å¤æ‚åº¦è¾ƒé«˜ï¼Œå¹¶éœ€è¦æ”¯æŒç»§æ‰¿å’Œç±»å‹è½¬æ¢ï¼Œåº”è¯¥ä½¿ç”¨ class 1 å¦‚æœå¯¹è±¡æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”éœ€è¦é«˜æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ struct ä»€ä¹ˆæ˜¯ Swift ä¸­çš„è®¿é—®æ§åˆ¶ï¼ˆAccess Controlï¼‰ï¼Ÿå®ƒæœ‰å“ªäº›çº§åˆ«ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1/3 Open: å¯ä»¥è¢«åŒä¸€æ¨¡å—å†…å’Œå¤–éƒ¨æ¨¡å—çš„ä»£ç è®¿é—®ï¼Œå…è®¸è¢«ç»§æ‰¿å’Œé‡å†™ æåˆ°å¤–éƒ¨æ¨¡å—è®¡3åˆ†ï¼Œå¦åˆ™1åˆ† 1/3 Public: å¯ä»¥è¢«åŒä¸€æ¨¡å—å†…å’Œå¤–éƒ¨æ¨¡å—çš„ä»£ç è®¿é—®ï¼Œä½†æ˜¯åœ¨å¤–éƒ¨æ¨¡å—ä¸èƒ½è¢«é‡å†™æˆ–ç»§æ‰¿ï¼Œå†…éƒ¨æ¨¡å—å¯ä»¥ æåˆ°å¤–éƒ¨æ¨¡å—è®¡3åˆ†ï¼Œå¦åˆ™1åˆ† 1/3 Internal: åªèƒ½è¢«åŒä¸€æ¨¡å—å†…çš„ä»£ç è®¿é—®ï¼Œä¸èƒ½è¢«å¤–éƒ¨æ¨¡å—è®¿é—®ï¼ˆé»˜è®¤è®¿é—®çº§åˆ«ï¼‰ æåˆ°æ˜¯é»˜è®¤æƒé™è®¡3åˆ†ï¼Œå¦åˆ™1åˆ† 1 fileprivate: åªèƒ½è¢«åŒä¸€æºæ–‡ä»¶å†…çš„ä»£ç è®¿é—® - 1 private: åªèƒ½åœ¨æ‰€å®šä¹‰çš„ä½œç”¨åŸŸå†…è®¿é—®ï¼ˆæ¯”å¦‚å‡½æ•°ã€æ–¹æ³•ã€ç±»ã€ç»“æ„ä½“ç­‰ï¼‰ï¼Œä¸èƒ½è¢«åŒä¸€æ–‡ä»¶ä¸­çš„å…¶ä»–ä½œç”¨åŸŸè®¿é—®ã€‚ - 2 Xcode ç”Ÿæˆçš„ struct çš„åˆå§‹åŒ–æ–¹æ³•æ˜¯ Internal å±æ€§ï¼Œæœ‰å¤–éƒ¨è®¿é—®éœ€æ±‚çš„è¯è¦æ‰‹åŠ¨å®ç° init æ–¹æ³• - ä»€ä¹ˆæ˜¯ Swiftå±æ€§è§‚å¯Ÿå™¨ï¼ˆProperty Observerï¼‰ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 çŸ¥é“å±æ€§è§‚å¯Ÿå™¨æ˜¯ willSet å’Œ didSet - 1 åªèƒ½åº”ç”¨äºå­˜å‚¨å±æ€§ï¼Œè€Œä¸èƒ½åº”ç”¨äºè®¡ç®—å±æ€§ - 2+1 å¦‚æœå±æ€§æ˜¯åœ¨åˆå§‹åŒ–æœŸé—´ï¼ˆinitå’Œå®šä¹‰æ—¶èµ‹å€¼ï¼‰è®¾ç½®çš„ï¼Œåˆ™ä¸ä¼šè°ƒç”¨ willSet å’Œ didSet è§‚å¯Ÿå™¨ å›ç­” initï¼Œ2åˆ†ï¼Œå›ç­”å®šä¹‰æ—¶ï¼Œ1åˆ†ï¼Œæ€»åˆ†3åˆ† Swiftä¸­ä¸€ä¸ªæ–¹æ³•å¦‚ä½•è¿”å›å¤šä¸ªå€¼ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å¯ä»¥ä½¿ç”¨å…ƒç»„ï¼ˆTupleï¼‰æ¥å®ç°ä¸€ä¸ªæ–¹æ³•è¿”å›å¤šä¸ªå€¼çš„æ•ˆæœ 0 è‡ªå®šä¹‰ç±»å‹ã€æ•°ç»„ã€å­—å…¸ç­‰ ä»€ä¹ˆæ˜¯ Swift ä¸­çš„ Extensionï¼ˆæ‰©å±•ï¼‰ï¼Ÿå¦‚ä½•ä½¿ç”¨ Extensionï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å…è®¸å¼€å‘è€…å‘å·²æœ‰çš„ç±»å‹æ·»åŠ æ–°çš„æ–¹æ³•ã€è®¡ç®—å±æ€§ç­‰ï¼Œè€Œæ— éœ€ç»§æ‰¿å­ç±»æˆ–ä½¿ç”¨ Objective-C runtime 1 ä¸èƒ½æ·»åŠ å­˜å‚¨å±æ€§æˆ–å±æ€§è§‚å¯Ÿå™¨ 1 æ‰©å±•ä¸­çš„æ–¹æ³•ä¸èƒ½å’Œå·²æœ‰æ–¹æ³•é‡å 2 ä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ï¼Œæ˜“äºç»´æŠ¤ 2 ä¹Ÿå¯ä»¥å¯¹ç¬¬ä¸‰æ–¹ç±»è¿›è¡Œæ‰©å±•ï¼Œè€Œæ— éœ€æ”¹åŠ¨åŸä»£ç ï¼Œæ›´åŠ æ–¹ä¾¿åœ°æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ Swiftä¸­çš„åè®®ï¼ˆprotocolï¼‰æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¦‚æœå›ç­”ä¸­åŒ…å«äº†åè®®ä¸­çš„èŒƒå‹ç­‰å†…å®¹ï¼Œå‚è€ƒ ä»€ä¹ˆæ˜¯èŒƒå‹ ä¸€é¢˜ä¸­çš„åˆ†å€¼ã€‚ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 åè®®å®šä¹‰äº†ä¸€ç»„æ–¹æ³•ã€å±æ€§ - 1 å¯ä»¥è¢«ç±»ã€ç»“æ„ä½“å’Œæšä¸¾ç±»å‹å®ç°ï¼Œç„¶åå®ç°æ–¹å°±å¯ä»¥ä½¿ç”¨åè®®ä¸­æä¾›çš„å†…å®¹ - 3 æé«˜ä»£ç çš„æ¨¡å—åŒ–ç¨‹åº¦ã€å¯é‡ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå‡å°‘ä»£ç çš„è€¦åˆæ€§ - 1/2 å¯ä»¥æ‰©å±•åè®®ï¼Œä¸ºåè®®æ·»åŠ é»˜è®¤å®ç° å¦‚æœé¢è¯•è€…æ²¡æœ‰æï¼Œå¯ä»¥è¿›è¡Œæé—®â€œSwift åè®®å¦‚ä½•åšé»˜è®¤å®ç°ï¼Ÿâ€ 5 ä¹ æƒ¯ä½¿ç”¨æ‰©å±•éµå¾ªåè®®ï¼Œè€Œä¸æ˜¯åœ¨å£°æ˜ç±»å‹æ—¶ - -5 ä¹ æƒ¯åœ¨å£°æ˜ç±»å‹æ—¶éµå¾ªåè®® - 1/3/10 æåˆ°äº†é¢å‘åè®®ç¼–ç¨‹ ä»…ä»…æåˆ°ï¼Œè®¡1åˆ†ï¼›æœ‰å¯¹åº”æè¿°ã€è§£é‡Šï¼Œè®¡3åˆ†ï¼›æè¿°è¯¦ç»†ï¼Œå¹¶é…åˆç¤ºä¾‹ï¼Œè®¡10åˆ† ä»€ä¹ˆæ˜¯æ³›å‹ï¼ˆGenericï¼‰ç±»å‹ï¼Ÿå®ƒä»¬åœ¨Swiftä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ ç¬”è¯•é¢˜ä¸­åŒ…å«èŒƒå‹æ“¦å‡ºï¼Œæ‰€ä»¥æœ¬é¢˜ä¸»è¦è€ƒå¯Ÿé¢è¯•è€…æœ‰æ²¡æœ‰ â€œç”¨èŒƒå‹æé«˜ä»£ç å¯è¯»æ€§ã€ç»´æŠ¤æ€§â€ çš„æ„è¯†ã€‚ åœ¨è¿™é‡Œä¸å¿…å›ç­”èŒƒå‹æ“¦å‡ºã€‚å›ç­”èŒƒå‹æ“¦å‡ºä¸é¢å¤–è®¡åˆ†ã€‚ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 å¯ä»¥ç”¨äºå®šä¹‰å‡½æ•°ã€ç±»ã€ç»“æ„ä½“ã€æšä¸¾ç­‰å¤šç§ç±»å‹çš„é€šç”¨ç±»å‹æœºåˆ¶ 2 æ³›å‹ç±»å‹å¯ä»¥ç”¨äºæ¶ˆé™¤ä»£ç é‡å¤ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ 1 å®šä¹‰åè®®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³è”ç±»å‹æ¥å®ç°æ›´åŠ çµæ´»çš„æ•°æ®å¤„ç† ä»€ä¹ˆæ˜¯Swiftå­—é¢é‡åè®®ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 ExpressibleByNilLiteral 1 ExpressibleByIntegerLiteralï¼šå…è®¸ç±»å‹ä»æ•´æ•°å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByFloatLiteralï¼šå…è®¸ç±»å‹ä»æµ®ç‚¹æ•°å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByBooleanLiteralï¼šå…è®¸ç±»å‹ä»å¸ƒå°”å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByStringLiteralï¼šå…è®¸ç±»å‹ä»å­—ç¬¦ä¸²å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByArrayLiteralï¼šå…è®¸ç±»å‹ä»æ•°ç»„å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ 1 ExpressibleByDictionaryLiteralï¼šå…è®¸ç±»å‹ä»å­—å…¸å­—é¢é‡åˆ›å»ºå®ä¾‹ã€‚ åªè¦æåˆ°æœ‰è¿™ä¹ˆå‡ ä¸ªåè®®ï¼ˆä¸ç”¨è¯´å‡ºå…·ä½“çš„åå­—ï¼‰ï¼Œå¯ä»¥é€šè¿‡æ•°å­—ã€å­—ç¬¦ä¸²ã€Boolã€æ•°ç»„ã€å­—å…¸å­—é¢é‡æ¥åˆå§‹åŒ–å¯¹åº”çš„ç±»å‹å³å¯ã€‚ ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½ï¼ˆæ‡’åŠ è½½ï¼ŒLazy Loadingï¼‰ï¼Ÿåœ¨Swiftä¸­ä½ ä¸€èˆ¬ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 åœ¨Swiftä¸­ï¼Œå»¶è¿ŸåŠ è½½å¯ä»¥é€šè¿‡ä½¿ç”¨ lazy å…³é”®å­—æ¥å®ç° - 1 lazy å…³é”®å­—å¯ä»¥ç”¨äºå±æ€§ - 1 åœ¨ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å˜é‡æˆ–å±æ€§æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œç›¸åº”çš„ä»£ç è¿›è¡Œåˆå§‹åŒ– - 5 å‡ ä¹æ— è„‘ä½¿ç”¨æ‡’åŠ è½½æ¥å®šä¹‰ä»»ä½•çš„å±æ€§ - Swiftä¸­çš„é«˜é˜¶å‡½æ•°ï¼ˆHigher Order Functionï¼‰æœ‰å“ªäº›ï¼Ÿè¯·åˆ†åˆ«è¯´æ˜å®ƒä»¬çš„ä½œç”¨ã€‚ ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå³å¯ï¼Œå…¶ä½™çš„ä¾‹å¦‚ containsã€allSatisfy ç­‰è¯´äº†ä¹Ÿè®¡1åˆ†ã€‚ å¦‚æœåªè¯´å‡ºäº†å‡½æ•°åï¼Œæ²¡æœ‰è¯´æ˜ä½œç”¨ï¼Œä¾ç„¶å¾—åˆ†ã€‚æˆ–è€…èƒ½è¯´å‡ºæ¥åŠŸèƒ½ï¼Œå…·ä½“å‡½æ•°åæ‹¼ä¸å…¨ä¹Ÿå¯ã€‚ å¦‚æœä¸‹é¢è¿™äº›æ²¡æœ‰è¯´å…¨ï¼Œé¢è¯•å®˜å¯æç¤º â€œè¿˜æœ‰æ²¡æœ‰äº†ï¼Ÿâ€ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 mapï¼šå°†ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°æ˜ å°„ä¸ºå¦ä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„é›†åˆ - 1 filterï¼šè¿‡æ»¤ä¸€ä¸ªé›†åˆä¸­ç¬¦åˆç‰¹å®šæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„é›†åˆ - 1 reduceï¼šé€šè¿‡å¯¹ä¸€ä¸ªé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œç´¯åŠ æˆ–ç´¯ç§¯æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæœ€ç»ˆçš„ç»“æœ - 1 flatMapï¼šå°†ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ é€šè¿‡ä¸€ä¸ªå‡½æ•°æ˜ å°„ä¸ºå¦ä¸€ä¸ªé›†åˆï¼Œç„¶åå°†æ‰€æœ‰é›†åˆä¸­çš„å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„é›†åˆ - 1 compactMapï¼šå¯¹ä¸€ä¸ªåºåˆ—è¿›è¡Œå˜æ¢æ“ä½œï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åºåˆ—ï¼Œè¯¥åºåˆ—å°†æ‰€æœ‰çš„ nil å…ƒç´ å»é™¤ - 1 sortedï¼šå¯¹ä¸€ä¸ªé›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ’åºåçš„é›†åˆ - 1 forEachï¼šå¯¹ä¸€ä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ®µç‰¹å®šçš„ä»£ç  - flatMap å’Œ compactMap è¿™ä¸¤ä¸ªä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 flatMap ç”¨äºé«˜ç»´æ•°ç»„çš„é™ç»´ï¼Œä¾‹å¦‚äºŒç»´æ•°ç»„æ‹å¹³ä¸ºä¸€ç»´æ•°ç»„ - 1 compactMap ç”¨äºè¿‡æ»¤æ•°ç»„ä¸­çš„å¯é€‰å€¼ï¼Œå»æ‰æ‰€æœ‰è¿”å› nil çš„å…ƒç´  - 3 Swift 4.2 ä¸­å°†è¿™ä¸¤ä¸ªå‡½æ•°æ‹†å¼€ï¼Œä¸å¯æ··ç”¨ æåˆ°ä¸å¯æ··ç”¨å³å¯ è¿›é˜¶ åœ¨Swiftä¸­å¦‚ä½•å®ç°ä¸€æ®µä»£ç åœ¨æ•´ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå†…åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 0 dispatch_once ä¸å¾—åˆ†ï¼ŒSwift 3 åŠä»¥ä¸Šç‰ˆæœ¬å·²åºŸå¼ƒ 0 å•ä¾‹ ä¸å¾—åˆ†ï¼Œé¢˜ç›®è¦æ±‚çš„æ˜¯ â€œä¸€æ®µä»£ç â€ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ 3 (lazy var)/static + Void ç±»å‹çš„å±æ€§ï¼Œå®šä¹‰æ—¶ä½¿ç”¨ {}() åŒ…æ‹¬éœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚å€ŸåŠ©äº†æ‡’åŠ è½½çš„ç‰¹æ€§ Swiftä¸­çš„ç±»å‹æ¨æ–­ï¼ˆType Inferenceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿè¯·è¯´æ˜å®ƒçš„ä½œç”¨ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 2 ç¼–è¯‘å™¨èƒ½å¤Ÿæ¨æ–­å‡ºå˜é‡æˆ–å¸¸é‡çš„ç±»å‹è€Œä¸éœ€è¦æ˜¾å¼å£°æ˜å…¶ç±»å‹ - 2 ä½¿ä»£ç æ›´åŠ ç®€æ´ï¼Œå‡å°‘äº†ç±»å‹å£°æ˜çš„å†—ä½™ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†å› ç±»å‹å£°æ˜é”™è¯¯è€Œå¼•èµ·çš„ç¼–è¯‘é”™è¯¯çš„å¯èƒ½æ€§ - -10 ä¸å»ºè®®ä½¿ç”¨ å¦‚æœé¢è¯•è€…è¯´å»ºè®®æ˜¾å¼å£°æ˜ç±»å‹ï¼ˆé™¤éæ˜¯ä¸ºäº†è§£å†³Xcodeä»£ç æç¤ºçš„bugï¼‰ï¼Œå¦åˆ™æ‰£10åˆ† Swiftä¸­çš„finalå…³é”®å­—æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1+2+2 final å…³é”®å­—å¯ä»¥ä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ æåˆ°ç±»è®¡1åˆ†ï¼›æåˆ°æ–¹æ³•ã€å˜é‡æ¯ä¸ª2åˆ†ï¼Œæ€»åˆ†5åˆ† 1 final ä¿®é¥°åä¸å¯é›†æˆã€ä¸å¯é‡å†™ - 3 private çš„ç±»å‹ï¼Œå…¶å†…çš„å±æ€§å’Œæ–¹æ³•ä¼šåœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨æ·»åŠ  final - Swiftä¸­çš„Stringç±»å‹å’ŒObjCä¸­çš„NSStringç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 åº•å±‚å®ç°ä¸åŒï¼ŒSwift çš„ String ç±»å‹æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼Œè€ŒObjCçš„ NSString ç±»å‹æ˜¯ä¸€ä¸ªç±» 1 Swiftçš„ String ç±»å‹å¯ä»¥æ— ç¼åœ°ä¸ObjCä¸­çš„ NSString ç±»å‹äº’ç›¸è½¬æ¢ 2 Swiftä¸­çš„å­—ç¬¦ä¸²æ˜¯Unicodeå…¼å®¹çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Unicodeå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å·ï¼Œè€ŒObjCä¸­çš„å­—ç¬¦ä¸²æ˜¯åŸºäºASCIIç¼–ç çš„ï¼Œæ— æ³•ç›´æ¥å¤„ç†Unicodeå­—ç¬¦å’Œè¡¨æƒ…ç¬¦å· Swiftä¸­çš„æšä¸¾ç›¸æ¯”è¾ƒObjCä¸­çš„æšä¸¾æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 æ¯ä¸ªæšä¸¾æˆå‘˜å¯ä»¥æœ‰è‡ªå·±çš„å…³è”å€¼ï¼Œè¿™ä½¿å¾—æšä¸¾æ›´åŠ çµæ´»ã€‚è€ŒObjCä¸­çš„æšä¸¾åªèƒ½åŒ…å«æ•´æ•° 3 æšä¸¾æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œå®ƒå’Œç±»ã€ç»“æ„ä½“ç­‰ç±»å‹ä¸€æ ·ï¼Œå¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œç”šè‡³éµå¾ªåè®®ã€‚ Swiftä¸­çš„å»¶è¿Ÿï¼ˆDeferï¼‰è¯­å¥æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 0/2/3 Deferè¯­å¥å¯ä»¥ç”¨æ¥åœ¨å‡½æ•°/ä½œç”¨åŸŸæ‰§è¡Œå®Œæ¯•ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œ å›ç­” â€œå‡½æ•°â€ 0åˆ†ï¼Œâ€œä½œç”¨åŸŸâ€ 2åˆ†ï¼Œèƒ½ç»™å‡ºä½œç”¨åŸŸçš„ä¾‹å­ï¼Œä¾‹å¦‚ if ä¸­ä½¿ç”¨çš„æƒ…å†µï¼Œ3åˆ†ã€‚å¦‚æœé¢è¯•è€…æ²¡æåˆ°ä½œç”¨åŸŸé—®é¢˜ï¼Œåˆ™å¯ä»¥å½“ä½œè¿›é˜¶é—®é¢˜æŠ›å‡º 1 Deferè¯­å¥å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œ - 1 æ— è®ºå‡½æ•°æ˜¯æ­£å¸¸è¿”å›è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œ - 1 è™½ç„¶å½¢å¼ä¸Šåƒæ˜¯é—­åŒ…ï¼Œä½†æ›´åƒæ˜¯è¯­æ³•ç³–ï¼Œæ‰€ä»¥ä¸ä¼šæ•è·å˜é‡ - 2 å½“å‡½æ•°å†…æœ‰å¤šä¸ª defer è¯­å¥æ—¶ï¼Œå°†æŒ‰ç…§å€’åºçš„é¡ºåºæ‰§è¡Œï¼Œå³æœ€åä¸€ä¸ª defer å…ˆæ‰§è¡Œ å¦‚æœé¢è¯•è€…æ²¡å›ç­”ï¼Œåˆ™å¯ä»¥å½“ä½œè¿›é˜¶é—®é¢˜æŠ›å‡º ä»€ä¹ˆæ˜¯Swiftæ–¹æ³•æ´¾å‘ï¼Ÿæœ‰å“ªå‡ ç§ï¼Ÿ æ–¹æ³•è°ƒåº¦å’Œæ–¹æ³•æ´¾å‘æ˜¯ä¸€å›äº‹ï¼Œä¸åŒçš„ç¿»è¯‘ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 å®è§‚ä¸Šåˆ†ä¸ºé™æ€ï¼ˆç›´æ¥ï¼‰æ´¾å‘å’ŒåŠ¨æ€æ´¾å‘ä¸¤ç§ - 3 å…¶ä¸­åŠ¨æ€æ´¾å‘åˆåŒ…å«ä¸¤ç§ï¼šè¡¨æ´¾å‘/å‡½æ•°è¡¨æ´¾å‘å’Œæ¶ˆæ¯æ´¾å‘ - 5/6 é™æ€æ´¾å‘ï¼šç¼–è¯‘æ—¶æ‰¾åˆ°æŒ‡ä»¤æ‰€åœ¨çš„ä½ç½®ã€‚æ‰€ä»¥æ‰§è¡Œé€Ÿåº¦å¿«ï¼Œè¿˜å…è®¸ç¼–è¯‘æœŸåšå„ç§ä¼˜åŒ–ï¼Œä¾‹å¦‚å†…è” æåˆ°å†…è”ï¼Œé¢å¤–åŠ 1åˆ†ï¼Œå…±6åˆ† 5/6 è¡¨æ´¾å‘ï¼šè¿è¡Œæ—¶å†³å®šå®ç°æ–¹å¼ï¼Œç†è®ºä¸Šé€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œç¼–è¯‘æœŸå†³å®šå‡½æ•°è¡¨ æåˆ°ç¼–è¯‘æœŸå†³å®šå¯’æš‘è¡¨ï¼Œé¢å¤–åŠ 1åˆ†ï¼Œå…±6åˆ† 5 æ¶ˆæ¯æ´¾å‘ï¼šObjective-C çš„é€»è¾‘ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹æ¶ˆæ¯æ¥æ”¶å¯¹è±¡ - 5 ä¼šé€šè¿‡çœ‹ SIL ç¡®å®šæ´¾å‘æ–¹å¼ - è¯·è¯´æ˜Swiftä¸­Arrayç±»å‹çš„åº•å±‚å®ç°æ–¹å¼ æ€»åˆ†å€¼10åˆ† Array ä½¿ç”¨äº†ä¸€ä¸ªåä¸ºâ€œç¼“å†²åŒºâ€ï¼ˆbufferï¼‰çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨å…ƒç´ ã€‚ ç¼“å†²åŒºç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š æŒ‡å‘å…ƒç´ å­˜å‚¨ä½ç½®çš„æŒ‡é’ˆ ç¼“å†²åŒºçš„å®¹é‡å¤§å° ç¼“å†²åŒºçš„å…ƒç´ ä¸ªæ•° Swiftçš„switchè¯­æ³•å’ŒObjCçš„switchè¯­æ³•ï¼Œåœ¨åº•å±‚å®ç°æ–¹å¼ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ€»åˆ†å€¼10åˆ† ObjC çš„ switch è¿˜æ˜¯æŸç§æ„ä¹‰ä¸Šçš„ goto è¯­æ³•ï¼Œå‘½ä¸­çš„æ—¶å€™ä¼šè·³åˆ°å¯¹åº”çš„ä»£ç çš„åœ°å€ï¼Œè¿™æ®µä»£ç æ˜¯è¿ç»­çš„ï¼Œéœ€è¦ break æ¥å†³å®šæ‰§è¡Œåˆ°å“ªé‡Œã€‚è¿™ç§å®ç°æ–¹å¼ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿ä»æ—©æœŸ C è¯­è¨€ä¸­ç»§æ‰¿è€Œæ¥ã€‚ è€Œ swift çš„ switch ä¼šè¢«ç¼–è¯‘æˆç±»ä¼¼ if else çš„è¯­æ³•ï¼Œä½œç”¨åŸŸæ›´æ˜ç¡®ã€‚ SILæ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆå°†Swiftä»£ç è½¬æ¢ä¸ºSILä»£ç ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ å¤‡æ³¨ 1 SILæ˜¯Swiftä¸­é—´è¯­è¨€ï¼Œæ˜¯æºä»£ç å’Œæœºå™¨ä»£ç ä¹‹é—´çš„ä¸€ç§ä¸­é—´ä»£ç  - 1/2 ç¼–è¯‘å™¨ä¼šå°†Swiftä»£ç ç¼–è¯‘æˆSILï¼Œç„¶åå¯¹SILè¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢ï¼Œæœ€åå°†å…¶ç¼–è¯‘æˆæœºå™¨ä»£ç  æåˆ°ç¼–è¯‘å™¨å¯¹ SIL è¿›è¡Œä¼˜åŒ–ï¼Œè®¡2åˆ†ï¼Œå¦åˆ™è®¡1åˆ† 3 ä½¿ç”¨ swiftc -emit-sil + &lt;file_name.swift&gt; å°† swift æ–‡ä»¶è½¬æ¢ä¸º SIL ä»£ç  - è¯·ç®€è¿° Swift extension çš„å®ç°åŸç† æ€»åˆ†10åˆ† åœ¨ Swift å†…éƒ¨ï¼Œæ¯ä¸ªç±»æˆ–ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªåä¸º vtableï¼ˆè™šå‡½æ•°è¡¨ï¼‰çš„è¡¨æ ¼ï¼Œå…¶ä¸­è®°å½•äº†ç±»æˆ–ç»“æ„ä½“çš„æ–¹æ³•çš„åœ°å€ã€‚å½“ Swift è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå®ƒä¼šå…ˆæ£€æŸ¥ç±»æˆ–ç»“æ„ä½“çš„ç±»å‹ï¼Œç„¶åæŸ¥æ‰¾è¯¥ç±»å‹çš„ vtable è¡¨æ ¼ï¼Œä»¥è·å–è¯¥æ–¹æ³•çš„åœ°å€å¹¶è°ƒç”¨å®ƒã€‚ å½“æˆ‘ä»¬åœ¨ Extension ä¸­å®šä¹‰ä¸€ä¸ªæ–°æ–¹æ³•æ—¶ï¼ŒSwift ç¼–è¯‘å™¨ä¼šå°†å…¶æ·»åŠ åˆ° vtable è¡¨æ ¼ä¸­ï¼Œå¹¶æ ¹æ®éœ€è¦é‡æ–°ç”Ÿæˆ vtable è¡¨æ ¼ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æ–¹æ³•éƒ½åœ¨æ­£ç¡®çš„ä½ç½®ã€‚è¿™å°±æ˜¯ Swift Extension å®ç°çš„åº•å±‚åŸç†ã€‚ iOS å¼€å‘ç›¸å…³ ä¸»è¦è€ƒå¯Ÿ iOS å¼€å‘ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œå’Œå…·ä½“å¼€å‘è¯­è¨€æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ã€‚ åŸºç¡€ è¯·ç®€è¿°iOSå¼€å‘ä¸­ï¼ŒAPNSçš„æ¨é€æœºåˆ¶ æ€»åˆ†5åˆ† APNSçš„æ¨é€æœºåˆ¶åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åº”ç”¨ç¨‹åºåœ¨è®¾å¤‡ä¸Šæ³¨å†Œè¿œç¨‹é€šçŸ¥ã€‚æ³¨å†ŒæˆåŠŸåï¼Œè®¾å¤‡ä¼šäº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„ä»¤ç‰Œï¼ˆdevice tokenï¼‰ï¼Œç”¨äºæ ‡è¯†è¯¥è®¾å¤‡ã€‚ åº”ç”¨ç¨‹åºå°†ä»¤ç‰Œå‘é€ç»™åå°æœåŠ¡å™¨ï¼Œåå°æœåŠ¡å™¨å°†ä»¤ç‰Œä¸è®¾å¤‡ç»‘å®šèµ·æ¥ã€‚ å½“éœ€è¦å‘è®¾å¤‡å‘é€é€šçŸ¥æ—¶ï¼Œåå°æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¨é€é€šçŸ¥è¯·æ±‚åˆ°APNSæœåŠ¡å™¨ã€‚ APNSæœåŠ¡å™¨å°†æ¨é€é€šçŸ¥å‘é€åˆ°æŒ‡å®šçš„è®¾å¤‡ä¸Šã€‚ è®¾å¤‡æ¥æ”¶åˆ°æ¨é€é€šçŸ¥åï¼Œæ ¹æ®æ¨é€é€šçŸ¥çš„å†…å®¹æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚æ‰“å¼€åº”ç”¨ç¨‹åºã€æ˜¾ç¤ºæé†’ç­‰ã€‚ å¸¸è§çš„è§¦å‘ç¦»å±æ¸²æŸ“çš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ æ€»åˆ†10åˆ† è¿›é˜¶ ç¦»å±æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆä¼šè§¦å‘ç¦»å±æ¸²æŸ“ æ€»åˆ†15åˆ† ä»€ä¹ˆæ˜¯RunLoopï¼ŸRunLoopçš„è¿è¡Œæ¨¡å¼æœ‰å“ªå‡ ç§ï¼Ÿ æ€»åˆ†10åˆ† RunLoopæ˜¯iOSä¸­çš„ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·äº‹ä»¶ï¼Œå¦‚è§¦æ‘¸äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€ç½‘ç»œè¯·æ±‚äº‹ä»¶ç­‰ï¼ŒåŒæ—¶è¿˜è¦å¤„ç†UIæ›´æ–°ã€çº¿ç¨‹é€šä¿¡ç­‰ä»»åŠ¡ã€‚ RunLoopä¼šå°†äº‹ä»¶æºåˆ†å‘åˆ°ç›¸åº”çš„å¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œå¦‚æœRunLoopæ²¡æœ‰äº‹ä»¶éœ€è¦å¤„ç†ï¼Œé‚£ä¹ˆå®ƒä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°çš„äº‹ä»¶åˆ°æ¥ã€‚ å¸¸è§çš„RunLoopè¿è¡Œæ¨¡å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š DefaultRunLoopModeï¼šé»˜è®¤æ¨¡å¼ï¼Œå¤„ç†UIäº‹ä»¶ã€å®šæ—¶å™¨ã€ç½‘ç»œäº‹ä»¶ç­‰ã€‚ UITrackingRunLoopModeï¼šå¤„ç†UIScrollViewæ»‘åŠ¨è¿‡ç¨‹ä¸­çš„äº‹ä»¶ï¼Œä¼˜å…ˆçº§é«˜äºDefaultRunLoopModeã€‚ CommonModesï¼šæ˜¯ä¸€ä¸ªé›†åˆæ¨¡å¼ï¼Œå¯ä»¥æ·»åŠ å¤šä¸ªæ¨¡å¼ï¼ŒåŒ…æ‹¬DefaultRunLoopModeå’ŒUITrackingRunLoopModeç­‰ï¼Œç”¨äºå¤„ç†éœ€è¦åŒæ—¶å“åº”å¤šä¸ªæ¨¡å¼ä¸‹çš„äº‹ä»¶ã€‚ åœ¨è¿è¡ŒRunLoopæ—¶ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªè¿è¡Œæ¨¡å¼ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä¼šä½¿ç”¨DefaultRunLoopModeã€‚ iOSå¼€å‘ä¸­çš„å“åº”é“¾æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ æ€»åˆ†15åˆ† åœ¨iOSåº”ç”¨ä¸­ï¼Œå°†ç”¨æˆ·çš„è§¦æ‘¸äº‹ä»¶ï¼ˆtouch eventï¼‰ä¼ é€’åˆ°æ­£ç¡®çš„è§†å›¾ï¼ˆviewï¼‰æˆ–è€…æ§åˆ¶å™¨ï¼ˆcontrollerï¼‰çš„è¿‡ç¨‹å°±æ˜¯å“åº”é“¾ã€‚ å½“ç”¨æˆ·åœ¨å±å¹•ä¸Šè¿›è¡Œè§¦æ‘¸æ—¶ï¼Œè§¦æ‘¸äº‹ä»¶ä¼šè¢«UIWindowæ•è·ï¼Œå¹¶ä»UIWindowå¼€å§‹å‘ä¸‹ä¼ é€’ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„å“åº”è€…å¤„ç†äº‹ä»¶ä¸ºæ­¢ã€‚ å½“ç”¨æˆ·è§¦æ‘¸åˆ°ç•Œé¢ä¸Šçš„æŒ‰é’®æ—¶ï¼ŒiOSç³»ç»Ÿä¼šå°†æ­¤äº‹ä»¶å°è£…æˆä¸€ä¸ª UIEvent å¯¹è±¡ï¼Œå¹¶é€šè¿‡ UIApplication å¯¹è±¡å°†è¯¥äº‹ä»¶å‘é€ç»™å½“å‰ UIWindow å¯¹è±¡ã€‚æ¥ç€ï¼Œè¯¥ UIWindow å¯¹è±¡ä¼šå°†è¯¥äº‹ä»¶å‘é€ç»™æœ€å‰ç«¯çš„ UIResponder å¯¹è±¡ï¼Œå³å½“å‰å±•ç¤ºåœ¨å±å¹•ä¸Šçš„ UIViewController çš„ view å±æ€§å¯¹åº”çš„ UIView å¯¹è±¡ã€‚è¿™ä¸€è¿‡ç¨‹å³ä¸ºå“åº”é“¾çš„å¼€å§‹ã€‚ æ¥ç€ï¼Œè¯¥ UIView å¯¹è±¡ä¼šé€šè¿‡ hitTest:withEvent: æ–¹æ³•åˆ¤æ–­å½“å‰è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨è¯¥ UIView å¯¹è±¡å†…ã€‚å¦‚æœåœ¨ï¼Œåˆ™è¯¥ UIView å¯¹è±¡ä¼šå°†è¯¥äº‹ä»¶ä¼ é€’ç»™è‡ªå·±çš„ touchesBegan:withEvent: æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚å¦‚æœä¸åœ¨ï¼Œåˆ™è¯¥ UIView å¯¹è±¡ä¼šå°†è¯¥äº‹ä»¶ä¼ é€’ç»™å…¶å­è§†å›¾è¿›è¡Œå¤„ç†ã€‚è¿™ä¸€è¿‡ç¨‹å°±æ˜¯å“åº”é“¾çš„ä¼ é€’è¿‡ç¨‹ã€‚ å½“å­è§†å›¾æ¥æ”¶åˆ°äº‹ä»¶åï¼Œä¼šæŒ‰ç…§ç›¸åŒçš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚å¦‚æœè¯¥å­è§†å›¾çš„ userInteractionEnabled å±æ€§ä¸º NOï¼Œåˆ™è¯¥è§†å›¾å°†ä¸ä¼šå“åº”è¯¥äº‹ä»¶ï¼Œå¹¶å°†è¯¥äº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚å¦‚æœå­è§†å›¾çš„ userInteractionEnabled å±æ€§ä¸º YESï¼Œåˆ™è¯¥è§†å›¾ä¼šå…ˆè¿›è¡Œ hitTest:withEvent: æ–¹æ³•çš„åˆ¤æ–­ï¼Œå¦‚æœè§¦æ‘¸ç‚¹åœ¨è¯¥è§†å›¾å†…ï¼Œåˆ™è¯¥è§†å›¾å°†è¯¥äº‹ä»¶ä¼ é€’ç»™è‡ªå·±çš„ touchesBegan:withEvent: æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™å°†è¯¥äº‹ä»¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå“åº”è€…ã€‚ æœ€ç»ˆï¼Œå¦‚æœæ‰€æœ‰çš„å­è§†å›¾éƒ½æ²¡æœ‰å¤„ç†è¯¥äº‹ä»¶ï¼Œåˆ™è¯¥äº‹ä»¶ä¼šä¼ é€’ç»™è¯¥ UIView å¯¹è±¡çš„çˆ¶è§†å›¾è¿›è¡Œå¤„ç†ï¼Œä¸€ç›´ä¼ é€’åˆ° UIWindow å¯¹è±¡å’Œ UIApplication å¯¹è±¡ã€‚å¦‚æœè¯¥äº‹ä»¶éƒ½æ²¡æœ‰è¢«å¤„ç†ï¼Œåˆ™è¯¥äº‹ä»¶å°†è¢«ä¸¢å¼ƒã€‚ æ¶æ„ç›¸å…³ ä¸»è¦è€ƒå¯Ÿæ¶æ„ã€è®¾è®¡èƒ½åŠ› åŸºç¡€ ä»€ä¹ˆæ˜¯MVCæ¶æ„ï¼Ÿå®ƒçš„ç»„æˆéƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿåœ¨iOSå¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°MVCæ¶æ„ï¼Ÿ æ€»åˆ†10åˆ† ä»€ä¹ˆæ˜¯MVVMæ¶æ„ï¼Ÿå®ƒçš„ç»„æˆéƒ¨åˆ†æ˜¯ä»€ä¹ˆï¼Ÿåœ¨iOSå¼€å‘ä¸­ï¼Œå¦‚ä½•å®ç°MVVMæ¶æ„ï¼Ÿ æ€»åˆ†15åˆ† ä»€ä¹ˆæ˜¯è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ¨¡å¼ï¼Ÿåœ¨Swiftä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 1 è£…é¥°å™¨æ¨¡å¼å…è®¸å¼€å‘è€…åœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åœ°æ·»åŠ è¡Œä¸ºã€‚ 3 åœ¨ Swift ä¸­ï¼Œè£…é¥°å™¨æ¨¡å¼å¯ä»¥é€šè¿‡ä½¿ç”¨åè®®å’Œæ‰©å±•æ¥å®ç°ã€‚ 5 å…·ä½“æ¥è¯´ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåè®®æ¥è¡¨ç¤ºè¢«è£…é¥°è€…çš„åŸºæœ¬è¡Œä¸ºï¼Œç„¶ååˆ›å»ºä¸€ä¸ªè£…é¥°å™¨åè®®ï¼Œè¯¥åè®®ç»§æ‰¿è‡ªè¢«è£…é¥°è€…åè®®ï¼Œå¹¶æ·»åŠ äº†é¢å¤–çš„è¡Œä¸ºã€‚æœ€åï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªç±»æ¥å®ç°è£…é¥°å™¨åè®®ï¼Œè¯¥ç±»é€šè¿‡å­˜å‚¨è¢«è£…é¥°è€…å¯¹è±¡çš„å¼•ç”¨æ¥å®ç°å¯¹è¢«è£…é¥°è€…å¯¹è±¡çš„åŒ…è£…ã€‚ è¿›é˜¶ ä»€ä¹ˆæ˜¯å°¾é€’å½’ä¼˜åŒ–ï¼ˆTail-Call Optimizationï¼‰ï¼Ÿåœ¨Swiftä¸­å¦‚ä½•å®ç°å°¾é€’å½’ä¼˜åŒ–ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 å°¾é€’å½’ä¼˜åŒ–æ˜¯ä¸€ç§ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒå¯ä»¥é¿å…åœ¨é€’å½’ç®—æ³•ä¸­å‡ºç°æ ˆæº¢å‡ºçš„é—®é¢˜ 3 åœ¨é€’å½’å‡½æ•°çš„æœ€åä¸€ä¸ªæ“ä½œæ˜¯è°ƒç”¨è‡ªèº«ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–æ“ä½œæ—¶ï¼Œå°¾é€’å½’ä¼˜åŒ–å¯ä»¥å°†é€’å½’è½¬æ¢ä¸ºå¾ªç¯ï¼Œé¿å…äº†æ ˆçš„å¢é•¿ ä»€ä¹ˆæ˜¯å‡½æ•°æŸ¯é‡ŒåŒ–ï¼ˆFunction Curryingï¼‰ï¼Ÿåœ¨Swiftä¸­å¦‚ä½•å®ç°å‡½æ•°æŸ¯é‡ŒåŒ–ï¼Ÿ å¾—åˆ† åˆ†å€¼ ç­”æ¡ˆ 2 å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯ä¸€ç§å°†å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢ä¸ºä¸€ç³»åˆ—åªæœ‰å•ä¸ªå‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ 3 åœ¨swiftä¸­ï¼Œå¯ä»¥é€šè¿‡å°†å‡½æ•°è¿”å›å€¼å£°æ˜ä¸ºé—­åŒ…ç±»å‹ï¼Œå°†åŸæœ¬éœ€è¦çš„å‚æ•°æ”¾åˆ°è¿”å›å€¼çš„é—­åŒ…ä¸­ï¼Œæ¥å®ç°å‡½æ•°æŸ¯é‡ŒåŒ– è®¾è®¡ åœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ æ˜¯å¦‚ä½•åˆ’åˆ†æ¨¡å—ï¼ˆModuleï¼‰å’Œå±‚çº§ï¼ˆLayerï¼‰çš„ï¼Ÿè¯·ä¸¾ä¾‹è¯´æ˜ã€‚ æ€»åˆ†10åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ ä¸ç”¨ target-action çš„æ–¹å¼å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·¯ç”±ç»„ä»¶ï¼Ÿ æ€»åˆ†20åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ å½“ä½ ä»ObjCè½¬åˆ°Swiftä¹‹åï¼Œä½ æœ€å¤§çš„æ„Ÿè§¦æ˜¯ä»€ä¹ˆï¼Ÿ æ€»åˆ†20åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ å½“ä½ ä»ObjCè½¬åˆ°Swiftä¹‹åï¼Œä½ åšäº†å“ªäº›äº‹è®©ä½ çš„Swiftä»£ç çœ‹ä¸Šå»ä¸é‚£ä¹ˆObjCï¼Ÿ æ€»åˆ†30åˆ† å¼€æ”¾å¼é¢˜ç›®ã€‚ä¸‹é¢æä¾›å‡ ä¸ªç¤ºä¾‹ï¼š ä½¿ç”¨Swiftçš„æ•°æ®ç»“æ„å’Œç±»å‹ï¼šä½¿ç”¨Swiftçš„Arrayã€Dictionaryç­‰æ•°æ®ç»“æ„ï¼Œé¿å…ä½¿ç”¨NSArrayå’ŒNSDictionaryç­‰ã€‚ ä½¿ç”¨Swiftçš„å¯é€‰å‹ï¼ˆOptionalï¼‰ï¼šä½¿ç”¨å¯é€‰å‹æ¥å¤„ç†å˜é‡æ˜¯å¦å­˜åœ¨çš„æƒ…å†µï¼Œè€Œä¸æ˜¯å®šä¹‰0ï¼Œç©ºå­—ç¬¦ä¸²ï¼Œæˆ–è€…ä½¿ç”¨ObjCä¸­çš„nilæˆ–NSNotFoundç­‰ã€‚ ä½¿ç”¨Swiftçš„è¯­è¨€ç‰¹æ€§ï¼šä½¿ç”¨Swiftä¸­çš„é«˜é˜¶å‡½æ•°å’Œé—­åŒ…ç­‰è¯­è¨€ç‰¹æ€§ï¼Œé¿å…ä½¿ç”¨ObjCä¸­çš„å¾ªç¯å’Œå‡½æ•°æŒ‡é’ˆç­‰ã€‚ å‡å°‘ä½¿ç”¨å…¨å±€å˜é‡ï¼šå°½é‡é¿å…ä½¿ç”¨å…¨å±€å˜é‡ï¼Œè€Œé‡‡ç”¨æ›´å…·ä½“å’Œå±€éƒ¨çš„æ–¹å¼æ¥ä¼ é€’æ•°æ®ã€‚ å‡å°‘ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼šå°½é‡é¿å…ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œè€Œé‡‡ç”¨æ›´å®‰å…¨å’Œä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†ç±»å‹è½¬æ¢ã€‚ ","link":"https://blog.rakuyo.dev/ios-self-paced-interview-questions/"},{"title":"Pythonï¼šCelery çš„ç®€å•ä½¿ç”¨","content":"æœ€è¿‘å†™çš„åç«¯é¡¹ç›®éœ€è¦ç”¨åˆ°é˜Ÿåˆ—ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¸œè¥¿æŠ˜è…¾äº†å¥½ä¸€ä¼šå„¿ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚ Celery æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¯å®ç°å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ã€å®šæ—¶ä»»åŠ¡ã€ä»»åŠ¡ç»“æœå¤„ç†ç­‰åŠŸèƒ½ã€‚ æœ¬æ–‡åŸºäº Celery 5.2.7 ç‰ˆæœ¬ç¼–å†™ã€‚ æ¦‚è§ˆ Celery å…¶å®åŒ…å«äº†å‡ ä¸ªæ¦‚å¿µï¼šCelery å®¢æˆ·ç«¯ã€æ¶ˆæ¯ä¸­é—´ä»¶ Brokerã€ç»“æœå­˜å‚¨ Backend ä»¥åŠ ä»»åŠ¡æ‰§è¡Œå•å…ƒ Workerã€‚ å¤§è‡´çš„æµç¨‹æ˜¯ï¼šCeler å®¢æˆ·ç«¯å‘èµ·ä»»åŠ¡ -&gt; ç›¸å…³ä¿¡æ¯å­˜å‚¨åˆ°æ¶ˆæ¯ä¸­é—´ä»¶ Broker ä¸­ -&gt; ä»»åŠ¡æ‰§è¡Œå•å…ƒ Worker ä» Broker ä¸­è¯»å–ä»»åŠ¡ï¼ˆTaskï¼‰ç„¶åæ‰§è¡Œ -&gt; å°†æ‰§è¡Œç»“æœå­˜å‚¨åˆ° Backend ä¸­ -&gt; Celery å®¢æˆ·ç«¯ä» Backend ä¸­è¯»å–ç»“æœã€‚ Celery æ”¯æŒå¤šç§æ¶ˆæ¯ä¸­é—´ä»¶å’Œç»“æœå­˜å‚¨ï¼Œæœ¬æ–‡ä¸»è¦ä½¿ç”¨ Redis ä½œä¸ºä¸­é—´ä»¶å’Œç»“æœå­˜å‚¨ã€‚ Celery å¯¹è±¡çš„åˆå§‹åŒ– &amp; é…ç½® åœ¨ Celery ç±»ç”¨ __init__ æ–¹æ³•åˆå§‹åŒ–ä¹‹åï¼Œæœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š __init__ å¯ä»¥åœ¨åˆå§‹åŒ– Celery å¯¹è±¡çš„åŒæ—¶ä¼ å…¥å¯¹åº”çš„é…ç½®ã€‚æœ‰ä»¥ä¸‹å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å‚æ•°ï¼š mainï¼šä¸»æ¨¡å—çš„åç§° brokerï¼šæ¶ˆæ¯ä¸­é—´ä»¶å­˜å‚¨çš„è®¿é—®åœ°å€ backendï¼šç»“æœå­˜å‚¨æœåŠ¡çš„è®¿é—®åœ°å€ï¼ˆå¯é€‰çš„ï¼‰ ä¾‹å¦‚è¯´ä¸€ä¸ªå¯èƒ½çš„ Celery å¯¹è±¡çš„åˆå§‹åŒ–ä»£ç ä¸ºï¼š from celery import Celery celery = Celery('flaskr', broker='redis://localhost:6379/0', backend='redis://localhost:6379/0') å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª Redis æœåŠ¡åŒæ—¶ä½œä¸ºä¸­é—´ä»¶å’Œç»“æœå­˜å‚¨ã€‚ flaskr æ˜¯åŒ…å« Celery å®¢æˆ·ç«¯çš„ Python ç¨‹åºçš„åç§°ï¼Œå¦‚æœä½¿ç”¨ Flask æ¡†æ¶å¼€å‘ï¼Œé‚£ä¹ˆåº”å½“æ˜¯å’Œåˆå§‹åŒ– Flask å¯¹è±¡æ—¶ä½¿ç”¨çš„åç§°ä¸€è‡´ã€‚ ä¸Šæ–‡æœ‰æåˆ° backend æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä¼ è¯¥å‚æ•°ï¼Œé‚£ä¹ˆå°±æ— æ³•é€šè¿‡ Celery æŸ¥è¯¢åˆ°ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚ config_from_object Celery ç±»è¿˜æä¾›äº†ä¸€ä¸ª config_from_object æ–¹æ³•ï¼Œæ”¯æŒé€šè¿‡ â€œPython é…ç½®æ–‡ä»¶â€ è¿›è¡Œé…ç½®ã€‚ä½¿ç”¨ä¸Šä»£ç ç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š from celery import Celery celery = Celery('flaskr') celery.config_from_object('flaskr.tools.celery_config') celery_config æ˜¯æ–‡ä»¶åã€‚flaskr.tools.celery_config æ˜¯è¿™ä¸ªæ–‡ä»¶çš„ â€œè·¯å¾„â€ï¼Œæˆ–è€…è¯´å½“æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­ import è¯¥ python æ–‡ä»¶æ—¶ä½¿ç”¨çš„è·¯å¾„ã€‚ celery_config.py æ–‡ä»¶ä¸­çš„å†…å®¹ä¸ºï¼š from os import environ CELERY_REDIS_URL = &quot;redis://&quot; + \\ &quot;:&quot; + \\ environ.get(&quot;REDIS_PASSWD&quot;) + \\ &quot;@&quot; + \\ environ.get(&quot;REDIS_HOST&quot;) + \\ &quot;:&quot; + \\ environ.get(&quot;REDIS_PORT&quot;) + \\ &quot;/&quot; + \\ environ.get(&quot;REDIS_DATABASE&quot;) BROKER_URL = CELERY_REDIS_URL CELERY_RESULT_BACKEND = CELERY_REDIS_URL åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–é…ç½®ï¼Œæˆ–è€…ç›´æ¥å†™æ­»äº†æˆ‘ä»¬æ‰€éœ€è¦çš„é…ç½®å­—æ®µã€‚ æ³¨æ„ Celery å¯¹è±¡çš„åˆå§‹åŒ–ä»¥åŠé…ç½®å¿…é¡»è¦æ”¾åœ¨é¡¶å±‚ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä¸è¡Œçš„ï¼š from celery import Celery celery = Celery('flaskr') def init_app(app): celery.config_from_object('flaskr.tools.celery_config') å› ä¸ºåç»­ Worker å°†ä¼šæ ¹æ®é…ç½®çš„è·¯å¾„ï¼Œå¯»æ‰¾ Celery å¯¹è±¡ï¼Œä»è¯¥å¯¹è±¡ä¸­è·å–ç›¸åº”çš„é…ç½®ã€‚ è¯¥è¿‡ç¨‹å¯ä»¥ç†è§£ä¸ºï¼šâ€œä¸æ˜¯è·å–ä¸€ä¸ªå·²ç»åˆå§‹åŒ–å¥½äº†çš„å¯¹è±¡ï¼Œè€Œæ˜¯æ ¹æ®é…ç½®çš„è·¯å¾„ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶/æ¨¡å—ï¼Œé‡æ–°åˆå§‹åŒ– Celery å¯¹è±¡â€ã€‚ è¯¥è¿‡ç¨‹åªä¼šæ‰§è¡Œé¡¶å±‚å±æ€§ã€æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¸ä¼šè°ƒç”¨ä½ çš„ init_app æ–¹æ³•ï¼Œæ‰€ä»¥è¿™ä¹ˆå†™ä¹‹å Worker ä¾§çš„ Celery å¯¹è±¡å±äºåªæ˜¯è¢«åˆå§‹åŒ–ä½†æ˜¯æ²¡æœ‰è¢«é…ç½®è¿‡çš„çŠ¶æ€ï¼Œæ‰€æœ‰çš„é…ç½®é¡¹éƒ½ä¼šæ˜¯é»˜è®¤å€¼ã€‚ Worker Worker æœåŠ¡æ˜¯ç‹¬ç«‹äº Celery å®¢æˆ·ç«¯ç¨‹åºçš„ï¼Œéœ€è¦å•ç‹¬å¦èµ·ä¸€ä¸ªæœåŠ¡ã€‚ åœ¨ç»ˆç«¯æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ Worker æœåŠ¡ï¼š celery -A flaskr.libs.system worker -l info å…¶ä¸­ -A å‚æ•°åé¢æ¥ç€çš„ flaskr.libs.system æ˜¯ Celery å¯¹è±¡æ‰€åœ¨çš„æ¨¡å—/æ–‡ä»¶è·¯å¾„ã€‚å’Œ config_from_object ä¸€æ ·ï¼Œè¿™é‡Œä¹Ÿæ˜¯ â€œå½“æˆ‘ä»¬æƒ³è¦åœ¨ä»£ç ä¸­ import è¯¥ python æ–‡ä»¶æ—¶ä½¿ç”¨çš„è·¯å¾„â€ã€‚è¦ç¡®ä¿è¯¥è·¯å¾„ä¸‹åŒ…å«ç€ Celery å¯¹è±¡ã€‚ -l å‚æ•°æ˜¯æ—¥å¿—ç­‰çº§ï¼Œç¤ºä¾‹ä¸­æŒ‡å®šåˆ° info çº§åˆ«ã€‚ Celery çš„ä½¿ç”¨ ä¸‹é¢ç®€å•çš„ä»‹ç»ä¸€ä¸‹ Celery æ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ã€‚ ä¸Šæ–‡ä¸­æœ‰æåˆ°ï¼ŒWorker ä¼šåœ¨è¿è¡Œæ—¶è¯»å– Celery å®¢æˆ·ç«¯ä¸­çš„ Task ä»»åŠ¡å¹¶æ‰§è¡Œã€‚ å®šä¹‰ä»»åŠ¡ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Task çš„å®šä¹‰ï¼š # in tasks.py from flaskr.libs.system import celery @celery.task def add(x, y): return x + y ä½ å¯ä»¥å°†å…¶å®šä¹‰ä¸ºé¡¶å±‚/å…¨å±€æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥å°†å…¶åŒ…è£¹åœ¨ç±»ä¸­ã€‚ å¦‚æœåŒ…è£¹åœ¨ç±»ä¸­ï¼Œä¼šæ¶‰åŠåˆ° self å‚æ•°é—®é¢˜ï¼Œè¯·å‚è€ƒåé¢çš„å°èŠ‚ï¼šä»»åŠ¡ä¸­çš„ self ä¸Šæ–‡æˆ‘ä»¬åœ¨ flaskr.libs.system æ¨¡å—ä¸‹å®šä¹‰äº† celery å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥åœ¨ tasks.py æ–‡ä»¶ä¸­ä½¿ç”¨ @celery.task è£…é¥°å™¨ï¼Œä½¿ä¸€ä¸ªæ–¹æ³•æˆä¸º Celery ä»»åŠ¡ã€‚ æ³¨æ„ï¼šå¦‚æœä½ çš„ Celery å¯¹è±¡ä¸å« celery è€Œæ˜¯å…¶ä»–åå­—ï¼Œä¾‹å¦‚ appã€‚é‚£ä¹ˆä½ çš„è£…é¥°å™¨åº”è¯¥æ˜¯ @app.task â€”â€” task æ˜¯ Celery å¯¹è±¡çš„æ–¹æ³•ã€‚ åœ¨ Task ä»»åŠ¡å†…ï¼Œreturn ç»“æœä»£è¡¨ç€ â€œä»»åŠ¡æ‰§è¡ŒæˆåŠŸâ€ï¼Œé€šè¿‡ raise æŠ›å‡ºå¼‚å¸¸æ„å‘³ç€ â€œä»»åŠ¡æ‰§è¡Œå¤±è´¥ã€‚â€ æ‰§è¡Œä»»åŠ¡ å¯¹ä»»åŠ¡æ–¹æ³•è°ƒç”¨ delay æ–¹æ³•ä»¥ä¼ é€’å‚æ•°å¹¶æ‰§è¡Œä»»åŠ¡ï¼š # ä½¿ç”¨å‚æ•° 4ï¼Œ5 è°ƒç”¨ä»»åŠ¡ add result = add.delay(4, 5) # å¯¹æ‰§è¡Œç»“æœè°ƒç”¨ get() æ–¹æ³•ä»¥è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ print(result.get()) get() æ–¹æ³•è·å–çš„æ˜¯ä»»åŠ¡æ‰§è¡ŒæˆåŠŸä¹‹åçš„ç»“æœï¼Œå³ return çš„ç»“æœã€‚ å¦‚æœè¦è·å– raise æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ result.result æ–¹æ³•è·å–å¼‚å¸¸ã€‚ åˆ¤æ–­çŠ¶æ€ åœ¨è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœä¹‹å‰ï¼Œæˆ‘å»ºè®®æ‚¨å…ˆåˆ¤æ–­å½“å‰ä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚ Celery æ¡†æ¶æä¾›äº† AsyncResult ç±»æ¥æŸ¥è¯¢ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ï¼š def exec_task(self): &quot;&quot;&quot;æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶è¿”å›ä»»åŠ¡ ID&quot;&quot;&quot; result = add.delay(4, 5) task_id = result.task_id return task_id def check_status(self, task_id): &quot;&quot;&quot;æ ¹æ®ä»»åŠ¡ ID æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€&quot;&quot;&quot; from flaskr.libs.system import celery result = celery.AsyncResult(task_id) æœ‰ä¸€äº›æ–‡ç« ä¼šæ‰§è¡Œä½¿ç”¨ AsyncResult ç±»ï¼Œè€Œä¸æ˜¯é€šè¿‡ celery å¯¹è±¡è°ƒç”¨ AsyncResultã€‚ ä½†æ˜¯åœ¨æˆ‘å®é™…æ“ä½œè¿‡ç¨‹ä¸­å‘ç°ï¼Œä¸é€šè¿‡ celery å¯¹è±¡è°ƒç”¨çš„è¯ä¼šæ‰¾ä¸åˆ° Backendï¼Œæ€€ç–‘ä¹Ÿæ˜¯å’Œé…ç½®æœ‰å…³ã€‚ result å¯¹è±¡æœ‰ä¸€ä¸ª task_id å±æ€§ï¼Œä½¿ç”¨è¯¥å±æ€§å€¼ä½œä¸ºå‚æ•°åˆå§‹åŒ– AsyncResult å¯¹è±¡ï¼Œå°±å¯ä»¥æŸ¥è¯¢è¯¥ä»»åŠ¡çš„çŠ¶æ€ï¼š result.stateï¼šè·å–å½“å‰ä»»åŠ¡çš„çŠ¶æ€ï¼ˆå­—ç¬¦ä¸²ï¼‰ result.ready()ï¼šåˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²ç»ç»“æŸï¼ˆæˆåŠŸ or å¤±è´¥ï¼‰ result.successful()ï¼šåˆ¤è¯»ä»»åŠ¡æ˜¯å¦æˆåŠŸ result.get()ï¼šå’Œä¸Šæ–‡æåŠçš„ä¸€æ ·ï¼Œè·å–æ‰§è¡ŒæˆåŠŸçš„ä»»åŠ¡çš„ç»“æœï¼ˆreturnï¼‰ result.resultï¼šå’Œä¸Šæ–‡æåŠçš„ä¸€æ ·ï¼Œè·å–æ‰§è¡Œå¤±è´¥çš„ä»»åŠ¡æŠ›å‡ºçš„å¼‚å¸¸ï¼ˆraiseï¼‰ ä¸€ç§æœ‰å¯èƒ½çš„å¤„ç†æµç¨‹å¦‚ä¸‹ï¼š def check_status(self, task_id): # æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€ from flaskr.libs.system import celery result = celery.AsyncResult(task_id) logging.info(f&quot;æŸ¥è¯¢ä»»åŠ¡ç»“æœï¼Œä»»åŠ¡IDï¼ˆ{task_id}ï¼‰å¯¹åº”çš„çŠ¶æ€ä¸ºï¼š{result.state}&quot;) # ä»»åŠ¡ä»åœ¨æ‰§è¡Œä¸­ if not result.ready(): return { &quot;code&quot;: &quot;105&quot;, &quot;message&quot;: &quot;ä»»åŠ¡ä»åœ¨æ‰§è¡Œä¸­&quot; } # ä»»åŠ¡å¤±è´¥ if not result.successful(): error = result.result return { &quot;code&quot;: &quot;9999&quot;, &quot;message&quot;: f&quot;{str(error)}&quot; } # è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ task_result = result.get() return { &quot;code&quot;: &quot;200&quot;, &quot;data&quot;: task_result, &quot;message&quot;: &quot;ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ&quot; } ä»»åŠ¡ä¸­çš„ self .task() æ–¹æ³•æœ‰ä¸€ä¸ª bind å‚æ•°ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯ Falseã€‚è¯¥å‚æ•°å¯ä»¥æ§åˆ¶æ˜¯å¦å°†ä»»åŠ¡ç»‘å®šåˆ°å®ä¾‹å¯¹è±¡ä¸Šã€‚è¿™å…³ä¹åˆ° self å‚æ•°çš„å…·ä½“å€¼ã€‚ å®šä¹‰åœ¨ç±»ä¸­çš„ä»»åŠ¡ å¦‚æœä½ çš„ä»»åŠ¡å®šä¹‰æ˜¯åŒ…è£¹åœ¨ç±»ä¸­ï¼Œåƒæ˜¯è¿™æ ·ï¼š from flaskr.libs.system import celery class Tasks(object): def __init__(self, value): self.value = value @celery.task def add(self, x): return x + self.value é‚£ä¹ˆæ­¤æ—¶éœ€è¦æ³¨æ„ï¼Œå› ä¸º bind å‚æ•°çš„é»˜è®¤å€¼æ˜¯ Falseï¼Œæ‰€ä»¥æ­¤æ—¶ add ä»»åŠ¡æ²¡æœ‰è¢«ç»‘å®šåˆ° Tasks ç±»å®ä¾‹ä¸Šï¼Œæ‰€ä»¥æ­¤æ—¶ self å‚æ•°æŒ‡çš„æ˜¯ä»»åŠ¡æœ¬èº«ï¼Œè€Œä¸æ˜¯ Tasks ç±»çš„å®ä¾‹å¯¹è±¡ã€‚æ­¤æ—¶åœ¨ add æ–¹æ³•ä¸­ï¼Œä½ å°†æ— æ³•è·å–åˆ° self.value çš„å€¼ã€‚ å¦‚æœä½ æƒ³åœ¨ add æ–¹æ³•ä¸­ä½¿ç”¨ self.valueï¼Œä½ éœ€è¦å°† bind å‚æ•°è®¾ç½®ä¸º Trueï¼Œåƒæ˜¯è¿™æ ·ï¼š ... @celery.task(bind=True) def add(self, x): return x + self.value ... æ­¤æ—¶ä½ å¯ä»¥é¡ºåˆ©çš„è·å–åˆ° self.value çš„å€¼ã€‚ å®šä¹‰åœ¨é¡¶å±‚çš„ä»»åŠ¡ å¦‚æœä»»åŠ¡ç›´æ¥å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š from flaskr.libs.system import celery @celery.task def add(x, y): return x + y é‚£ä¹ˆé¦–å…ˆï¼Œæ­¤æ—¶ bind å‚æ•°çš„å€¼æ˜¯ Falseã€‚è¿™ä¸ªæ—¶å€™æ‚¨æ— æ³•åœ¨ add æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ä¸­æ·»åŠ  selfï¼Œä¹Ÿæ— æ³•åœ¨æ–¹æ³•å®ç°å†…ä½¿ç”¨ self å‚æ•°ï¼Œè¿™ä¼šå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ å¦‚æœä½ å°† bind è®¾ç½®ä¸º Trueï¼Œé‚£ä¹ˆå°±å¯ä»¥æ·»åŠ  self å‚æ•°äº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š from flaskr.libs.system import celery @celery.task(bind=True) def add(self, x, y): return x + y é‚£ä¹ˆæ­¤æ—¶ self ä»£è¡¨ä»€ä¹ˆå‘¢ï¼Ÿ ä¸Šæ–‡æœ‰æåˆ°ï¼Œbind å‚æ•°ç”¨äºå°†ä»»åŠ¡ç»‘å®šåˆ°ç±»å®ä¾‹ã€‚ å®é™…ä¸Šï¼Œæ­¤æ—¶ Celery ä¼šåœ¨åå°è‡ªåŠ¨å°†è¯¥ä»»åŠ¡è½¬æ¢ä¸ºä¸€ä¸ªå¸¦æœ‰å®ä¾‹æ–¹æ³•çš„ç±»ï¼Œä½¿ä½ å¯ä»¥åœ¨ä»»åŠ¡å‡½æ•°ä¸­è®¿é—®å®ä¾‹å±æ€§å’Œæ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œself å‚æ•°è¡¨ç¤ºå½“å‰ä»»åŠ¡çš„å®ä¾‹å¯¹è±¡ï¼Œå°±åƒåœ¨ç±»ä¸­å®šä¹‰ä»»åŠ¡ä¸€æ ·ã€‚ é‡è¯• Celery æ¡†æ¶æœ¬èº«æ”¯æŒ â€œé‡è¯•â€ åŠŸèƒ½ï¼ŒåŒ…å«è‡ªåŠ¨é‡è¯•å’Œæ‰‹åŠ¨é‡è¯•ä¸¤ç§æ–¹æ³•ã€‚è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹æ‰‹åŠ¨é‡è¯•çš„ç”¨æ³•ã€‚ retry æ–¹æ³•çš„è°ƒç”¨ # in tasks.py from flaskr.libs.system import celery @celery.task(bind=True) def add(self, x, y): try: # æŸäº›å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³• return __some_method_may_throw_exceptions() except Exception as e: # å‡ºé”™æ¯15ç§’å°è¯•ä¸€æ¬¡ï¼Œæ€»å…±å°è¯•3æ¬¡ raise self.retry(exc=e, countdown=15, max_retries=3) finally: pass è¯¥ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨æ–‡ä»¶å†…ç›´æ¥å®šä¹‰äº†ä¸€ä¸ªä»»åŠ¡ï¼Œè€Œä¸” bind å‚æ•°è¢«è®¾ç½®ä¸ºäº† Trueã€‚æ­¤æ—¶æˆ‘ä»¬è¦é€šè¿‡ self å‚æ•°æ¥è°ƒç”¨ retry æ–¹æ³•ï¼Œæ‰§è¡Œæ‰‹åŠ¨é‡è¯•ã€‚ é‚£å¦‚æœ bind æ˜¯ False çš„æƒ…å†µå‘¢ï¼Ÿæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ add.retry(...) æ¥è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœä»»åŠ¡å®šä¹‰åœ¨ç±»ä¸­ï¼š å¦‚æœ bind æ˜¯ Falseï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ self.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœ bind æ˜¯ Trueï¼Œåˆ™éœ€è¦ä½¿ç”¨ add.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ æ€»ç»“ä¸€ä¸‹ä¸åŒçš„åœºæ™¯ï¼š ä»»åŠ¡å®šä¹‰åœ¨ç±»ä¸­ï¼š å¦‚æœ bind æ˜¯ Falseï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ self.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœ bind æ˜¯ Trueï¼Œåˆ™éœ€è¦ä½¿ç”¨ add.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ ä»»åŠ¡å®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼š å¦‚æœ bind æ˜¯ Falseï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨ add.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¦‚æœ bind æ˜¯ Trueï¼Œåˆ™éœ€è¦ä½¿ç”¨ self.retry(...) è§¦å‘æ‰‹åŠ¨é‡è¯•ã€‚ å¯ä»¥è¯´å®šä¹‰åœ¨ç±»ä¸­å’Œå®šä¹‰åœ¨æ–‡ä»¶ä¸­ï¼Œå¯¹äºç›¸åŒçš„ bind å‚æ•°ï¼Œè°ƒç”¨æ–¹å¼æ˜¯ç›¸åçš„ã€‚ retry æ–¹æ³•çš„å‚æ•° è¯´å®Œäº†è°ƒç”¨ï¼Œæˆ‘ä»¬æ¥è¯´ä¸€ä¸‹å‚æ•°ã€‚ countdown å®šä¹‰é‡è¯•çš„é—´éš”ï¼Œmax_retries å®šä¹‰æœ€å¤šé‡è¯•å‡ æ¬¡ã€‚ exc å‚æ•°æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå®ƒä»£è¡¨ç€ â€œå½“å‰ä»»åŠ¡å¤±è´¥æ—¶äº§ç”Ÿçš„å¼‚å¸¸â€ã€‚é€šè¿‡å°† e å‚æ•°ä¼ é€’åˆ° retry æ–¹æ³•ä¸­ï¼Œå¯ä»¥è®©é‡è¯•å¤±è´¥åæŠ›å‡ºæœ€å¼€å§‹çš„å¼‚å¸¸ã€‚æ‚¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¯¥å¼‚å¸¸å‚æ•°ã€‚ åœ¨ä½¿ç”¨ retry æ–¹æ³•æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š exc å‚æ•°ï¼ŒCelery æ¡†æ¶å°†é»˜è®¤å°†ä»»åŠ¡çš„å¼‚å¸¸ä¿¡æ¯ä¼ é€’ç»™ retry æ–¹æ³•ã€‚å¦‚æœæŒ‡å®šäº† exc å‚æ•°ï¼Œåˆ™ä¼šå°†æŒ‡å®šçš„å¼‚å¸¸å¯¹è±¡ä¼ é€’ç»™ retry æ–¹æ³•ã€‚ retry æ–¹æ³•çš„ç»“æœ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† raise å°† retry å¤±è´¥åçš„å¼‚å¸¸æŠ›å‡ºï¼Œæ„å‘³ç€ä»»åŠ¡å¤±è´¥ã€‚ åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥ä¸ä½¿ç”¨è¯¥å‚æ•°ï¼Œåœ¨é‡è¯•å¤±è´¥ä¹‹åæ‰‹åŠ¨å¤„ç†å¼‚å¸¸ï¼Œä¾‹å¦‚ï¼š # in tasks.py from flaskr.libs.system import celery @celery.task(bind=True) def add(self, x, y): try: return __some_method_may_throw_exceptions() except Exception as e: max_retries = 3 # è¶…è¿‡æœ€å¤§æ¬¡æ•°ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ if self.request.retries &gt;= max_retries: return __create_error_response() self.retry(exc=e, countdown=15, max_retries=max_retries) finally: pass åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœè¶…è¿‡äº†æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å°†é‡è¯•çš„å¼‚å¸¸æŠ›ç»™å¤–ç•Œï¼Œæ‰€ä»¥åœ¨æœ€åä¸€æ¬¡é‡è¯•å¤±è´¥ä¹‹åä¼šå†æ¬¡è§¦å‘ exceptï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ¤æ–­æ˜¯å¦è¶…è¿‡äº†æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ„å‘³ç€é‡è¯•å¤±è´¥ã€‚ å½“é‡è¯•å¤±è´¥åï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œå¤±è´¥å¤„ç†ã€‚ ","link":"https://blog.rakuyo.dev/simple-use-of-python-celery/"},{"title":"å¯ç»„åˆçš„ UICollectionView å¸ƒå±€ï¼šUICollectionViewCompositionalLayout","content":"UICollectionViewCompositionalLayout æ˜¯ Apple åœ¨ iOS 13 å¼•å…¥çš„ï¼Œç”¨äºæ„å»ºåŸºäºç»„åˆçš„ UICollectionView å¸ƒå±€çš„ç±»ã€‚å®ƒå…è®¸å¼€å‘è€…æ ¹æ®ä¸€ç³»åˆ—çš„ç»„åˆå¸ƒå±€ï¼Œæ›´è½»æ¾ã€æ›´çµæ´»åœ°åˆ›å»ºå¤æ‚çš„ UICollectionView å¸ƒå±€ã€‚ æœ¬æ–‡ä¸»è¦å›´ç»• UICollectionViewCompositionalLayout ä¸­ â€œå¯ç»„åˆâ€ è¿™ä¸ªç‰¹æ€§è¿›è¡Œè®¨è®ºã€‚ æœ¬æ–‡å»ºç«‹åœ¨æ‚¨å·²ç»å¤§è‡´äº†è§£è¿‡ UICollectionViewCompositionalLayoutï¼ŒçŸ¥é“å®ƒæ˜¯ä»€ä¹ˆï¼Œä»¥åŠåŸºç¡€çš„ç”¨æ³•ã€‚ä¸‹æ–‡å°†ä¸å†å¯¹å…¶è¿›è¡Œè®²è§£ã€‚ ç»„åˆç±» FlowLayout å¸ƒå±€ åœ¨ä¸Šä¸€ç¯‡æ–‡ç«  NSCollectionLayoutGroup ä¹‹å­è§†å›¾çš„å¡«å…… çš„æœ€åæœ‰æåˆ°ä¸€ä¸ªåœºæ™¯ï¼Œè¿™é‡Œå¤ç”¨ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š åœ¨å‰æ–‡ä¸­ï¼Œæˆ‘æœ‰è¯´ä¸­é—´çš„ â€œå·¥å…·Groupâ€ ä¸èƒ½ä½¿ç”¨ subitems çš„å½¢å¼è¿›è¡Œåˆå§‹åŒ–ï¼Œåº”è¯¥ä½¿ç”¨ subitem + count çš„å½¢å¼åˆå§‹åŒ– â€”â€” å…¶å®è¿™ä¸å®Œå…¨å¯¹ã€‚ å®é™…éœ€æ±‚ä¸Šï¼Œå¦‚å›¾è¿™ç§ç±» FlowLayout çš„å¸ƒå±€å¾€å¾€ä¼šè¦æ±‚ â€œæ¯è¡ŒXä¸ªâ€ï¼Œå³å¹³åˆ†å±•ç¤ºã€‚ æ­¤æ—¶å¦‚æœä½ ä»¬éœ€è¦è€ƒè™‘ä¸‹é¢çš„åœºæ™¯ï¼š å±å¹•æ—‹è½¬ã€‚ iPad ç­‰å±å¹•å°ºå¯¸ä¼šå‘ç”Ÿå˜åŒ–çš„æƒ…å†µã€‚ AutoLayout ä¾§ä¸æƒ³è¦è·å–å±å¹•å°ºå¯¸å»è®¡ç®—å‡º cell å®½åº¦ã€‚ é‚£ä¹ˆ subitem + count å°±æ²¡æ³•åšäº†ï¼šsubitem + count ä¼šå¿½ç•¥å¸ƒå±€æ–¹å‘ä¸Šçš„å°ºå¯¸ï¼Œæ‰€ä»¥æ­¤æ—¶å¾ˆéš¾å•çº¯ç”¨ AutoLayout åšå‡ºå¹³åˆ†çš„æ•ˆæœï¼Œæˆ–è€…è¯´ä¸ºäº†å®ç°å¹³åˆ†ï¼Œéœ€è¦å¤šæ¬¡åˆ·æ–°é¡µé¢å¸ƒå±€ã€‚ æ­¤æ—¶æœ‰ä¸€ç§ç”¨ subitems å®ç°çš„æ–¹å¼ï¼šä»¥æ¯è¡Œ/åˆ—ä½œä¸ºä¸€ä¸ª Groupï¼ŒGroup å†…ä½¿ç”¨ subitemsã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š let itemSize = NSCollectionLayoutSize( widthDimension: .fractionalWidth(1/4), heightDimension: .estimated(69) ) let normalLayoutSize = NSCollectionLayoutSize( widthDimension: .fractionalWidth(1), heightDimension: .estimated(500) ) let toolsListGroup = NSCollectionLayoutGroup.horizontal( layoutSize: normalLayoutSize, subitems: [ .init(layoutSize: itemSize) ] ) let rows = 5 let toolsGroup = NSCollectionLayoutGroup.vertical( layoutSize: normalLayoutSize, subitems: [ [toolsTitleItem], Array(repeating: toolsListGroup, count: rows), [ toolsFooterItem, sectionPaddingItem ], ].flatMap { $0 } ) ä¸Šé¢çš„ä»£ç é¦–å…ˆå®šä¹‰äº†2ä¸ª Sizeï¼Œä¸€ä¸ªæ˜¯ Item çš„å°ºå¯¸ï¼Œå¦å¤–ä¸€ä¸ªç®—æ˜¯ä¸€ä¸ª â€œå ä½ç¬¦â€ã€‚ ç„¶åæ˜¯2ä¸ª Groupï¼š toolsListGroup ä»¥è¡Œä¸ºå•ä½å±•ç¤º cellã€‚ toolsGroup åˆ™æ˜¯æœ€å¤–é¢çš„ Groupï¼Œå®ƒçš„ subitems åŒ…å«å¤šä¸ªä¸åŒçš„ Groupã€‚å…¶ä¸­çš„ Array(repeating: toolsListGroup, count: $0) åˆ™æ˜¯æ ¹æ®è¡Œæ•°ç”Ÿæˆå¯¹åº”æ•°é‡çš„ Groupã€‚ è¿™ç§å†™æ³•æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹è¿˜æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼š æ³¨æ„ç‚¹æ˜¯ï¼šå½“ cell çš„æ•°é‡ä¸æ˜¯è¡Œçš„æ•´æ•°å€çš„æ—¶å€™ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºå ä½ cellã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œcell æœ‰ 5 ä¸ªï¼Œå¯¹åº”çš„å°±æ˜¯2è¡Œï¼Œcell åˆ†å¸ƒæ˜¯ 4 + 1ã€‚æ­¤æ—¶å› ä¸ºåé¢è¿˜æœ‰å…¶ä»–ç­‰å¾…è¢«å¡«å……çš„ Item/Groupï¼Œå¦‚æœæ²¡æœ‰åˆ›å»ºå ä½ cellï¼Œåˆ™åé¢çš„ cell ä¼šè¢«æå‰ï¼Œä½¿ç”¨ toolsListGroup é‡Œçš„ Item å¸ƒå±€ã€‚ ç–‘æƒ‘çš„æ˜¯ï¼šæˆ‘å¹¶ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšèƒ½ç”Ÿæ•ˆã€‚ æŒ‰ç†è¯´ subitems çš„å¸ƒå±€æ–¹å¼æ˜¯ä¸ä¼šé™åˆ¶å†…å®¹çš„æ•°é‡çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå®ƒèƒ½æ¯è¡Œæ­£å¥½è£…4ä¸ªï¼ˆå°±è¿™ä¸ªä¾‹å­æ¥è¯´ï¼Œæ¯ä¸ªCellçš„å®½åº¦æ˜¯å±å¹•çš„1/4ï¼‰ï¼Œä¸‹ä¸€è¡Œçš„ Cell åˆ™ä½¿ç”¨ä¸‹ä¸€ä¸ª Group çš„å¸ƒå±€ï¼Ÿ æœ‰å…³äº UICollectionViewCompositionalLayout ç»„åˆå¤æ‚å¸ƒå±€çš„æ–‡æ¡£è¿˜æ˜¯å¤ªå°‘ï¼Œç›®å‰è¿˜æ²¡æ‰¾åˆ°è¿™ä¹ˆåšèƒ½ç”Ÿæ•ˆçš„åŸå› ã€‚ ","link":"https://blog.rakuyo.dev/composable-uicollectionview-layout-uicollectionviewcompositionallayout/"},{"title":"NSCollectionLayoutGroup ä¹‹å­è§†å›¾çš„å¡«å……","content":"æœ¬ç¯‡ä¸»è¦è®²è§£ NSCollectionLayoutGroup å†… â€œå­è§†å›¾â€ çš„å¡«å……æ–¹å¼ã€‚ ç®—æ˜¯ä¸º UICollectionViewCompositionalLayout çš„è®²è§£åšä¸€äº›é“ºå«ï¼Œæ¯•ç«ŸæŠŠ Item çš„å¡«å……æ–¹å¼äº†è§£æ¸…æ¥šäº†ä¹‹åï¼Œæ‰èƒ½ç»„åˆå¤šç§ Group æ¥è¿›è¡Œæ›´å¤æ‚çš„å¸ƒå±€ã€‚ NSCollectionLayoutGroup ä¸è€ƒè™‘æ–¹å‘çš„è¯ï¼Œæœ‰ä¸¤ç§å¡«å……å­è§†å›¾çš„æ–¹æ³•ã€‚ æ¦‚è§ˆ é€šè¿‡å¤´æ–‡ä»¶æ‚¨èƒ½æŸ¥åˆ°å¦‚ä¸‹å‡ ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼š open class func vertical(layoutSize: NSCollectionLayoutSize, subitems: [NSCollectionLayoutItem]) -&gt; Self @available(iOS, introduced: 13.0, deprecated: 16.0) open class func vertical(layoutSize: NSCollectionLayoutSize, subitem: NSCollectionLayoutItem, count: Int) -&gt; Self @available(iOS 16.0, *) open class func vertical(layoutSize: NSCollectionLayoutSize, repeatingSubitem subitem: NSCollectionLayoutItem, count: Int) -&gt; Self @available(iOS, introduced: 16.0, deprecated: 16.0, renamed: &quot;vertical(layoutSize:repeatingSubitem:count:)&quot;) public class func verticalGroup(with size: NSCollectionLayoutSize, repeatingSubitem subitem: NSCollectionLayoutItem, count: Int) -&gt; NSCollectionLayoutGroup ç¬¬ä¸‰ä¸ªæ–¹æ³•æ˜¯ iOS 16 æ–°å‡ºçš„ï¼ŒåŒæ—¶åºŸå¼ƒäº†ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œè€Œç¬¬å››ä¸ªæ–¹æ³•åœ¨ iOS 16 å¼•å…¥åŒæ—¶åˆåœ¨ iOS 16 åºŸé™¤ã€‚ åæ–‡å°†å›´ç»•å‰ä¸¤ä¸ªæ–¹æ³•å±•å¼€è®¨è®ºï¼Œä¸æ¶‰åŠåˆ°åä¸¤ä¸ªæ–¹æ³•ã€‚ subitem + count è¿™ç§åˆå§‹åŒ–æ–¹å¼å°†åœ¨æ¯ä¸ª Group ä¸­é‡å¤ count ä¸ª itemã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåœ¨ä¸åŒçš„æ–¹å‘ä¸Šï¼ŒlayoutSize ä¼šæœ‰ä¸åŒçš„è¡¨ç°ï¼š vertical func vertical(layoutSize: NSCollectionLayoutSize, subitem: NSCollectionLayoutItem, count: Int) -&gt; NSCollectionLayoutGroup åœ¨çºµå‘ä¸Šï¼ŒNSCollectionLayoutItem çš„ widthDimension ç”Ÿæ•ˆï¼Œä½†æ˜¯heightDimension å°†è¢«å¿½ç•¥ã€‚ Item çš„å®é™…é«˜åº¦ä¼šæ˜¯ .fractionalHeight(1/count)ã€‚ å‡è®¾ç°åœ¨æœ‰ä¸‹é¢è¿™äº›ä»£ç ï¼š let itemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1/3), heightDimension: .absolute(100)) let item = NSCollectionLayoutItem(layoutSize: itemSize) let groupSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1), heightDimension: .absolute(100)) let group = NSCollectionLayoutGroup.vertical(layoutSize: groupSize, subitem: item, count: 2) æ­¤æ—¶ Item çš„å®é™…é«˜åº¦ä¼šæ˜¯ 50ï¼Œç›¸å½“äºä¸€ä¸ªé«˜åº¦ä¸º 100 çš„ Group å†…æœ‰2ä¸ªé«˜åº¦ä¸º 50 çš„ Itemã€‚ horizontal func horizontal(layoutSize: NSCollectionLayoutSize, subitem: NSCollectionLayoutItem, count: Int) -&gt; NSCollectionLayoutGroup å’Œ vertical æ—¶çš„æƒ…å†µç›¸å¯¹åº”ï¼š åœ¨æ¨ªå‘ä¸Šï¼ŒNSCollectionLayoutItem çš„ heightDimension ç”Ÿæ•ˆï¼Œä½†æ˜¯widthDimension å°†è¢«å¿½ç•¥ã€‚ Item çš„å®é™…å®½åº¦ä¼šæ˜¯ .fractionalWidth(1/count)ã€‚ è¿™é‡Œå°±ä¸å†ç”¨ä»£ç ä¸¾ä¾‹è¯´æ˜äº†ã€‚ subitems å’Œä¸Šä¸€ç§åˆå§‹åŒ–æ–¹æ³•ç›¸æ¯”ï¼Œä½¿ç”¨ subitems çš„æ–¹å¼æ¥è¿›è¡Œåˆå§‹åŒ–è¦ç®€å•çš„å¤šï¼Œå› ä¸ºå®ƒå†…éƒ¨çš„ Item çš„å¤§å°å®Œå…¨å–å†³äº Item è‡ªèº«ã€‚è€ƒè™‘å¦‚ä¸‹ä»£ç ï¼š let itemSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1/3), heightDimension: .absolute(100)) let item = NSCollectionLayoutItem(layoutSize: itemSize) let groupSize = NSCollectionLayoutSize(widthDimension: .fractionalWidth(1), heightDimension: .absolute(300)) let group = NSCollectionLayoutGroup.vertical(layoutSize: groupSize, subitems: [item]) è¯¥ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ª Item çš„é«˜åº¦å°±æ˜¯ 100ï¼Œè€Œå®½åº¦æ˜¯ Group çš„ 1/3ã€‚æ¯ä¸ª Group ä¸­æœ‰å¤šå°‘ä¸ª Item å–å†³äºæ•°æ®æºä¼ é€’ç»™ UICollectionView çš„æ•°é‡ã€‚ æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒGroup åªæ˜¯ç”¨æ¥è¾…åŠ©å¸ƒå±€çš„ï¼Œå®ƒæœ¬èº«å¹¶ä¸ä¼šç”Ÿæˆä»»ä½•è§†å›¾ã€‚æ‰€ä»¥å°½ç®¡åœ¨æœ¬ç¤ºä¾‹ä¸­å®ƒçš„é«˜åº¦åªæœ‰ 300ï¼Œä¸è¶³ UICollectionView çš„é«˜åº¦ï¼Œä½†æ˜¯ Item ä¾ç„¶ä¼šå……æ»¡æ•´ä¸ª UICollectionViewï¼Œè€Œä¸æ˜¯ä»…ä»…åœ¨é«˜åº¦ä¸º 300 çš„èŒƒå›´å†…è¿›è¡Œæ»‘åŠ¨ã€‚ æˆ‘å¹¶ä¸èƒ½è‚¯å®šè¿™ç§ç°è±¡å¯ä»¥ç§°ä¹‹ä¸º â€œå¿½ç•¥ Group çš„ layoutSizeâ€ï¼Œæ‰€ä»¥æ²¡æœ‰ä½¿ç”¨è¿™ç§è¡¨è¿°ã€‚ æ€»ç»“ è¿™ä¸¤ç§åˆå§‹åŒ–æ–¹å¼å„æœ‰å„çš„ç”¨é€”ï¼š åœ¨ä¸è€ƒè™‘åµŒå¥—å¸ƒå±€ï¼ˆGroup ä¸­åµŒå¥— Item å’Œ Groupï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§å¸ƒå±€çš„ä½¿ç”¨åœºæ™¯å¤§ä½“ä¸Šä¸€è‡´ï¼Œåªéœ€è¦æ³¨æ„å„è‡ªå¯¹ Item å¤§å°çš„è®¡ç®—è§„åˆ™å³å¯ã€‚ç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘è‡ªå·±ä¼šé€‰æ‹© subitems çš„åˆå§‹åŒ–æ–¹å¼ï¼Œå› ä¸º Item çš„å¤§å°è®¡ç®—è§„åˆ™æ›´ä¸ºç›´è§‚ã€‚ ä½†æ˜¯åœ¨åµŒå¥—å¸ƒå±€çš„å‰æä¸‹ï¼Œè¿™ä¸¤ç§åˆå§‹åŒ–æ–¹å¼å°±ä¼šæœ‰æ¯”è¾ƒå¤§çš„å·®å¼‚ã€‚ é¦–å…ˆåµŒå¥—å¸ƒå±€çš„æœ€å¤–å±‚åªèƒ½ä½¿ç”¨ subitems çš„æ–¹å¼åˆå§‹åŒ–ï¼Œæ•°ç»„ä¸­åŒ…å«å¤šç§ä¸åŒçš„ Item æˆ–è€… Groupã€‚ å…¶æ¬¡å¦‚æœéœ€è¦æŒ‡å®š Item çš„æ•°é‡ï¼Œé‚£ä¹ˆå°±åªèƒ½ä½¿ç”¨ subitem + count çš„åˆå§‹åŒ–å½¢å¼ã€‚ è€ƒè™‘ä¸‹å›¾çš„åœºæ™¯ï¼š å¦‚æœç°åœ¨è¦æ±‚é¡¶éƒ¨çš„æ ‡é¢˜ã€ä¸­é—´çš„å·¥å…·å’Œä¸‹æ–¹çš„ç°è‰²åˆ†éš”æ¡ï¼Œä¸‰éƒ¨åˆ†æ”¾åˆ°ä¸€ä¸ª NSCollectionLayoutGroup å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ [æ ‡é¢˜Item + å·¥å…·Group + ç°æ¡Item] çš„ç»„åˆå¸ƒå±€å½¢å¼ã€‚ æ­¤æ—¶ â€œå·¥å…·Groupâ€ å°±ä¸èƒ½ä½¿ç”¨ subitems çš„æ–¹å¼è¿›è¡Œåˆå§‹åŒ–äº†ï¼Œå¿…é¡»è¦æŒ‡å®šå·¥å…·çš„æ•°é‡ï¼Œå¦åˆ™ UICollectionView ä¼šæŠŠä¸‹æ–¹çš„ç°æ¡ä¹Ÿèåˆ°å·¥å…· Group ä¸­ã€‚ ","link":"https://blog.rakuyo.dev/notes-of-nscollectionlayoutgroup/"},{"title":"NSCollectionLayoutSection æ³¨æ„äº‹é¡¹ä¹‹ orthogonalScrollingBehavior","content":"æœ¬ç¯‡æ–‡ç« è®°å½•ä½¿ç”¨ NSCollectionLayoutSection ç±»çš„ orthogonalScrollingBehavior å±æ€§çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚ é€šè¿‡è®¾ç½®è¯¥å±æ€§å¯ä»¥æ§åˆ¶å¯¹åº” Section çš„æ»‘åŠ¨æ•ˆæœã€‚ åœ¨é˜…è¯»ä»¥ä¸‹å†…å®¹æ—¶ï¼Œæˆ‘å°†é»˜è®¤æ‚¨å·²ç»æŒæ¡äº† UICollectionViewCompositionalLayout çš„åŸºç¡€ç”¨æ³•ï¼Œä¸å†å¯¹ä¸€äº›ç»†èŠ‚è¿›è¡Œè¡¥å……è¯´æ˜ã€‚ Orthogonal Scroll View è¿™ä¸€èŠ‚æˆ‘ä»¬ä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªç³»ç»Ÿçš„ç§æœ‰ç±»å‹ï¼š_UICollectionViewOrthogonalScrollView å’Œ _UICollectionViewOrthogonalScrollerEmbeddedScrollView å› ä¸ºè¿™ä¸¤ä¸ªç±»å‹çš„åç§°å¤ªé•¿ï¼ŒåŒæ—¶ä¼šå¤šæ¬¡é‡å¤æåŠï¼Œæ•…ä¸‹æ–‡ä½¿ç”¨ _UIOrthogonalScrollView ä»£æ›¿ã€‚ è¿™ä¸¤ä¸ªç±»å‹å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªï¼Œæ—©æœŸ Apple ä½¿ç”¨çš„æ˜¯ _UICollectionViewOrthogonalScrollerEmbeddedScrollView è¿™ä¸ªåç§°ï¼ŒåæœŸåœ¨æŸä¸ªç‰ˆæœ¬ä¸­æ”¹ä¸º _UICollectionViewOrthogonalScrollViewã€‚ orthogonalScrollingBehavior çš„é»˜è®¤å€¼æ˜¯ .noneï¼Œå½“æˆ‘ä»¬å°†å…¶è®¾ç½®ä¸ºå…¶ä»–å€¼åï¼Œç³»ç»Ÿå°±ä¼šåœ¨ UICollectionView ä¸Šæ·»åŠ ä¸€å±‚ç±»å‹ä¸º _UIOrthogonalScrollView çš„ UIScrollView å­ç±»ä½œä¸º Cell çš„çˆ¶è§†å›¾ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶ Cell çš„çˆ¶è§†å›¾ä¸å†æ˜¯ UICollectionVIewã€‚ æˆ‘ä»¬æµ‹è¯•è¿‡ä»¥ä¸‹æƒ…å†µï¼š UICollectionViewCompositionalLayout åªæœ‰ä¸€ç§å¸ƒå±€ã€‚ NSCollectionLayoutGroup çš„æ»‘åŠ¨æ–¹å‘å’Œ UICollectionView çš„æ»‘åŠ¨æ–¹å‘ä¸€è‡´æˆ–ä¸ä¸€è‡´ã€‚ NSCollectionLayoutSection çš„å°ºå¯¸å’Œ UICollectionView ç›¸ç­‰æˆ–ä¸ç›¸ç­‰ã€‚ åœ¨è¿™ä¸‰ç§æƒ…å†µä¸‹ï¼Œåªè¦ä¿®æ”¹äº† orthogonalScrollingBehavior å±æ€§ï¼Œå°±ä¼šæ·»åŠ  _UIOrthogonalScrollView è§†å›¾ã€‚ åœ¨æ­£å¼å±•å¼€è¯´æ˜ä¹‹å‰æ’ä¸€å¥ï¼šæœ¬æ–‡åé¢æ‰€æåŠçš„å†…å®¹ï¼Œéƒ½æ˜¯åœ¨ä¸‹é¢è¿™ä¸ªå¸ƒå±€çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹çš„ï¼š let itemSize = NSCollectionLayoutSize( widthDimension: .fractionalWidth(1/3), heightDimension: .absolute(50)) let item = NSCollectionLayoutItem(layoutSize: itemSize) let group = NSCollectionLayoutGroup.horizontal( layoutSize: .init( widthDimension: .fractionalWidth(1), heightDimension: .fractionalHeight(0.5)), subitems: [item]) let section = NSCollectionLayoutSection(group: group) return section è·å–æ—¶æœº é‚£ä¹ˆè¯¥å¦‚ä½•è·å–è¯¥è§†å›¾å‘¢ï¼Œç»è¿‡ä¸å®Œå…¨æµ‹è¯•ï¼Œåˆ—è¡¨ä¸åŒ…å«ä»»ä½• Cell æ—¶ï¼Œä¸ä¼šæ·»åŠ è¯¥è§†å›¾ã€‚ è¯¥è§†å›¾å¯åœ¨ viewDidLayoutSubviews æ–¹æ³•ä¸­é€šè¿‡éå†å­è§†å›¾è·å¾—ã€‚ /// `orthogonalScrollView` å¯èƒ½çš„ç±»å‹ /// /// ç›®å‰å°šæ— æ³•ç¡®å®šå“ªä¸ªç‰ˆæœ¬çš„ç³»ç»Ÿä½¿ç”¨äº†å“ªä¸ªç±»å‹ï¼Œæ‰€ä»¥ä¸ºäº†ç¨³å¦¥èµ·è§ï¼Œä½¿ç”¨æ•°ç»„è¿›è¡Œåˆ¤æ–­ private var orthogonalScrollViewTypes: [String] { [ &quot;_UICollectionViewOrthogonalScrollView&quot;, &quot;_UICollectionViewOrthogonalScrollerEmbeddedScrollView&quot; ] } var orthogonalScrollView: UIScrollView? { subviews.first { orthogonalScrollViewTypes.contains(&quot;\\(type(of: $0))&quot;) } as? UIScrollView } clipsToBounds _UIOrthogonalScrollView çš„ clipsToBounds å±æ€§é»˜è®¤æ˜¯ falseï¼Œè¿™ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼š å¦‚æœæ‚¨çš„ Section è®¾ç½®äº† contentInsets ä¹‹ç±»çš„å±æ€§ï¼Œå¯¼è‡´æ¯” UICollectionView å°ï¼Œé‚£ä¹ˆåœ¨æ»‘åŠ¨ _UIOrthogonalScrollView çš„æ—¶å€™ï¼Œå…¶å†…å®¹ä¼šè¶…å‡º Section çš„èŒƒå›´ã€‚ iOS 15 åŠä»¥ä¸Š _UIOrthogonalScrollView æ˜¯ä¸¥æ ¼è·Ÿç€ Section èŒƒå›´èµ°çš„ï¼Œä¾‹å¦‚ä¸‹å›¾ï¼š è“è‰²é€‰ä¸­çš„èŒƒå›´æ˜¯ _UIOrthogonalScrollViewï¼Œå¯ä»¥çœ‹åˆ°æ»‘åŠ¨çš„æ—¶å€™ Cell æ˜æ˜¾è¶…å‡ºäº†å®ƒçš„èŒƒå›´ã€‚ ä¸Šæ–‡æœ‰æåˆ°è·å– _UIOrthogonalScrollView çš„æ—¶æœºï¼Œæ‚¨å¯ä»¥åœ¨è·å–åé€šè¿‡æ‰‹åŠ¨å°† clipsToBounds è®¾ç½®ä¸º ture æ¥è§£å†³è¯¥é—®é¢˜ã€‚ iOS 15 ä»¥ä¸‹ ç»ä¸å®Œå…¨æµ‹è¯•ï¼ŒiOS 14.7.1 åŠä»¥ä¸‹ç‰ˆæœ¬ç¬¦åˆè¯¥å°èŠ‚å†…å®¹ã€‚iOS 14.7.1 - iOS 15 ä¹‹é—´çš„ç‰ˆæœ¬æ²¡æœ‰ç»è¿‡æµ‹è¯•ï¼Œä¸ç¡®å®šç¬¦åˆä¸Šä¸€å°èŠ‚è¿˜æ˜¯è¯¥å°èŠ‚ã€‚ _UIOrthogonalScrollView çš„èŒƒå›´æ˜¯è·Ÿç€ UICollectionView èµ°çš„ï¼Œç”±ä¸‹å›¾æ‰€ç¤ºï¼š å’Œä¸Šä¸€å¼ å›¾å¯¹æ¯”ä¹‹åï¼Œå¯ä»¥å¾ˆæ˜æ˜¾çš„å‘ç°åŒºåˆ«ï¼ˆä»£ç ç›¸åŒï¼‰ã€‚å€¼å¾—ä¸€æçš„æ˜¯æ­¤æ—¶ _UIOrthogonalScrollView çš„ contentInset æ˜¯ .zero æ­¤æ—¶è®¾ç½® clipsToBounds å°±æ²¡æœ‰ç”¨äº†ã€‚ è·Ÿéšæ»‘åŠ¨ å¦‚æœæ‚¨å‡†å¤‡ç”¨ UICollectionViewCompositionalLayout å®ç°ç±»ä¼¼å¦‚ä¸Šå›¾çš„æ•ˆæœï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ç¡®ä¿æ»‘å—æ˜¯æ·»åŠ åˆ° _UIOrthogonalScrollView ä¸Šã€‚ è€ƒè™‘åˆ°è¯¥è§†å›¾çš„è·å–æ—¶æœºï¼Œæˆ‘å»ºè®®æ‚¨è¿˜æ˜¯æ”¹ç”¨ UICollectionViewFlowLayout å®ç°ã€‚ .continuous åŸæœ¬ä»¥ä¸ºé…åˆ UICollectionLayoutSectionOrthogonalScrollingBehavior.continuousï¼Œæœ€ç»ˆå¯ä»¥è¾¾åˆ°å’Œ UICollectionViewCompositionalLayout ä¸€æ ·çš„æ•ˆæœï¼Œä½†æ˜¯äº‹å®æ˜¯å¹¶ä¸ä¼šã€‚ æœ¬æ–‡ä½¿ç”¨çš„ä¾‹å­é‡ŒåŒ…å«ä¸€ä¸ªæ¨ªæ»‘çš„ groupï¼Œitem çš„å®½åº¦æ˜¯ group çš„ 1/3ï¼Œgroup çš„å®½åº¦å’Œ UICollectionView å®½åº¦ä¸€è‡´ã€‚ä½†æ˜¯å¦‚æœæŠŠ item çš„å®½åº¦æ”¹ä¸ºæŸä¸ªå›ºå®šçš„å€¼ï¼Œä¾‹å¦‚ 50ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç°ï¼šå±å¹•ä¸Šåªä¼šæ˜¾ç¤ºå®Œæ•´çš„ Cellã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å³ä¾§å‰©ä½™çš„å®½åº¦ä¸å¤Ÿç¬¬å››ä¸ª Cell æ˜¾ç¤ºå‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šéšè—æ‰ï¼Œåœ¨åé¢å†æ˜¾ç¤ºï¼š å¦‚æœä¸ä¿®æ”¹ orthogonalScrollingBehaviorï¼ˆå³å€¼ä¸º .noneï¼‰ï¼Œåˆ™ä¸ä¼šæœ‰è¯¥é—®é¢˜ï¼Œä½†æ˜¯ Cell åœ¨è¶…å‡ºå±å¹•åä¼šæ¢è¡Œå±•ç¤ºï¼Œå› ä¸ºæ²¡æœ‰ _UIOrthogonalScrollView ... æ‰€ä»¥å»ºè®®è¿™ç§éœ€æ±‚è¿˜æ˜¯ä½¿ç”¨ UICollectionViewFlowLayout ç»„åˆå®ç°ã€‚ æˆ–è€…æ‚¨çŸ¥é“ä»€ä¹ˆæ›´å¥½çš„æ–¹å¼ï¼Œè¯·åœ¨è¯„è®ºåŒºç•™è¨€å‘Šè¯‰æˆ‘ï¼Œè°¢è°¢ã€‚ ","link":"https://blog.rakuyo.dev/note-of-orthogonalscrollingbehavior/"},{"title":"fastlane match error: 503","content":"ä½¿ç”¨ match å‘½ä»¤æ›´æ–°å¼€å‘è¯ä¹¦çš„æ—¶å€™ï¼Œé‡åˆ°äº† 503 Service Temporarily Unavailable çš„æŠ¥é”™ï¼Œæœåˆ°è§£å†³æ–¹æ¡ˆåæƒ³ç€è¿˜æ˜¯è®°å½•ä¸€ä¸‹å§ã€‚ æœ¬æ–‡è½¬è½½è‡ª Fastlane 503 Service Temporarily Unavailable ç©¶å…¶åŸå› æ˜¯å› ä¸º match å‘½ä»¤è°ƒç”¨ Apple æœåŠ¡å¤ªé¢‘ç¹/é‡è¿‡å¤§ï¼Œå¯¼è‡´ 503 æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ã€‚ æ­¤æ—¶å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¸…é™¤ fastlane spaceship çš„ cookie æ¥è¾¾åˆ°é‡åˆ¶çš„ç›®çš„ï¼š rm $HOME/.fastlane/spaceship/*/cookie ä¹‹åé‡æ–°è°ƒç”¨ fastlane match å‘½ä»¤å³å¯ã€‚ ","link":"https://blog.rakuyo.dev/fastlane-match-error-503/"},{"title":"VPN é…ç½®åœ¨ iOS å’Œ macOS ä¸‹çš„åŒºåˆ«","content":"æœ€è¿‘å°è¯•ä½¿ç”¨ Mac Catalyst å°† App ç§»æ¤åˆ° macOS ä¸Šï¼Œæ‰“åŒ…æ—¶é‡åˆ°äº†è¯¥é—®é¢˜ï¼Œæ•…è®°å½•ä¸€ä¸‹ã€‚ åœ¨ .entitlements æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä½¿ç”¨ key com.apple.developer.networking.networkextension æ¥æ ‡è®°éœ€è¦ VPN æƒé™ã€‚ ä½†æ˜¯è¿™ä¸ª key çš„å€¼åœ¨ iOS å’Œ macOS ä¸Šæ˜¯ä¸åŒçš„ï¼š iOSï¼špacket-tunnel-provider macOSï¼špacket-tunnel-provider-systemextension åŒºåˆ«å°±åœ¨äº macOS ä¸‹å¤šäº† -systemextension è¿™éƒ¨åˆ†ï¼Œæ‰€ä»¥å¦‚æœ App æä¾› VPN åŠŸèƒ½ï¼Œé‚£ä¹ˆ Mac Catalyst å’Œé Mac Catalyst çš„ Settings å°±ä¸èƒ½ä½¿ç”¨åŒä¸€ä»½ .entitlements æ–‡ä»¶äº†ã€‚ ","link":"https://blog.rakuyo.dev/difference-between-vpn-entitlement-config-in-ios-and-macos/"},{"title":"Combine æ“ä½œç¬¦é€ŸæŸ¥è¡¨","content":"æ–‡ç« ä»¥å›¾æ–‡çš„å½¢å¼ï¼Œè®°å½• Combine ä¸­å„æ“ä½œç¬¦çš„ç”¨æ³•ä»¥åŠæ•ˆæœã€‚ä¸‹æ–‡ä¸ºåŸæ–‡ç« å†…å®¹çš„è½¬è½½ + ç¿»è¯‘ã€‚ æœ¬æ–‡è½¬è½½è‡ª Cheat sheet on s for iOS development ç‚¹å‡»æŸ¥çœ‹åŸæ–‡ä»¥æ›´å¥½çš„æ•ˆæœæŸ¥çœ‹å†…å®¹ã€‚ allSatisfy(_:) Publishes true if all elements match the condition. Publishes false &amp; completes if it receives an element that does not match the condition. å¦‚æœæ‰€æœ‰çš„å…ƒç´ éƒ½ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å› trueã€‚å¦‚æœæ”¶åˆ°ä¸€ä¸ªä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œåˆ™è¿”å› false å¹¶å®Œæˆä¿¡å·ã€‚ append(_:) Appends the specified elements after the upstream publisher completes. åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåæ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€‚ collect(_:) Collects up to the specified number of elements and emits them in an array. æ”¶é›†å¤šè¾¾æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œå¹¶å°†å®ƒä»¬å‘å°„åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ combineLatest(_:) Publishes a tuple of the most recent element from multiple publishers when any of them emits a value. å½“ä»»ä½•ä¸€ä¸ªå‘å¸ƒè€…å‘å‡ºä¸€ä¸ªå€¼æ—¶ï¼Œå‘å¸ƒä¸€ä¸ªæ¥è‡ªå¤šä¸ªå‘å¸ƒè€…çš„æœ€æ–°å…ƒç´ çš„å…ƒç»„ã€‚ compactMap(_:) Transforms each element with the provided closure and publishes any returned non-nil optional result. ç”¨æä¾›çš„é—­åŒ…å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ï¼Œå¹¶å…¬å¸ƒä»»ä½•è¿”å›çš„éé›¶çš„å¯é€‰ç»“æœã€‚ contains(_:) Publishes true &amp; completes after receiving a matching value, or false when upstream publisher completes without producing a matching value. åœ¨æ”¶åˆ°ä¸€ä¸ªåŒ¹é…çš„å€¼åå‘å¸ƒçœŸå€¼&amp;å®Œæˆï¼Œæˆ–è€…åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåæ²¡æœ‰äº§ç”Ÿä¸€ä¸ªåŒ¹é…çš„å€¼æ—¶å‘å¸ƒå‡å€¼ã€‚ count() Publishes the count of all received elements when the upstream publisher completes. å½“ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆæ—¶ï¼Œå‘å¸ƒæ‰€æœ‰æ”¶åˆ°çš„å…ƒç´ çš„è®¡æ•°ã€‚ dropFirst(_:) Omits a specified number of elements, then republishes all remaining elements. çœç•¥æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œç„¶åé‡æ–°å‘å¸ƒæ‰€æœ‰å‰©ä½™çš„å…ƒç´ ã€‚ drop(while:) Omits elements until a given closure returns false, then republishes all remaining elements. çœç•¥å…ƒç´ ï¼Œç›´åˆ°ä¸€ä¸ªç»™å®šçš„é—­åŒ…è¿”å›é”™è¯¯ï¼Œç„¶åé‡æ–°å‘å¸ƒæ‰€æœ‰å‰©ä½™çš„å…ƒç´ ã€‚ filter(_:) Republishes all elements that match a provided closure. é‡æ–°å‘å¸ƒæ‰€æœ‰ç¬¦åˆæ‰€æä¾›çš„é—­åŒ…çš„å…ƒç´ ã€‚ first() Publishes the first element of the upstream publisher, then completes. å‘å¸ƒä¸Šæ¸¸å‘å¸ƒå™¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå®Œæˆã€‚ first(where:) Publishes the first element of a stream that satisfies a condition, then completes. å‘å¸ƒä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æµçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå®Œæˆã€‚ flatMap(maxPublishers:_:) Transforms all elements from an upstream publisher into a new publisher. å°†ä¸Šæ¸¸å‘å¸ƒå™¨ä¸­çš„æ‰€æœ‰å…ƒç´ è½¬åŒ–ä¸ºä¸€ä¸ªæ–°çš„å‘å¸ƒå™¨ã€‚ ignoreOutput() Ignores all elements and passes along only the upstream publisher's completion state. å¿½ç•¥æ‰€æœ‰å…ƒç´ ï¼Œåªä¼ é€’ä¸Šæ¸¸å‘å¸ƒè€…çš„å®ŒæˆçŠ¶æ€ã€‚ last() Publishes the last element of the upstream publisher after it completes. åœ¨ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆåï¼Œå‘å¸ƒå®ƒçš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ last(where:) Publishes the last element that satisfies a condition after the upstream publisher completes. åœ¨ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆåï¼Œå‘å¸ƒæ»¡è¶³æ¡ä»¶çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ map(_:) Transforms each element it receives from the upstream publisher with the provided closure. ç”¨æ‰€æä¾›çš„é—­åŒ…å¯¹å®ƒä»ä¸Šæ¸¸å‘å¸ƒè€…é‚£é‡Œæ”¶åˆ°çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œè½¬æ¢ã€‚ max() Publishes the maximum value received after the upstream publisher completes. åœ¨ä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåï¼Œå‘å¸ƒæ”¶åˆ°çš„æœ€å¤§å€¼ã€‚ merge(with:) Publishes an element whenever any of the upstream publishers emits an element. æ¯å½“ä»»ä½•ä¸€ä¸ªä¸Šæ¸¸å‘å¸ƒè€…å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œå°±å‘å¸ƒä¸€ä¸ªå…ƒç´ ã€‚ min() Publishes the minimum value received after the upstream publisher completes. å‘å¸ƒä¸Šæ¸¸å‘å¸ƒè€…å®Œæˆåæ”¶åˆ°çš„æœ€å°å€¼ã€‚ output(at:) Republishes an element specified by its position, or completes if upstream publisher completes before the specified element. é‡æ–°å‘å¸ƒä¸€ä¸ªç”±å…¶ä½ç½®æŒ‡å®šçš„å…ƒç´ ï¼Œå¦‚æœä¸Šæ¸¸å‘å¸ƒè€…åœ¨æŒ‡å®šçš„å…ƒç´ ä¹‹å‰å®Œæˆï¼Œåˆ™å®Œæˆã€‚ output(in:) Republishes elements specified by a range of positions. é‡æ–°å‘å¸ƒç”±æŸä¸ªä½ç½®èŒƒå›´æŒ‡å®šçš„å…ƒç´ ã€‚ prefix(_:) Republishes elements up to a specified maximum count. é‡æ–°å‘å¸ƒå…ƒç´ ï¼Œç›´åˆ°æŒ‡å®šçš„æœ€å¤§æ•°é‡ã€‚ prefix(while:) Emits values while elements meet the specified condition, otherwise it completes. å½“å…ƒç´ æ»¡è¶³æŒ‡å®šçš„æ¡ä»¶æ—¶å‘å‡ºæ•°å€¼ï¼Œå¦åˆ™å°±ä¼šå®Œæˆã€‚ prepend(_:) Prepends elements with the specified values. ç”¨æŒ‡å®šçš„å€¼å¯¹å…ƒç´ è¿›è¡Œé¢„ç½®ã€‚ reduce(_:_:) Applies a closure to all elements and publishes a final result when the upstream publisher completes. å¯¹æ‰€æœ‰å…ƒç´ åº”ç”¨ä¸€ä¸ªé—­åŒ…ï¼Œå¹¶åœ¨ä¸Šæ¸¸å‘å¸ƒå™¨å®Œæˆåå‘å¸ƒä¸€ä¸ªæœ€ç»ˆç»“æœã€‚ removeDuplicates() Publishes an element only if it doesn't match the previous element. åªåœ¨ä¸€ä¸ªå…ƒç´ ä¸å‰ä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…æ—¶æ‰å‘å¸ƒã€‚ replaceNil(with:) Replaces nil elements with the provided element. ç”¨æ‰€æä¾›çš„å…ƒç´ æ›¿æ¢nilå…ƒç´ ã€‚ scan(_:_:) Transforms elements by applying a closure that receives its previous return value and the next element from the upstream publisher. é€šè¿‡åº”ç”¨ä¸€ä¸ªé—­åŒ…æ¥è½¬æ¢å…ƒç´ ï¼Œè¯¥é—­åŒ…ä»ä¸Šæ¸¸å‘å¸ƒè€…é‚£é‡Œæ¥æ”¶å…¶å…ˆå‰çš„è¿”å›å€¼å’Œä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ switchToLatest() Republishes elements sent by the most recently received publisher. é‡æ–°å‘å¸ƒç”±æœ€è¿‘æ”¶åˆ°çš„å‘å¸ƒè€…å‘é€çš„å…ƒç´ ã€‚ zip(_:) Waits until both publishers emit an element, then publishes the oldest unconsumed element from each one as a tuple. ç­‰å¾…ï¼Œç›´åˆ°ä¸¤ä¸ªå‘å¸ƒè€…éƒ½å‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç„¶åå°†æ¯ä¸ªå‘å¸ƒè€…ä¸­æœ€å¤è€çš„æœªè¢«å¸æ”¶çš„å…ƒç´ ä½œä¸ºä¸€ä¸ªå…ƒç»„å‘å¸ƒã€‚ ","link":"https://blog.rakuyo.dev/cheatsheet-combine-operators/"},{"title":"GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner","content":" æœ¬æ–‡é’ˆå¯¹ GitLab-Runner çš„é…ç½®è¿›è¡Œè®²è§£è¯´æ˜ã€‚ GitLab-CI ç³»åˆ—æ–‡ç« ç›®å‰æœ‰ä¸‰ç¯‡ï¼Œä¸»è¦è®²è§£ GitLab-CI çš„ç¯å¢ƒæ­å»ºä¸é…ç½®ã€‚æœ¬æ–‡ä¸ºè¯¥ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ã€‚ ç›®å½•ï¼š GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner config.tom æ–‡ä»¶é…ç½® åœ¨ç»ˆç«¯å†…è¾“å…¥ gitlab-runner list å‘½ä»¤ï¼Œè·å–åˆ° config.toml æ–‡ä»¶è·¯å¾„ï¼Œåç»­å°†é’ˆå¯¹è¯¥æ–‡ä»¶è¿›è¡Œè®²è§£è¯´æ˜ã€‚ concurrent è¯¥æ–‡ä»¶é¡¶éƒ¨çš„ concurrent å­—æ®µæ„å‘³ç€æœ¬å°æœºå™¨æœ€å¤šå¯ä»¥åŒæ—¶è¿è¡Œçš„ä½œä¸šæ•°é‡ã€‚ è¯·æ ¹æ®éœ€æ±‚ä¸ CI æœºå™¨çš„æ€§èƒ½ä¿®æ”¹è¯¥å­—æ®µã€‚ ä¾‹å¦‚ concurrent = 2 æ„å‘³ç€ â€œè¯¥å°ç”µè„‘åŒä¸€æ—¶é—´åªèƒ½è¿è¡Œ2ä¸ªä½œä¸šâ€ã€‚è€ƒè™‘åˆ°å®é™…æƒ…å†µï¼ˆä¸€ä¸ªä½œä¸šå¯¹åº”ä¸€ä¸ªæ‰“åŒ…ä»»åŠ¡ï¼‰ï¼Œå³åŒä¸€æ—¶é—´å†…åªèƒ½åŒæ—¶æ‰“2ä¸ªåŒ…ã€‚ å»ºè®®8gå†…å­˜çš„æœºå™¨å°†è¯¥å€¼è®¾ç½®ä¸º2ï¼Œä»¥ä¸Šå†…å­˜çš„æœºå™¨å¯å°†è¯¥å€¼è®¾ç½®ä¸º4ã€‚ runners name å³æ³¨å†Œ Runner æ—¶å¡«å†™çš„ descriptionï¼Œå¯é€šè¿‡ä¿®æ”¹è¯¥å€¼è¾¾åˆ°ä¿®æ”¹ Runner åç§°çš„ç›®çš„ã€‚ åœ¨ä¸‹æ–‡ä»‹ç»çš„æè¿°ä¸­ï¼Œä¹Ÿå¯ä¿®æ”¹ã€‚ åœ¨ GitLab - CI/CD ç•Œé¢é…ç½® æ‰¾åˆ°ç¾¤ç»„/é¡¹ç›®å·¦ä¾§å¯¼èˆªæ æœ€ä¸‹æ–¹çš„è®¾ç½®æŒ‰é’®ï¼Œä¾æ¬¡é€‰æ‹© â€œè®¾ç½®ï¼ˆSettingsï¼‰ -&gt; CI/CD -&gt; Runnersâ€ï¼Œè¿›å…¥ Runner è®¾ç½®é¡µé¢ã€‚ æ‰¾åˆ°éœ€è¦ç¼–è¾‘/é…ç½®çš„ Runnerï¼Œç‚¹å‡»å³ä¾§é“…ç¬”å½¢çŠ¶çš„ â€œç¼–è¾‘æŒ‰é’®â€ï¼Œè¿›å…¥ç¼–è¾‘é¡µé¢ã€‚ å¯ç”¨ é€šè¿‡å‹¾é€‰æˆ–å–æ¶ˆå‹¾é€‰è¯¥é€‰é¡¹ï¼Œå¯å¼€å¯/å…³é—­è¯¥ Runnerï¼Œè¢«å…³é—­çš„ Runner å°†æ— æ³•æ¥æ”¶æ–°çš„ä»»åŠ¡ã€‚ æè¿° å³æ³¨å†Œ Runner æ—¶å¡«å†™çš„ descriptionï¼Œå¯é€šè¿‡ä¿®æ”¹è¯¥å€¼è¾¾åˆ°ä¿®æ”¹ Runner åç§°çš„ç›®çš„ã€‚ æœ€å¤§ä½œä¸šè¶…æ—¶ å¯è®¾ç½®ä»»åŠ¡è¶…æ—¶æ—¶é—´ã€‚ è¶…æ—¶æ—¶é—´æœ‰3ç§ï¼š Runner å¤„é…ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œå³æ­¤å¤„é…ç½®çš„è¶…æ—¶æ—¶é—´ã€‚ä¼˜å…ˆçº§æœ€é«˜ã€‚ Git é¡¹ç›®çš„è¶…æ—¶æ—¶é—´ï¼Œå¯åœ¨ â€œè®¾ç½®ï¼ˆSettingsï¼‰ -&gt; CI/CD -&gt; æµæ°´çº¿é€šç”¨è®¾ç½®â€ å¤„è¿›è¡Œè®¾ç½®ã€‚ä¼˜å…ˆçº§æœ€ä½ã€‚ ä»»åŠ¡çš„è¶…æ—¶æ—¶é—´ï¼Œåœ¨å…·ä½“çš„ .yml æ–‡ä»¶ä¸­è®¾ç½®ã€‚ä¼˜å…ˆçº§å±…ä¸­ã€‚ ä¾‹å¦‚ï¼š Runner é…ç½®äº† 2å°æ—¶ è¶…æ—¶ è¯¥ git é¡¹ç›®é…ç½®äº† 1å°æ—¶ è¶…æ—¶ æ‰€è¦æ‰§è¡Œçš„ä»»åŠ¡é…ç½®äº† 1.5å°æ—¶ è¶…æ—¶ åˆ™ä½¿ç”¨è¯¥ Runner æ‰§è¡Œçš„ä»»åŠ¡çš„æœ€ç»ˆè¶…æ—¶æ—¶é—´ä¸º 1.5 å°æ—¶ã€‚ æ ‡ç­¾ å¯é…ç½®è¯¥ Runner å¯æ¥æ”¶çš„ä»»åŠ¡çš„æ ‡ç­¾ã€‚ä¸€ä¸ª Runner å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œä¹‹é—´ç”¨ , å·è¿›è¡Œåˆ†å‰²ã€‚ åªæœ‰å½“ Runner çš„æ ‡ç­¾åˆ—è¡¨åŒ…å«å°†è¦æ‰§è¡Œçš„ä»»åŠ¡çš„æ ‡ç­¾æ—¶ï¼Œæ‰ä¼šé€‰æ‹©è¯¥ Runner å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚å¦åˆ™å³ä½¿è¯¥ Runer å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè¢«ä½¿ç”¨ã€‚ ","link":"https://blog.rakuyo.dev/gitlab-ci-config-runner/"},{"title":"GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner","content":" æœ¬æ–‡ä»…é’ˆå¯¹ macOS å’Œ Linux å¹³å°ï¼Œè®²è§£å¦‚ä½•æ³¨å†Œ GitLab-Runnerã€‚Windows å¹³å°ä¸åŒ…å«åœ¨æœ¬æ–‡ä»‹ç»èŒƒå›´å†…ã€‚ GitLab-CI ç³»åˆ—æ–‡ç« ç›®å‰æœ‰ä¸‰ç¯‡ï¼Œä¸»è¦è®²è§£ GitLab-CI çš„ç¯å¢ƒæ­å»ºä¸é…ç½®ã€‚æœ¬æ–‡ä¸ºè¯¥ç³»åˆ—çš„ç¬¬äºŒç¯‡ã€‚ ç›®å½•ï¼š GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner Runner çš„åˆ†ç±» Runner æŒ‰ç…§é€‚ç”¨èŒƒå›´åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š é¡¹ç›® Runnerï¼šä»…æŸä¸ªé¡¹ç›®å¯ä»¥ä½¿ç”¨è¯¥ Runnerï¼Œå…¶ä»–é¡¹ç›®ä¸å¯ä½¿ç”¨ã€‚ ç¾¤ç»„ Runnerï¼šæŸä¸ªç¾¤ç»„ä¸‹çš„é¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨è¯¥ Runnerï¼Œå…¶ä»–ç¾¤ç»„ä¸‹çš„é¡¹ç›®ä¸å¯ä½¿ç”¨ã€‚ å…±äº« Runnerï¼šæ•´ä¸ª GitLab ç³»ç»Ÿä¸­çš„æ‰€æœ‰é¡¹ç›®éƒ½å¯ä»¥ä½¿ç”¨è¯¥ Runnerã€‚ æ³¨å†Œ Runner å‰æœŸå‡†å¤‡ æ‰“å¼€å¹¶ç™»å½• GitLabã€‚ æ€è€ƒä½ éœ€è¦æ³¨å†Œå“ªç§ Runnerã€‚ å¦‚æœä½ éœ€è¦æ³¨å†Œç¬¬ä¸€ç§ â€œé¡¹ç›® Runnerâ€ï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰“å¼€æŸä¸ªå…·ä½“çš„ git é¡¹ç›®ã€‚ å¦‚æœä½ éœ€è¦æ³¨å†Œç¬¬äºŒç§ â€œç¾¤ç»„ Runnerâ€ï¼Œé‚£ä¹ˆä½ éœ€è¦æ‰“å¼€æŸä¸ªå…·ä½“çš„ç¾¤ç»„ã€‚ æ‰¾åˆ°å·¦ä¾§å¯¼èˆªæ æœ€ä¸‹æ–¹çš„è®¾ç½®æŒ‰é’®ï¼Œä¾æ¬¡é€‰æ‹© â€œè®¾ç½®ï¼ˆSettingsï¼‰ -&gt; CI/CD -&gt; Runnersâ€ã€‚ ç‚¹å‡» Runner å³ä¾§çš„ â€œå±•å¼€â€ æŒ‰é’®ã€‚ åœ¨å±•å¼€å†…å®¹çš„å·¦ä¾§ï¼Œæ‰¾åˆ° â€œSet up a specific Runner manuallyâ€ ä¸­çš„å†…å®¹ã€‚ åç»­å°†ä½¿ç”¨ â€œSet up a specific Runner manuallyâ€ ä¸­çš„å†…å®¹æ³¨å†Œ Runnerã€‚ æ³¨å†Œ åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¼€å§‹æ³¨å†Œæµç¨‹ï¼š æ³¨æ„ï¼š å¦‚æœæ˜¯åœ¨ Linux å¹³å°ä¸Šæ³¨å†Œï¼Œè¯·ä½¿ç”¨ sudo æ‰§è¡Œ register å‘½ä»¤ï¼ŒmacOS åˆ™ç›´æ¥æ‰§è¡Œä¸‹æ–¹å‘½ä»¤å³å¯ã€‚ gitlab-runner register é’ˆå¯¹é¡¶éƒ¨é»„è‰²WARNINGè­¦å‘Šçš„è¯´æ˜è¯·å‚è€ƒï¼šé¡¶éƒ¨é»„è‰²WARNINGè­¦å‘Šã€‚ 1. è¾“å…¥ GitLab URL æ‰§è¡Œå®Œå‘½ä»¤åï¼Œé¦–å…ˆè¦æ±‚è¾“å…¥ GitLab çš„ urlã€‚å¡«å…¥ä½ ä»¬ GitLab çš„åœ°å€å³å¯ã€‚ ç»†å¿ƒçš„ä½ å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œâ€œSet up a specific Runner manuallyâ€ ä¸­çš„ url æ˜¯ httpï¼Œè¿™é‡Œå†™çš„å´æ˜¯ httpsã€‚ å…¶å®æ­£ç¡®çš„åº”è¯¥æ˜¯ httpsã€‚å¦‚æœä½ ä½¿ç”¨ http è¿›è¡Œæ³¨å†Œï¼Œé‚£ä¹ˆè¿›è¡Œåˆ°æœ€åä½ å°†æ”¶åˆ° â€œè®¤è¯å¤±è´¥â€ çš„é”™è¯¯ã€‚ 2. è¾“å…¥ Token è¿™é‡Œçš„ token æ¥è‡ª â€œå‰æœŸå‡†å¤‡â€ ä¸€èŠ‚ä¸­ â€œSet up a specific Runner manuallyâ€ é‡Œæ˜¾ç¤ºçš„ Tokenã€‚ å¤åˆ¶è¯¥ token å¹¶è´´å…¥è¿™é‡Œï¼ŒæŒ‰å›è½¦è¿›å…¥ä¸‹ä¸€æ­¥ã€‚ 3. ç»™ Runner èµ·ä¸€ä¸ªåå­— è¯¥å€¼åç»­å¯è¿›è¡Œä¿®æ”¹ï¼Œè¯¦è§ é…ç½® GitLab-Runner ç¬¬ä¸‰æ­¥è¦æ±‚è¾“å…¥ä¸€ä¸ª description æè¿°ï¼Œå…¶å®ç†è§£ä¸º Runner çš„åå­—ä¼šæ›´å¥½ä¸€ç‚¹ã€‚ ä¸€èˆ¬ä½¿ç”¨è‹±æ–‡ï¼Œä¾‹å¦‚ â€œsever_xxx_ios_project_spareâ€ã€‚ 4. è®¾ç½® Runner çš„æ ‡ç­¾ è¯¥å€¼åç»­å¯è¿›è¡Œä¿®æ”¹ï¼Œè¯¦è§ é…ç½® GitLab-Runner æ ‡ç­¾åˆ—è¡¨ï¼ˆtagï¼‰å†³å®šç€ Runner å¯ä»¥æ‰§è¡Œå“ªäº›ä»»åŠ¡ï¼ˆjobï¼‰ã€‚ åœ¨è¿™ä¸€æ­¥æ‚¨å¯ä»¥è®¾ç½®å¤šä¸ªæ ‡ç­¾ï¼Œä¹‹é—´ä½¿ç”¨ , å·åˆ†å‰²å³å¯ã€‚ ä¸€ä¸ªæ¸…æ™°ã€ç®€çŸ­å¹¶ä¸”å¯ä»¥è¡¨è¾¾ Runner èŒè´£çš„æ ‡ç­¾åæ‰æ˜¯ä¸€ä¸ªå¥½çš„æ ‡ç­¾åã€‚ é’ˆå¯¹ tag çš„ç®€å•è¯´æ˜ ä¸Šæ–‡æœ‰æåˆ°ï¼ŒRunner é¦–å…ˆä¼šè¢«é¡¹ç›®ã€ç¾¤ç»„ç­‰èŒƒå›´é™åˆ¶ç€ã€‚ ä½†æ˜¯è¿™æ ·è¿˜ä¸å¤Ÿï¼Œåœ¨ä¸‹é¢è¿™ä¸ªç°å®åœºæ™¯ä¸­ï¼Œå°±ä¼šæœ‰å¾ˆå¤šé—®é¢˜ï¼š å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªâ€œé¡¹ç›®Runnerâ€ï¼š è¯¥ git é¡¹ç›®è®¾ç½®äº†å¤šä¸ªCI/CDä»»åŠ¡ è¯¥ git é¡¹ç›®å†…è¿˜æ³¨å†Œäº†å¤šä¸ª Runnerï¼Œç”šè‡³è¿˜æœ‰ç»§æ‰¿è‡ªç¾¤ç»„çš„ Runner æ­¤æ—¶å¦‚æœä½ æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œéœ€è¦ä»»åŠ¡Aå¿…é¡»æ‰§è¡Œåœ¨RunnerAä¸Šï¼Œè¯¥å¦‚ä½•åšï¼Ÿ è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ â€œæ ‡ç­¾â€ æ¥åšåˆ°è¿™ç‚¹ï¼Œåªéœ€è¦ç¡®ä¿RunnerAçš„æ ‡ç­¾åŒ…å«ä»»åŠ¡Açš„æ ‡ç­¾å³å¯ã€‚ åªæœ‰å½“ Runner çš„æ ‡ç­¾åˆ—è¡¨åŒ…å«å°†è¦æ‰§è¡Œçš„ä»»åŠ¡çš„æ ‡ç­¾æ—¶ï¼Œæ‰ä¼šé€‰æ‹©è¯¥ Runner å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚å¦åˆ™å³ä½¿è¯¥ Runer å¤„äºç©ºé—²çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šè¢«ä½¿ç”¨ã€‚ 5. æ— è§†è¿™ä¸€æ­¥ ç›´æ¥æŒ‰å›è½¦å³å¯ã€‚ 6. é€‰æ‹©æ‰§è¡Œå™¨ å½“ä½ è¾“å…¥æ­£ç¡®çš„ url å’Œ tokenï¼Œé‚£ä¹ˆä½ å°†æœ€åä¸€æ­¥ï¼šé€‰æ‹© Runner çš„æ‰§è¡Œå™¨ï¼š åœ¨è¿™ä¸€æ­¥è¾“å…¥ä½ æƒ³é€‰æ‹©çš„æ‰§è¡Œå™¨çš„åç§°ï¼Œè¾“å…¥å›è½¦å³å¯å®Œæˆ Runner çš„æ³¨å†Œã€‚ æœ‰å…³æ‰§è¡Œå™¨çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚è€ƒ GitLab çš„å®˜æ–¹æ–‡æ¡£ã€‚è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹æ¯”è¾ƒå¸¸ç”¨çš„ä¸¤ç§æ‰§è¡Œå™¨ï¼šshell å’Œ dockerã€‚ shell shell æ‰§è¡Œå™¨æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š å½“å‰ä»»åŠ¡åœ¨ æœ¬æœºçš„shellç¯å¢ƒ ä¸‹æ‰§è¡Œï¼Œæ„å‘³ç€å½“å‰ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶å°†ç›´æ¥ç”Ÿæˆåœ¨æœ¬æœºè·¯å¾„å†…ï¼Œä¸éœ€è¦åšä»»ä½•å¤–çš„é…ç½®ï¼Œä»»åŠ¡å°±å¯ä»¥è®¿é—®æœ¬æœºä¸­ä»»æ„æ–‡ä»¶ã€‚ æ¯ä¸ªä»»åŠ¡å’Œæ¯ä¸ªä»»åŠ¡ä¹‹é—´æ²¡æœ‰éš”ç¦»ï¼Œæ„å‘³ç€å½“å‰ä»»åŠ¡ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–é…ç½®ï¼Œå°±èƒ½å¤Ÿè¢«ä¸‹ä¸ªä»»åŠ¡ç›´æ¥è¯»å–ä½¿ç”¨ã€‚ shell æ‰§è¡Œå™¨ä¸€èˆ¬ç”¨äºæ‰§è¡Œçº¯ shell å‘½ä»¤ã€è„šæœ¬ï¼ŒåŒæ—¶å¯¹ä»»åŠ¡ä¹‹é—´çš„éš”ç¦»ä¸æ•æ„Ÿçš„ä»»åŠ¡ã€‚ iOSã€macOS App æ‰“åŒ…å¿…é¡»é€‰æ‹© shell æ‰§è¡Œå™¨ï¼Œæ— æ³•ä½¿ç”¨ docker æ‰§è¡Œã€‚ docker ç®€å•åœ°ã€æŒ‰ç…§æœ¬æ–‡ä½œè€…çš„ä¸ªäººç†è§£ï¼Œè§£é‡Šä¸€ä¸‹ docker æ˜¯ä»€ä¹ˆï¼š docker æŠ€æœ¯å³å®¹å™¨æŠ€æœ¯ï¼ŒåŸºäº docker å¯ä»¥å¿«é€Ÿåœ°é…ç½®å¥½ç”¨æˆ·æ‰€éœ€çš„å¼€å‘ç¯å¢ƒï¼ŒåŒæ—¶åŸºäº dockerï¼Œå¯ä»¥å®ç°å®¹å™¨ä¸å®¹å™¨ä¹‹é—´çš„éš”ç¦»ã€‚ å½“æˆ‘ä»¬é€‰æ‹© docker æ‰§è¡Œå™¨åï¼Œä¸‹ä¸€æ­¥ä¼šè®©æˆ‘ä»¬å¡«å†™ä¸€ä¸ªé»˜è®¤çš„ docker é•œåƒåç§°ï¼Œè¯¥åç§°åç»­å¯æ›´æ”¹ã€‚ Android æ‰“åŒ…ã€ä¸Šä¼  bugly ç­‰æ“ä½œå‡å¯ä½¿ç”¨ docker æ‰§è¡Œå™¨æ‰§è¡Œã€‚ æ€»ç»“ iOSã€macOS App æ‰“åŒ…åªèƒ½é€‰æ‹© shellã€‚ ä¸éœ€è¦è€ƒè™‘ä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´äº’ç›¸éš”ç¦»çš„ã€è½»é‡åŒ–çš„ä»»åŠ¡å¯ä»¥é€‰æ‹© shellã€‚ éœ€è¦å¤æ‚çš„å¼€å‘ç¯å¢ƒï¼Œä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´éœ€è¦äº’ç›¸éš”ç¦»ï¼Œæˆ–è€…è¾ƒä¸ºç¹æ‚çš„ä»»åŠ¡å¯ä»¥é€‰æ‹© dockerã€‚ é¡¶éƒ¨é»„è‰²WARNINGè­¦å‘Š é¦–å…ˆï¼Œå¦‚æœæ˜¯åœ¨ macOS ç¯å¢ƒä¸‹ï¼Œé‚£ä¹ˆæ— è§†è¯¥è­¦å‘Šå³å¯ï¼› å¦‚æœæ˜¯åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œåˆ™æ˜¯å› ä¸ºæ‰§è¡Œ gitlab-runner register å‘½ä»¤æ—¶æ²¡æœ‰æ·»åŠ  sudo å¯¼è‡´çš„ï¼Œä¸­æ–­å½“å‰æµç¨‹ï¼Œé‡æ–°æ‰§è¡Œ sudo gitlab-runner register å³å¯ã€‚ é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼ŒiOS æ‰“åŒ…å¿…é¡»åœ¨ shell ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œæ‰“åŒ…è¿‡ç¨‹ä¸­ä½¿ç”¨å½“å‰ç”¨æˆ·ç”³è¯·å»æ‰§è¡Œç›¸å…³ gitlab-runner å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨æ³¨å†Œ runner æ—¶ï¼Œæ— æ³•ä½¿ç”¨ sudo æ‰§è¡Œã€‚ GitLab-Runner æ²¡æœ‰å¯¹æ­¤è¿›è¡Œé¢å¤–çš„åˆ¤æ–­ï¼Œæ‰€ä»¥åªè¦ä¸åŠ  sudoï¼Œå°±æ˜¯ user-modeï¼Œå°±ä¼šè¾“å‡ºè¯¥è­¦å‘Šã€‚ ","link":"https://blog.rakuyo.dev/gitlab-ci-register-runner/"},{"title":"GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ","content":" æœ¬æ–‡æ¡£ç”¨äºä»‹ç»å¦‚ä½•æ­å»ºé€‚ç”¨äºæ„å»º iOS é¡¹ç›®çš„ GitLab-CI ç¯å¢ƒã€‚ GitLab-CI ç³»åˆ—æ–‡ç« ç›®å‰æœ‰ä¸‰ç¯‡ï¼Œä¸»è¦è®²è§£ GitLab-CI çš„ç¯å¢ƒæ­å»ºä¸é…ç½®ã€‚æœ¬æ–‡ä¸ºè¯¥ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ã€‚ ç›®å½•ï¼š GitLab-CIï¼ˆä¸€ï¼‰ï¼šæ­å»º iOS CI ç¯å¢ƒ GitLab-CIï¼ˆäºŒï¼‰ï¼šæ³¨å†Œ GitLab-Runner GitLab-CIï¼ˆä¸‰ï¼‰ï¼šé…ç½® GitLab-Runner macOS æ„å»º iOS é¡¹ç›®å¿…é¡»è¦åŸºäº macOS æ“ä½œç³»ç»Ÿã€‚ æ— æ³•ä¸Šäº‘ï¼ˆå› ä¸ºå…¬æœ‰äº‘ä¸æ”¯æŒ CPU è™šæ‹ŸåŒ–ï¼‰ï¼Œä¸”ç›®å‰æ²¡æœ‰æä¾›çš„ macOS æœåŠ¡å™¨ï¼Œæ•…éœ€è¦ä¸€å°æœ¬åœ°ç¡¬ä»¶æ¥æä¾› CI/CD æœåŠ¡ã€‚ æœ€ä½è¦æ±‚ macOS çš„ç³»ç»Ÿç‰ˆæœ¬è¦æ±‚ç¬¦åˆå¼€å‘æ‰€ä½¿ç”¨çš„ Xcode æ‰€è¦æ±‚çš„æœ€ä½ç³»ç»Ÿç‰ˆæœ¬ã€‚ å› ä¸ºä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªå¼€å‘ç»„å†…çš„ç³»ç»Ÿç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œæ•… CI æœºå™¨çš„ç³»ç»Ÿç‰ˆæœ¬åº”å½“å°½é‡ä¿æŒä¸€è‡´ã€‚ å¯æŸ¥é˜… Apple å®˜æ–¹çš„ Xcode - æ”¯æŒ æ–‡æ¡£ï¼ŒæŸ¥çœ‹ç³»ç»Ÿæœ€ä½è¦æ±‚ã€‚ å¦‚æœä½¿ç”¨ Xcode 14.2 &amp; macOS 13 ç‰ˆæœ¬çš„ç³»ç»Ÿè¿›è¡Œå¼€å‘ï¼Œåˆ™ CI æœºå™¨æœ€ä½åº”ä½¿ç”¨ macOS 12.5 ç‰ˆæœ¬ã€‚ ç¿»å¢™ VPN å› ä¸ºåç»­è¯¸å¤šæ­¥éª¤éœ€è¦ç¿»å¢™æ‰èƒ½æé«˜è®¿é—®é€Ÿåº¦ï¼Œç”šè‡³éœ€è¦ç¿»å¢™æ‰èƒ½å®‰è£…æˆåŠŸï¼Œæ‰€ä»¥å»ºè®®å…ˆæŠŠç¿»å¢™VPNé…ç½®å¥½ã€‚ å¼€å‘ç¯å¢ƒ Xcode åœ¨ macOS ä¸Šï¼ŒXcode æ˜¯å¤§éƒ¨åˆ†ç¼–ç¨‹ç¯å¢ƒçš„åŸºç¡€ï¼›Xcode åŒ…å«ä¾‹å¦‚ git åœ¨å†…çš„ä¸€ç³»åˆ—å¼€å‘å·¥å…·ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥æˆ‘ä»¬åº”å½“å…ˆä¸‹è½½ Xcodeï¼Œä¹‹åå†æ‰§è¡Œå…¶ä»–æ“ä½œã€‚ é€šè¿‡ Mac App Store ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Xcodeï¼Œæˆ–å»å®˜ç½‘ä¸‹è½½å¯¹åº”ç‰ˆæœ¬çš„ Xcodeã€‚ å¦‚ä¸Šæ‰€è¿°ï¼ŒCI æœºå™¨ä¸Šçš„ Xcode ç‰ˆæœ¬åº”å½“ä¸å¼€å‘æ‰€ä½¿ç”¨çš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚ ä¸‹è½½å®‰è£…å¥½ Xcode ä¹‹åï¼Œåº”å½“å…ˆæ‰“å¼€ä¸€æ¬¡ Xcodeï¼Œå®Œæˆåç»­æµç¨‹ï¼Œç›´è‡³çœ‹åˆ°æ¬¢è¿é¡µé¢ã€‚ å‘½ä»¤è¡Œå·¥å…· æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£… Xcode å‘½ä»¤è¡Œå·¥å…·ï¼š xcode-select --install åœ¨å¼¹å‡ºçš„å¼¹çª—å†…ï¼Œé€‰æ‹©å®‰è£…ï¼Œå¹¶æ ¹æ®æç¤ºå®Œæˆåç»­å®‰è£…å³å¯ã€‚ Git é…ç½® å®‰è£… Xcode çš„è¿‡ç¨‹ä¸­ï¼Œå°†è‡ªåŠ¨å®‰è£… git æœåŠ¡ã€‚æ­¤æ—¶æ‚¨éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­è¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®ï¼š git config --global user.name &quot;gitè´¦æˆ·å&quot; git config --global user.email &quot;æ³¨å†Œgitæ‰€ç”¨é‚®ç®±&quot; SSH æ‚¨éœ€è¦é…ç½® SSHï¼Œå°†æœ¬æœºçš„ SSH æ·»åŠ åˆ° GitLab ç³»ç»Ÿä¸­ã€‚ é¦–å…ˆè¿›å…¥ .ssh ç›®å½•ï¼š cd ~/.ssh # å¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦æ‚¨æ‰‹åŠ¨ä½¿ç”¨ mkdir ~/.ssh è¿›è¡Œåˆ›å»º æ¥ç€åˆ›å»º ssh æ–‡ä»¶ï¼š ssh-keygen -t rsa -C &quot;æ³¨å†Œgitæ‰€ç”¨é‚®ç®±&quot; è¾“å…¥å‘½ä»¤ä¹‹åï¼Œè¿ç»­æ•²å‡»3ä¸ªå›è½¦å®Œæˆåˆ›å»ºï¼ˆè¯·å‹¿è®¾ç½®å¯†ç ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜ï¼‰ æœ€åï¼Œä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„å…¬é’¥ï¼Œå¹¶å¤åˆ¶åˆ° GitLab ä¸­å³å¯ï¼š cat id_rsa.pub ç¯å¢ƒåˆå§‹åŒ– åšä¸»è‡ªå·±å†™äº†ä¸€ä¸ªç”¨äºåˆå§‹åŒ–ç¯å¢ƒçš„è„šæœ¬ï¼š /bin/zsh -c &quot;$(curl -fsSL ä»¥åçš„è„šæœ¬è·¯å¾„)&quot; ci åœ¨ç»ˆç«¯ä¸­ï¼Œè¾“å…¥ä¸Šè¿°å‘½ä»¤åï¼Œå°†å®‰è£…å¦‚ä¸‹æœåŠ¡ï¼š Homebrewï¼ˆå®‰è£…è¿‡ç¨‹ä¸­éœ€è¦ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©å›½å†…é•œåƒæºï¼‰ RVMï¼Œå¹¶ç¡®ä¿ ruby ç‰ˆæœ¬ä¸º 2.7.4 ç‰ˆæœ¬ Bundle Mint åœ¨ ~ ç›®å½•ä¸‹æ·»åŠ å¼€æœºè§£é”å¯†ç ï¼ˆé»˜è®¤ä¸º qazxsw2ï¼‰ æ‚¨å¯ä»¥ fork è¯¥è„šæœ¬åä¿®æ”¹è„šæœ¬å†…å®¹ï¼Œä»¥å®‰è£…é€‚ç”¨äºæ‚¨è‡ªå·±çš„å¼€å‘ç¯å¢ƒã€‚ é’ˆå¯¹ Homebrew çš„é¢å¤–é…ç½® æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬æ—¶ï¼Œå¯èƒ½å‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š No remote 'origin' in ... fatal: not in a git directory Error æ­¤æ—¶åˆå§‹åŒ–è„šæœ¬ä¼šè¢«ä¸­æ–­ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œ brew -v å‘½ä»¤æŸ¥çœ‹æç¤ºï¼Œå¹¶æŒ‰ç…§æç¤ºæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š git config --global --add safe.directory homebrew-coreè·¯å¾„ git config --global --add safe.directory homebrew-caskè·¯å¾„ git config --global --add safe.directory homebrew-servicesè·¯å¾„ å°† homebrew-coreã€homebrew-cask å’Œ homebrew-services çš„è·¯å¾„æ·»åŠ åˆ° git config ä¸­å³å¯ã€‚ ä¹‹åå†é‡æ–°æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬å³å¯ã€‚ å†…ç½‘ VPN ä¸€èˆ¬æ¥è¯´ GitLab æœåŠ¡éƒ½å®‰è£…åœ¨å…¬å¸å†…ç½‘ï¼Œéœ€è¦è¿æ¥å†…ç½‘æ‰èƒ½è¿›è¡Œè®¿é—®ã€‚ æ‚¨éœ€è¦åœ¨è¿™ä¸€æ­¥ä¸­æ ¹æ®æ‚¨è‡ªèº«çš„æƒ…å†µï¼Œç¡®ä¿ CI ç”µè„‘å¯ä»¥é¡ºåˆ©è®¿é—®å…¬å¸å†…ç½‘æœåŠ¡ã€‚ GitLab-Runner æ•´ä½“å®‰è£…ã€é…ç½®æµç¨‹å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£ï¼Œæœ¬èŠ‚å†…å®¹ä»…ä½œä¸ºè¡¥å……è¯´æ˜ä½¿ç”¨ã€‚å…¶å†…å®¹ä¸å®˜æ–¹æ–‡æ¡£åŸºæœ¬ä¸€è‡´ã€‚ ä¸‹è½½å®‰è£… å› ä¸ºå®˜æ–¹ä½¿ç”¨çš„æ˜¯äºšé©¬é€Šçš„ s3 æœåŠ¡å™¨ï¼Œåœ¨å¢™å†…ä¸‹è½½ä¼šæ¯”è¾ƒæ…¢ï¼Œå»ºè®®å¼€å¯ç¿»å¢™ VPN æˆ–åœ¨æ—©ä¸Šæˆ–è€…ç½‘ç»œæ¡ä»¶æ¯”è¾ƒå¥½çš„æ—¶å€™ä¸‹è½½ã€‚ GitLab-Runner ä½œä¸º GitLab-CI çš„åŸºç¡€ï¼Œå…¶ç‰ˆæœ¬åº”è¯¥å’Œ GitLab çš„ç‰ˆæœ¬æœ‰æ‰€å¯¹åº”ï¼Œå¦åˆ™å®¹æ˜“å‡ºç°ä¸åŒ¹é…çš„æƒ…å†µã€‚ 14.8.1-jh ç‰ˆæœ¬çš„ GitLab å¯ä»¥ä½¿ç”¨ 15.1.0 ç‰ˆæœ¬çš„ Runnerã€‚ åœ¨ç»ˆç«¯è¾“å…¥ä¸‹é¢çš„é“¾æ¥ä¸‹è½½å®‰è£…åŒ…ï¼š è¯¥å®‰è£…åŒ…é€‚ç”¨äº Intel èŠ¯ç‰‡çš„ Macï¼Œå¦‚æœæ˜¯ M ç³»åˆ—èŠ¯ç‰‡çš„ Macï¼Œåˆ™éœ€è¦å°†æœ€åçš„ amd64 ä¿®æ”¹ä¸º arm64ã€‚ sudo curl --output /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/v15.1.0/binaries/gitlab-runner-darwin-amd64 èµ‹äºˆæƒé™ sudo chmod +x /usr/local/bin/gitlab-runner åœ¨ç»ˆç«¯è¾“å…¥ä¸Šè¿°å‘½ä»¤åï¼Œå³å¯åœ¨ç»ˆç«¯å†…ä½¿ç”¨ gitlab-runner å‘½ä»¤ã€‚ æ³¨å†Œ Runner è¯¦ç»†æ³¨å†Œæµç¨‹è¯·å‚è€ƒ æ³¨å†Œ GitLab-Runner å¯åŠ¨ Runner é¦–å…ˆæ‰“å¼€ç»ˆç«¯ï¼Œåˆ‡æ¢åˆ°å½“å‰ç™»é™†ç”¨æˆ·ï¼š su - &lt;username&gt; æ¥ç€å®‰è£… Runner æœåŠ¡å¹¶å¯åŠ¨ï¼š cd ~ gitlab-runner install gitlab-runner start æœ€åé‡å¯ç”µè„‘å³å¯å®Œæˆ Runner çš„å®‰è£…ã€‚ å¯ä»¥åœ¨ç»ˆç«¯å†…è¾“å…¥ gitlab-runner list å‘½ä»¤ï¼ŒæŸ¥çœ‹è¾“å‡ºï¼Œå¹¶æ£€æŸ¥ config.toml æ–‡ä»¶è·¯å¾„ã€‚ é…ç½® Runner è¯·å‚è€ƒ é…ç½® GitLab-Runner æ–‡æ¡£ä¸­ concurrent ä¸€èŠ‚è¿›è¡Œé…ç½®ã€‚ è‡³æ­¤ï¼Œè¿™å°ç”µè„‘å®Œæˆäº† CI/CD çš„ç›¸å…³é…ç½®ã€‚ ","link":"https://blog.rakuyo.dev/gitlab-ci-build-ios-environment/"},{"title":"Objective-C delegate æ€§èƒ½å°ä¼˜åŒ–","content":"ä¹‹å‰ä¹Ÿæ˜¯å¯¹ delegate æ€¨å¿µé¢‡æ·±â€”â€”æ¯æ¬¡éƒ½éœ€è¦æ£€æŸ¥ deleagte å¹¶ä¸”æ£€æŸ¥æ˜¯å¦å“åº”äº†æŸä¸ªæ–¹æ³•ã€‚ä¸è¿‡é‚£ä¸ªæ—¶å€™çš„æ€¨å¿µæ˜¯æ¥è‡ªäº éœ€è¦å†™é‚£ä¹ˆä¸€å¤§æ®µä»£ç ï¼Œè€Œä¸æ˜¯æ€¨å¿µæ€§èƒ½ã€‚ è¿‡å»çš„è§£å†³æ–¹æ³• å½“æ—¶çš„è§£å†³åŠæ³•æ˜¯å†™äº†è¿™ä¹ˆä¸€ä¸ª å® ï¼š #define MBCCheckDelegate(methodName) (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(methodName)]) å®é™…ä¸Šå†™æˆ å†…è”å‡½æ•° ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¸è¿‡åˆ°äº†è¿™ä¸€æ­¥åˆå¼€å§‹æœ‰ç‚¹çŠ¯æ‡’äº†ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æœ‰ç»§ç»­ã€‚ ä¼˜åŒ– ç›´åˆ°ä»Šå¤©çœ‹åˆ°äº† å‚è€ƒ1 çš„è¿™ç¯‡æ–‡ç« ã€‚æ–‡ç« ä¸­æåˆ°äº†å¯ä»¥ç¼“å­˜ respondsToSelector: æ–¹æ³•çš„ç»“æœï¼Œè®©æˆ‘æ„Ÿæ…¨åŸæ¥è¿˜èƒ½è¿™ä¹ˆåšï¼ @protocol SomethingDelegate &lt;NSObject&gt; @optional - (void)something:(id)something didFinishLoadingItem:(id)item; - (void)something:(id)something didFailWithError:(NSError *)error; @end @interface Something : NSObject @property (nonatomic, weak) id &lt;SomethingDelegate&gt; delegate; @end @implementation Something { struct { unsigned int didFinishLoadingItem:1; unsigned int didFailWithError:1; } delegateRespondsTo; } @synthesize delegate; - (void)setDelegate:(id &lt;JSSomethingDelegate&gt;)aDelegate { if (delegate != aDelegate) { delegate = aDelegate; delegateRespondsTo.didFinishLoadingItem = [delegate respondsToSelector:@selector(something:didFinishLoadingItem:)]; delegateRespondsTo.didFailWithError = [delegate respondsToSelector:@selector(something:didFailWithError:)]; } } @end å¦‚ä¸Šæ‰€ç¤ºï¼Œä¾¿æ˜¯ä½¿ç”¨ ç»“æ„ä½“ æ¥ç¼“å­˜ç»“æœã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ•°æ®ç»“æ„æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ã€‚ ç„¶ååœ¨å®é™…é€šè¿‡ delegate å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œåªéœ€è¦åˆ¤æ–­å¯¹åº”çš„å±æ€§å³å¯ã€‚ ä½†æ˜¯æœ‰ä¸€ç‚¹éœ€è¦ç•™æ„ï¼ŒObjective-C å¯ä»¥åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œæ‰€ä»¥è®¾ç½®æ—¶çš„æƒ…å†µæœªå¿…èƒ½ä»£è¡¨è°ƒç”¨æ—¶çš„æƒ…å†µã€‚å…·ä½“è¦ä¸è¦ç”¨è¿™ç§æ–¹æ³•è¿˜è¦è€ƒè™‘å›¢é˜Ÿå†…çš„å¼€å‘æ°›å›´ã€‚ ç®€å†™çš„ delegate åœ¨æœ‰ protocol ä¹‹å‰ï¼Œä¸€èˆ¬æ˜¯ç»™ NSObject åŠ ä¸€ä¸ª category æ¥å£°æ˜ delegate å¯ä»¥å®ç°çš„æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œç°å¦‚ä»Š CALayer è¿˜æœ‰ï¼š @interface NSObject(CALayerDelegate) - (void)displayLayer:(CALayer *)layer; // ... other methods here @end æ„æ€æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œä»»ä½•å¯¹è±¡éƒ½å¯ä»¥å®ç° displayLayer: æ–¹æ³•ã€‚ å¦‚æœè¿™æ ·å†™çš„è¯ï¼Œåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ä¹Ÿè¦åŒæ ·è¦ç”¨ä¸Šé¢æåˆ°çš„ -respondsToSelector: æ¥æ£€æŸ¥ã€‚åªè¦è®© delegate å¯¹è±¡å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œç„¶åæŠŠå®ƒä¿å­˜åœ¨ delegate å±æ€§é‡Œå°±è¡Œäº†ï¼Œä¸ç”¨å†™ protocol ä»€ä¹ˆçš„ã€‚ è‹¹æœå®˜æ–¹çš„åº“é‡Œæœ‰ä¸å°‘è¿™æ ·çš„ä¸œè¥¿ï¼Œä½†æ˜¯æ–°å†™çš„ä»£ç æœ€å¥½è¿˜æ˜¯ç”¨ä¸Šé¢å£°æ˜ protocol çš„æ­£è§„å†™æ³•ã€‚ å› ä¸ºè¿™ç§ç®€å†™æ–¹æ³•ä¼šæ±¡æŸ“NSObjectï¼ˆä¼šå¹²æ‰°ä»£ç è‡ªåŠ¨è¡¥å…¨ï¼‰ï¼Œå¹¶ä¸”ä¹Ÿè®©ç¼–è¯‘å™¨ä¸æ˜“æ£€æŸ¥å‡ºæ‰“é”™å­—ä¹‹ç±»çš„ errorã€‚ å‚è€ƒ [çˆ†æ ˆçƒ­é—¨ iOS é—®é¢˜â€”â€”æˆ´ä»“è–¯] å¦‚ä½•å†™å¥½ä¸€ä¸ª delegate ","link":"https://blog.rakuyo.dev/objc-delegate-optimization/"},{"title":"C ä¸ Objective-C ä¸­çš„æšä¸¾","content":"æœ¬æ–‡ä»‹ç» C ä¸ Objective-C ä¸­çš„æšä¸¾ï¼ŒåŒæ—¶å¯¹ Objective-C ä¸­çš„å­—ç¬¦ä¸²æšä¸¾è¿›è¡Œä»‹ç» Cè¯­è¨€ä¸­çš„æšä¸¾ Cè¯­è¨€ä¸­ä¹Ÿæ˜¯æœ‰æšä¸¾çš„ï¼Œæˆ–è€…è¯´æšä¸¾æ­£æ˜¯ä»Cè¯­è¨€ä¸­è¯ç”Ÿçš„ã€‚åœ¨Cè¯­è¨€ä¸­ï¼Œæšä¸¾ä½¿ç”¨ enum å…³é”®å­—å£°æ˜ï¼Œè¾…ä»¥ typedefã€‚è®©æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼š typedef enum RKOEnumType { RKOEnumTypeNone = 0, RKOEnumTypeNormal, ... } RKOEnumType; ä¸Šé¢çš„ä»£ç ä¾¿å®šä¹‰äº†ä¸€ä¸ªæšä¸¾ç±»å‹ RKOEnumTypeï¼Œä½¿ç”¨å®ƒå£°æ˜å˜é‡æ—¶æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š RKOEnumType type = RKOEnumTypeNone; è€Œç”¨å®ƒè¿›è¡Œåˆ¤æ–­æ—¶åˆ™æ˜¯è¿™æ ·çš„ï¼š switch (type) { case RKOEnumTypeNone: // some code break; case RKOEnumTypeNormal: // some code break; ... } Objective-C ä¸­çš„æšä¸¾ åœ¨ Objective-C è¯­è¨€ä¸­ï¼ŒFoundaation æ¡†æ¶ä¸ºæˆ‘ä»¬å°è£…äº†ä¸€å¥—æ›´æ–¹ä¾¿çš„æšä¸¾å®šä¹‰æ–¹æ³•ã€‚é‚£ä¾¿æ˜¯ NS_ENUM å’Œ NS_OPTIONSã€‚ NS_ENUM NS_ENUM ç”¨æ¥ç”³æ˜å•é€‰ç±»å‹çš„æšä¸¾ï¼Œå³æšä¸¾å˜é‡ä¸­åªå¯ä»¥æœ‰ä¸€ç§å€¼ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ —å­ï¼š typedef NS_ENUM(NSInteger, RKOEnumType) { RKOEnumTypeNone = 0, RKOEnumTypeNormal, ... }; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œç”¨ NSInteger å£°æ˜äº†æšä¸¾å˜é‡çš„ç±»å‹ï¼Œå³æ•´æ•°ç±»å‹ï¼Œå…¶åœ¨ä½¿ç”¨æ—¶å’Œ Cè¯­è¨€ å¹¶æ— åŒºåˆ«ï¼Œä¾ç„¶ä½¿ç”¨ switch è¯­æ³•ç”¨ä»¥åŒºåˆ†æ¯ç§ä¸åŒçš„æšä¸¾å˜é‡ã€‚ NS_OPTIONS é™¤äº† NS_ENUM ä¹‹åï¼ŒObjective-C è¿˜ä¸ºæˆ‘ä»¬å°è£…äº†ä¸€å¥— NS_OPTIONSã€‚æœ‰çš„æ—¶å€™å•ä¸€çš„æšä¸¾å€¼å¹¶ä¸æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œä¾‹å¦‚åœ¨å¦‚ä¸‹åœºæ™¯æ—¶ï¼šæˆ‘ä»¬å¸Œæœ›è®¾ä¸€ä¸ªè§†å›¾çš„å¯é€‰è½¬æ–¹å‘ï¼Œå®ƒå³å¯å‘å·¦æ—‹è½¬ï¼Œåˆå¯å‘å³æ—‹è½¬ã€‚è¿™æ—¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨æšä¸¾æ¥ä»£è¡¨æ—‹è½¬æ–¹å‘çš„è¯ï¼Œæ˜¾ç„¶æˆ‘ä»¬ä¸åº”è¯¥è®¾ç½®ä¸€ä¸ªæšä¸¾å€¼ä¸ºâ€œæ—¢å¯å‘å·¦åˆå¯å‘å³â€ï¼Œæˆ‘ä»¬ä¾ç„¶å®šä¹‰ä¸€ä¸ª RKORotatTypeLeft ä¸€ä¸ª RKORotatTypeRightï¼Œç„¶åå¤šé€‰å®ƒä»¬ã€‚é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®šä¹‰å‘¢ï¼Ÿä¸‹é¢æ¥ä¸¾ä¸ªä¾‹å­ï¼š typedef NS_OPTIONS(NSUInteger, RKORotatType) { RKORotatTypeRightNone = 0, // 2è¿›åˆ¶ä¸­çš„ 0000 RKORotatTypeRight = 1 &lt;&lt; 0, // å€¼ä¸º2çš„0æ¬¡æ–¹ï¼ŒäºŒè¿›åˆ¶ä¸­çš„ 0001 RKORotatTypeLeft = 1 &lt;&lt; 1, // å€¼ä¸º2çš„1æ¬¡æ–¹ï¼ŒäºŒè¿›åˆ¶ä¸­çš„ 0010 ... }; è¿™æ ·æˆ‘ä»¬ä½¿ç”¨ NS_OPTIONSï¼Œç»“åˆä½ç§»æ“ä½œï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªå¯ä»¥è¿›è¡Œå¤šé€‰çš„æšä¸¾ç±»å‹äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒNS_OPTIONS ä½¿ç”¨çš„å˜é‡ç±»å‹ä¸º NSUIntegerã€‚è€Œä¸æ˜¯ NS_ENUM çš„ NSIntegerã€‚ åœ¨å¯¹å˜é‡èµ‹å€¼æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ | æˆ–è¿ç®—ç¬¦è¿æ¥å¤šä¸ªä¸åŒçš„æšä¸¾å€¼ï¼Œä¾‹å¦‚ï¼š RKORotatType type = RKORotatTypeRight | RKORotatTypeLeft; åˆ¤æ–­ NS_OPTIONS åœ¨å¯¹å˜é‡çš„åˆ¤æ–­ä¸Šä¸ NS_ENUM ä¸åŒï¼Œå› ä¸ºå˜é‡ä¸­å¯ä»¥åŒ…å«å¤šä¸ªå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸æ–¹ä¾¿ä½¿ç”¨ switch æ¥è¿›è¡Œåˆ¤æ–­äº†ã€‚ ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ if æ¥è¿›è¡Œ NS_OPTIONS ç±»å‹çš„æšä¸¾çš„å€¼åˆ¤è¯»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š // RKORotatTypeRight if (type &amp; RKORotatTypeRight) { // some code } // åŒ…å« RKORotatTypeLeft if (type &amp; RKORotatTypeLeft) { // some code } ä½¿ç”¨ if åˆ¤æ–­ï¼Œç»“åˆ &amp; ä¸è¿ç®—ç¬¦ï¼Œæˆ‘ä»¬å³å¯åˆ¤æ–­å˜é‡ä¸­æ˜¯å¦åŒ…å«æŸä¸ªå…·ä½“çš„æšä¸¾å€¼ï¼Œè¿›è€Œæ‰§è¡Œæ“ä½œã€‚ æ’é™¤ æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ï¼Œæœ‰å¯èƒ½å®šä¹‰ä¸‹é¢è¿™æ ·çš„ä¸€ä¸ªé€‰é¡¹æšä¸¾ï¼š typedef NS_OPTIONS(NSUInteger, RKORotatType) { RKORotatTypeRightNone = 0, RKORotatTypeRight = 1 &lt;&lt; 0, RKORotatTypeLeft = 1 &lt;&lt; 1, RKORotatTypeTop = 1 &lt;&lt; 2, RKORotatTypeBottom = 1 &lt;&lt; 3, RKORotatTypeAll = RKORotatTypeRight | RKORotatTypeLeft | RKORotatTypeTop | RKORotatTypeBottom, }; è¿™é‡Œæˆ‘é¢å¤–å®šä¹‰äº†ä¸€ä¸ªæšä¸¾é€‰é¡¹ä¸º RKORotatTypeAllï¼Œä»£è¡¨æ‰€æœ‰çš„æ—‹è½¬ç±»å‹ã€‚ç°åœ¨æˆ‘ä»¬æœ‰å¯èƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªéœ€æ±‚ï¼Œç‚¹å‡»æŸä¸ªæŒ‰é’®ï¼Œæˆ–è€…æ‰§è¡Œäº†æŸä¸ªæ“ä½œä¹‹åï¼Œè¦ç¦æ­¢è¿™ä¸ªè§†å›¾å‘å·¦æ—‹è½¬ã€‚ æˆ‘ä»¬å¯ä»¥é‡æ–°å¯¹ type è¿›è¡Œèµ‹å€¼ï¼Œä¹Ÿå¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼Œå°† RKORotatTypeLeft ä» type ä¸­æ’é™¤æ‰ï¼š type = type &amp; (~RKORotatTypeLeft); å°† RKORotatTypeLeft å–ååå†ä¸ type è¿›è¡Œä¸æ“ä½œï¼Œå³å¯ä» type ä¸­ç§»é™¤ RKORotatTypeLeft é€‰é¡¹ã€‚ Cæ•°ç»„ä¸å­—ç¬¦ä¸²æšä¸¾ å¦‚ä¸Šæ‰€è¿°ï¼Œc ä¸ Objective-C çš„å¸¸è§æšä¸¾éƒ½æ˜¯ int ç±»å‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­—ç¬¦ä¸²æšä¸¾å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥å€ŸåŠ© c æ•°ç»„æ¥å®ç°ã€‚é¦–å…ˆå®šä¹‰ä¸€ä¸ªå¸¸è§çš„ Objective-C æšä¸¾ï¼š typedef NS_ENUM(NSUInteger, KLType) { KLTypeRed = 1, KLTypeGreen = 2, KLTypeOrange = 3, }; éšåä½¿ç”¨è¯¥ Objective-C æšä¸¾ä½œä¸ºä¸‹æ ‡ï¼Œå®šä¹‰ c æ•°ç»„ï¼š // è¿™ä¸ªæ˜¯ Map NSString * ç±»å‹çš„æ•°ç»„ NSString *KLTypeStringMap[] = { [KLTypeRed] = @&quot;çº¢è‰²&quot;, [KLTypeGreen] = @&quot;ç»¿è‰²&quot;, [KLTypeOrange] = @&quot;æ©˜è‰²&quot; }; // ä½¿ç”¨ï¼š KLTypeStringMap[KLTypeRed]; å‚è€ƒ iOS Enum-æšä¸¾çš„æ­£ç¡®ä½¿ç”¨â€”â€”Snow_xueY NS_OPTIONSæšä¸¾çš„ç”¨æ³•â€”â€”Channe OCä¸­æšä¸¾å†™æ³• ä»¥åŠ å­—ç¬¦ä¸²ç±»å‹æšä¸¾å®ç°æ¢ç´¢ ","link":"https://blog.rakuyo.dev/enums-in-objc/"},{"title":"SQL åŸºç¡€è¯­å¥ä¸ SQLite åŸºç¡€æ“ä½œ","content":"è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯å›´ç»• SQLiteï¼Œè®°å½•æ€»ç»“ SQL çš„ä¸€äº›ç”¨æ³•ã€‚ è‡³äº iOS ä¸­å…¶ä½™çš„å‡ ç§å­˜å‚¨æ–¹å¼ä¾‹å¦‚ .plist ç­‰ï¼Œä»¥åŠæ•°æ®åº“çš„æ¦‚å¿µï¼ŒSQL çš„æ¦‚å¿µç­‰ï¼Œå…ˆä¸åšä»‹ç»ã€‚ SQL çš„ç‰¹ç‚¹ ä¸åŒºåˆ†å¤§å°å†™ã€‚ æ¯æ¡è¯­å¥å¿…é¡»ä»¥åˆ†å· ; ç»“å°¾ã€‚ ä¸å¯ä»¥ä½¿ç”¨å…³é”®å­—æ¥å‘½åè¡¨ã€å­—æ®µã€‚ï¼ˆå…³é”®å­—è§ä¸‹ä¸€å°èŠ‚ï¼‰ SQL ä¸­çš„å…³é”®å­— select ã€ insert ã€ update ã€ delete ã€ from ã€ create ã€ where ã€ desc ã€ order ã€ by ã€ group ã€ table ã€ alter ã€ view ã€ index etc. æ³¨æ„ï¼Œä¸ºäº†ä¿æŒè‰¯å¥½çš„æ•°æ®åº“ç¼–ç¨‹ä¹ æƒ¯ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ SQL è¯­å¥çš„æ—¶å€™ï¼Œåº”å½“é‡‡ç”¨å…³é”®å­—å¤§å†™çš„å½¢å¼ã€‚ SQL è¯­å¥çš„ç§ç±» DDL æ•°æ®å®šä¹‰è¯­å¥ æ•°æ®å®šä¹‰è¯­å¥ DDL çš„å…¨ç§°æ˜¯ Data Definition Languageã€‚ å…¶åŒ…å« create ã€ drop ç­‰æ“ä½œã€‚create å³ åˆ›å»ºè¡¨ (create table) ã€‚drop åˆ™æ˜¯ åˆ é™¤è¡¨ ï¼ˆdrop tableï¼‰ã€‚ DML æ•°æ®æ“ä½œè¯­å¥ æ•°æ®æ“ä½œè¯­å¥ DML çš„å…¨ç§°æ˜¯ Data Manipulation Languageã€‚ åŒ…æ‹¬ insert ã€ update ã€ delete ç­‰æ“ä½œã€‚ ç¬¬ä¸€æ¬¡æ¥è§¦çš„æ—¶å€™ï¼Œåªçœ‹è¿™äº›å…³é”®è¯çš„è¯å¯ä»¥ä¼šè¯¯è§£ delete ä¸ºåˆ é™¤è¡¨çš„æ“ä½œã€‚å®åˆ™ä¸ç„¶ï¼ŒDML å…¨éƒ¨éƒ½æ˜¯å¯¹ æ•°æ® çš„æ“ä½œï¼ŒDDL æ‰æ˜¯å¯¹äºè¡¨çš„æ“ä½œã€‚ æ‰€ä»¥è¿™é‡Œ insert ä¸ºåœ¨è¡¨ä¸­ æ·»åŠ  ï¼ˆæ’å…¥ï¼‰æ•°æ®ï¼Œupdate ä¸º ä¿®æ”¹ è¡¨ä¸­çš„æ•°æ®ï¼Œdelete ä¸º åˆ é™¤ è¡¨ä¸­çš„æ•°æ®ã€‚ DQL æ•°æ®æŸ¥è¯¢è¯­å¥ æ•°æ®æŸ¥è¯¢è¯­å¥ DQL çš„å…¨ç§°æ˜¯ Data Query Languageã€‚ç”¨äºæŸ¥è¯¢å¹¶è·å¾—è¡¨ä¸­çš„æ•°æ®ã€‚ å…³é”®å­— select æ˜¯ DQL ï¼ˆä¹Ÿæ˜¯æ‰€æœ‰ SQL ï¼‰ç”¨çš„æœ€å¤šçš„æ“ä½œã€‚ å…¶ä»–çš„ DQL å¸¸ç”¨çš„å…³é”®å­—æœ‰ where ã€order by ã€ group by ã€ having ç­‰ã€‚ SQLåŸºç¡€æ“ä½œ ä»¥ä¸‹å†…å®¹å°±æ˜¯é‡ç‚¹è¦è®°å½•çš„éƒ¨åˆ†äº†ã€‚ä¸ºäº†æ›´åŠ æ¸…æ™°çš„åˆ’åˆ†å„ä¸ªæ¨¡å—ï¼Œä»¥ä¸‹å†…å®¹å°†ä½¿ç”¨åˆ†å‰²çº¿æ¥å¯¹å„ä¸ªæ¨¡å—è¿›è¡Œåˆ’åˆ†ã€‚ åˆ›è¡¨ CREATE TABLE è¡¨å (å­—æ®µå1 å­—æ®µç±»å‹1, å­—æ®µå2 å­—æ®µç±»å‹2, ...); ä¸Šé¢ä¸ªè¿™æ¡è¯­å¥æ˜¯æœ€åŸºæœ¬çš„åˆ›è¡¨è¯­å¥ï¼Œcreate å…³é”®å­— å’Œ table å…³é”®å­—è¿ç”¨ï¼Œç”¨äºåˆ›å»ºä¸€å¼ è¡¨ï¼Œç”¨ () è‹±æ–‡æ‹¬å·å°†å¤šä¸ª å­—æ®µå å’Œ å­—æ®µç±»å‹ æ‹¬èµ·æ¥ã€‚ ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ä¸Šé¢é‚£æ¡è¯­å¥ï¼Œä¸ºäº†æ›´åŠ çš„å®‰å…¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ ä¸‹é¢è¿™ç§å†™æ³•è¿›è¡Œè¡¨çš„åˆ›å»º ï¼š CREATE TABLE IF NOT EXISTS è¡¨å (å­—æ®µå1 å­—æ®µç±»å‹1, å­—æ®µå2 å­—æ®µç±»å‹2, ...); IF NOT EXISTS ç”¨äºåˆ¤æ–­æ‰€è¦åˆ›å»ºçš„ è¡¨æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨çš„è¯æ‰ä¼šåˆ›å»ºã€‚ ä¸¾ä¸ªä¾‹å­çš„è¯åˆ›å»ºä¸€å¼ è¡¨çš„å®é™…è¯­å¥æ˜¯è¿™æ ·çš„ï¼š CREATE TABLE IF NOT EXISTS t_student (id integer, name text, age inetger, score real); tip: åˆä¸€åˆ™è‰¯å¥½çš„ SQL ç¼–ç ä¹ æƒ¯â€”â€”åœ¨åˆ›å»ºè¡¨æ—¶ï¼Œè¡¨åå‰åŠ ä¸Š t_ æ¥è¡¨æ˜è¿™æ˜¯ä¸€å¼ è¡¨ï¼ŒåŒç†ï¼Œåˆ›å»ºè§†å›¾æ—¶ä½¿ç”¨ v_ æ¥è¡¨æ˜è§†å›¾ã€‚ ç„¶è€Œï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¾‹å¦‚ Navicat Premium ç­‰è½¯ä»¶ï¼Œåœ¨ GUI ä¸­åˆ›å»ºè¡¨ï¼Œç„¶åä½¿ç”¨ DDL æŸ¥çœ‹è¯¥è¡¨çš„åˆ›è¡¨è¯­æ³•æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¯­å¥ï¼š CREATE TABLE &quot;t_shop&quot; ( &quot;name&quot; text, &quot;price&quot; real, &quot;left_count&quot; integer ); è¡¨åå’Œå­—æ®µåéƒ½åŠ äº†å¼•å·ã€‚æˆ‘ç¨å¾®æŸ¥äº†ä¸€ä¸‹ï¼Œå¥½åƒ oracle æ˜¯éœ€è¦åŠ å¼•å·çš„ï¼Œå¥½åƒå’Œå¤§å°å†™æœ‰å…³ã€‚ä¸è¿‡åœ¨ SQLite ä¸­ä¸åŠ å¼•å·å³å¯ã€‚æ¯•ç«Ÿ Navicat Premium ä¸­é›†æˆäº†å¤šç§æ•°æ®åº“ï¼Œä¸æ˜¯ä»…æœ‰ SQLiteã€‚ å­—æ®µç±»å‹ SQLite å°†æ•°æ®åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ç§å­˜å‚¨ç±»å‹ï¼š åç§° å«ä¹‰ integer æ•´å‹å€¼ real æµ®ç‚¹å€¼ text æ–‡æœ¬å­—ç¬¦ä¸² blob äºŒè¿›åˆ¶æ•°æ®ï¼ˆæ¯”å¦‚æ–‡ä»¶ï¼‰ ç„¶è€Œå‘¢ï¼Œå®é™…ä¸Š SQLite æ˜¯ æ— ç±»å‹ çš„ã€‚å°±ç®—æˆ‘ä»¬å°†ä¸€ä¸ªå­—æ®µå£°æ˜ä¸º integerï¼Œè¿˜èƒ½å¯ä»¥å­˜å‚¨ç±»å¦‚ å­—ç¬¦ä¸²ä¹‹ç±»çš„æ•°æ®ï¼ˆæ³¨æ„ï¼Œè¿™é‡Œ ä¸»é”®é™¤å¤–ï¼‰ã€‚ è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åœ¨å»ºè¡¨çš„æ—¶å€™å®é™…ä¸Šæ˜¯å¯ä»¥ä¸å£°æ˜ç±»å‹çš„ï¼Œåªå£°æ˜åç§°å³å¯ã€‚ä½†æ˜¯ä¸ºäº†ä¿æŒè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œå¯å¯è¯»æ€§ç­‰ç­‰ï¼Œæˆ‘ä»¬è¿˜æ˜¯åº”è¯¥å£°æ˜ç±»å‹çš„ã€‚ åˆ è¡¨ åˆ è¡¨çš„æ—¶å€™ä½¿ç”¨å…³é”®å­— dropï¼Œå’Œåˆ›è¡¨æ—¶ä¸€æ ·ï¼Œåˆ†ä¸ºæ™®é€šçš„å†™æ³•å’Œæˆ‘ä»¬å¹³æ—¶ä¼šç”¨åˆ°çš„å†™æ³•ã€‚è¿™é‡Œå°±ç›´æ¥ç»™å‡ºåè€…äº†ï¼š DROP TABLE IF EXISTS è¡¨å; ä¸¾ä¸ªä¾‹å­ï¼š DROP TABLE IF EXISTS t_student; æ’å…¥æ•°æ® INSERT INTO è¡¨å (å­—æ®µ1, å­—æ®µ2, ...) values (å­—æ®µ1çš„å€¼, å­—æ®µ2çš„å€¼, ...); æç‚¼ä¸€ä¸‹ä¸Šè¿°è¯­æ³•ï¼Œå³ insert into ... values ...ã€‚æ„Ÿè§‰è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼šæ’å…¥åˆ°... å®ƒçš„å€¼æ˜¯ ... ä¸¾ä¾‹æ¥è¯´ï¼š INSERT INTO t_student (name, age) VALUE ('mj', 10); æ³¨æ„ï¼š åœ¨å­˜å‚¨ å­—ç¬¦ä¸² æ—¶ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ å•å¼•å· å°†å…¶æ‹¬èµ·æ¥ã€‚ åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¸€å®šè¦æ¯ä¸ªå­—æ®µéƒ½æœ‰å€¼ï¼Œå³è¡¨ååé¢çš„é‚£ä¸ªæ‹¬å·ï¼Œä¸å¿…åŒ…å«è¡¨ä¸­çš„æ‰€æœ‰å­—æ®µã€‚ æ›´æ–°æ•°æ® UPDATE è¡¨å SET å­—æ®µ1 = å­—æ®µ1çš„å€¼, å­—æ®µ2 = å­—æ®µ2çš„å€¼, ...; ä¸Šé¢ä¾¿æ˜¯æ›´æ–°æ•°æ®çš„è¯­æ³•æ ¼å¼ï¼Œä½†æ˜¯å¦‚æœä»…ä»…æ˜¯å¥—ç”¨è¿™ä¸ªæ ¼å¼çš„è¯ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ¡è¯­å¥ï¼š UPDATE t_student SET name = 'jack', age = 20; è¿™æ¡è¯­å¥å°†ä¼šå°†æ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®ï¼Œname å­—æ®µçš„å€¼éƒ½æ”¹ä¸º jackï¼Œage å­—æ®µçš„å€¼éƒ½æ”¹ä¸º20ã€‚ æ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬è¿˜è¦ç»“åˆä¸‹ä¸€å¤§èŠ‚çš„æ¡ä»¶è¯­å¥è¿›è¡Œä½¿ç”¨ã€‚ åˆ é™¤æ•°æ® DELETE FROM è¡¨å; åˆ é™¤æ•°æ®çš„ä¸€èˆ¬è¯­æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä½†æ˜¯å’Œæ›´æ–°æ•°æ®ä¸€æ ·ã€‚æ‰§è¡Œäº†ä¸Šé¢çš„æ“ä½œä¹‹åï¼Œæ•´å¼ è¡¨çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šè¢«åˆ é™¤ã€‚æ‰€ä»¥ä¹Ÿè¦ç»“åˆæ¡ä»¶è¯­å¥è¿›è¡Œä½¿ç”¨ã€‚ æ¡ä»¶è¯­å¥ åœ¨ åˆ›è¡¨ å’Œ åˆ è¡¨ æ—¶ï¼Œæˆ‘ä»¬æ›¾ç»ä½¿ç”¨è¿‡ if è¿™ä¸ªå…³é”®è¯ï¼Œå¯ä»¥ç†è§£ä¸ºå¦‚æœã€‚ä½†æ˜¯è¿™ä¸ª if å¹¶ä¸æ˜¯æ¡ä»¶åˆ¤æ–­è¯­å¥çš„ç”¨è¯ã€‚ åœ¨æ¡ä»¶åˆ¤æ–­è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ where å…³é”®å­—ï¼Œå¯ä»¥ç¿»è¯‘ä¸º å½“....æ—¶ï¼Œåˆæ¬¡æ¥è§¦æ—¶æˆ‘å¾ˆå¥½å¥‡ï¼Œå¦‚æœä¸ä½¿ç”¨ if çš„è¯ï¼Œä¸ºä»€ä¹ˆä¸ç”¨ when å‘¢ï¼Ÿæ„Ÿè§‰è¿™é‡Œå¯èƒ½æ›´æ˜¯ä¸ºäº†çªå‡º åœ¨æŸè¡Œè®°å½• çš„è¿™ä¸ªæ¦‚å¿µå§ã€‚ æ¡ä»¶è¯­å¥çš„æ ¼å¼ä¹Ÿå¾ˆå¥½è®°å¿†ï¼Œå³åœ¨éœ€è¦æ¡ä»¶åˆ¤æ–­çš„è¯­å¥åé¢ï¼Œè·Ÿä¸Šç”± where å¼€å¤´çš„æ¡ä»¶åˆ¤æ–­è¯­å¥å³å¯ã€‚ æ ¼å¼ å«ä¹‰ WHERE å­—æ®µ = æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦ç­‰äºæŸä¸ªå€¼ WHERE å­—æ®µ != æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦ä¸ç­‰äºæŸä¸ªå€¼ WHERE å­—æ®µ &gt; æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦å¤§äºæŸä¸ªå€¼ WHERE å­—æ®µ &lt; æŸä¸ªå€¼ å­—æ®µçš„å€¼æ˜¯å¦å°äºæŸä¸ªå€¼ WHERE å­—æ®µ1 = æŸä¸ªå€¼ AND å­—æ®µ2 &gt; æŸä¸ªå€¼ å…³é”®å­— AND ç”¨äºè¿æ¥ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ WHERE å­—æ®µ1 = æŸä¸ªå€¼ OR å­—æ®µ2 &gt; æŸä¸ªå€¼ å…³é”®å­— OR ç”¨äºè¿æ¥ä¸¤ä¸ªåˆ¤æ–­æ¡ä»¶ ä¸¾ä¾‹ï¼š -- å°† t_student è¡¨ä¸­å¹´é¾„å¤§äº10å¹¶ä¸”å§“åä¸ç­‰äºjackçš„è®°å½•ï¼Œå¹´é¾„éƒ½æ”¹ä¸º5ã€‚ UPDATE t_student SET age = 5 WHERE age &gt; 10 AND name != 'jack'; -- åˆ é™¤ t_student è¡¨ä¸­å¹´é¾„å°äºç­‰äº 10 æˆ–è€… å¹´é¾„å¤§äº 30 çš„è®°å½•ã€‚ DELETE FROM t_student WHERE age &lt; 10 OR age &gt; 30; -- å°† t_student è¡¨ä¸­åå­—ç­‰äº jack çš„è®°å½•ï¼Œscore å­—æ®µçš„å€¼éƒ½æ”¹ä¸º age å­—æ®µçš„å€¼ã€‚ UPDATE t_student SET score = age WHERE name = 'jack'; ç‰¹åˆ«æ³¨æ„ï¼šåœ¨ SQLite ä¸­ï¼Œç­‰äº è¿™ä¸ªæ¦‚å¿µä½¿ç”¨çš„æ˜¯ å•ç‹¬çš„ç­‰å·ã€‚å’Œ Obj-C ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ç¼–ç¨‹è¯­è¨€éƒ½ä¸ç›¸åŒã€‚ æŸ¥è¯¢æ•°æ® æŸ¥è¯¢æ“ä½œä½¿ç”¨å…³é”®å­— selectã€‚æ ¼å¼ä¸ºï¼š SELECT å­—æ®µ1, å­—æ®µ2, ... FROM è¡¨å; å¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ•´å¼ è¡¨çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ * å·æ¥ä»£æ›¿å­—æ®µåï¼Œå³ SELECT * FROM è¡¨å; ä¸¾ä¸ªä¾‹å­ï¼š SELECT name, age FROM t_student; SELECT * FROM t_student WHERE age &gt; 10; åˆ«å åœ¨è¿›è¡ŒæŸ¥è¯¢æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¸º å­—æ®µ å’Œ è¡¨ èµ·ä¸€ä¸ª åˆ«åï¼Œä»è€Œæˆ‘ä»¬æˆ‘ä»¬æŸ¥çœ‹æˆ–è€…è¿›è¡ŒæŸäº›æ“ä½œã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ«å é¡¾åæ€ä¹‰ï¼Œåªæ˜¯å¦å¤–ä¸€ä¸ªç§°å‘¼ï¼Œå¹¶ä¸ä¼šä¿®æ”¹å­—æ®µæœ¬èº«çš„åç§°ã€‚ åˆ«å ä½¿ç”¨å…³é”®å­— asï¼Œä¸è¿‡è¯¥å…³é”®å­—æ˜¯å¯ä»¥çœç•¥çš„ï¼Œè€Œä¸”ï¼Œè¿™ä¸ªåˆ«åå¯ä»¥ä½¿ç”¨ ä¸­æ–‡ã€‚å…¶æ ¼å¼å¦‚ä¸‹ï¼š -- æœ€åŸºæœ¬çš„å†™æ³•ä¸ºï¼š SELECT å­—æ®µ1 AS åˆ«å1, å­—æ®µ2 AS åˆ«å2, ... FROM è¡¨å AS è¡¨åˆ«å; -- å½“éšè— AS æ—¶ SELECT å­—æ®µ1 åˆ«å1, å­—æ®µ2 åˆ«å2, ... FROM è¡¨å è¡¨åˆ«å; åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä¸ºè¡¨èµ·äº†ä¸€ä¸ª åˆ«åï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨æŸ¥è¯¢æ—¶å°±å¯ä»¥è¿™ä¹ˆå®šä¹‰éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼š SELECT è¡¨åˆ«å.å­—æ®µ1 åˆ«å1, è¡¨åˆ«å.å­—æ®µ2 åˆ«å2, ... FROM è¡¨å è¡¨åˆ«å; å³ç”¨ è¡¨åˆ«å åæ¥ . å†æ¥å­—æ®µåçš„æ ¼å¼ï¼Œç”¨ è¡¨åˆ«å æ¥å¼•ç”¨è¡¨ä¸­çš„å­—æ®µã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œåœ¨ä½¿ç”¨å¦‚ Navicat Premium æ—¶ï¼Œå¯ä»¥æç¤ºè¯¥è¡¨æœ‰å“ªäº›å­—æ®µï¼Œä»¥é˜²å­—æ®µå¤ªå¤šæˆ‘ä»¬è®°ä¸æ¸…æ¥šã€‚è€Œä¸”å½“å¤šè¡¨è”æŸ¥æ—¶å‡ºç°äº†å­—æ®µåé‡åçš„é—®é¢˜çš„è¯ï¼Œè¡¨åˆ«å ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³åŠæ³•ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š SELECT s.name å§“å, s.age å¹´é¾„ FROM t_student s; è®¡ç®—è®°å½•çš„æ•°é‡ åœ¨ SQL ä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå‡½æ•° count() ï¼Œå…¶ä½œç”¨ä¸ºè®°å½•æŸä¸ªå­—æ®µçš„æ•°é‡ã€‚æ ¼å¼ä¸ºï¼š SELECT COUNT(å­—æ®µå) FROM è¡¨å; ä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ * å·æ¥ä»£æ›¿å­—æ®µåã€‚å³ï¼š SELECT COUNT(*) FROM è¡¨å; ä¸¾ä¸ªä¾‹å­ï¼š SELECT COUNT(*) FROM t_student WHERE score &gt;= 60; æŸ¥è¯¢ç»“æœæ’åº æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³é”®å­— order by å¯¹æŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºï¼Œå…¶æ ¼å¼ä¸ºï¼š SELECT å­—æ®µå FROM è¡¨å ORDER BY å­—æ®µå æ’åºè§„åˆ™; å…¶é»˜è®¤æ˜¯æŒ‰ç…§ asc ï¼Œå³å‡åºæ’åˆ—ã€‚æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºçš„ä¿®æ”¹æ’åºè§„åˆ™ï¼Œæ”¹ä¸º descï¼Œ å³é™åºæ’åˆ—ã€‚å¦‚æœçœç•¥æ’åºè§„åˆ™çš„è¯ï¼Œåˆ™æ˜¯é»˜è®¤çš„å‡åºæ’åˆ—ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š -- çœç•¥æ’åºè§„åˆ™ã€‚(æŒ‰ç…§å‡åºæ’åˆ— SELECT * FROM t_student ORDER BY age; -- é™åºæ’åˆ— SELECT * FROM t_student ORDER BY age DESC; åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥æŒ‡å®šæŒ‰ç…§å¤šä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ¡è¯­å¥ï¼š SELECT * FROM t_student ORDER BY age ASC, height DESC; è¿™æ¡è¯­å¥ä¼šå°†æŸ¥è¯¢ç»“æœæŒ‰ç…§å­—æ®µ age å‡åºæ’åˆ—ï¼Œå¹´é¾„ç›¸ç­‰çš„è¯å°±ä¼šæŒ‰ç…§å­—æ®µ height é™åºæ’åˆ—ã€‚ æœªå®Œå¾…ç»­ ... ","link":"https://blog.rakuyo.dev/sql-basic-and-sqlite-basic/"},{"title":"å»æ‰éšå¼åŠ¨ç”»","content":"å®é™…ä¸Š iOS å¥½åƒæ˜¯ä¼šåœ¨å¾ˆå¤šåœ°æ–¹é»˜è®¤æ·»åŠ ä¸ŠåŠ¨ç”»çš„ã€‚è¿™äº›åŠ¨ç”»å€’ä¹Ÿè¿˜å¥½ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™å°±å’Œéœ€æ±‚ä¸ç¬¦å°±æ¯”è¾ƒçƒ¦äººäº†ã€‚ å‰å‡ å¤©å¶ç„¶çš„å†æ¬¡æŸ¥åˆ°äº†è¿™ä¸ªæ–¹æ³•ï¼Œäºæ˜¯å†³å®šå¼€ä¸ªæ–‡ç« è®°å½•ä¸€ä¸‹ã€‚ æ„Ÿè°¢å‚è€ƒ1ï¼ŒåŸä½œè€…çš„æ€»ç»“ã€‚æœ¬æ–‡åŸºæœ¬å¼•ç”¨è‡ªå‚è€ƒ1ã€‚ è¯´åˆ°éšå¼åŠ¨ç”»ï¼Œä¹‹å‰åœ¨åšæ‰‹åŠ¿æ§ä»¶çš„æ—¶å€™ï¼Œå¯¹äº CALayer çš„ä¸€äº›æ“ä½œå°±ä¼šæœ‰éšå¼åŠ¨ç”»ï¼Œä¾‹å¦‚è¯´ä¸‹é¢è¿™è¡Œä»£ç å°±ä¼šæœ‰éšå¼åŠ¨ç”»ï¼š self.frameLayer.frame = self.frameView.bounds; è¿™é‡Œä»‹ç»å‡ ç§å¯ä»¥å»æ‰ç³»ç»ŸåŠ¨ç”»çš„æ–¹æ³•ã€‚å¦‚æœæ‚¨æƒ³éšè—çš„æ˜¯ CALayer ç›¸å…³çš„åŠ¨ç”»ï¼Œè¯·ç›´æ¥å‚è€ƒ æ–¹æ³•ä¸‰ã€‚ æ–¹æ³•ä¸€ æ–¹æ³•ä¸€æ˜¯ä½¿ç”¨ UIView ç±»çš„ç±»æ–¹æ³•ï¼š performWithoutAnimation [UIView performWithoutAnimation:^{ // your code }]; å¦‚æœä½ çš„ App éœ€è¦æœ€å°‘æ”¯æŒåˆ° iOS 7 ã€‚é‚£ä¹ˆæ¨èä½ ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ æ–¹æ³•äºŒ è¯¥æ–¹æ³•å¯è¡Œï¼Œä½†æ˜¯å®åœ¨æ˜¯å¤ªè ¢äº†ï¼Œä¸å»ºè®®ä½¿ç”¨ åœ¨ä½ çŸ¥é“ä¼šäº§ç”ŸåŠ¨ç”»çš„ä»£ç å¤„ï¼Œå†æ¬¡æ·»åŠ ä¸€ä¸ªåŠ¨ç”»ï¼Œåªä¸è¿‡å°†è¿™ä¸ªåŠ¨ç”»çš„æ—¶é—´è®¾ä¸º0ï¼š [UIView animateWithDuration:0 animations:^{ [collectionView performBatchUpdates:^{ [collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]]; } completion:nil]; }]; æ–¹æ³•ä¸‰ æ–¹æ³•å››æ˜¯é’ˆå¯¹ CALayer çš„éšå¼åŠ¨ç”»çš„ã€‚è¿™ç§æƒ…å†µä¸‹ä¸Šé¢çš„ä¸‰ç§æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œåªèƒ½é‡‡ç”¨æ–¹æ³•å››ï¼š [CATransaction begin]; [CATransaction setDisableActions:YES]; // CALayer åŠ¨ç”» self.frameLayer.frame = self.frameView.bounds; [CATransaction commit]; å‚è€ƒ iOSå¼€å‘å°æŠ€å·§-å¦‚ä½•å»æ‰éšå¼åŠ¨ç”»â€”â€”æœ¨å¤´åŠ ç™½æ°´ ","link":"https://blog.rakuyo.dev/remove-implicit-animation/"},{"title":"PushKit çš„é›†æˆ","content":"å®é™…ä¸Šé¡¹ç›®ä¸­å¾ˆæ—©å°±ç”±æˆ‘æå‡ºè¦å°†ç°æœ‰çš„ APNs æ›´æ”¹ä¸º PushKit äº†ã€‚åªä¸è¿‡å½“åˆåç«¯çš„åŒå­¦å¾ˆå¿™ï¼Œæ²¡æœ‰æ—¶é—´æè¿™ä¸ª... ç°åœ¨å› ä¸ºè¦æ¥å…¥ CallKitï¼Œæ‰€ä»¥è¿™ä¸ªä¸æä¸è¡Œäº†ã€‚é‚£ä¹ˆä¹Ÿæ¥è®°å½•ä¸€ä¸‹å§ã€‚ è¿™ç¯‡æ–‡ç« ä¸­æ²¡æœ‰æ¶‰åŠåˆ°è¯ä¹¦çš„ç”³è¯·ï¼Œè¿™å—å„¿æˆ‘è¿˜ä¸å¤ªä¼šï¼Œç­‰åˆ°æœªæ¥æ¥è§¦äº†ä¼šå›è¿‡æ¥è¡¥å……çš„ æµç¨‹ å¯¼å…¥æ¡†æ¶ Xcodeè®¾ç½® è¿™é‡Œè¦åŒºåˆ†ä¸€ä¸‹ Xcode çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ çš„ç‰ˆæœ¬æ˜¯ Xcode 9 ä»¥å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆè¯·æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤é…ç½®ï¼š åœ¨ Xcode ä¸­é€‰ä¸­ä½ çš„é¡¹ç›®ï¼Œåˆ‡æ¢åˆ°ä¸» Target ä¸‹ã€‚ ç‚¹å‡» capabilities é€‰é¡¹å¡ï¼Œæ‰¾åˆ° Background Modes è¿™ä¸€é¡¹ã€‚ å‹¾é€‰ Voice over IP ä»¥åŠ Remote notifications ä¸¤é¡¹å³å¯ã€‚ å¦‚æœä½ çš„ Xcode ç‰ˆæœ¬æ˜¯ Xcode 9 åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œé‚£ä¹ˆå¾ˆé—æ†¾ã€‚è‹¹æœåœ¨ Background Modes ä¸­ç§»é™¤äº† Voice over IP è¿™ä¸€é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½é€‰æ‹©æ‰‹åŠ¨åœ°åœ¨ info.plist æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼š æˆ‘ä»¬å¯ä»¥é€‰æ‹© Open As Source Code æ¨¡å‹ï¼Œç„¶åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æ‰“å¼€ info.plist æ–‡ä»¶ï¼Œç„¶ååœ¨ Required background modes ä¸­æ·»åŠ å›¾ä¸­çš„è¿™é¡¹ã€‚ æœ€åæˆ‘ä»¬åœ¨ Build Phases çš„ Link Binary With Libraries ä¸­æ·»åŠ  PushKit çš„ç³»ç»Ÿåº“ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š AppDelegate.m é¦–å…ˆæˆ‘ä»¬åœ¨ AppDelegate.m ä¸­å¯¼å…¥å¤´æ–‡ä»¶ï¼š #import &lt;PushKit/PushKit.h&gt; å…¶æ¬¡æˆ‘ä»¬è¿˜éœ€è¦éµå®ˆ PKPushRegistryDelegate åè®®ã€‚ æ³¨å†Œæ¨é€ æˆ‘ä»¬åœ¨ AppDelegate.m æ–‡ä»¶ä¸­ï¼Œç¼–å†™å¦‚ä¸‹æ–¹æ³•ï¼š // æ³¨å†ŒpushKitæ¨é€ - (void)registerPushKitNotification { if ([UIDevice currentDevice].systemVersion.floatValue &gt;= 8.0) { PKPushRegistry *pushRegistry = [[PKPushRegistry alloc] initWithQueue:dispatch_get_main_queue()]; pushRegistry.delegate = self; pushRegistry.desiredPushTypes = [NSSet setWithObject:PKPushTypeVoIP]; } } æ³¨æ„ï¼š PushKit çš„æ”¯æŒæ˜¯éœ€è¦ iOS ç³»ç»Ÿå¤§äº 8.0 çš„ã€‚ PKPushTypeVoIP æ˜¯ä¸€ä¸ª key å€¼ï¼Œå…·ä½“çš„ä¼šæ”¾åœ¨åé¢è®²è§£ã€‚ ä¹‹åæˆ‘ä»¬åœ¨ application:didFinishLaunchingWithOptions: æ–¹æ³•ä¸­è°ƒç”¨ä¸Šè¿°æ–¹æ³•å³å¯ã€‚ ä»£ç†æ–¹æ³• pushRegistry:didUpdatePushCredentials: PKPushRegistryDelegate åè®®ä¸­æœ‰ä¸€ä¸ªå¿…é¡»è¦å®ç°çš„ä»£ç†æ–¹æ³•ï¼š - (void)pushRegistry:(PKPushRegistry *)registry didUpdatePushCredentials:(PKPushCredentials *)pushCredentials forType:(PKPushType)type; ç®€å•è¯´ä¸€ä¸‹ï¼Œå°±æ˜¯å½“æ”¶åˆ°ä¸€ä¸ªæŒ‡å®šçš„ PKPushTypeï¼ˆè¿™æ˜¯ä¸€ä¸ªæšä¸¾ï¼‰ç±»å‹çš„æ–°çš„ credentialsï¼ˆå‡­è¯/è¯ä¹¦ï¼‰ï¼ˆåŒ…æ‹¬ push tokenï¼‰æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·å– token å€¼ï¼Œç„¶åå°†å…¶ç¼“å­˜èµ·æ¥ï¼š - (void)pushRegistry:(PKPushRegistry *)registry didUpdatePushCredentials:(PKPushCredentials *)credentials forType:(NSString *)type { NSLog(@&quot;--- Token ---%@ ====%@&quot;, credentials.token, [credentials.token description]) NSString *deviceTokenStr = [[credentials.token description] stringByReplacingOccurrencesOfString:@&quot; &quot; withString:@&quot;&quot;]; deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot;&lt;&quot; withString:@&quot;&quot;]; deviceTokenStr = [deviceTokenStr stringByReplacingOccurrencesOfString:@&quot;&gt;&quot; withString:@&quot;&quot;]; NSUserDefaults *groupDefault = [[NSUserDefaults alloc] initWithSuiteName:GroupDefaultsName]; [groupDefault setValue:deviceTokenStr forKey:DeviceTokenKey]; [groupDefault synchronize]; } pushRegistry:didInvalidatePushTokenForType: æ¥ç€æˆ‘ä»¬å¯ä»¥åœ¨ pushRegistry: didInvalidatePushTokenForType: æ–¹æ³•ä¸­æ¸…é™¤ Token - (void)pushRegistry:(PKPushRegistry *)registry didInvalidatePushTokenForType:(PKPushType)type { NSUserDefaults *groupDefault = [[NSUserDefaults alloc] initWithSuiteName:GroupDefaultsName]; [groupDefault setValue:@&quot;&quot; forKey:DeviceTokenKey]; [groupDefault synchronize]; } pushRegistry:didReceiveIncomingPushWithPayload: æ¥ä¸‹æ¥çš„ä»£ç†æ–¹æ³•ç‰¹åˆ«é‡è¦ï¼Œé‚£å°±æ˜¯ pushRegistry:didReceiveIncomingPushWithPayload: ã€‚è¿™ä¸ªæ–¹æ³•ä¸æ˜¯å¿…é¡»å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬å°†ä¸šåŠ¡é€»è¾‘å†™åœ¨è¯¥æ–¹æ³•ä¸­ã€‚ ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ‰§è¡Œ CallKit ç›¸å…³çš„ä»£ç ï¼Œæˆ–è€…ç»“åˆæœ¬åœ°æ¨é€è¿›è¡Œæ“ä½œã€‚ - (void)pushRegistry:(PKPushRegistry *)registry didReceiveIncomingPushWithPayload:(PKPushPayload *)payload forType:(PKPushType)type { // your code } å‚è€ƒ è®ºå…»æˆä¸€ä¸ªå¥½çš„ä¹ æƒ¯æœ‰å¤šé‡è¦.....å½“åˆå†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å±…ç„¶å¿˜è®°è®°å½•å‚è€ƒäº†ï¼Œç»“æœç°åœ¨å›è¿‡å¤´æ¥è¡¥å……çš„æ—¶å€™æ‰¾ä¸åˆ°å½“åˆçš„å‚è€ƒäº†....å¦‚æœæ‚¨å‘ç°è¿™ç¯‡æ–‡ç« å¼•ç”¨äº†æ‚¨çš„æ–‡ç« ï¼Œè¯·è¯„è®ºæˆ–è€…é‚®ä»¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œå¼•ç”¨ä¸Šæ‚¨çš„æ–‡ç« é“¾æ¥ã€‚è°¢è°¢ï¼ ","link":"https://blog.rakuyo.dev/pushKit-integration/"},{"title":"ä» Share Extension è·³è½¬åˆ° Containing App","content":"Share Extension è¿™ç¯‡æ–‡ç« å°±ä¸å¤šè®²äº†ã€‚ å•çº¯çš„è¯´ä¸€ä¸‹ä»å‰è¾ˆé‚£é‡Œè¯·æ•™æ¥çš„å¦‚ä½•ä» Share Extension è·³è½¬åˆ° Containing App å§ã€‚ ä»£ç  NSURL *customURL = [NSURL URLWithString:@&quot;ShareKit://&quot;]; SEL sel = NSSelectorFromString(@&quot;openURL:&quot;); NSExtensionContext *context = [[NSExtensionContext alloc]init]; [context openURL:customURL completionHandler:nil]; UIResponder *responder = self; while (responder != nil){ if ([responder respondsToSelector:sel]) { [responder performSelector:sel withObject:customURL]; } responder = responder.nextResponder; } åŸç† ä»£ç æ˜¯ä»å‰è¾ˆé‚£é‡Œè¯·æ•™è¿‡æ¥çš„ï¼ŒåŸç†å°±æ˜¯åˆ©ç”¨ UIResponder æŸ¥æ‰¾å“åº”é“¾ã€‚ç›´æ¥åœ¨ Extension ä¸­è°ƒ openURL æ–¹æ³•æ˜¯ä¼šé—ªé€€çš„ï¼Œå› ä¸ºå“åº”ä¸äº†æ–¹æ³•ã€‚ æ‰€ä»¥ä½¿ç”¨ UIResponderï¼Œä»å“åº”æ ‘ä¸ŠæŸ¥æ‰¾èƒ½å¤Ÿå“åº”è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ Safariï¼Œæˆ–è€…å…¶ä»–ä½¿ç”¨åŸç”Ÿåˆ†äº«çš„ Appã€‚ ç”¨é€” ç”¨é€”è¿™å—å®é™…ä¸Šä¹Ÿæ²¡å¿…è¦å¤šè¯´ï¼Œä¸è¿‡è¯´ä¸€ç‚¹ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸Šæ¶ä¸ä¼šè¢«æ‹’ï¼Œåƒæ˜¯ QQæµè§ˆå™¨ï¼Œå¾®ä¿¡ï¼Œ æ”¯ä»˜å® ç­‰ç­‰éƒ½æœ‰è¿™ç§è·³è½¬çš„åŠŸèƒ½ï¼Œä¸è¿‡ å¾®ä¿¡ çš„åŠå…¶éšè”½ã€‚æ‰€ä»¥å¤§å®¶åœ¨ä½¿ç”¨ä¸­å¯èƒ½è¿˜æ˜¯å¾—æŠŠå…¥å£è—å¾—æ·±ä¸€äº›äº†ã€‚ ","link":"https://blog.rakuyo.dev/jump-from-share-extension-to-app/"},{"title":"Xcode9 å¿«æ·é”®","content":"å¼€ä¸ªè´´è®°å½•ä¸€ä¸‹ Xcode 9 ä¸‹è‡ªå·±å¸¸ç”¨çš„å‡ ä¸ªå‘ç”Ÿäº†å˜åŒ–çš„å¿«æ·é”®ã€‚ å¿«é€Ÿè·³è½¬è‡³å®šä¹‰ Xcode 9 ä¸‹æœ‰è¿™ä¹ˆä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œcommand + é¼ æ ‡å·¦é”® ä¹‹åä¼šå¼¹å‡ºä¸‹å›¾çš„è¿™ä¸ªèœå•ã€‚ ä½†æ˜¯è¿™é‡Œéƒ¨åˆ†çš„åŠŸèƒ½å¾ˆå°‘ç”¨åˆ°ï¼Œå†åŠ ä¸Šä¹‹å‰å·²æœ‰çš„ä¹ æƒ¯ï¼Œæ‰€ä»¥è¿™ä¸ªæ”¹åŠ¨çœŸçš„è®©äººå¾ˆéš¾å—ã€‚è€Œä¸”å®ƒæä¾›çš„å¿«æ·é”® control + command æœ‰çš„æ—¶å€™è¿˜æŒ‰ä¸å‡ºæ¥ã€‚ å®é™…ä¸Šè¿™é‡Œæœ‰ä¸ªæ–°çš„å¿«æ·é”®ï¼š command + é¼ æ ‡å³é”® å¤§å®¶å¯ä»¥å›å»è¯•ä¸€ä¸‹ï¼Œå¯ä»¥ç›´æ¥è·³è½¬åˆ°å®šä¹‰ã€‚ ä»£ç æŠ˜å  ä»£ç æŠ˜å çš„æ–¹å¼ä¹Ÿæ”¹äº†ï¼Œç°åœ¨çš„å¿«æ·é”®æ˜¯ï¼š å±€éƒ¨æŠ˜å ï¼ˆæŠ˜å ä¸€ä¸ªå‡½æ•°ï¼‰ Command + Option + æ–¹å‘é”®å·¦/å³ å…¨å±€æŠ˜å ï¼ˆæŠ˜å å½“å‰æ–‡ä»¶ä¸‹çš„å…¨éƒ¨å‡½æ•°ï¼‰ Shift + Command + Option + æ–¹å‘é”®å·¦ / å³ æŠ˜å æ³¨é‡Šå—ï¼šï¼ˆ/* */ä¹‹é—´çš„æ–‡å­—ï¼‰ Ctrl + Shift + Command + æ–¹å‘é”®å·¦ / å³ éšè—/æ˜¾ç¤ºå·¦ä¾§è¾¹æ  Command + 0 æˆ‘çš„ macOS ç‰ˆæœ¬æ˜¯ macOS 10.12.6ï¼Œåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸‹ï¼ŒXcode 9 ä¸èƒ½åšåˆ°ä¸¤ä¸ªé¡¹ç›®åˆ†å±.... ä¸çŸ¥é“å’Œç³»ç»Ÿæˆ–è€… Xcode ç‰ˆæœ¬æœ‰æ²¡æœ‰å…³ç³»... æ‰€ä»¥è¿™é‡Œåªèƒ½æ›²çº¿æ•‘å›½ä¸€ä¸‹ï¼Œæ‰“å¼€å•ä¸ªçš„ä»£ç æ–‡ä»¶ï¼Œç„¶åç”¨è¿™ä¸ªæ–‡ä»¶å’Œé¡¹ç›®è¿›è¡Œåˆ†å±ã€‚ ä½†æ˜¯è¿™æ ·æ‰€å¯¼è‡´çš„é—®é¢˜å°±æ˜¯ï¼Œè¿è¡Œé¡¹ç›®åï¼Œä»£ç æ–‡ä»¶ é‚£è¾¹å·¦ä¾§çš„è¾¹æ ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œä½†æ˜¯å› ä¸ºæ˜¯å•ç‹¬çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æ²¡æœ‰å³ä¸Šè§’çš„å¿«æ·æŒ‰é’®... æ‰€ä»¥è¿™ä¸ªå°èŠ‚ä»‹ç»çš„å¿«æ·é”®å°±å¾ˆé‡è¦äº†ã€‚ å‚è€ƒ Xcode 9 å¿«é€Ÿè·³è½¬åˆ°å®šä¹‰æ–°å§¿åŠ¿ï¼ˆJump to Definitionï¼‰ Xcode 9 ä»£ç æŠ˜å ï¼Œå…¨å±€æŠ˜å ï¼Œå¿«æ·é”® ","link":"https://blog.rakuyo.dev/xcode9-shortcuts/"},{"title":"iOS å¼€å‘ä¹‹é€‚é… iOS11","content":"å¥½äº†ï¼Œç°åœ¨ Xcode 9 çš„æ­£å¼ç‰ˆç»ˆäºæ¨é€äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿè¯¥é€‚é… iOS 11äº†ã€‚ iOS 11çš„æ”¹åŠ¨è¿˜æ˜¯æŒºå¤§çš„ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦åªæ˜¯æŠŠè‡ªå·±é‡åˆ°çš„é—®é¢˜è®°å½•ä¸‹æ¥ï¼Œæ²¡æœ‰é‡åˆ°çš„æš‚æ—¶å…ˆä¸ä¼šå‡ºç°åœ¨æ–‡ç« å†…ã€‚ç­‰æœ‰æ—¶é—´çš„è¯ä¼šå»ç½‘ä¸Šæ‰¾ä¸€æ‰¾ç„¶åæ€»ç»“ä¸‹æ¥çš„ã€‚ NavigationBar TitleView å®½åº¦ æˆ‘çš„ App ä¸­æ˜¯æœ‰è¿™ä¹ˆä¸€ä¸ªè‡ªå®šä¹‰çš„NavigationBar TitleViewçš„ï¼Œå…¶å®½åº¦åŸæœ¬åº”è¯¥ä¸å±å¹•å®½åº¦ä¸€è‡´ã€‚åœ¨ iOS 10 ä»¥åŠ Xcode 8.3.3 ä¸Šä¸€åˆ‡å®‰ç„¶æ— æ™ã€‚ä½†æ˜¯åœ¨ iOS 11 ä»¥åŠ Xcode 9 ä¸Šå°±å˜æˆäº†ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡æ ·ï¼ŒæŒ¤åˆ°äº†ä¸€èµ·ã€‚ æˆ‘ä»¬æŸ¥çœ‹å±‚æ¬¡ç»“æ„å¯ä»¥å‘ç°ï¼ŒTitleViewå˜å¾—è¿™ä¹ˆå°äº†ã€‚ è§£å†³æ–¹æ³• æˆ‘ä»¬å…ˆæ¥çœ‹è§£å†³æ–¹æ³•ï¼Œå†æ¥è¯´åŸå› ã€‚ è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨è‡ªå®šä¹‰çš„ TitleView çš„ç±»ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼Œå°±okäº†ã€‚ // é€‚é…iOS11çš„NavigationBar Tiltleå®½åº¦ã€‚ - (CGSize)intrinsicContentSize { return UILayoutFittingExpandedSize; } ç°åœ¨æˆ‘ä»¬å†è¿è¡Œç¨‹åºï¼Œä¸€åˆ‡æ­£å¸¸ï¼š åŸå›  é€šè¿‡å‚è€ƒ1ï¼Œé‡Œé¢æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š As an explanation: the titleView is now laid out with Auto Layout. Since it looks for the intrinsicContentSize, this is what worked. æˆ‘ç¿»è¯‘ä¸å¥½å°±ä¸ç¿»è¯‘äº†ï¼Œå¤§æ¦‚çš„æ„æ€å¥½åƒå°±æ˜¯ç°åœ¨ TitleView ä¼šå»å¯»æ‰¾ intrinsicContentSize è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¦‚æœéœ€è¦å»é‡å†™ä¸€ä¸‹è¿™ä¸ªå±æ€§çš„ getæ–¹æ³• ã€‚ ç„¶è€Œè¿™ä¸ªå±æ€§æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¹ˆé‡å†™è¿™ä¸ªå±æ€§ï¼Œç„¶åç»™å®ƒèµ‹å€¼ï¼Œè¦ä¹ˆé‡å†™ getæ–¹æ³• ï¼Œç›´æ¥ return ã€‚ æ›´åŠ è¯¦ç»†çš„å¯ä»¥ç§»æ­¥åˆ°å‚è€ƒ1å»æŸ¥çœ‹ã€‚ å³ä¾§è§†å›¾ ä»Šå¤©æµ‹è¯•å¦¹å­æäº†è¿™ä¹ˆä¸€ä¸ª bugï¼Œæ“ä½œæ­¥éª¤ç®€åŒ–ä¸€ä¸‹æ˜¯è¿™æ ·çš„ï¼š ç‚¹å‡»é¡µé¢ï¼ˆè¯¥é¡µé¢ NavigationBar åŒ…å«ä¸€ä¸ªè‡ªå®šä¹‰çš„ rightBarButtonItem ï¼‰ä¸­çš„ä¸€ä¸ª UISearchBar ï¼Œè°ƒç”¨ä¸€ä¸ªç‚¹å‡»æ‰‹åŠ¿ï¼Œpush åˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ newViewControllerã€‚ newViewController çš„ NavigationBar çš„ titleView æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„è§†å›¾ã€‚å…¶åŒ…å«äº†ä¸€ä¸ª UISearchBar å’Œä¸€ä¸ªå–æ¶ˆæŒ‰é’®ã€‚åŒæ—¶ NavigationBar çš„å·¦ä¾§æ˜¯æ²¡æœ‰è¿”å›æŒ‰é’®çš„ã€‚ ç†æƒ³çš„æ•ˆæœæ˜¯ï¼Œåœ¨è¿›å…¥ newViewController çš„åŒæ—¶ï¼Œå…¶ NavigationBar ä¸Šçš„ UISearchBar åº”è¯¥å˜æˆç¬¬ä¸€å“åº”è€…å¹¶å¼¹å‡ºé”®ç›˜ã€‚ ä½†æ˜¯å®é™…ä¸Šï¼Œé”®ç›˜æ˜¯å‡ºç°äº†ä¸€ç¬é—´ï¼Œç„¶åå°±æ¶ˆå¤±äº†ã€‚ è§£å†³æ–¹æ³• åœ¨ç‚¹å‡»æ‰‹åŠ¿çš„æ–¹æ³•ä¸­ï¼Œå°† NavigationBar çš„ rightBarButtonItem ç½®ä¸º nilã€‚ç„¶ååœ¨ viewWillAppear ä¸­å¯¹ rightBarButtonItem é‡æ–°èµ‹å€¼ã€‚ æ³¨æ„ï¼šéšè—æ˜¯æ— æ•ˆçš„ï¼Œå¿…é¡»ç½® nil æ‰å¯ä»¥ã€‚ åŸå›  è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› æˆ‘ä¹Ÿä¸å¤ªæ¸…æ¥š....æ‰¾äº†ä¸€ä¸Šåˆå®åœ¨æ‰¾ä¸åˆ°ï¼Œå‘ç°å’Œ UISearchBar ä»¥åŠæ§åˆ¶å™¨æœ¬èº«æ— å…³ã€‚å’Œ NavigationBarï¼ˆç©ºç™½çš„ï¼‰ä¹Ÿæ— å…³ã€‚æ— å¥ˆåªèƒ½æŒ¨ä¸ªæ³¨é‡Šæ¨¡å—ï¼Œæœ€ç»ˆæ‰¾åˆ°äº†è¿™ä¸ª rightBarButtonItem çš„é—®é¢˜ã€‚ æ¨æµ‹ä¸ iOS 11 ä¸­ rightBarButtonItem çš„å ä½æœ‰å…³ã€‚ä½†æ˜¯ä¸ºä½•ä¼šå¯¼è‡´é”®ç›˜æ¶ˆå¤±è¿˜æ˜¯ä¸å¤ªæ¸…æ¥š.... TabaleView åˆ‡æ¢æ—¶çš„æ»‘åŠ¨åŠ¨ç”» åœ¨ iOS 11 ä¸Šï¼Œpush è¿›å…¥ Table View æˆ–è€… pop å‡º Table View çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ª è‡ªä¸‹è€Œä¸Š çš„æ»‘åŠ¨æ•ˆæœã€‚ è§£å†³æ–¹æ³• å°† Table View çš„ contentInsetAdjustmentBehavior å±æ€§è®¾ä¸º UIScrollViewContentInsetAdjustmentNever å³å¯ã€‚ æ³¨æ„ï¼šéœ€è¦åšç‰ˆæœ¬åˆ¤æ–­ã€‚è¿™ä¸ªå±æ€§æ˜¯ä» iOS 11 å¼€å§‹æ‰æœ‰çš„ã€‚ å‚è€ƒä»£ç å¦‚ä¸‹ï¼š if (@available(iOS 11.0, *)) { self.tableView.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever; self.tableView.contentInset = UIEdgeInsetsMake(0, 0, [[UIScreen mainScreen] bounds].size.height == 812 ? 83 : 49, 0); self.tableView.scrollIndicatorInsets = _tableView.contentInset; } åŸå›  è¿™ä¸ªæ•ˆæœå®é™…ä¸Šä¸æ˜¯ Table View çš„ã€‚è€Œæ˜¯ Scroll View çš„ï¼Œè¯¦æƒ…è§ä¸‹é¢çš„ Scroll View å°èŠ‚ã€‚ ScrollView Scroll Viewåœ¨ iOS 11 æ–°å¢çš„ä¸¤ä¸ªå±æ€§ï¼šadjustContentInset å’Œ contentInsetAdjustmentBehaviorã€‚ adjustContentInset è¡¨ç¤º contentView.frame.origin åç§»äº†scrollview.frame.origin å¤šå°‘ï¼›æ˜¯ç³»ç»Ÿè®¡ç®—å¾—æ¥çš„ï¼Œè®¡ç®—æ–¹å¼ç”± contentInsetAdjustmentBehavior å†³å®šã€‚ contentInsetAdjustmentBehavior æ˜¯ä¸ªç»“æ„ä½“ï¼Œå…·ä½“å¦‚ä¸‹ï¼š typedef NS_ENUM(NSInteger, UIScrollViewContentInsetAdjustmentBehavior) { UIScrollViewContentInsetAdjustmentAutomatic, UIScrollViewContentInsetAdjustmentScrollableAxes, UIScrollViewContentInsetAdjustmentNever, UIScrollViewContentInsetAdjustmentAlways, } æ¯ä¸€ç§åˆ†åˆ«ä»£è¡¨ç€ä¸€ç§è®¡ç®—æ–¹å¼ï¼š UIScrollViewContentInsetAdjustmentAutomaticï¼šå¦‚æœ Scroll View åœ¨ä¸€ä¸ª automaticallyAdjustsScrollViewContentInset = YES çš„ æ§åˆ¶å™¨ ä¸Šï¼Œå¹¶ä¸”è¿™ä¸ª æ§åˆ¶å™¨ åŒ…å«åœ¨ä¸€ä¸ª Navigation Controller ä¸­ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šè®¾ç½®åœ¨ top &amp; bottom ä¸Š adjustedContentInset = safeAreaInset + contentInset ä¸ç®¡æ˜¯å¦æ»šåŠ¨ã€‚å…¶ä»–æƒ…å†µä¸‹ä¸ç¬¬äºŒä¸ªçš„ UIScrollViewContentInsetAdjustmentScrollableAxes ç›¸åŒã€‚ UIScrollViewContentInsetAdjustmentScrollableAxesï¼šåœ¨å¯æ»šåŠ¨æ–¹å‘ä¸Š adjustedContentInset = safeAreaInset + contentInset ï¼Œåœ¨ä¸å¯æ»šåŠ¨æ–¹å‘ä¸Š adjustedContentInset = contentInset ï¼›ä¾èµ–äº Scroll Enabled å’ŒalwaysBounceHorizontal / vertical = YESï¼ŒscrollEnabled é»˜è®¤ä¸º yesï¼Œæ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè®¡ç®—æ–¹å¼è¿˜æ˜¯ adjustedContentInset = safeAreaInset + contentInset UIScrollViewContentInsetAdjustmentNeverï¼šadjustedContentInset = contentInsetã€‚ adjustContentInset å€¼ä¸å— SafeAreaInset å€¼çš„å½±å“ã€‚ UIScrollViewContentInsetAdjustmentAlwaysï¼š adjustedContentInset = safeAreaInset + contentInset æƒé™ ä¿å­˜å›¾ç‰‡ åœ¨ iOS 11 ä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨ XCode 9 åŠä»¥ä¸Šç‰ˆæœ¬æ‰“åŒ…ã€‚é‚£ä¹ˆåœ¨ä¿å­˜å›¾ç‰‡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹é¢è¿™ä¸ªå´©æºƒï¼š This app has crashed because it attempted to access privacy-sensitive data without a usage description. The app's Info.plist must contain an NSPhotoLibraryAddUsageDescription key with a string value explaining to the user how the app uses this data. è§£å†³æ–¹æ³• æˆ‘ä»¬å¯ä»¥ç”¨ Source Code çš„æ–¹å¼æ‰“å¼€ info.plist æ–‡ä»¶ è¾“å…¥ä¸‹é¢çš„ä»£ç ï¼š &lt;key&gt;NSPhotoLibraryAddUsageDescription&lt;/key&gt; &lt;string&gt;Appéœ€è¦æ‚¨çš„åŒæ„,æ‰èƒ½ä¿å­˜å›¾ç‰‡&lt;/string&gt; åˆæˆ–è€…é€‰æ‹© Property List æ–¹æ³•ï¼Œåœ¨ App Transport Security Settings é¡¹ä¸­ç‚¹å‡»åŠ å·ï¼Œæ·»åŠ  Photo Library Additions Usage Description å­—æ®µã€‚Type é€‰æ‹© Stringï¼Œç„¶ååœ¨ Value ä¸­æ·»åŠ æç¤ºè¯­ã€‚ åŸå›  è¿™ä¸ªå´©æºƒçš„åŸå› æ˜¯å› ä¸ºï¼Œåœ¨ iOS 11 ä¸­ï¼Œä¿å­˜å›¾ç‰‡ä¹Ÿåƒè°ƒç”¨ç›¸æœºä¸€æ ·ï¼Œéœ€è¦è·å–æƒé™äº†ã€‚ å‚è€ƒ iOS 11 navigationItem.titleView Width Not Set ä½ å¯èƒ½éœ€è¦ä¸ºä½ çš„APPé€‚é…iOS11 iOS 11ä¸­APPä¸­tableViewå†…å®¹ä¸‹ç§»20ptæˆ–ä¸‹ç§»64ptçš„é—®é¢˜é€‚é…çš„ä¸€ä¸ªæ€»ç»“ iOS 11 NSPhotoLibraryAddUsageDescription é”™è¯¯çš„è§£å†³åŠæ³• ","link":"https://blog.rakuyo.dev/available-for-ios11/"},{"title":"Objective-C ä¸­çš„ nullableã€__nullable å’Œ _Nullable","content":"è¿™æ¬¡çš„å†…å®¹æ˜¯å…³äº nullableã€__nullable å’Œ _Nullable çš„ã€‚å¯¹äºæˆ‘ä»¬è¿™æ ·çš„åˆå­¦è€…ï¼Œåœ¨çœ‹ç¬¬ä¸‰æ–¹æ¡†æ¶æˆ–è€…å®˜æ–¹æ–‡æ¡£çš„æ—¶å€™ç»å¸¸ä¼šçœ‹åˆ°è¿™æ ·çš„å­—æ ·ã€‚ç„¶è€Œå¹³æ—¶ä¹Ÿæ²¡æœ‰å»ç ”ç©¶å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè¿™æ¬¡å°±æ¥å¥½å¥½è®°å½•ä¸€ä¸‹ä¸€ä¸‹å§ã€‚ æœ¬æ¬¡çš„å†…å®¹è½¬è½½è‡ªå‚è€ƒ1ï¼Œæ„Ÿè§‰åŸä½œè€…çš„åˆ†äº«ä¸è´¡çŒ®ã€‚ å‰è¨€ åœ¨ Swift ä¸­ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ ? å’Œ ! å»æ˜¾å¼å£°æ˜ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ–¹æ³•çš„å‚æ•°æ˜¯ optional è¿˜æ˜¯ non-optional ï¼Œè€Œåœ¨ Objective-C ä¸­åˆ™æ²¡æœ‰è¿™ä¸€åŒºåˆ†ï¼Œè¿™æ ·å°±ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ Swift ä¸ Objective-C æ··ç¼–æ—¶ï¼ŒSwift ç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“ä¸€ä¸ª Objective-C å¯¹è±¡æˆ–è€…ä¸€ä¸ªæ–¹æ³•çš„å‚æ•°åˆ°åº•æ˜¯ optional è¿˜æ˜¯ non-optional ï¼Œå› æ­¤è¿™ç§æƒ…å†µä¸‹ç¼–è¯‘å™¨ä¼šéšå¼åœ°éƒ½å½“æˆæ˜¯ non-optional æ¥å¤„ç†ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¤ªå¥½çš„ã€‚ è§£å†³æ–¹æ¡ˆ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè‹¹æœåœ¨ Xcode 6.3 å¼•å…¥äº†ä¸€ä¸ª Objective-C çš„æ–°ç‰¹æ€§ï¼š Nullability Annotations ï¼Œè¿™ä¸€æ–°ç‰¹æ€§çš„æ ¸å¿ƒæ˜¯ä¸¤ä¸ªæ–°çš„ç±»å‹ä¿®é¥°ï¼š __nullable å’Œ __nonnull ã€‚ä»å­—é¢ä¸Šæˆ‘ä»¬å¯çŸ¥ï¼Œ __nullable è¡¨ç¤ºå¯¹è±¡å¯ä»¥æ˜¯ NULL æˆ– nilï¼Œè€Œ __nonnull è¡¨ç¤ºå¯¹è±¡ä¸åº”è¯¥ä¸ºç©ºã€‚å½“æˆ‘ä»¬ä¸éµå¾ªè¿™ä¸€è§„åˆ™æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šç»™å‡ºè­¦å‘Šã€‚ åœ¨ Xcode 7 ä¸­ï¼Œä¸ºäº†é¿å…ä¸ç¬¬ä¸‰æ–¹åº“æ½œåœ¨çš„å†²çªï¼Œè‹¹æœæŠŠ __nonnull/__nullable æ”¹æˆ _Nonnull/_Nullable ã€‚å†åŠ ä¸Šè‹¹æœåŒæ ·æ”¯æŒäº†æ²¡æœ‰ä¸‹åˆ’çº¿çš„å†™æ³• nonnull/nullable ï¼Œäºæ˜¯å°±é€ æˆç°åœ¨æœ‰ä¸‰ç§å†™æ³•è¿™æ ·æ··ä¹±çš„å±€é¢ã€‚ ä½†æ˜¯è¿™ä¸‰ç§å†™æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯äº’é€šçš„ï¼Œåªæ˜¯æ”¾çš„ä½ç½®ä¸åŒï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š æ–¹æ³•è¿”å›å€¼ä¿®é¥°ï¼š - (nullable NSString *)method; - (NSString* __nullable)method; - (NSString* _Nullable)method; å£°æ˜å±æ€§çš„ä¿®é¥°ï¼š @property (nonatomic, copy, nullable) NSString *aString; @property (nonatomic, copy) NSString *__nullable aString; @property (nonatomic, copy) NSString *_Nullable aString; æ–¹æ³•å‚æ•°ä¿®é¥°ï¼š - (void)methodWithString:(nullable NSString*)aString; - (void)methodWithString:(NSString * _Nullable)aString; - (void)methodWithString:(NSString * __nullable)aString; è€Œå¯¹äº åŒæŒ‡é’ˆç±»å‹å¯¹è±¡ ã€ Block çš„è¿”å›å€¼ ã€ Block çš„å‚æ•° ç­‰ï¼Œè¿™æ—¶å€™å°±ä¸èƒ½ç”¨ nonnull/nullable ä¿®é¥°ï¼Œåªèƒ½ç”¨å¸¦ä¸‹åˆ’çº¿çš„ __nonnull/__nullable æˆ–è€… _Nonnull/_Nullable ï¼š - (void)methodWithError:(NSError* _Nullable * _Nullable)error - (void)methodWithError:(NSError* __nullable* __null_unspecified)error; // ä»¥åŠå…¶ä»–çš„ç»„åˆæ–¹å¼ - (void)methodWithBlock:(nullable void(^)())block; // æ³¨æ„ä¸Šé¢çš„ nullable ç”¨äºä¿®é¥°æ–¹æ³•ä¼ å…¥çš„å‚æ•° Block å¯ä»¥ä¸ºç©ºï¼Œè€Œä¸æ˜¯ä¿®é¥° Block è¿”å›å€¼ï¼› - (void)methodWithBlock:(void(^ _Nullable)())block; - (void)methodWithBlock:(void(^ __nullable)())block; - (void)methodWithBlock:(nullable id __nonnull(^)(id __nullable params))block; // æ³¨æ„ä¸Šé¢çš„ nullable ç”¨äºä¿®é¥°æ–¹æ³•ä¼ å…¥çš„å‚æ•° Block å¯ä»¥ä¸ºç©ºï¼Œè€Œ __nonnull ç”¨äºä¿®é¥° Block è¿”å›å€¼ id ä¸èƒ½ä¸ºç©ºï¼› - (void)methodWithBlock:(id __nonnull(^ __nullable)(id __nullable params))block; - (void)methodWithBlock:(id _Nonnull (^ _Nullable)(id _Nullable params))block; // the method accepts a nullable block that returns a nonnull value // there are some more combinations here, you get the idea ä½¿ç”¨è§„èŒƒ åœ¨çœ‹äº†åŸç”Ÿ iOS SDK é‡Œ Foundation å’Œ UIKit çš„å¤´æ–‡ä»¶ä»¥åŠè‹¹æœçš„åšæ–‡ ã€ŠNullability and Objective-Cã€‹ ï¼Œæˆ‘ä»¬æ€»ç»“å¦‚ä¸‹ä½¿ç”¨è§„èŒƒï¼š å¯¹äºå±æ€§ã€æ–¹æ³•è¿”å›å€¼ã€æ–¹æ³•å‚æ•°çš„ä¿®é¥°ï¼Œä½¿ç”¨ï¼š nonnull/nullableï¼› å¯¹äº C å‡½æ•°çš„å‚æ•°ã€Blockçš„å‚æ•°ã€Blockè¿”å›å€¼çš„ä¿®é¥°ï¼Œä½¿ç”¨ï¼š _Nonnull/_Nullableï¼Œ å»ºè®®å¼ƒç”¨ __nonnull/__nullable ã€‚ Nonnull Audited Regions å¦‚æœéœ€è¦æ¯ä¸ªå±æ€§æˆ–æ¯ä¸ªæ–¹æ³•éƒ½å»æŒ‡å®š nonnull å’Œ nullable ï¼Œå°†æ˜¯ä¸€ä»¶éå¸¸ç¹ççš„äº‹ã€‚ è‹¹æœä¸ºäº†å‡è½»æˆ‘ä»¬çš„å·¥ä½œé‡ï¼Œä¸“é—¨æä¾›äº†ä¸¤ä¸ªå®ï¼š NS_ASSUME_NONNULL_BEGIN å’Œ NS_ASSUME_NONNULL_END ã€‚åœ¨è¿™ä¸¤ä¸ªå®ä¹‹é—´çš„ä»£ç ï¼Œæ‰€æœ‰ç®€å•æŒ‡é’ˆå¯¹è±¡éƒ½è¢«å‡å®šä¸º nonnull ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å»æŒ‡å®šé‚£äº› nullable æŒ‡é’ˆå¯¹è±¡å³å¯ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š NS_ASSUME_NONNULL_BEGIN @interface myClass() @property (nonatomic, copy)NSString *aString; - (id)methodWithString:(nullable NSString*)str; @end NS_ASSUME_NONNULL_END åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ aString å±æ€§é»˜è®¤æ˜¯ nonnull çš„ï¼Œ methodWithString:æ–¹æ³•çš„è¿”å›å€¼ä¹Ÿæ˜¯ nonnull ï¼Œè€Œæ–¹æ³•çš„å‚æ•° str è¢«æ˜¾å¼æŒ‡å®šä¸º nullable ã€‚ ä¸è¿‡ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œè‹¹æœè¿˜åˆ¶å®šäº†ä»¥ä¸‹å‡ æ¡è§„åˆ™ï¼š é€šè¿‡ typedef å®šä¹‰çš„ç±»å‹çš„ nullability ç‰¹æ€§é€šå¸¸ä¾èµ–äºä¸Šä¸‹æ–‡ï¼Œå³ä½¿æ˜¯åœ¨ Audited Regions ä¸­ï¼Œä¹Ÿä¸èƒ½å‡å®šå®ƒä¸º nonnullï¼› å¯¹äºå¤æ‚çš„æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ id * ï¼‰å¿…é¡»æ˜¾å¼å»æŒ‡å®šæ˜¯ nonnull è¿˜æ˜¯ nullableã€‚ä¾‹å¦‚ï¼ŒæŒ‡å®šä¸€ä¸ªæŒ‡å‘ nullable å¯¹è±¡çš„ nonnull æŒ‡é’ˆï¼Œå¯ä»¥ä½¿ç”¨ __nullable id * __nonnull ï¼› æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„ NSError ** é€šå¸¸æ˜¯è¢«å‡å®šä¸ºä¸€ä¸ªæŒ‡å‘ nullable NSError å¯¹è±¡çš„ nullable æŒ‡é’ˆ ç–‘é—® è™½ç„¶åœ¨ Xcode 7 é‡Œé¢ï¼Œè‹¹æœå»ºè®®æˆ‘ä»¬æ”¾å¼ƒä½¿ç”¨ __nonnull/__nullable ï¼Œæ”¹ç”¨ _Nonnull/_Nullable æ¥ä¿®é¥°å¯¹è±¡å¯å¦ä¸ºç©ºï¼Œä½†å³ä½¿æ˜¯åœ¨æœ€æ–° ios 9.3 SDK çš„ Foundation å’Œ UIKit çš„å¤´æ–‡ä»¶é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®˜æ–¹åŸç”Ÿç±»çš„æ–¹æ³•å‚æ•°ä»ç„¶åœ¨ç”¨ __nonnull/__nullable ä¿®é¥°ã€‚ å¦å¤–ä¸ºä»€ä¹ˆå·²ç»æœ‰äº† nonnull/nullable ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¢åŠ  _Nonnull/_Nullable ï¼Ÿè¿™åˆ°åº•æ˜¯å‡ºäºä»€ä¹ˆè€ƒè™‘ï¼Ÿè‹¹æœåœ¨å®ƒçš„åšæ–‡ ã€ŠNullability and Objective-Cã€‹ ä¸­ä¹Ÿæ²¡æœ‰å…·ä½“è§£é‡Šï¼Œäºæ˜¯ StackOverflow ä¸Šæœ‰ä¸ªå…³äºæ­¤é—®é¢˜çš„è®¨è®ºï¼š Difference between nullable, __nullable and _Nullable in Objective-C ã€‚ å‚è€ƒ nullableã€__nullableã€_Nullable ç©¶ç«Ÿæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿâ€”â€”bravegogo æ³¨æ„ï¼šä¸Šé¢çš„blogæ ‡å‡†è¯¥åšæ–‡æœªè½¬å¸–ï¼Œç„¶è€Œå¹¶æ²¡æœ‰æ ‡æ³¨åŸå¸–åœ°å€ï¼Œæ•…åªèƒ½åœ¨æ­¤æ”¾å‡ºè½¬å¸–åœ°å€ã€‚ ","link":"https://blog.rakuyo.dev/nullable-of-objc/"},{"title":"Objective-C ä¹‹ Block åŸºç¡€ç”¨æ³•","content":"è¿™ä¸¤å¤©æ”¹bugæ”¹çš„å¤ªå¿™äº†....å®é™…ä¸Šè¯¥æ•´ç†çš„çŸ¥è¯†ç‚¹æŒºå¤šçš„ï¼Œä»Šå¤©å°±å…ˆè¯´ä¸€ä¸‹ Block å§ã€‚ æœ¬ç¯‡æ–‡ç« ä¸­å¤§é‡å†…å®¹å‚è€ƒã€è½¬è½½è‡ªæ–‡ç« æœ«å°¾çš„å‚è€ƒ1ï¼Œæ„Ÿè°¢åŸä½œè€…çš„æ€»ç»“ä¸åˆ†äº«ã€‚åŸæ–‡ä¸­è¿˜æœ‰æ›´å¤šæ›´è¯¦ç»†çš„å†…å®¹ï¼Œæ¬¢è¿å¤§å®¶ç‚¹å‡»åŸæ–‡å­¦ä¹ æ›´å¤šå†…å®¹ã€‚ ä»€ä¹ˆæ˜¯Block è®©æˆ‘ä»¬å…ˆç®€å•çš„ä»‹ç»ä¸€ä¸‹Block ä»£ç å—Blockæ˜¯è‹¹æœåœ¨iOS4å¼€å§‹å¼•å…¥çš„å¯¹Cè¯­è¨€çš„æ‰©å±•,ç”¨æ¥å®ç°åŒ¿åå‡½æ•°çš„ç‰¹æ€§ï¼ŒBlockæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼Œå…¶å¯ä»¥æ­£å¸¸å®šä¹‰å˜é‡ã€ä½œä¸ºå‚æ•°ã€ä½œä¸ºè¿”å›å€¼ï¼Œç‰¹æ®Šåœ°ï¼ŒBlockè¿˜å¯ä»¥ä¿å­˜ä¸€æ®µä»£ç ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨ï¼Œç›®å‰Blockå·²ç»å¹¿æ³›åº”ç”¨äºiOSå¼€å‘ä¸­ï¼Œå¸¸ç”¨äºGCDã€åŠ¨ç”»ã€æ’åºåŠå„ç±»å›è°ƒã€‚ ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼š Blockæ˜¯ä¸€ç§æ•°æ®ç±»å‹ã€‚ Blockå¯ä»¥åšå˜é‡ï¼Œä¹Ÿå¯ä»¥åšå‚æ•°ï¼Œè¿˜å¯ä»¥åšä¸ºè¿”å›å€¼ï¼Œç”šè‡³ç”¨æ¥ä¿å­˜ä¸€æ®µä»£ç ã€‚ Blockå˜é‡ Blockçš„å£°æ˜ Blockçš„å£°æ˜æ ¼å¼ä¸ºï¼šè¿”å›å€¼(^Blockåç§°)(å‚æ•°åˆ—è¡¨)ï¼Œè®©æˆ‘ä»¬æ¥ä¸¾ä¸ªæ —å­: NSString *(^aBlock)(NSString *str, NSArray *arr); å¦‚ä¸Šæ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºNSStringï¼Œåç§°ä¸ºaBlockï¼Œæ‹¥æœ‰2ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸ºNSStringå’ŒNSArrayçš„ä¸€ä¸ªBlockä»£ç å—ã€‚ æ³¨æ„ï¼š å…¶ä¸­å½¢å‚çš„å½¢å‚åï¼Œå³æ —å­ä¸­çš„strå’Œarrå¯ä»¥çœç•¥ä¸è®°ã€‚ è¿™é‡Œçš„åç§°æˆ‘ä»¬ä¾¿å¯ä»¥å°†å®ƒæƒ³è±¡æˆå‡½æ•°åã€‚ ç»™Blockå˜é‡èµ‹å€¼ æˆ‘ä»¬å£°æ˜å®ŒBlockä¹‹åï¼Œå°±è¯¥ç»™å˜é‡èµ‹å€¼äº†ã€‚ è¿™ç§æƒ…å†µä¸‹çš„æ ¼å¼ä¸ºï¼šå˜é‡å = ^è¿”å›å€¼ç±»å‹(å‚æ•°ç±»å‹){å‡½æ•°ä½“}ã€‚ä¸¾ä¸ªæ —å­ï¼š aBlock = ^NSString *((NSString *str, NSArray *arr) { NSLog(@&quot;%@, %@&quot;, str, arr); return str; }; è¿™é‡Œå®é™…ä¸Šæˆ‘ä»¬æ˜¯æŠŠä¸€ä¸ªå‡½æ•°ä½“èµ‹å€¼ç»™äº†Blockå˜é‡ã€‚ä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥Blockçš„ä¸€ä¸ªé‡è¦ç”¨æ³•ï¼Œé‚£å°±æ˜¯ç”¨æ¥å­˜å‚¨å‡½æ•°ä½“ã€‚ æ³¨æ„ï¼š è¿™é‡Œçš„è¿”å›å€¼ç±»å‹å¯ä»¥ä¸ç”¨å£°æ˜ï¼Œç›´æ¥çœç•¥ã€‚å› ä¸ºç¼–è¯‘å™¨å¯ä»¥ä»å­˜å‚¨ä»£ç å—çš„å˜é‡ä¸­ç¡®å®šè¿”å›å€¼çš„ç±»å‹ã€‚ å¦‚æœæ²¡æœ‰å‚æ•°åˆ—è¡¨ï¼Œåœ¨èµ‹å€¼çš„æ—¶å€™å¯ä»¥çœç•¥ã€‚ å£°æ˜çš„åŒæ—¶èµ‹å€¼ æŠŠä¸Šé¢ä¸¤ç‚¹ç»¼åˆèµ·æ¥å°±å°±å¯ä»¥äº†ï¼Œè¿™é‡Œç›´æ¥ç»™ä¸ªæ —å­å§ã€‚ NSString *(^aBlock)(NSString *, NSArray *) = ^(NSString *str, NSArray *arr) { NSLog(@&quot;%@, %@&quot;, str, arr); return str; }; è°ƒç”¨Blockå˜é‡ Blockå˜é‡çš„è°ƒç”¨å®é™…ä¸Šå’ŒCè¯­è¨€å‡½æ•°çš„è°ƒç”¨éå¸¸æ¥è¿‘ã€‚ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œè¿™é‡Œçš„å‚æ•°str1å’Œarræˆ‘åªè¿›è¡Œäº†åˆå§‹åŒ–ï¼Œæ²¡æœ‰èµ‹å€¼ã€‚ NSString *str1 = [[NSString alloc] init]; NSArray *arr = [NSArray array]; NSString *str = aBlock(str1, arr); NSLog(@&quot;%@&quot;,aBlock(str1, arr)); æ˜¯ä¸æ˜¯å’ŒCè¯­è¨€å¾ˆåƒå‘¢ã€‚ ä½¿ç”¨typedefå®šä¹‰Blockç±»å‹ åœ¨å®é™…ä½¿ç”¨Blockçš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬å¯èƒ½éœ€è¦é‡å¤åœ°å£°æ˜å¤šä¸ªç›¸åŒè¿”å›å€¼ç›¸åŒå‚æ•°åˆ—è¡¨çš„Blockå˜é‡,å¦‚æœæ€»æ˜¯é‡å¤åœ°ç¼–å†™ä¸€é•¿ä¸²ä»£ç æ¥å£°æ˜å˜é‡ä¼šéå¸¸ç¹ç,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨typedefæ¥å®šä¹‰Blockç±»å‹ã€‚ // å®šä¹‰ä¸€ç§æ— è¿”å›å€¼æ— å‚æ•°åˆ—è¡¨çš„Blockç±»å‹ typedef void(^SayHello)(); // æˆ‘ä»¬å¯ä»¥åƒOCä¸­å£°æ˜å˜é‡ä¸€æ ·ä½¿ç”¨Blockç±»å‹SayHelloæ¥å£°æ˜å˜é‡ SayHello hello = ^() { NSLog(@&quot;hello&quot;); }; // è°ƒç”¨åæ§åˆ¶å°è¾“å‡º&quot;hello&quot; hello(); æ³¨æ„ï¼Œåœ¨ä½¿ç”¨typedefçš„æ—¶å€™ï¼Œ(^)å†…çš„Blockåå·²ç»è¢«å½“åšäº†æ•´ä¸ªBlockç±»å‹çš„åç§°ï¼Œè€Œä¸å•å•æ˜¯ä¸€ä¸ªBlockçš„åç§°ã€‚ åœ¨å‡½æ•°å½¢å‚ä¸­ä½¿ç”¨Block å½¢å‚ä½¿ç”¨Blockæ—¶å‡½æ•°çš„å£°æ˜ Blockä½œä¸ºå‡½æ•°å½¢å‚æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç”¨æ³•ï¼Œ å¾ˆå¤šçŸ¥åçš„ç¬¬ä¸‰æ–¹åº“æˆ–è€…ç½‘ç»œè¯·æ±‚ä¸­éƒ½ä¼šåœ¨å‡½æ•°çš„å½¢å‚ä¸­ç”¨åˆ°Blockã€‚æˆ‘ä»¬è‡ªå·±å†™ä»£ç çš„æ—¶å€™ï¼Œå¶å°”ä¸ºäº†æ–¹ä¾¿é«˜æ•ˆï¼Œæˆ–è€…ä¸ºäº†å°è£…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Blockã€‚ å…¶æ ¼å¼ä¸ºï¼š-ï¼ˆè¿”å›å€¼ï¼‰å‡½æ•°åç§°ï¼šï¼ˆBlockè¿”å›ç±»å‹ï¼ˆ^ï¼‰ï¼ˆå‚æ•°åˆ—è¡¨ï¼‰ï¼‰å‡½æ•°å‚æ•°å æ³¨æ„ï¼š ä¸ºäº†çœ‹èµ·æ¥æ¸…æ™°ï¼Œåœ¨ä¸Šé¢çš„æ ¼å¼ä¸­ï¼Œæˆ‘ä½¿ç”¨çš„éƒ½æ˜¯ä¸­æ–‡æ ‡ç‚¹ï¼Œå®é™…ä½¿ç”¨ä¸­è‚¯å®šéƒ½è¦æ˜¯è‹±æ–‡æ ‡ç‚¹çš„ã€‚ åœ¨ä½œä¸ºå½¢å‚ä½¿ç”¨æ—¶ï¼Œå°†Blockå†™åœ¨å‡½æ•°å®šä¹‰/å£°æ˜çš„å½¢å‚ä½ç½®æ—¶ï¼ŒBlockæ²¡æœ‰Blockåç§°ã€‚ ä¸‹é¢æ˜¯æˆ‘è‡ªå·±çš„åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­å®šä¹‰çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°±ä½¿ç”¨åˆ°äº†Blockä½œä¸ºå½¢å‚ã€‚åœ¨è¿™é‡Œå¤§å®¶ç†è§£è¿™ç§å£°æ˜çš„æ ¼å¼å³å¯ã€‚ - (void)autoresizingMaskOfChildView:(NSMutableArray&lt;NSNumber *&gt; *(^)())autoMaskArr { NSMutableArray *tempArrM = [NSMutableArray arrayWithArray:autoMaskArr()]; } ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªè¿”å›å€¼ä¸ºç©ºvoidï¼Œåç§°ä¸ºautoresizingMaskOfChildViewï¼Œæ‹¥æœ‰ä¸€ä¸ªBlockå‚æ•°çš„å‡½æ•°ã€‚ å…¶ä¸­Blockå‚æ•°æ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºå­˜å‚¨NSNumberçš„NSMutableArrayï¼Œæ²¡æœ‰å‚æ•°åˆ—è¡¨ã€‚ è°ƒç”¨å½¢å‚ä½¿ç”¨Blockçš„å‡½æ•° æ²¡æœ‰å‚æ•°çš„Blockå½¢å‚ ä¸Šé¢é‚£ä¸ªæ —å­ä¸­çš„å‡½æ•°ï¼Œå…¶è°ƒç”¨çš„æ—¶å€™ä¼šæ˜¯è¿™æ ·çš„ï¼š [self.view autoresizingMaskOfChildView:^NSMutableArray&lt;NSNumber *&gt; *{ &lt;#code#&gt; }]; æˆ‘ä»¬åœ¨&lt;#code#&gt;ä¸­è¾“å…¥è‡ªå·±çš„ä»£ç ï¼Œè¿™ä¸€éƒ¨åˆ†çš„ä»£ç ç›¸å½“äºæ˜¯èµ‹å€¼ç»™äº†Blockå½¢å‚ã€‚ æœ‰å‚æ•°çš„Blockå½¢å‚ æˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œæ–¹æ³•ä¸­å®šä¹‰äº†ä¸€ä¸ªblockæ•°æ®ç±»å‹å‚æ•°ï¼ˆè¿”å›å€¼ä¸ºintç±»å‹çš„ï¼Œä¸”å¸¦æœ‰ä¸€ä¸ªintç±»å‹çš„å½¢å‚ï¼‰ - (void)calculate:(int (^)(int)) calculateBlock { //calculateBlockæ¥å—å¤–ç•Œä¼ å…¥çš„ä»£ç å—ï¼Œä¹Ÿå°±æ„å‘³ç€æ€ä¹ˆå»æ“ä½œæ˜¯ç”±å¤–ç•Œè°ƒç”¨è€…å†³å®šçš„ self.result = calculateBlock(_result);//å°†_resultçš„å€¼ä½œä¸ºå®å‚ä¼ å…¥ } å¤–éƒ¨æ§åˆ¶å™¨è°ƒç”¨æ—¶å¦‚ä¸‹æ‰€ç¤ºï¼š [manager calculate:^int(int i) { //å‚æ•°iè‡ªåŠ 1ï¼Œç„¶åè¿”å› i++; return i; }]; NSLog(@&quot;%d&quot;,manager.result); //è¾“å‡ºç»“æœä¸º1 é€šè¿‡æœ€åçš„NSLogè¾“å‡ºæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤–ç•Œè°ƒç”¨Blockçš„æ—¶å€™ï¼Œå‚æ•°içš„å€¼è¢«ä¼ ç»™äº†å‡½æ•°å®šä¹‰æ—¶çš„å‚æ•°_resultã€‚ç›¸å½“äº_result = iã€‚ å³æ˜¯å¤–ç•Œæä¾›å€¼ï¼Œç„¶åèµ‹å€¼ç»™Blockå†…éƒ¨çš„å˜é‡ã€‚è€Œä¸æ˜¯ä»Blockä¸­å°†å€¼ä¼ ç»™å¤–ç•Œã€‚ æ³¨æ„ï¼šä¸Šé¢è¿™ç§å†™æ³•å®é™…ä¸Šæœ‰å¾ˆå¤§é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°å£°æ˜çš„æ—¶å€™ï¼Œæ²¡æœ‰è¯´è¿™ä¸ªblcokæ˜¯ä¸èƒ½ä¸ºç©ºçš„ï¼Œé‚£ä¹ˆå‡å¦‚å¤–ç•Œåœ¨è°ƒç”¨è¿™ä¸ªblockçš„æ—¶å€™ï¼Œå¦‚æœç»™blockå‚æ•°çš„ä½ç½®ä¼ çš„æ˜¯nilï¼Œè€Œå‡½æ•°å†…éƒ¨åˆç»™è¿™ä¸ªblockä¼ äº†å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰äº§ç”ŸCrachã€‚ ä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š [manager calculate:nil]; calculate:å‡½æ•°å†…éƒ¨ä¸å˜ï¼Œä¾ç„¶æ˜¯è¿™æ ·ï¼š - (void)calculate:(int (^)(int)) calculateBlock { self.result = calculateBlock(_result); } è¿™æ ·å°±ä¼šå¯¼è‡´Crachï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨Blockä¹‹å‰è¦å¯¹Blockåšåˆ¤ç©ºå¤„ç†ã€‚ - (void)calculate:(int (^)(int)) calculateBlock { if (!calculateBlock) { self.result = calculateBlock(_result); } } ä½¿ç”¨typedefç®€åŒ–Block // 1.ä½¿ç”¨typedefå®šä¹‰Blockç±»å‹ typedef int(^MyBlock)(int, int); // 2.å®šä¹‰ä¸€ä¸ªå½¢å‚ä¸ºBlockçš„OCå‡½æ•° - (void)useBlockForOC:(MyBlock)aBlock { NSLog(@&quot;result = %d&quot;, aBlock(300,200)); } // 3.å£°æ˜å¹¶èµ‹å€¼å®šä¹‰ä¸€ä¸ªBlockå˜é‡ MyBlock addBlock = ^(int x, int y){ return x+y; }; // 4.ä»¥Blockä½œä¸ºå‡½æ•°å‚æ•°,æŠŠBlockåƒå¯¹è±¡ä¸€æ ·ä¼ é€’ [self useBlockForOC:addBlock]; // å°†ç¬¬3ç‚¹å’Œç¬¬4ç‚¹åˆå¹¶ä¸€èµ·,ä»¥å†…è”å®šä¹‰çš„Blockä½œä¸ºå‡½æ•°å‚æ•° [self useBlockForOC:^(int x, int y){ return x+y; }]; Objective-C ä¸­çš„blockå±æ€§ è¯´å®Œäº†å½¢å‚ä¸å˜é‡ï¼Œé‚£ä¹ˆåœ¨ Objective-C çš„å±æ€§ä¸­è¯¥å¦‚ä½•ä½¿ç”¨ block è¯­æ³•å‘¢ï¼Ÿ å®šä¹‰ block ç±»å‹ é¦–å…ˆæˆ‘ä»¬åº”è¯¥å®šä¹‰ä¸€ä¸ª block ç±»å‹ï¼š // åœ¨#import ä¸ @interface ä¹‹é—´å£°æ˜è¯¥ block ç±»å‹ typedef void(^ButtonEventsBlock)(UIButton *btn); è¿™æ ·æˆ‘ä»¬å°±å®šä¹‰äº†ä¸€ä¸ªè¿”å›å€¼ä¸ºç©ºï¼Œåç§°ä¸º ButtonEventsBlockï¼Œå¸¦æœ‰ä¸€ä¸ª UIButton ç±»å‹å‚æ•°çš„ block ç±»å‹äº†ã€‚ å£°æ˜ block å±æ€§ è¿™ä¸€æ­¥å¾ˆç®€å•ï¼Œå°±å¦‚åŒå£°æ˜å…¶ä»–å˜é‡ä¸€æ ·ï¼Œä½¿ç”¨ä¹‹å‰å®šä¹‰å¥½çš„ block ç±»å‹å£°æ˜ä¸€ä¸ªå˜é‡å³å¯ã€‚ @property (nonatomic, copy) ButtonEventsBlock buttonEventsBlock; å¯¹ block å±æ€§èµ‹å€¼ è¿™é‡Œæˆ‘å°†æ¼”ç¤ºä¸¤ç§æ–¹æ³•ï¼šæ‡’åŠ è½½ ä¸ Runtimeã€‚ æ‡’åŠ è½½ åœ¨ä»£ç ä¸­ä¸º block å±æ€§èµ‹å€¼å’Œä½¿ç”¨ æ‡’åŠ è½½ å¯¹ block èµ‹å€¼åœ¨è¯­æ³•å±‚é¢æ²¡æœ‰å¤ªå¤§çš„å·®å¼‚ï¼Œæ‰€ä»¥è¿™é‡Œå°±åªæ¼”ç¤ºæ‡’åŠ è½½äº†ã€‚ é‚£ä¹ˆè®©æˆ‘ä»¬ç›´æ¥ç ä»£ç å§ï¼š - (ButtonEventsBlock)buttonEventsBlock { if (!_buttonEventsBlock) { _buttonEventsBlock = ^(UIButton *btn) { // your code }; } return _buttonEventsBlock; } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¯­æ³•å±‚é¢ä¸Šï¼Œé™¤äº†ä¸º block èµ‹å€¼çš„é‚£éƒ¨åˆ†å¤–ï¼Œå…¶ä½™éƒ¨åˆ†ä¸ä¸€èˆ¬çš„æ‡’åŠ è½½å¹¶æ— å·®å¼‚ã€‚è€Œä¸º block èµ‹å€¼çš„é‚£éƒ¨åˆ†ä»£ç æˆ‘ä»¬ä¹‹å‰ä¹Ÿå·²ç»æåˆ°è¿‡äº†ã€‚ Runtime å¦‚æœæˆ‘ä»¬è¦åœ¨åˆ†ç±»ä¸­ä½¿ç”¨ block å±æ€§çš„è¯ï¼Œæˆ‘ä»¬å°±è¦å€Ÿä½ Runtime æ¥å®ç°äº†ã€‚å› ä¸º Category ä¸­å¹¶ä¸ä¼šä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä»£ç é•¿ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ static void *buttonEventsBlockKey = &amp;buttonEventsBlockKey; - (ButtonEventsBlock)buttonEventsBlock { return objc_getAssociatedObject(self, &amp;buttonEventsBlockKey); } - (void)setMbc_buttonEventsBlock:(ButtonEventsBlock)buttonEventsBlock { objc_setAssociatedObject(self, &amp;buttonEventsBlockKey, buttonEventsBlockKey, OBJC_ASSOCIATION_COPY); } å“ˆï¼Œè¿™é‡Œåˆå’Œä¸€èˆ¬çš„åœ¨ Category ä¸­ä½¿ç”¨å±æ€§çš„è¯­æ³•æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«äº†ã€‚åªä¸è¿‡ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•ä½¿ç”¨æ‡’åŠ è½½ä¸ºå…¶èµ‹å€¼äº†ï¼Œå¦‚æœéœ€è¦é»˜è®¤æ“ä½œçš„è¯ï¼Œæˆ‘ä»¬åªèƒ½åœ¨ä»£ç ä¸­å¯¹å…¶èµ‹å€¼äº†ã€‚ å‚è€ƒ ä¸€ç¯‡æ–‡ç« çœ‹æ‡‚iOSä»£ç å—Blockâ€”â€”èšŠé¦™é…± iOSå¼€å‘ï¼šBlockä½œä¸ºå‚æ•°ä½¿ç”¨ï¼ˆå¸¸è§äºå„æ¡†æ¶ï¼‰â€”â€”å¤é²é² ","link":"https://blog.rakuyo.dev/objc-block-basic-usage/"},{"title":"Objective-C ä¸­ id å’Œ instancetype çš„ä½¿ç”¨ä¸å¼‚åŒ","content":"ä»Šå¤©è®°å½•ä¸€ä¸‹åœ¨Objective-Cä¸­ï¼Œä¿ç•™å­—idå’Œinstancetypeå„è‡ªçš„ç”¨æ³•ï¼Œä»¥åŠå¼‚åŒã€‚ id ä»€ä¹ˆæ˜¯idç±»å‹ åœ¨æ¦‚å¿µä¸Šï¼Œidç±»ä¼¼äºJavaä¸­çš„Objectç±»ï¼Œå¯ä»¥è½¬æ¢ä¸ºä»»ä½•æ•°æ®ç±»å‹ã€‚æ¢å¥è¯è¯´ï¼Œidç±»å‹çš„å˜é‡å¯ä»¥å­˜æ”¾ä»»ä½•æ•°æ®ç±»å‹çš„å¯¹è±¡ã€‚åœ¨å†…éƒ¨å¤„ç†ä¸Šï¼Œè¿™ç§ç±»å‹è¢«å®šä¹‰ä¸ºæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘è¿™ç§å¯¹è±¡çš„å®ä¾‹å˜é‡çš„æŒ‡é’ˆã€‚ ä¸‹é¢æ˜¯idç±»å‹åœ¨Objective-Cä¸­çš„å®šä¹‰: typedef struct objc_object { Class isa; } *id; ä»ä¸Šé¢çœ‹å‡ºï¼Œidæ˜¯æŒ‡å‘struct objc_objectçš„ä¸€ä¸ªæŒ‡é’ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œidæ˜¯ä¸€ä¸ªæŒ‡å‘ä»»ä½•ä¸€ä¸ªç»§æ‰¿äº†Objectï¼ˆæˆ–è€…NSObjectï¼‰ç±»çš„å¯¹è±¡ã€‚ idçš„ç”¨æ³• idæ˜¯ä¸€ä¸ªæŒ‡é’ˆ å› ä¸ºidç±»å‹æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨idç±»å‹çš„æ—¶å€™ä¸éœ€è¦æ·»åŠ ä»»ä½•çš„æ˜Ÿå·ï¼Œä¾‹å¦‚: id foo = nil; ä¸Šé¢çš„ä»£ç å£°æ˜äº†ä¸€ä¸ªidç±»å‹çš„æŒ‡é’ˆfooï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘NSObjectçš„ä»»æ„ä¸€ä¸ªå­ç±»ã€‚ è€Œä¸‹é¢çš„ä»£ç åˆ™å®šä¹‰äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªæŒ‡é’ˆï¼Œè¢«æŒ‡å‘çš„è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘NSObjectçš„ä¸€ä¸ªå­ç±»ã€‚ id *foo = nil; å¯ä»¥æ¥æ”¶ä»»ä½•æ¶ˆæ¯ åœ¨ObjeciveCä¸­ï¼Œidæ˜¯å¯ä»¥æ¥æ”¶ä»»ä½•æ¶ˆæ¯çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä¸€ä¸ªå˜é‡å£°æ˜ä¸ºidç±»å‹ï¼Œç”¨æ¥æ¥æ”¶å¤šç§ç±»å‹çš„æ•°æ®ã€‚ ä¾‹å¦‚NSArrayä¸­å³å¯ä»¥æ¥æ”¶NSStringï¼Œä¹Ÿå¯ä»¥æ˜¯NSObjectï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨idäº†ã€‚ å°ç»“ åœ¨æˆ‘çš„ç†è§£çœ‹æ¥ï¼Œidç±»å‹å°±æ˜¯ä¸€ä¸ªä¸‡èƒ½çš„ç±»å‹ï¼Œå½“æˆ‘ä»¬æš‚æ—¶ä¸çŸ¥é“æ–¹æ³•çš„è¿”å›å€¼è¯¥æ˜¯ä»€ä¹ˆç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°è¯•å°†æ–¹æ³•å®šä¹‰ä¸ºidç±»å‹ï¼Œç­‰å¾…ç¡®å®šæ–¹æ³•è¿”å›å€¼åå†å›æ¥ä¿®æ”¹ï¼Œæˆ–è€…å°±ç›´æ¥å®šä¹‰ä¸ºidç±»å‹ç½¢äº†ã€‚ æˆ–è€…æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªidç±»å‹çš„å˜é‡ï¼Œç”¨å®ƒæ¥åšä¸­é—´å˜é‡ï¼Œç”¨æ¥æ¥æ”¶å¤šç§ç±»å‹çš„æ•°æ®ã€‚ å…³è”è¿”å›ç±»å‹ åœ¨ä»‹ç»instancetypeä¹‹å‰å…ˆè®²è§£ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯å…³è”è¿”å›ç±»å‹çš„æ–¹æ³•ã€‚ æ ¹æ®Cocoaçš„å‘½åè§„åˆ™ï¼Œæ»¡è¶³ä¸‹è¿°è§„åˆ™çš„æ–¹æ³•ï¼š ç±»æ–¹æ³•ä¸­ï¼Œä»¥allocæˆ–newå¼€å¤´ å®ä¾‹æ–¹æ³•ä¸­ï¼Œä»¥autoreleaseï¼Œinitï¼Œretainæˆ–selfå¼€å¤´ ä¼šè¿”å›ä¸€ä¸ªæ–¹æ³•æ‰€åœ¨ç±» ç±»å‹ çš„å˜é‡ï¼Œè¿™é‡Œæˆ‘ç”¨ç©ºæ ¼å’ŒåŠ ç²—æ–­å¥ï¼Œæ–¹ä¾¿å¤§å®¶ç†è§£ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æ–¹æ³•çš„è¿”å›å€¼çš„ç±»å‹ï¼Œæ˜¯è°ƒç”¨è¿™äº›æ–¹æ³•çš„é‚£ä¸ªç±»çš„ç±»å‹ã€‚NSArrayè°ƒç”¨çš„allocæ–¹æ³•ï¼Œå³[NSArray alloc]ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯NSArrayç±»å‹çš„ã€‚åŒç†[[NSArray alloc] init]è¿”å›çš„ä¹Ÿæ˜¯NSArrayç±»å‹çš„å€¼ã€‚ é‚£ä¹ˆè¯´å›æ¥ï¼Œä»¥ä¸Šè¿™äº›çš„æ–¹æ³•å‘¢ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºå…³è”è¿”å›ç±»å‹çš„æ–¹æ³•ã€‚ instancetype ä»€ä¹ˆæ˜¯instancetypeç±»å‹ instancetypeæ˜¯ä» clang 3.5 å¼€å§‹æä¾›çš„ä¸€ä¸ªå…³é”®å­—ï¼Œè¡¨ç¤ºæŸä¸ªæ–¹æ³•è¿”å›çš„æœªçŸ¥ç±»å‹çš„Objective-Cå¯¹è±¡ã€‚å•çœ‹è¿™ä¸ªå®šä¹‰ï¼Œæ„Ÿè§‰å’Œidè¿˜æ˜¯æŒºåƒçš„ã€‚ instancetypeçš„ä½œç”¨ å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ª: @interface UIView (TestView) + (id) testFounation; @end TestViewç±»æ˜¯UIViewç±»çš„åˆ†ç±»ï¼Œå½“æˆ‘ä»¬å¦‚ä¸‹è°ƒç”¨testFounationæ–¹æ³•æ—¶ [TestView testFounation]; å…¶è¿”å›å€¼çš„ç±»å‹å’Œæ–¹æ³•çš„å£°æ˜ç›¸åŒï¼Œæ˜¯idç±»å‹ã€‚ è€Œå¦‚æœæˆ‘ä»¬å¦‚ä¸‹ä½¿ç”¨instancetypeå£°æ˜testFounationçš„è¯ @interface UIView (TestView) + (instancetype) testFounation; @end å½“æˆ‘ä»¬å†æ¬¡è°ƒç”¨testFounationæ–¹æ³•: [TestView testFounation]; å…¶è¿”å›å€¼çš„ç±»å‹ä¼šæ˜¯TestViewç±»å‹ã€‚ å°ç»“ ç»¼ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œinstancetypeçš„ä½œç”¨å®é™…ä¸Šå°±æ˜¯ä½¿éå…³è”è¿”å›ç±»å‹çš„æ–¹æ³•è¿”å›æ‰€åœ¨ç±»çš„ç±»å‹ã€‚ é€šä¿—çš„è®²ï¼Œå°±æ˜¯å½“æˆ‘ä»¬éœ€è¦æ–¹æ³•çš„è¿”å›ç±»å‹ä¸æ˜¯æœªçŸ¥çš„idç±»å‹ï¼Œè€Œæ˜¯å…·ä½“çš„ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„ç±»çš„ç±»å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨instancetypeç±»å‹ã€‚ å†å…·ä½“ä¸€äº›ï¼Œå½“æˆ‘ä»¬è‡ªå®šä¹‰initæ–¹æ³•çš„æ—¶å€™ï¼Œå…¶è¿”å›å€¼å°±æ˜¯instancetypeç±»å‹ã€‚ idå’Œinstancetypeçš„å¼‚åŒ æ€»ç»“ä¸‹æ¥ï¼Œidå’Œinstancetypeçš„å¼‚åŒä¸€å…±æœ‰ä»¥ä¸‹å‡ ç‚¹: ç›¸åŒä¹‹å¤„ å…¶éƒ½å¯ä»¥ä½œä¸ºæ–¹æ³•çš„è¿”å›ç±»å‹ã€‚ ä¸åŒä¹‹å¤„ instancetypeå¯ä»¥è¿”å›å’Œæ–¹æ³•æ‰€åœ¨ç±»ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œidåªèƒ½è¿”å›æœªçŸ¥ç±»å‹çš„å¯¹è±¡ã€‚ instancetypeåªèƒ½ä½œä¸ºè¿”å›å€¼ï¼Œä¸èƒ½åƒidé‚£æ ·ä½œä¸ºå‚æ•°ã€‚instancetypeåªé€‚ç”¨äºåˆå§‹åŒ–æ–¹æ³•å’Œä¾¿åˆ©æ„é€ å™¨çš„è¿”å›å€¼ç±»å‹ã€‚ åœ¨ä¸åŒçš„å†…å­˜ç®¡ç†æœºåˆ¶ä¸­: åœ¨ARC(Auto Reference Count)ç¯å¢ƒä¸‹:instancetypeç”¨æ¥åœ¨ç¼–è¯‘æœŸç¡®å®šå®ä¾‹çš„ç±»å‹,è€Œä½¿ç”¨idçš„è¯,ç¼–è¯‘å™¨ä¸æ£€æŸ¥ç±»å‹, è¿è¡Œæ—¶æ£€æŸ¥ç±»å‹ã€‚ åœ¨MRC(Manual Reference Count)ç¯å¢ƒä¸‹:instancetypeå’Œidä¸€æ ·,ä¸åšå…·ä½“ç±»å‹æ£€æŸ¥ã€‚ å…³äºç¬¬ä¸‰ç‚¹ï¼Œå› ä¸ºæˆ‘ç°åœ¨è¿˜æ²¡æœ‰å…·ä½“å­¦ä¹ åˆ°å†…å­˜ç®¡ç†ç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒä¸‹æ–¹å‚è€ƒä¸­ä¸‰æœ¨æˆæ£®çš„æ–‡ç« ï¼Œæœ‰ä¸¾ä¾‹è¯´æ˜è¯¥ç‚¹ã€‚ å‚è€ƒ Objective-Cä¸­çš„idç±»å‹â€”â€”Kilnn ç†è§£Objective C ä¸­idâ€”â€”åšä¸ªä¸å–„çš„äºº OCä¸­instancetypeä¸idçš„åŒºåˆ«â€”â€”ä¸‰æœ¨æˆæ£® Objective-Cä¸­çš„instancetypeå’ŒidåŒºåˆ«â€”â€”kuizhang1 ","link":"https://blog.rakuyo.dev/use-of-id-and-instancetype/"},{"title":"Cè¯­è¨€çš„å˜é‡ç±»å‹","content":"cè¯­è¨€å¤ä¹ ä¹‹è·¯ï¼Œä¹‹ä¸€ å˜é‡ç±»å‹ å˜é‡çš„å­˜å‚¨ç±»å‹ Cè¯­è¨€æ ¹æ®å˜é‡çš„å­˜å‚¨ç±»å‹çš„ä¸åŒï¼Œå¯ä»¥æŠŠå˜é‡åˆ†ä¸º:è‡ªåŠ¨å˜é‡ã€é™æ€å˜é‡ã€å¯„å­˜å™¨å˜é‡ã€‚ è‡ªåŠ¨å˜é‡ å®šä¹‰ï¼šè‡ªåŠ¨å˜é‡æ˜¯å­˜å‚¨åœ¨å †æ ˆä¸­çš„ã€‚ æ‰€æœ‰å±€éƒ¨å˜é‡é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯è‡ªåŠ¨å˜é‡ã€‚ å£°æ˜å‘¨æœŸï¼šè‡ªåŠ¨å˜é‡éšæ‰€åœ¨ä»£ç å—è¢«æ‰§è¡Œè€Œåˆ›å»ºï¼Œéšæ‰€åœ¨ä»£ç å—æ‰§è¡Œç»“æŸè€Œé”€æ¯ã€‚å¦‚æœå‡½æ•°è¢«é‡å¤è°ƒç”¨ï¼Œè‡ªåŠ¨å˜é‡ä¼šè¢«é‡å¤åˆ›å»ºã€é”€æ¯ã€‚ é™æ€å˜é‡ å®šä¹‰ï¼šé™æ€å˜é‡å­˜å‚¨äºé™æ€å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯ä¸å±äºå †æ ˆã€‚ å“ªäº›æ˜¯é™æ€å˜é‡: æ‰€æœ‰çš„å…¨å±€å˜é‡éƒ½æ˜¯é™æ€å˜é‡ã€‚ è¢«å…³é”®å­—staticä¿®é¥°çš„å±€éƒ¨å˜é‡ä¹Ÿæ˜¯é™æ€å˜é‡ã€‚ å£°æ˜å‘¨æœŸ:é™æ€å˜é‡åœ¨ç¨‹åºè¿è¡Œä¹‹å‰è¢«åˆ›å»ºï¼Œå§‹ç»ˆå­˜åœ¨ã€‚ å¯„å­˜å™¨å˜é‡ å®šä¹‰:å­˜å‚¨åœ¨ç¡¬ä»¶å¯„å­˜å™¨ä¸­çš„å˜é‡ï¼Œç§°ä¸ºå¯„å­˜å™¨å˜é‡ã€‚ å“ªäº›å˜é‡æ˜¯å¯„å­˜å™¨å˜é‡: è¢«å…³é”®å­—registerä¿®é¥°çš„è‡ªåŠ¨å˜é‡éƒ½æ˜¯å¯„å­˜å™¨å˜é‡ã€‚ åªæœ‰è‡ªåŠ¨å˜é‡æ‰å¯ä»¥æ˜¯å¯„å­˜å™¨å˜é‡ï¼Œé™æ€å˜é‡(å…¨å±€å˜é‡)ä¸è¡Œã€‚ å¯„å­˜å™¨å˜é‡åªé™äºintã€charå’ŒæŒ‡é’ˆç±»å‹ä½¿ç”¨ã€‚ ç”Ÿå‘½å‘¨æœŸ:è°ƒç”¨è¯¥å‡½æ•°æ—¶å ç”¨å¯„å­˜å™¨ä¸­å­˜æ”¾çš„å€¼ï¼Œå½“å‡½æ•°ç»“æŸæ—¶é‡Šæ”¾å¯„å­˜å™¨ï¼Œå˜é‡æ¶ˆå¤±ã€‚ ä½¿ç”¨æ³¨æ„: ä¸èƒ½è¿‡å¤šä½¿ç”¨ã€‚å¦‚æœå¯„å­˜å™¨ä½¿ç”¨é¥±å’Œæ—¶ï¼Œç¨‹åºå°†å¯„å­˜å™¨å˜é‡è‡ªåŠ¨è½¬æ¢ä¸ºè‡ªåŠ¨å˜é‡å¤„ç†ã€‚ ä¸ºäº†æé«˜è¿ç®—é€Ÿåº¦ï¼Œä¸€èˆ¬ä¼šå°†ä¸€äº›é¢‘ç¹ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡å®šä¹‰ä¸ºå¯„å­˜å™¨å˜é‡ï¼Œè¿™æ ·ç¨‹åºå°½å¯èƒ½åœ°ä¸ºå®ƒåˆ†é…å¯„å­˜å™¨å­˜æ”¾ï¼Œè€Œä¸ç”¨å†…å­˜ã€‚ register int a; // aå°±æ˜¯ä¸€ä¸ªå¯„å­˜å™¨å˜é‡ å‚è€ƒ ã€Cè¯­è¨€ã€‘18-å˜é‡ç±»å‹â€”â€”Mäº†ä¸ªJ ","link":"https://blog.rakuyo.dev/variable-types-in-c/"},{"title":"Git åŸºæœ¬æ“ä½œæ€»ç»“","content":"æ€»ç»“ä¸€ä¸‹ Mac ä¸‹ Git çš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚ æœ¬æ–‡å…¶å®æ˜¯æŠŠä¹‹å‰ç»™å¤§ä¸€å­¦ç”Ÿè®² Git æ—¶å¤‡è¯¾çš„ç¨¿å­æ‹¿è¿‡æ¥ï¼Œæ•´ç†ä¿®æ”¹ï¼ŒäºŒæ¬¡åŠ å·¥åçš„äº§ç‰©ã€‚ æ–‡ç« é£æ ¼åå‘äºâ€œå¤‡å¿˜å½•â€ï¼Œè€Œä¸æ˜¯â€œæ•™ç¨‹â€ã€‚éƒ¨åˆ†åœ°æ–¹è¯´çš„ä¸å¤Ÿæ¸…æ™°è¿˜è¯·è¯»è€…è§è°…ã€‚ è‡³äºGitçš„åˆå­¦è€…å¯ä»¥æ‹‰åˆ°æ–‡ç« æœ€ä¸‹é¢ï¼Œåˆ°å»–é›ªå³°å¤§ç¥çš„blogå»å­¦ä¹ ã€‚ æ¦‚è§ˆ é¦–å…ˆæ”¾ä¸€ä¸ªåæ–‡æ¶‰åŠåˆ°çš„å‘½ä»¤çš„æ€»ç»“ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾ã€‚ æŒ‡ä»¤ ä½œç”¨ ssh-keygen -t rsa -C &quot;your-email@emial.com&quot; æ–°å»º SSH ssh -T git@&lt;git url&gt; æ£€æŸ¥æœ¬åœ°å’Œè¿œç«¯çš„ SSH è¿é€šæ€§ git add xx.txt æ·»åŠ æŸä¸€æ–‡ä»¶åˆ°ç¼“å­˜åŒº git add . æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°ç¼“å­˜åŒº git commit -m&quot;æ³¨é‡Šä¿¡æ¯&quot; æäº¤ä¿®æ”¹åˆ°å·¥ä½œåŒº git status æŸ¥çœ‹Gitä»“åº“çŠ¶æ€ git diff æŸ¥çœ‹æ–‡ä»¶ä¸ä¹‹å‰æœ‰ä½•ä¸åŒ git reset --hard HEAD^ è¿”å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ git reset --hard HEAD~10 å‘å‰å›æ»š10ä¸ªç‰ˆæœ¬ git reset --hard commit IDå€¼ å›æ»šåˆ°æŸä¸ªå…·ä½“çš„ç‰ˆæœ¬ git log --pretty=oneline è¾“å‡ºcommitæ—¥å¿—ï¼ŒåŒ…å«ä½œè€…ï¼Œæ—¥æœŸï¼Œæäº¤è¯´æ˜ï¼Œæäº¤ID git reflog è¾“å‡ºæ‰€æœ‰çš„æ“ä½œä¿¡æ¯ã€‚æ–¹ä¾¿æˆ‘ä»¬åœ¨æ¸…å±æˆ–é€€å‡ºç»ˆç«¯åæŸ¥è¯¢commit IDå€¼ git checkout -- file æ’¤é”€å·¥ä½œåŒºä¿®æ”¹(addä¹‹å‰) git reset HEAD file æ’¤é”€æš‚å­˜åŒºä¿®æ”¹(commitä¹‹å‰) rm file åˆ é™¤æœ¬åœ°æ–‡ä»¶ git rm file åˆ é™¤gitä»“åº“ä¸­çš„æ–‡ä»¶ git branch æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼Œç»¿è‰²ä¸ºå½“å‰åˆ†æ”¯ git branch åˆ†æ”¯å åˆ›å»ºåˆ†æ”¯ git checkout åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ git checkout -b åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ git log --graph --pretty=oneline --abbrev-commit è¾“å‡ºå¸¦åˆ†æ”¯ä¿¡æ¯çš„logåˆ—è¡¨ git merge ç›®æ ‡åˆ†æ”¯å åˆå¹¶åˆ†æ”¯ git branch -d åˆ†æ”¯å åˆ é™¤åˆ†æ”¯ SSH é¦–å…ˆæ˜¯ SSHï¼Œå»ºè®®é€šè¿‡ SSH è€Œä¸æ˜¯ https å…‹éš†é¡¹ç›®ï¼Œæœ‰ä¸€äº›å…¬å¸ç”šè‡³å¯èƒ½ä¼šè®¾ç½®åªå…è®¸é€šè¿‡ SSH è¿›è¡Œå…‹éš†ã€‚ æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨é…ç½® SSH æœ¬åœ°ç›®å½•ä¸º ~/.sshï¼Œå¯ä»¥åœ¨ Finder æˆ–ç»ˆç«¯ä¸­è¿›åˆ°è¯¥æ–‡ä»¶å¤¹ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨ id_rsa å’Œ id_rsa.pub æ–‡ä»¶ï¼Œæ¥åˆ¤æ–­æ˜¯å¦å·²ç»åˆ›å»ºäº† SSH é…ç½®ã€‚å¦‚æœæ‚¨ä¹‹å‰æ²¡æœ‰é…ç½®è¿‡ SSHï¼Œé‚£ä¹ˆå¯èƒ½è¿è¿™ä¸ªæ–‡ä»¶å¤¹éƒ½ä¸å­˜åœ¨ã€‚ æ–°å»º SSH å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±éœ€è¦æ–°å»ºã€‚å‘½ä»¤å¦‚ä¸‹ï¼š $ ssh-keygen -t rsa -C &quot;your-email@emial.com&quot; è¾“å…¥å®Œè¿™æ¡å‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬è¿ç€æ•²ä¸‰ä¸ªå›è½¦ï¼Œä¸ç®¡å®ƒæ˜¾ç¤ºçš„ä»€ä¹ˆï¼Œä¸€ç›´æ•²å›è½¦ã€‚ç›´åˆ°ä¸‹é¢å‡ºç°ä¸€ä¸ªå›¾å½¢ã€‚ ä¹‹åå°±å¯ä»¥åˆ° ~/.ssh æ–‡ä»¶å¤¹ä¸‹æŸ¥çœ‹æ˜¯å¦å¤šå‡ºäº† id_rsa å’Œ id_rsa.pub æ–‡ä»¶ã€‚ æ·»åŠ åˆ°è¿œç«¯ Git å¹³å° ä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡ cat å‘½ä»¤ï¼Œæˆ–è€…ç›´æ¥æ‰“å¼€ id_rsa.pub æ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„å†…å®¹å¤åˆ¶åˆ° Git å¹³å°çš„ SSH é…ç½®ä¸­å³å¯ã€‚ æ£€æŸ¥è¿é€šæ€§ æ·»åŠ å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥æœ¬åœ°å’Œè¿œç«¯ Git çš„ SSH è¿é€šæ€§ã€‚ $ ssh -T git@&lt;git url&gt; æ•²å›è½¦åï¼Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡è¿æ¥ï¼Œä¼šè¯¢é—®ä½ yes or noï¼Œè¾“å…¥yesï¼Œç„¶åè¾“å…¥ Git çš„å¯†ç ã€‚å¦‚æœä¸€åˆ‡éƒ½æ²¡é—®é¢˜ï¼Œä¼šè¿”å›æ¬¢è¿ä¿¡æ¯ã€‚ Git é…ç½® é…ç½®å¥½ SSH ä¹‹åï¼Œå°±å¯ä»¥å›è¿‡å¤´æ¥é…ç½® Gitã€‚ Mac å¹³å°åœ¨å®‰è£…äº† Xcode åè‡ªå¸¦ Git æœåŠ¡ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ä¸‹åˆ—å‘½ä»¤è¿›è¡Œ Git é…ç½®ï¼š $ git config --global user.name &quot;Your Name&quot; $ git config --global user.email &quot;email@example.com&quot; æ–°å»º Git é¡¹ç›®ä¸è¿œç«¯å…‹éš† ä¸€èˆ¬å¾ˆå°‘æœ‰åªåœ¨æœ¬åœ°ä½¿ç”¨ Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„åœºæ™¯ï¼ŒåŸºæœ¬éƒ½ä¼šå’Œè¿œç«¯ Git ç»“åˆä¸€èµ·ä½¿ç”¨ã€‚ é‚£ä¹ˆæˆ‘å»ºè®®çš„æµç¨‹æ˜¯ï¼š ç°åœ¨è¿œç«¯å»ºç«‹ç©ºé¡¹ç›® å°†è¿œç«¯é¡¹ç›®å…‹éš†åˆ°æœ¬åœ° åœ¨å…‹éš†çš„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºé¡¹ç›®è¿›è¡Œå¼€å‘ æœ‰çš„äººä¹ æƒ¯æœ¬åœ°æœ‰é¡¹ç›®ä¹‹åï¼Œå†å’Œè¿œç«¯é¡¹ç›®è¿›è¡Œå…³è”ã€‚è¿™é‡Œä¸ä»‹ç»è¯¥ç§æ–¹æ³•ã€‚ å¦‚æœä½ æœ¬åœ°å·²ç»æœ‰ä»£ç ï¼š æ²¡æœ‰é›†æˆ Git çš„æƒ…å†µä¸‹ï¼Œåœ¨è¿œç«¯ç©ºé¡¹ç›®å…‹éš†åˆ°æœ¬åœ°åï¼Œç›´æ¥å°†æœ¬åœ°å·²æœ‰çš„ä»£ç ç§»åŠ¨åˆ°è¯¥ç©ºé¡¹ç›®ä¸­å³å¯ã€‚ å¦‚æœå·²ç»é›†æˆäº† Gitï¼Œåˆ™å¯ä»¥ä¿®æ”¹é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹çš„ .git/config æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­çš„ remote é‡Œçš„ url é¡¹æ”¹ä¸ºè¿œç«¯ url å³å¯ã€‚è¯¥æ“ä½œä¹Ÿé€‚ç”¨äºæ›´æ¢é¡¹ç›®çš„è¿œç«¯åœ°å€ã€‚ å…‹éš†é¡¹ç›® å…‹éš†çš„å‘½ä»¤éå¸¸ç®€å•ï¼Œè€Œä¸”éå¸¸é¡¾åæ€ä¹‰ã€‚åœ¨æŸä¸€ç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ï¼Œå°±å¯ä»¥å°†è¿œç¨‹ä»“åº“é‡Œçš„å†…å®¹å…¨éƒ¨å…‹éš†åˆ°æœ¬åœ°è¯¥æ–‡ä»¶å¤¹ä¸‹ã€‚ $ git clone &lt;sshé“¾æ¥&gt; æ¨é€æ–‡ä»¶ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç å°†æœ¬åœ°é¡¹ç›® push æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚ $ git push origin master è¯¥å‘½ä»¤å®é™…ä¸Šæ˜¯æŠŠå½“å‰åˆ†æ”¯ master æ¨é€åˆ°è¿œç¨‹ã€‚ Git å¸¸ç”¨æ“ä½œ æ·»åŠ ï¼Œæäº¤æ–‡ä»¶ æ·»åŠ ã€æäº¤æ–‡ä»¶çš„æ­¥éª¤ä¸º: $ git add xx.txt $ git commit -m &quot;æ³¨é‡Šä¿¡æ¯&quot; addï¼Œæ·»åŠ çš„æ„æ€ï¼ŒæŠŠxx.txtæ·»åŠ åˆ°gitä»“åº“ã€‚ commitï¼Œæäº¤çš„æ„æ€ã€‚åé¢çš„-mçš„å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªæè¿°æ€§å†…å®¹ï¼Œç”¨æ¥æè¿°æˆ‘ä»¬è¿™æ¬¡æäº¤çš„å¯¹æ–‡ä»¶åšäº†å“ªäº›ä¿®æ”¹çš„ã€‚ æ³¨æ„: å¯ä»¥ä½¿ç”¨ git add . å°†æ‰€æœ‰æ–‡ä»¶ä¸€å¹¶ addï¼Œé€‚åˆå¯¹å¤šä¸ªæ–‡ä»¶è¿›è¡Œä¿®æ”¹çš„æƒ…å†µã€‚ä¸€èˆ¬ç›´æ¥ç”¨è¿™ä¸ªå°±å¯ä»¥ã€‚ åœ¨æäº¤æ—¶ï¼Œ-m å¯ä»¥å…ˆè¾“å…¥ä¸€ä¸ªå·¦å•å¼•å·ï¼Œæ•²å›è½¦åå¯ä»¥è¾“å…¥å¤šè¡Œæ³¨é‡Šä¿¡æ¯ã€‚ç„¶åå†è¾“å…¥å³å•å¼•å·ï¼Œå®Œæˆæ³¨é‡Šä¿¡æ¯çš„è¾“å…¥ã€‚ è¿™ä¸ª add å‘½ä»¤å®é™…ä¸Šæ˜¯å¯ä»¥ä¸€å£æ°”æ·»åŠ å¤šä¸ªæ–‡ä»¶ï¼Œç„¶åä¸€å£æ°” commitã€‚ ä¿®æ”¹æ–‡ä»¶ æŒ‡ä»¤ ä½œç”¨ git status æŸ¥çœ‹Gitä»“åº“çŠ¶æ€ git diff æŸ¥çœ‹æ–‡ä»¶ä¸ä¹‹å‰æœ‰ä½•ä¸åŒ ç‰ˆæœ¬å›é€€ ä¸‹é¢çš„è¡¨æ ¼æ˜¯ç‰ˆæœ¬å›é€€çš„å…·ä½“æŒ‡ä»¤ã€‚ æŒ‡ä»¤ ä½œç”¨ git reset --hard HEAD^ è¿”å›åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ git reset --hard HEAD~10 å‘å‰å›æ»š10ä¸ªç‰ˆæœ¬ git reset --hard commit IDå€¼ å›æ»šåˆ°æŸä¸ªå…·ä½“çš„ç‰ˆæœ¬ ä¸‹é¢çš„è¡¨æ ¼å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æˆ‘ä»¬æ‰€éœ€è¦çš„commit IDå€¼ã€‚ æŒ‡ä»¤ ä½œç”¨ git log --pretty=oneline è¾“å‡º commit æ—¥å¿—ï¼ŒåŒ…å«ä½œè€…ï¼Œæ—¥æœŸï¼Œæäº¤è¯´æ˜ï¼Œæäº¤ID git reflog è¾“å‡ºæ‰€æœ‰çš„æ“ä½œä¿¡æ¯ã€‚æ–¹ä¾¿æˆ‘ä»¬åœ¨æ¸…å±æˆ–é€€å‡ºç»ˆç«¯åæŸ¥è¯¢commit IDå€¼ æ’¤é”€ä¿®æ”¹ åœ¨æˆ‘ä»¬ push åˆ°è¿œç¨‹ä»“åº“ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹è¡¨çš„æŒ‡ä»¤æ¥æ’¤é”€æˆ‘ä»¬å¯¹ä»“åº“å†…æ–‡ä»¶åšå‡ºçš„ä¿®æ”¹ã€‚æ¢å¤åˆ°ä¸Šæ¬¡æäº¤çš„çŠ¶æ€ã€‚ æŒ‡ä»¤ ä½œç”¨ git checkout -- file æ’¤é”€å·¥ä½œåŒºä¿®æ”¹(addä¹‹å‰) git reset HEAD file æ’¤é”€æš‚å­˜åŒºä¿®æ”¹(commitä¹‹å‰) git reset --hard HEAD^ å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬(pushä¹‹å‰) åˆ é™¤æ–‡ä»¶/æ–‡ä»¶å¤¹ æŒ‡ä»¤ ä½œç”¨ rm file åˆ é™¤æœ¬åœ°æ–‡ä»¶ git rm file åˆ é™¤gitä»“åº“ä¸­çš„æ–‡ä»¶ git rm æ–‡ä»¶å¤¹å -r -f åˆ é™¤gitå’Œæœ¬åœ°ä¸­è¯¥æ–‡ä»¶å¤¹åŠå…¶ä¸‹æ–‡ä»¶ æ³¨æ„ åœ¨ git rm ä¹‹å‰ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ’¤é”€ï¼Œå¯ä»¥æ”¾å¼ƒå·¥ä½œåŒºä¿®æ”¹ï¼Œgit checkout -- fileã€‚ åœ¨ git rm ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ’¤é”€ï¼Œç›´æ¥ git reset --hard HEAD^ å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±å¯ä»¥äº† åœ¨è¿™é‡Œå¤šè¯´ä¸€å¥ï¼Œå¦‚æœæƒ³è¦åˆ é™¤Gitä»“åº“ï¼Œæˆ‘ä»¬ç”¨ä»£ç  rm -rf .git åˆ é™¤**.gitæ–‡ä»¶å¤¹**å°±å¯ä»¥äº†ã€‚ åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯ åˆ›å»ºåˆ†æ”¯ä¸åˆ‡æ¢åˆ†æ”¯ç›¸å…³çš„å‘½ä»¤å¦‚ä¸‹è¡¨æ‰€ç¤º: æŒ‡ä»¤ ä½œç”¨ git branch æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨ï¼Œç»¿è‰²ä¸ºå½“å‰åˆ†æ”¯ git branch åˆ†æ”¯å åˆ›å»ºåˆ†æ”¯ git checkout åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ git checkout -b åˆ†æ”¯å åˆ‡æ¢åˆ†æ”¯ï¼Œè‹¥ä¸å­˜åœ¨åˆ™åˆ›å»ºå®ƒ git log --graph --pretty=oneline --abbrev-commit è¾“å‡ºå¸¦åˆ†æ”¯ä¿¡æ¯çš„logåˆ—è¡¨ åˆå¹¶åˆ†æ”¯ åœ¨æˆ‘ä»¬åˆ‡æ¢å›masteråˆ†æ”¯åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥ç”¨å¿«é€Ÿåˆå¹¶çš„æ¨¡å¼å°†ç›®æ ‡åˆ†æ”¯åˆå¹¶åˆ°masteråˆ†æ”¯ä¸Šã€‚ $ git merge &lt;ç›®æ ‡åˆ†æ”¯å&gt; æ³¨æ„: å‡å¦‚æˆ‘ä»¬è¦å°†Aåˆ†æ”¯ï¼Œåˆå¹¶åˆ° master åˆ†æ”¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¿…é¡»å…ˆåˆ‡æ¢åˆ°masteråˆ†æ”¯ï¼Œç„¶åå†æ‰§è¡ŒæŠŠAåˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯çš„æ“ä½œã€‚ ä»‹ç»ä¸€ä¸ª git æŒ‡ä»¤ git ls-filesï¼Œè¯¥æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ git ä»“åº“ä¸‹çš„æ–‡ä»¶ã€‚å¦‚æœæƒ³éªŒè¯æ–°å»ºæ–‡ä»¶æ˜¯å¦åˆå¹¶æˆåŠŸï¼Œå¯ä»¥ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚ åˆ é™¤åˆ†æ”¯ åˆ é™¤åˆ†æ”¯çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„ï¼Œè¿™æ¡å‘½ä»¤å¯ä¸æ˜¯ç±»ä¼¼ branch rm äº†ã€‚ $ git branch -d &lt;åˆ†æ”¯å&gt; åˆ†æ”¯ç®¡ç†å°ç»“ å…³äºåˆ†æ”¯ç®¡ç†çš„ä¸€èˆ¬è¿‡ç¨‹ï¼Œæˆ‘åšäº†ä¸€ä¸ª GIFï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º: å¦‚å›¾GIFæ¼”ç¤ºäº†ä»åˆ›å»ºåˆ†æ”¯åˆ°åˆå¹¶åˆ†æ”¯çš„è¿‡ç¨‹ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªåœ†é¥¼ä»£è¡¨ç€ä¸€æ¬¡ commitã€‚ å‚è€ƒ å»–é›ªå³°å¤§ç¥çš„blog ","link":"https://blog.rakuyo.dev/git/"}]}