<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>计算机网络之七 - Socket 编程入门 | Rakuyo&#39;s blog</title>

<link rel="shortcut icon" href="https://blog.rakuyo.dev/favicon.ico?v=1769154921003">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://blog.rakuyo.dev/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/9.12.0/languages//dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
    
        <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.1/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script> 
    
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <a class="navbar-brand" href="/">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            Rakuyo&#39;s blog
        </div>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" id="changeNavbar">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/reference" class="menu gt-a-link">
                    收藏
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/friends" class="menu gt-a-link">
                    友链
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1769154921003"
                action="/search/">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = () => {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>

    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    计算机网络之七 - Socket 编程入门
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2025-08-22 ·
                    </time>
                    
                        <a href="https://blog.rakuyo.dev/tag/ji-suan-ji-wang-luo/" class="post-tags">
                            # 计算机网络
                        </a>
                    
                </div>
                <div class="post-content">
                    <p>在前几篇文章中，我们探讨了 IP、端口、DNS、HTTP、TCP 和 UDP 等网络核心概念与协议。这些协议定义了数据如何在网络中寻址、路由和传输。然而，这些理论知识最终需要通过编程实践来应用。Socket（套接字）便是连接应用层程序与传输层协议（如 TCP/UDP）的桥梁，是进行网络编程的核心接口。本文将深入介绍 Socket 的基本概念、工作原理，并通过代码示例演示如何使用 Socket 进行网络通信。</p>
<!-- more -->
<p>本系列其余几篇的目录：</p>
<ul>
<li><a href="/computer-network-ip-and-port/">计算机网络之一 - IP 与端口</a></li>
<li><a href="/computer-network-url-and-dns/">计算机网络之二 - URL 与 DNS</a></li>
<li><a href="/computer-network-dhcp-and-intranet-penetration/">计算机网络之三 - DHCP 与内网穿透</a></li>
<li><a href="/computer-network-virtual-nic-and-wireguard">计算机网络之四 - 虚拟网卡与 WireGuard</a></li>
<li><a href="/computer-network-http-and-https">计算机网络之五 - HTTP 与 HTTPS</a></li>
<li><a href="/computer-network-tcp-and-udp">计算机网络之六 - 可靠的 TCP 与高效的 UDP</a></li>
</ul>
<h2 id="socket-概述">Socket 概述</h2>
<p>Socket 是一种抽象概念，它封装了网络通信所必需的底层协议细节（如 TCP 或 UDP），为应用程序提供了一套标准的、简单的接口来实现进程间通信。可以将其理解为应用程序与网络协议栈交互的“端点”或“插座”。通过这个“端点”，程序可以像读写文件一样发送和接收数据。</p>
<h3 id="socket-的核心要素">Socket 的核心要素</h3>
<p>一个 Socket 通常由以下几个核心要素定义，它们共同构成了一个唯一的网络通信地址：</p>
<ol>
<li><strong>通信域 (Domain/Family)</strong>：指定了 Socket 所使用的底层协议族。最常见的包括：
<ul>
<li><code>AF_INET</code>：用于 IPv4 网络。</li>
<li><code>AF_INET6</code>：用于 IPv6 网络。</li>
<li><code>AF_UNIX</code>：用于本地进程间通信（同一台机器上的不同进程）。</li>
</ul>
</li>
<li><strong>套接字类型 (Type)</strong>：定义了 Socket 的通信语义。主要类型有：
<ul>
<li><code>SOCK_STREAM</code>：提供面向连接、可靠、有序的字节流服务，通常与 TCP 协议关联。数据像水流一样，无边界地传输。</li>
<li><code>SOCK_DGRAM</code>：提供无连接、不可靠、但高效的数据报服务，通常与 UDP 协议关联。数据以独立的“包裹”（数据报）形式发送。</li>
</ul>
</li>
<li><strong>协议 (Protocol)</strong>：在给定的域和类型下，进一步指定使用的具体协议。大多数情况下，此字段可以设为 0，表示使用默认协议（如 <code>SOCK_STREAM</code> 类型默认使用 TCP，<code>SOCK_DGRAM</code> 类型默认使用 UDP）。</li>
</ol>
<h3 id="socket-与-tcpudp-的关系">Socket 与 TCP/UDP 的关系</h3>
<p>Socket 本身并不是协议，它是一个 API（应用程序编程接口）。它允许应用程序使用 TCP 或 UDP 等传输层协议进行通信。</p>
<ul>
<li><strong>TCP Socket</strong>：当创建一个 <code>SOCK_STREAM</code> 类型的 Socket 时，系统会自动使用 TCP 协议。TCP 的连接建立（三次握手）、可靠传输、流量控制等特性都由操作系统内核的 TCP/IP 协议栈处理，应用程序只需通过 Socket 接口进行读写操作。</li>
<li><strong>UDP Socket</strong>：当创建一个 <code>SOCK_DGRAM</code> 类型的 Socket 时，系统会自动使用 UDP 协议。UDP 的无连接、尽力而为传输特性同样由内核协议栈处理，应用程序通过 Socket 发送和接收独立的数据报。</li>
</ul>
<p>理解 Socket 与 TCP/UDP 的关系，是掌握网络编程的关键。Socket 是操作接口，而 TCP/UDP 是底层的实现协议。</p>
<h2 id="tcp-socket-编程流程">TCP Socket 编程流程</h2>
<p>TCP 是一种面向连接的、可靠的协议。因此，使用 TCP Socket 进行通信前，客户端和服务器需要先建立连接。这个过程通常被称为“三次握手”，在“<a href="/computer-network-tcp-and-udp">可靠的 TCP 与高效的 UDP</a>”一文中已有详细介绍。在编程层面，这个过程体现为服务器端和客户端各自遵循的一套标准操作流程。</p>
<h3 id="服务器端流程">服务器端流程</h3>
<p>服务器端的主要任务是监听来自客户端的连接请求，并与之建立连接，然后进行数据交换。典型的流程如下：</p>
<ol>
<li><strong>创建 Socket</strong>：调用系统调用（如 <code>socket()</code>）创建一个新的 Socket。此时，Socket 还未与任何地址或端口绑定。</li>
<li><strong>绑定地址和端口</strong>：调用 <code>bind()</code> 系统调用，将创建的 Socket 与服务器本机的一个 IP 地址和端口号绑定。这样，客户端才能通过这个地址和端口找到服务器。</li>
<li><strong>监听连接</strong>：调用 <code>listen()</code> 系统调用，使 Socket 进入被动监听状态，等待客户端的连接请求。</li>
<li><strong>接受连接</strong>：调用 <code>accept()</code> 系统调用。该调用会阻塞（暂停）程序执行，直到收到一个客户端的连接请求。收到请求后，<code>accept()</code> 会返回一个<strong>新的 Socket 文件描述符</strong>，这个新的 Socket 专门用于与该客户端进行数据通信。原来的监听 Socket 则继续保持监听状态。</li>
<li><strong>数据交换</strong>：通过 <code>accept()</code> 返回的新 Socket，调用 <code>send()</code> 和 <code>recv()</code>（或 <code>write()</code> 和 <code>read()</code>）等系统调用来发送和接收数据。</li>
<li><strong>关闭连接</strong>：数据交换完成后，通信双方（客户端和服务器）都需要调用 <code>close()</code> 来关闭各自的 Socket，释放相关资源。这个过程涉及到 TCP 的“四次挥手”，同样在前文中有所描述。</li>
</ol>
<h3 id="客户端流程">客户端流程</h3>
<p>客户端的任务是主动发起连接请求，并与服务器进行数据交换。</p>
<ol>
<li><strong>创建 Socket</strong>：与服务器端一样，客户端也需要调用 <code>socket()</code> 创建一个 Socket。</li>
<li><strong>发起连接</strong>：调用 <code>connect()</code> 系统调用，向服务器的指定地址和端口发起连接请求。客户端需要知道服务器的 IP 地址和端口号。</li>
<li><strong>数据交换</strong>：连接建立成功后，客户端就可以调用 <code>send()</code> 和 <code>recv()</code> 等系统调用来发送和接收数据了。注意，客户端通常不需要 <code>bind()</code> 调用，操作系统会自动为其分配一个临时的源端口。</li>
<li><strong>关闭连接</strong>：数据交换完成后，客户端调用 <code>close()</code> 关闭 Socket。</li>
</ol>
<h3 id="tcp-socket-工作流程图">TCP Socket 工作流程图</h3>
<p>下图展示了服务器端和客户端的完整交互流程：</p>
<!--
```mermaid
flowchart LR
    subgraph Server["服务器端"]
        S1["1. socket()"]
        S2["2. bind()"]
        S3["3. listen()"]
        S4["4. accept()"]
        S5["5. 数据交换 (send/recv)"]
        S6["6. close()"]
    end

    subgraph Client["客户端"]
        C1["1. socket()"]
        C2["2. connect()"]
        C3["3. 数据交换 (send/recv)"]
        C4["4. close()"]
    end

    S1 --> S2 --> S3 --> S4
<pre><code>C1 --&gt; C2
C2 -- &quot;连接请求&quot; --&gt; S4
S4 -- &quot;连接建立&quot; --&gt; C3
C3 &lt;--&gt; S5
C4 --&gt; S6
</code></pre>
<pre><code>--&gt;
</code></pre>

                </div>
            </article>
        </div>

        

        

        
            
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
<script>
    // md5.min.js
    !function(n){
        "use strict";
        function d(n,t){var r=(65535&n)+(65535&t);return(n>>16)+(t>>16)+(r>>16)<<16|65535&r}
        function f(n,t,r,e,o,u){return d((c=d(d(t,n),d(e,u)))<<(f=o)|c>>>32-f,r);var c,f}
        function l(n,t,r,e,o,u,c){return f(t&r|~t&e,n,t,o,u,c)}
        function v(n,t,r,e,o,u,c){return f(t&e|r&~e,n,t,o,u,c)}
        function g(n,t,r,e,o,u,c){return f(t^r^e,n,t,o,u,c)}
        function m(n,t,r,e,o,u,c){return f(r^(t|~e),n,t,o,u,c)}
        function i(n,t){var r,e,o,u,c;n[t>>5]|=128<<t%32,n[14+(t+64>>>9<<4)]=t;var f=1732584193,i=-271733879,a=-1732584194,h=271733878;for(r=0;r<n.length;r+=16)f=l(e=f,o=i,u=a,c=h,n[r],7,-680876936),h=l(h,f,i,a,n[r+1],12,-389564586),a=l(a,h,f,i,n[r+2],17,606105819),i=l(i,a,h,f,n[r+3],22,-1044525330),f=l(f,i,a,h,n[r+4],7,-176418897),h=l(h,f,i,a,n[r+5],12,1200080426),a=l(a,h,f,i,n[r+6],17,-1473231341),i=l(i,a,h,f,n[r+7],22,-45705983),f=l(f,i,a,h,n[r+8],7,1770035416),h=l(h,f,i,a,n[r+9],12,-1958414417),a=l(a,h,f,i,n[r+10],17,-42063),i=l(i,a,h,f,n[r+11],22,-1990404162),f=l(f,i,a,h,n[r+12],7,1804603682),h=l(h,f,i,a,n[r+13],12,-40341101),a=l(a,h,f,i,n[r+14],17,-1502002290),f=v(f,i=l(i,a,h,f,n[r+15],22,1236535329),a,h,n[r+1],5,-165796510),h=v(h,f,i,a,n[r+6],9,-1069501632),a=v(a,h,f,i,n[r+11],14,643717713),i=v(i,a,h,f,n[r],20,-373897302),f=v(f,i,a,h,n[r+5],5,-701558691),h=v(h,f,i,a,n[r+10],9,38016083),a=v(a,h,f,i,n[r+15],14,-660478335),i=v(i,a,h,f,n[r+4],20,-405537848),f=v(f,i,a,h,n[r+9],5,568446438),h=v(h,f,i,a,n[r+14],9,-1019803690),a=v(a,h,f,i,n[r+3],14,-187363961),i=v(i,a,h,f,n[r+8],20,1163531501),f=v(f,i,a,h,n[r+13],5,-1444681467),h=v(h,f,i,a,n[r+2],9,-51403784),a=v(a,h,f,i,n[r+7],14,1735328473),f=g(f,i=v(i,a,h,f,n[r+12],20,-1926607734),a,h,n[r+5],4,-378558),h=g(h,f,i,a,n[r+8],11,-2022574463),a=g(a,h,f,i,n[r+11],16,1839030562),i=g(i,a,h,f,n[r+14],23,-35309556),f=g(f,i,a,h,n[r+1],4,-1530992060),h=g(h,f,i,a,n[r+4],11,1272893353),a=g(a,h,f,i,n[r+7],16,-155497632),i=g(i,a,h,f,n[r+10],23,-1094730640),f=g(f,i,a,h,n[r+13],4,681279174),h=g(h,f,i,a,n[r],11,-358537222),a=g(a,h,f,i,n[r+3],16,-722521979),i=g(i,a,h,f,n[r+6],23,76029189),f=g(f,i,a,h,n[r+9],4,-640364487),h=g(h,f,i,a,n[r+12],11,-421815835),a=g(a,h,f,i,n[r+15],16,530742520),f=m(f,i=g(i,a,h,f,n[r+2],23,-995338651),a,h,n[r],6,-198630844),h=m(h,f,i,a,n[r+7],10,1126891415),a=m(a,h,f,i,n[r+14],15,-1416354905),i=m(i,a,h,f,n[r+5],21,-57434055),f=m(f,i,a,h,n[r+12],6,1700485571),h=m(h,f,i,a,n[r+3],10,-1894986606),a=m(a,h,f,i,n[r+10],15,-1051523),i=m(i,a,h,f,n[r+1],21,-2054922799),f=m(f,i,a,h,n[r+8],6,1873313359),h=m(h,f,i,a,n[r+15],10,-30611744),a=m(a,h,f,i,n[r+6],15,-1560198380),i=m(i,a,h,f,n[r+13],21,1309151649),f=m(f,i,a,h,n[r+4],6,-145523070),h=m(h,f,i,a,n[r+11],10,-1120210379),a=m(a,h,f,i,n[r+2],15,718787259),i=m(i,a,h,f,n[r+9],21,-343485551),f=d(f,e),i=d(i,o),a=d(a,u),h=d(h,c);return[f,i,a,h]}
        function a(n){var t,r="",e=32*n.length;for(t=0;t<e;t+=8)r+=String.fromCharCode(n[t>>5]>>>t%32&255);return r}
        function h(n){var t,r=[];for(r[(n.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var e=8*n.length;for(t=0;t<e;t+=8)r[t>>5]|=(255&n.charCodeAt(t/8))<<t%32;return r}
        function e(n){var t,r,e="0123456789abcdef",o="";for(r=0;r<n.length;r+=1)t=n.charCodeAt(r),o+=e.charAt(t>>>4&15)+e.charAt(15&t);return o}
        function r(n){return unescape(encodeURIComponent(n))}
        function o(n){return a(i(h(t=r(n)),8*t.length));var t}
        function u(n,t){return function(n,t){var r,e,o=h(n),u=[],c=[];for(u[15]=c[15]=void 0,16<o.length&&(o=i(o,8*n.length)),r=0;r<16;r+=1)u[r]=909522486^o[r],c[r]=1549556828^o[r];return e=i(u.concat(h(t)),512+8*t.length),a(i(c.concat(e),640))}(r(n),r(t))}
        function t(n,t,r){return t?r?u(t,n):e(u(t,n)):r?o(n):e(o(n))}
        "function"==typeof define&&define.amd?define(function(){return t}):"object"==typeof module&&module.exports?module.exports=t:n.md5=t;
    }(this);
</script>


<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '30875151c07a20ceb163',
    clientSecret: '9a57fd47038f45827326ab5b0ab8c796f184a46f',
    repo: 'rakuyomo.github.io',
    owner: 'rakuyoMo',
    admin: ['rakuyoMo'],
    id: md5(location.pathname),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false       // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

            

            
        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first"></div>
    <div class="social-container">
        
            
                <a href="https://github.com/rakuyoMo" target="_blank">
                    <i class="fab fa-github gt-c-content-color-first"></i>
                </a>
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        无常为常，变化即永恒
    </div>
    <div>
        Theme <a href="https://github.com/rakuyoMo/gridea-theme-pure" target="_blank">Pure</a>, Powered by <a
                href="https://gridea.dev" target="_blank">Gridea</a> | <a href="https://blog.rakuyo.dev/atom.xml" target="_blank">RSS</a>
    </div>
</div>

<script>
  hljs.highlightAll()
</script>

    </div>
</div>
</body>
</html>
